---
phase: 14-unified-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/navigation/navConfig.ts
  - src/components/navigation/useMediaTier.ts
  - src/components/navigation/useNavBadges.ts
  - src/components/navigation/NavBadge.tsx
  - src/components/navigation/NavItem.tsx
  - src/components/navigation/NavigationProvider.tsx
  - src/styles/globals.css
autonomous: true

must_haves:
  truths:
    - "Nav tab configuration defines exactly 6 tabs (Home, Study Guide, Mock Test, Interview, Progress Hub, Settings) with correct routes"
    - "Media tier hook correctly detects mobile (<768px), tablet (768-1279px), and desktop (>=1280px)"
    - "Badge data hook provides SRS due count, hub update status, and SW update status"
    - "NavigationProvider context exposes sidebar state, tier, lock state, scroll visibility, and badge data"
  artifacts:
    - path: "src/components/navigation/navConfig.ts"
      provides: "Tab config array, slide direction helper, utility control definitions"
      exports: ["NAV_TABS", "UTILITY_CONTROLS", "getSlideDirection", "NavTab", "HIDDEN_ROUTES"]
    - path: "src/components/navigation/useMediaTier.ts"
      provides: "Responsive tier detection hook"
      exports: ["useMediaTier", "MediaTier"]
    - path: "src/components/navigation/useNavBadges.ts"
      provides: "Aggregated badge data hook"
      exports: ["useNavBadges", "NavBadges"]
    - path: "src/components/navigation/NavBadge.tsx"
      provides: "Badge component with spring entrance animation"
      exports: ["NavBadge"]
    - path: "src/components/navigation/NavItem.tsx"
      provides: "Shared nav item with badge, active state, animations"
      exports: ["NavItem"]
    - path: "src/components/navigation/NavigationProvider.tsx"
      provides: "Navigation context provider"
      exports: ["NavigationProvider", "useNavigation"]
  key_links:
    - from: "src/components/navigation/NavigationProvider.tsx"
      to: "src/components/navigation/useMediaTier.ts"
      via: "hook call inside provider"
      pattern: "useMediaTier\\(\\)"
    - from: "src/components/navigation/NavigationProvider.tsx"
      to: "src/components/navigation/useNavBadges.ts"
      via: "hook call inside provider"
      pattern: "useNavBadges\\(\\)"
    - from: "src/components/navigation/NavItem.tsx"
      to: "src/components/navigation/NavBadge.tsx"
      via: "component import"
      pattern: "import.*NavBadge"
---

<objective>
Create the navigation foundation: shared config, hooks, reusable components, context provider, and glass-morphism CSS. This establishes the single source of truth for the entire unified navigation system.

Purpose: Every subsequent plan depends on these building blocks -- tab definitions, responsive tier detection, badge data, shared item rendering, and the central navigation context.
Output: 6 new files in src/components/navigation/ + glass-nav CSS class in globals.css
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-unified-navigation/14-CONTEXT.md
@.planning/phases/14-unified-navigation/14-RESEARCH.md
@src/components/navigation/BottomTabBar.tsx
@src/components/AppNavigation.tsx
@src/lib/useScrollDirection.ts
@src/contexts/SRSContext.tsx
@src/styles/globals.css
@src/lib/i18n/strings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create navConfig, useMediaTier, useNavBadges, and glass-nav CSS</name>
  <files>
    src/components/navigation/navConfig.ts
    src/components/navigation/useMediaTier.ts
    src/components/navigation/useNavBadges.ts
    src/styles/globals.css
  </files>
  <action>
**navConfig.ts** -- Single source of truth for all nav tabs and utility controls.

Create `NavTab` interface with: `id`, `href`, `label` (string -- primary language only per user decision), `labelMy` (string -- Burmese), `icon` (LucideIcon), `order` (number for slide direction), `badgeKey` (optional keyof NavBadges), `dataTour` (optional string).

Define `NAV_TABS` array with exactly 6 tabs per user decision:
1. `{ id: 'home', href: '/home', label: 'Home', labelMy: 'ပင်မ', icon: Home, order: 0 }`
2. `{ id: 'study', href: '/study', label: 'Study Guide', labelMy: 'လေ့လာမှုအညွှန်း', icon: BookOpen, order: 1, badgeKey: 'studyDueCount', dataTour: 'nav-study' }`
3. `{ id: 'test', href: '/test', label: 'Mock Test', labelMy: 'စမ်းသပ်စာမေးပွဲ', icon: ClipboardCheck, order: 2, dataTour: 'nav-test' }`
4. `{ id: 'interview', href: '/interview', label: 'Interview', labelMy: 'အင်တာဗျူး', icon: Mic, order: 3, dataTour: 'nav-interview' }`
5. `{ id: 'hub', href: '/hub', label: 'Progress Hub', labelMy: 'တိုးတက်မှု', icon: BarChart3, order: 4, badgeKey: 'hubHasUpdate', dataTour: 'nav-hub' }`
6. `{ id: 'settings', href: '/settings', label: 'Settings', labelMy: 'ဆက်တင်များ', icon: Settings, order: 5, badgeKey: 'settingsHasUpdate' }`

Note: Labels are primary-language-only per locked decision. `labelMy` is stored but only used when showBurmese is true (single line, not bilingual stacking).

Define `HIDDEN_ROUTES` array: `['/', '/auth', '/auth/forgot', '/auth/update-password', '/op-ed']` -- routes where nav is hidden.

Define `getSlideDirection(from: string, to: string): 'left' | 'right'` using tab order comparison. Higher order = slide left, lower = slide right. Return 'right' for unknown routes.

Export `NavBadges` interface: `{ studyDueCount: number; hubHasUpdate: boolean; settingsHasUpdate: boolean; }`.

Import icons from lucide-react: Home, BookOpen, ClipboardCheck, Mic, BarChart3, Settings.

**useMediaTier.ts** -- Responsive breakpoint detection hook.

Export `MediaTier` type: `'mobile' | 'tablet' | 'desktop'`.

Implement `useMediaTier()` hook:
- Use `useState` with lazy initializer that checks `window.innerWidth` (guard for SSR with `typeof window === 'undefined'` returning 'mobile').
- Use `useEffect` to create two `matchMedia` queries: `(min-width: 768px)` and `(min-width: 1280px)`.
- The matchMedia change callbacks call setState (this is an event handler, not direct effect body setState, so it's React Compiler safe).
- Cleanup: remove event listeners.
- Return the tier.

**useNavBadges.ts** -- Aggregated badge data hook.

Import `useSRS` from `@/contexts/SRSContext` to get `dueCount`.
Return `NavBadges` object:
- `studyDueCount`: from `useSRS().dueCount`
- `hubHasUpdate`: false initially (will be wired to achievement/streak data in Phase 15)
- `settingsHasUpdate`: check for SW update via `navigator.serviceWorker?.getRegistration()` -- use a simple state that checks for `registration.waiting` on mount and on visibilitychange. Keep it lightweight.

**globals.css** -- Add glass-nav component class.

Add inside `@layer components { }` block (after existing component classes):
```css
.glass-nav {
  background: hsl(var(--color-surface) / 0.75);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  background-image: linear-gradient(
    to bottom,
    hsl(var(--color-surface) / 0.85),
    hsl(var(--color-surface) / 0.65)
  );
  box-shadow: 4px 0 24px -4px hsl(var(--color-overlay) / 0.12);
}

.dark .glass-nav {
  box-shadow:
    4px 0 24px -4px hsl(var(--color-overlay) / 0.3),
    inset 0 0 0 1px hsl(0 0% 100% / 0.12);
}
```

Check existing CSS variables in tokens.css/globals.css -- use `--color-surface`, `--color-overlay` if they exist, otherwise use the closest semantic tokens (likely `--color-card` or `--color-background`). The glass effect should be translucent with backdrop-blur per user decision (always enabled, no reduced-motion fallback for blur per locked decision).
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm all 3 new TS files type-check. Verify no ESLint errors: `npx eslint src/components/navigation/navConfig.ts src/components/navigation/useMediaTier.ts src/components/navigation/useNavBadges.ts --max-warnings 0`.
  </verify>
  <done>
navConfig.ts exports 6-tab array with correct routes/labels/icons, getSlideDirection helper, HIDDEN_ROUTES, and NavBadges interface. useMediaTier correctly returns 'mobile'/'tablet'/'desktop'. useNavBadges returns badge data with SRS due count. glass-nav CSS class exists in globals.css with backdrop-blur and gradient.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create NavBadge, NavItem, and NavigationProvider</name>
  <files>
    src/components/navigation/NavBadge.tsx
    src/components/navigation/NavItem.tsx
    src/components/navigation/NavigationProvider.tsx
  </files>
  <action>
**NavBadge.tsx** -- Badge component with spring entrance animation.

Props: `{ type: 'count' | 'dot'; count?: number; color?: 'warning' | 'primary'; visible?: boolean }`.

Use `AnimatePresence` from motion/react. Show the badge when `visible` is true (or when count > 0 for 'count' type).

For 'count' type: orange/warning color, min-width 18px, height 18px, rounded-full, text-[10px] font-bold. Display `count > 99 ? '99+' : count`. Cap per user decision.

For 'dot' type: accent/primary color, h-2.5 w-2.5 rounded-full. No text.

Badge entrance: motion.span with `initial={{ scale: 0, opacity: 0 }}`, `animate={{ scale: 1, opacity: 1 }}`, spring transition (stiffness: 500, damping: 25). Use `key` prop to trigger re-entrance on count change for 'count' type.

Position: `absolute -top-1 -right-1` (parent must be `relative`).

**NavItem.tsx** -- Shared nav item component used by both Sidebar and BottomTabBar.

Props: `{ tab: NavTab; isActive: boolean; isLocked: boolean; showBurmese: boolean; variant: 'mobile' | 'sidebar-expanded' | 'sidebar-collapsed'; badges: NavBadges; onLockedTap?: () => void; onClick?: () => void }`.

Renders:
- A wrapper element (Link when not locked, button when locked).
- `href`: `tab.href` (uses react-router-dom Link).
- Icon: h-6 w-6 (24px per user decision, up from h-4 w-4). Active state: `text-primary` with strokeWidth 2.5. Inactive: `text-muted-foreground` with strokeWidth 2. Use filled icon variant when active if available (per iOS convention locked decision).
- Label: Show `tab.label` when not showBurmese, `tab.labelMy` when showBurmese. Primary language only (not bilingual stacking). Mobile: text-xs (12px per user decision). Sidebar-expanded: text-sm. Sidebar-collapsed: hidden.
- Active state: pill shape (rounded-full) with `bg-primary/20 shadow-sm shadow-primary/15` per user decision.
- Hover (desktop): `hover:bg-primary/10` + slight scale-up (1.02) per user decision.
- Tap animation: motion.div with `whileTap={{ scale: 0.92 }}` then spring bounce back (spring physics per user decision).
- Badge: Render NavBadge if `tab.badgeKey` exists and the corresponding badge value is truthy. For 'studyDueCount': type='count', count=badges.studyDueCount, color='warning'. For 'hubHasUpdate': type='dot', color='primary'. For 'settingsHasUpdate': type='dot', color='primary'.
- Locked state: `opacity-60 cursor-not-allowed` per user decision. onClick calls onLockedTap instead of navigating.
- `data-tour` attribute: set to `tab.dataTour` if defined.

Variant differences:
- `mobile`: vertical flex-col, min-w-[60px], min-h-[56px], text-xs labels.
- `sidebar-expanded`: horizontal flex-row, gap-3, py-2.5 px-3, text-sm labels, rounded-full active bg.
- `sidebar-collapsed`: icon-only, centered, w-12 h-12, tooltip via CSS `[data-tooltip]::after` pseudo-element on hover (show tab.label). Position the tooltip to the right of the icon.

**NavigationProvider.tsx** -- Central context for navigation state.

Context value interface:
```typescript
interface NavigationContextValue {
  isExpanded: boolean;
  setExpanded: (expanded: boolean) => void;
  toggleSidebar: () => void;
  tier: MediaTier;
  isLocked: boolean;
  lockMessage: string | null;
  setLock: (locked: boolean, message?: string) => void;
  navVisible: boolean;
  badges: NavBadges;
}
```

Inside the provider:
- Call `useMediaTier()` for tier.
- Call `useNavBadges()` for badges.
- Call `useScrollDirection()` for navVisible.
- `isExpanded` state: default based on tier ('desktop' = true, 'tablet'/'mobile' = false). Persist to localStorage under key `sidebar-expanded` (Claude's discretion decision). On tier change, auto-adjust: if tier becomes 'desktop', expand; if becomes 'tablet' or 'mobile', collapse. But respect manual override: if user manually collapsed on desktop, keep collapsed until tier changes.
- `isLocked` + `lockMessage` state: controlled via `setLock()`. Pages call setLock(true, message) when test/interview starts, setLock(false) when done.
- Click-outside handler for sidebar: When expanded on tablet tier and user clicks outside sidebar, collapse. Don't auto-collapse on desktop tier (per research recommendation). Export a `sidebarRef` via context or use a callback ref pattern for the sidebar element.

Wrap context value in useMemo to prevent unnecessary re-renders. Export `useNavigation()` hook with helpful error if used outside provider.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm all 3 files type-check. Run `npx eslint src/components/navigation/NavBadge.tsx src/components/navigation/NavItem.tsx src/components/navigation/NavigationProvider.tsx --max-warnings 0`.
  </verify>
  <done>
NavBadge renders count (warning, capped at 99+) and dot (primary) badges with spring entrance animation. NavItem renders tabs for all 3 variants (mobile, sidebar-expanded, sidebar-collapsed) with correct active states, icon sizes (h-6 w-6), tap animations, lock behavior, and data-tour attributes. NavigationProvider centralizes tier, lock, sidebar expansion, scroll visibility, and badge state with proper memoization and click-outside handling.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npx eslint src/components/navigation/ --max-warnings 0` passes
- NAV_TABS array has exactly 6 entries with correct hrefs: /home, /study, /test, /interview, /hub, /settings
- getSlideDirection('/home', '/settings') returns 'left'; getSlideDirection('/settings', '/home') returns 'right'
- glass-nav CSS class exists in globals.css with backdrop-blur and gradient
</verification>

<success_criteria>
All 6 new navigation utility files compile and lint cleanly. The nav foundation is ready for Sidebar (plan 02) and BottomTabBar refactor (plan 03) to consume.
</success_criteria>

<output>
After completion, create `.planning/phases/14-unified-navigation/14-01-SUMMARY.md`
</output>
