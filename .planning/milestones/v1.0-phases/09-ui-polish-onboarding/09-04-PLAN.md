---
phase: 09-ui-polish-onboarding
plan: 04
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/onboarding/OnboardingTour.tsx
  - src/components/onboarding/WelcomeScreen.tsx
  - src/components/onboarding/TourTooltip.tsx
  - src/hooks/useOnboarding.ts
  - src/pages/Dashboard.tsx
  - src/pages/SettingsPage.tsx
  - src/AppShell.tsx
autonomous: true

must_haves:
  truths:
    - "First-time users see a CSS-only American flag welcome screen before the tour starts"
    - "Welcome screen is full bilingual (English + Burmese)"
    - "Welcome auto-transitions to tour after 2 seconds (no button)"
    - "Tour has 7 steps including SRS deck review and Interview simulation"
    - "All tour steps stay on Dashboard (single-page, no auto-navigation)"
    - "Spotlight overlay with smooth transitions between steps"
    - "Skip button is always visible at every step"
    - "Final step shows motivational bilingual close message"
    - "Settings page has a Replay onboarding tour button that triggers forceRun"
    - "Tour is mounted in AppShell and runs on Dashboard for first-time users"
  artifacts:
    - path: "src/components/onboarding/WelcomeScreen.tsx"
      provides: "CSS-only flag motif welcome modal with bilingual text and 2s auto-transition"
      min_lines: 30
    - path: "src/components/onboarding/TourTooltip.tsx"
      provides: "Custom react-joyride tooltip with Duolingo styling and progress dots"
      min_lines: 40
    - path: "src/components/onboarding/OnboardingTour.tsx"
      provides: "Enhanced tour with 7 steps, welcome screen integration, custom tooltip"
      contains: "WelcomeScreen"
    - path: "src/AppShell.tsx"
      provides: "OnboardingTour mounted inside Router"
      contains: "OnboardingTour"
  key_links:
    - from: "src/components/onboarding/OnboardingTour.tsx"
      to: "src/components/onboarding/WelcomeScreen.tsx"
      via: "Welcome renders first, then sets Joyride run=true"
      pattern: "setRun.*true"
    - from: "src/components/onboarding/OnboardingTour.tsx"
      to: "src/pages/Dashboard.tsx"
      via: "data-tour attributes on Dashboard widgets"
      pattern: "data-tour"
    - from: "src/pages/SettingsPage.tsx"
      to: "src/components/onboarding/OnboardingTour.tsx"
      via: "forceRun prop triggers tour replay"
      pattern: "forceRun"
---

<objective>
Enhance the orphaned OnboardingTour component with a CSS-only American flag welcome screen, 2 new tour steps (SRS + Interview), custom Duolingo-styled tooltip, and mount it in AppShell. Add Settings page replay button.

Purpose: First-time users get a guided onboarding experience that introduces all key features with a welcoming patriotic feel.
Output: WelcomeScreen.tsx, TourTooltip.tsx, enhanced OnboardingTour.tsx mounted in AppShell, Settings replay button.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-ui-polish-onboarding/09-RESEARCH.md
@.planning/phases/09-ui-polish-onboarding/09-01-SUMMARY.md

@src/components/onboarding/OnboardingTour.tsx
@src/hooks/useOnboarding.ts
@src/pages/Dashboard.tsx
@src/pages/SettingsPage.tsx
@src/AppShell.tsx
</context>

<instructions>
Use the /frontend-design skill for all UI design and implementation work in this phase. This is a locked user decision.
</instructions>

<tasks>

<task type="auto">
  <name>Task 1: Create WelcomeScreen and TourTooltip Components</name>
  <files>src/components/onboarding/WelcomeScreen.tsx, src/components/onboarding/TourTooltip.tsx</files>
  <action>
**WelcomeScreen.tsx:**
Create a centered modal welcome screen (Step 0 before tour):
- Full-screen overlay with `fixed inset-0 z-[1001] flex items-center justify-center bg-background/95 backdrop-blur-sm`
- Z-index 1001 (above Joyride's z-1000 overlay)
- CSS-only American flag motif using gradients and shapes:
  - Red/white stripes via `repeating-linear-gradient(180deg, hsl(0 72% 51%) 0px, hsl(0 72% 51%) 6px, white 6px, white 12px)`
  - Blue canton with star character using `&#9734;`
  - Rounded corners, shadow for polish
- Full bilingual welcome text:
  - English: "Welcome to Civic Test Prep!" (h1, font-extrabold)
  - Burmese: equivalent welcome in font-myanmar class
  - Subtitle encouraging message in both languages
- Patriotic emojis: eagle, US flag, liberty torch
- Auto-transition after 2 seconds via `useEffect` with `setTimeout(onComplete, 2000)` (no button CTA per locked decision)
- Wrap in `motion.div` from motion/react with fade-in animation: `initial={{ opacity: 0, scale: 0.95 }}` -> `animate={{ opacity: 1, scale: 1 }}`
- Exit animation via AnimatePresence in parent
- Props: `onComplete: () => void`

**TourTooltip.tsx:**
Create custom react-joyride tooltip component with Duolingo aesthetic:
- Accept `TooltipRenderProps` from react-joyride (continuous, index, isLastStep, size, step, backProps, primaryProps, skipProps, tooltipProps)
- MUST spread `{...tooltipProps}` on root element (includes required ref)
- Styling: `bg-card rounded-2xl shadow-2xl p-5 max-w-sm border border-border/60`
- Progress dots: Array of size dots, active dots wider (`w-6`) and colored (`bg-primary-500`), inactive narrow (`w-3`) and muted
- Step content: render `step.content` inside a div
- Navigation buttons:
  - Skip button always visible (left side): `{...skipProps}`, styled as subtle text link
  - Back button (index > 0): `{...backProps}`, rounded-full, subtle style
  - Next/Finish button: `{...primaryProps}`, 3D chunky style with `shadow-[0_3px_0_hsl(224,76%,48%)]` and `active:translate-y-[2px]`
  - Final step button says "Finish" with celebratory tone
- Smooth entry animation: wrap in `motion.div` with `initial={{ opacity: 0, y: 10 }}` -> `animate={{ opacity: 1, y: 0 }}`
  </action>
  <verify>Run `npx tsc --noEmit` to verify both components compile. Verify WelcomeScreen has no button elements (auto-transition only). Verify TourTooltip spreads tooltipProps.</verify>
  <done>WelcomeScreen renders CSS-only flag motif with bilingual text and 2s auto-transition. TourTooltip renders Duolingo-styled custom tooltip with progress dots, skip button, and 3D chunky next button.</done>
</task>

<task type="auto">
  <name>Task 2: Enhance OnboardingTour, Add data-tour Targets, Mount in AppShell, Add Settings Replay</name>
  <files>src/components/onboarding/OnboardingTour.tsx, src/pages/Dashboard.tsx, src/AppShell.tsx, src/pages/SettingsPage.tsx</files>
  <action>
**OnboardingTour.tsx - Major Enhancement:**
- Import WelcomeScreen and TourTooltip
- Add state: `showWelcome` (boolean, initially true if tour should show)
- Flow: WelcomeScreen renders first -> after 2s calls `onComplete` -> sets `showWelcome=false` and `run=true` for Joyride
- IMPORTANT: Do NOT set Joyride `run={true}` while welcome is showing (pitfall from research)
- Update tour steps to 7 total (add 2 new steps for SRS and Interview):
  1. `[data-tour="dashboard"]` - Dashboard welcome (existing, update copy)
  2. `[data-tour="study-guide"]` - Study with flashcards (existing)
  3. `[data-tour="mock-test"]` - Practice tests (existing)
  4. `[data-tour="srs-deck"]` - SRS Deck Review (NEW): "Review cards that are due! Our smart system tracks which questions you need to practice most." + Burmese
  5. `[data-tour="interview-sim"]` - Interview Simulation (NEW): "Practice answering questions out loud, just like the real USCIS interview!" + Burmese
  6. `[data-tour="theme-toggle"]` - Customize experience (existing)
  7. `body` (center) - Motivational close message: "You're ready to begin your citizenship journey! Every question brings you closer. We believe in you!" + Burmese equivalent + patriotic emojis (eagle, flag, sparkles)
- Set `tooltipComponent={TourTooltip}` on Joyride
- Set `spotlightClicks={true}` for spotlight overlay style
- All steps use `disableBeacon: true` for clean spotlight transitions
- Remove the inline `styles` prop (tooltip styling now handled by TourTooltip)
- Keep `showSkipButton` and bilingual locale strings

**Dashboard.tsx - Add data-tour targets:**
- Find the SRSWidget component render and add `data-tour="srs-deck"` attribute to its wrapping div (or add a wrapper div if needed)
- Find the InterviewDashboardWidget component render and add `data-tour="interview-sim"` attribute
- These MUST exist on Dashboard for the tour steps to find their targets

**AppShell.tsx - Mount OnboardingTour:**
- Import OnboardingTour from `@/components/onboarding/OnboardingTour`
- Mount inside `<Router>` after `<PWAOnboardingFlow />`:
  ```tsx
  <PWAOnboardingFlow />
  <SyncStatusIndicator />
  <OnboardingTour />
  ```
- Tour trigger on first visit to Dashboard (the useOnboarding hook already checks localStorage)

**SettingsPage.tsx - Add Replay Button:**
- Add state: `const [replayTour, setReplayTour] = useState(false)`
- Add a "Replay Onboarding Tour" button/card in Settings (after sound effects section):
  - Bilingual label: "Replay Onboarding Tour" / Burmese equivalent
  - Icon: HelpCircle or Compass from lucide-react
  - On click: clear localStorage key `civic-test-onboarding-complete`, then navigate to `/dashboard` (tour will auto-trigger since localStorage key is cleared)
  - OR: set a state that renders `<OnboardingTour forceRun />` directly on the Settings page -- but since tour targets are on Dashboard, navigating to Dashboard is better
- Style consistently with other Settings sections
  </action>
  <verify>Run `npx tsc --noEmit`. Verify Dashboard.tsx has `data-tour="srs-deck"` and `data-tour="interview-sim"` attributes. Verify AppShell imports OnboardingTour. Verify SettingsPage has replay button.</verify>
  <done>OnboardingTour has 7 steps with welcome screen, custom tooltip, spotlight overlay. Dashboard has data-tour targets for SRS and Interview widgets. Tour is mounted in AppShell. Settings has replay button that clears localStorage and navigates to Dashboard.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- OnboardingTour.tsx has 7 tour steps
- WelcomeScreen has CSS-only flag (no external images, no img tags)
- Dashboard.tsx has `data-tour="srs-deck"` and `data-tour="interview-sim"`
- AppShell.tsx imports and mounts OnboardingTour
- SettingsPage.tsx has replay tour button
- TourTooltip spreads tooltipProps on root element
</verification>

<success_criteria>
First-time users see welcome screen -> 7-step spotlight tour on Dashboard -> motivational close. Settings page can replay the tour. All tour targets exist on Dashboard.
</success_criteria>

<output>
After completion, create `.planning/phases/09-ui-polish-onboarding/09-04-SUMMARY.md`
</output>
