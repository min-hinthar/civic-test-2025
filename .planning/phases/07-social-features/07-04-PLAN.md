---
phase: 07-social-features
plan: 04
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/components/social/BadgeCelebration.tsx
  - src/components/social/BadgeGrid.tsx
  - src/components/social/StreakHeatmap.tsx
  - src/hooks/useBadges.ts
autonomous: true

must_haves:
  truths:
    - "Badge earned triggers celebration modal with confetti and bilingual message"
    - "Badge grid shows all badges with earned (gold) and locked (gray) states"
    - "Locked badges display requirement text in both languages"
    - "Calendar heatmap shows daily activity with warm color gradient"
    - "Freeze days are visually distinct on heatmap (snowflake/ice color)"
  artifacts:
    - path: "src/components/social/BadgeCelebration.tsx"
      provides: "Badge celebration modal"
      exports: ["BadgeCelebration"]
    - path: "src/components/social/BadgeGrid.tsx"
      provides: "Full badge collection grid"
      exports: ["BadgeGrid"]
    - path: "src/components/social/StreakHeatmap.tsx"
      provides: "Activity calendar heatmap"
      exports: ["StreakHeatmap"]
    - path: "src/hooks/useBadges.ts"
      provides: "Badge state and celebration hook"
      exports: ["useBadges"]
  key_links:
    - from: "src/hooks/useBadges.ts"
      to: "src/lib/social/badgeEngine.ts"
      via: "evaluates badges against current data"
      pattern: "getNewlyEarnedBadge|evaluateBadges"
    - from: "src/components/social/BadgeCelebration.tsx"
      to: "src/components/celebrations/Confetti.tsx"
      via: "reuses confetti effect"
      pattern: "Confetti"
    - from: "src/components/social/StreakHeatmap.tsx"
      to: "src/components/srs/ReviewHeatmap.tsx"
      via: "follows same CSS Grid + Tailwind pattern"
      pattern: "grid.*gap"
---

<objective>
Create the badge celebration modal, full badge grid, streak activity heatmap, and the useBadges hook that detects newly earned badges.

Purpose: These UI components power the Badges and Streak tabs in the Social Hub (Plan 07) and provide the celebration experience when users earn new badges. They are self-contained components with no page-level dependencies, enabling parallel development.
Output: Badge celebration modal with confetti, badge collection grid (earned + locked), and streak calendar heatmap with freeze day markers.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/07-social-features/07-RESEARCH.md
@.planning/phases/07-social-features/07-01-SUMMARY.md
@src/components/progress/MasteryMilestone.tsx (celebration modal pattern)
@src/components/celebrations/Confetti.tsx (confetti reuse)
@src/components/srs/ReviewHeatmap.tsx (heatmap pattern)
@src/lib/social/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: useBadges hook and BadgeCelebration modal</name>
  <files>
    src/hooks/useBadges.ts
    src/components/social/BadgeCelebration.tsx
  </files>
  <action>
    Create `src/hooks/useBadges.ts`:

    1. Hook `useBadges(badgeCheckData: BadgeCheckData | null)` — Takes current user stats (streak, accuracy, coverage data).
    2. Loads earned badges from `getEarnedBadges()` and shown badges from `getShownBadgeIds()` (badgeStore).
    3. Uses `useMemo` to derive `earnedBadges` (all currently earned badge definitions), `lockedBadges` (not yet earned), and `newlyEarnedBadge` (earned but not shown — for celebration).
    4. `dismissCelebration(badgeId: string)` — Calls `markBadgeShown(badgeId)` and `markBadgeEarned(badgeId)`, then refreshes state.
    5. Returns `{ earnedBadges: BadgeDefinition[]; lockedBadges: BadgeDefinition[]; newlyEarnedBadge: BadgeDefinition | null; dismissCelebration: (id: string) => void; isLoading: boolean }`.
    6. Follow React Compiler patterns: use useMemo for derived badge state, no setState in effects except for initial data load (use the cancellation pattern from Dashboard.tsx).
    7. When `badgeCheckData` is null (still loading), skip evaluation and return empty state.

    Create `src/components/social/BadgeCelebration.tsx`:

    1. Modal dialog following MasteryMilestone pattern — uses Radix Dialog from `@/components/ui/Dialog`.
    2. Props: `badge: BadgeDefinition | null; onDismiss: () => void`.
    3. When `badge` is not null, modal opens showing:
       - Confetti effect (reuse `<Confetti />` from celebrations).
       - Badge icon rendered large (64px) in a gold circular container.
       - Badge name (bilingual) in large text.
       - Badge description (bilingual).
       - Congratulatory message: "Badge Earned!" / "တံဆိပ်ရရှိပြီ!" bilingual heading.
       - Dismiss button: "Continue" / "ဆက်လုပ်ပါ".
    4. Animation: Use motion/react for badge icon scale-in (spring: stiffness 400, damping 17) matching existing component animation settings.
    5. Auto-dismiss after 8 seconds (setTimeout, cleared on unmount or manual dismiss).
    6. Use `useLanguage()` for bilingual display.
    7. Badge icon: dynamically render the lucide icon based on `badge.icon` string. Create a small icon map: `{ Flame, Target, Star, BookCheck, Award }` from lucide-react, lookup by string.
  </action>
  <verify>TypeScript compiles. BadgeCelebration renders with confetti when badge prop is provided. useBadges hook returns correct earned/locked/newly-earned state.</verify>
  <done>Badge celebration modal displays with confetti animation and bilingual congrats. useBadges hook detects newly earned badges from current user stats.</done>
</task>

<task type="auto">
  <name>Task 2: BadgeGrid and StreakHeatmap components</name>
  <files>
    src/components/social/BadgeGrid.tsx
    src/components/social/StreakHeatmap.tsx
  </files>
  <action>
    Create `src/components/social/BadgeGrid.tsx`:

    1. Props: `earnedBadges: BadgeDefinition[]; lockedBadges: BadgeDefinition[]; className?: string`.
    2. Responsive grid layout: 2 columns on mobile, 3 on md, 4 on lg.
    3. Each badge card shows:
       - Circular icon container: gold background (bg-amber-100 dark:bg-amber-900/30) for earned, gray (bg-muted) for locked.
       - Icon rendered from lucide-react icon map (same as BadgeCelebration).
       - Badge name (bilingual, from `badge.name`).
       - For earned: description text + earned date.
       - For locked: requirement text (bilingual, from `badge.requirement`) in muted color. Text like "Get 90% on a test" / "စမ်းသပ်စာမေးပွဲတွင် ၉၀% ရယူပါ".
       - Locked badges have reduced opacity (opacity-60) and grayscale icon.
    4. Group badges by category with section headers: "Streak" / "Accuracy" / "Coverage" with bilingual labels.
    5. Use `useLanguage()` for bilingual text display.
    6. Animate badge cards with StaggeredGrid from existing animations.

    Create `src/components/social/StreakHeatmap.tsx`:

    1. Props: `activityDates: string[]; freezesUsed: string[]; className?: string`.
    2. Follow `ReviewHeatmap.tsx` CSS Grid + Tailwind pattern exactly (no external library).
    3. Display 60 days desktop / 30 days mobile (responsive hidden/block classes, same as ReviewHeatmap).
    4. Color scheme (warm gradient per research discretion):
       - No activity: `bg-muted/40` (gray).
       - 1 activity: `bg-orange-200 dark:bg-orange-900/40`.
       - 2-3 activities: `bg-orange-400 dark:bg-orange-700/60`.
       - 4+ activities: `bg-orange-500 dark:bg-orange-600`.
    5. Freeze days: `bg-blue-200 dark:bg-blue-900/40` with a border (border-blue-400) to visually distinguish. Tooltip shows "Streak Freeze" / "Streak Freeze အသုံးပြု".
    6. Day labels and month labels following ReviewHeatmap pattern.
    7. Build date-count map from activityDates array (count occurrences per date).
    8. Today's cell highlighted with a ring border.
    9. Pure function for cell color determination — `getCellColor(count: number, isFreezeDay: boolean)`.
    10. Use `useLanguage()` for bilingual day/month labels.
  </action>
  <verify>TypeScript compiles. BadgeGrid renders with earned/locked badge cards. StreakHeatmap renders CSS grid with warm color gradient.</verify>
  <done>BadgeGrid shows all 7 badges with earned (gold) / locked (gray) states and bilingual requirement text. StreakHeatmap renders activity calendar with warm orange gradient and blue freeze day markers.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. BadgeCelebration opens with confetti when a badge is provided
3. BadgeGrid displays 7 badges grouped by category
4. Locked badges show bilingual requirement text
5. StreakHeatmap uses warm orange gradient (not primary blue)
6. Freeze days are visually distinct (blue/ice color)
7. All components use bilingual text via useLanguage()
</verification>

<success_criteria>
- Badge celebration modal displays with confetti and auto-dismiss
- Badge grid shows all badges with clear earned vs locked visual state
- Locked badges transparently show what's needed to earn them
- Streak heatmap differentiates activity days from freeze days
- All text is bilingual (English + Burmese)
- Components follow existing patterns (Radix Dialog, CSS Grid, motion/react)
</success_criteria>

<output>
After completion, create `.planning/phases/07-social-features/07-04-SUMMARY.md`
</output>
