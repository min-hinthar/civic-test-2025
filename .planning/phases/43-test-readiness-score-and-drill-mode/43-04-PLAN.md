---
phase: 43-test-readiness-score-and-drill-mode
plan: 04
type: execute
wave: 2
depends_on: ["43-01"]
files_modified:
  - src/components/hub/OverviewTab.tsx
  - src/components/results/TestResultsScreen.tsx
autonomous: true
requirements: [RDNS-04, RDNS-05]

must_haves:
  truths:
    - "User can navigate to /drill from a 'Drill Weak Areas' button on the Progress Hub overview tab"
    - "User sees an end-of-practice drill suggestion on the results screen when weak areas are detected"
    - "Progress Hub drill button only appears when the user has categories below 70% mastery"
    - "End-of-practice suggestion links to /drill (weak-all mode) alongside existing weak area nudges"
    - "All drill entry point text is fully localized for Burmese"
  artifacts:
    - path: "src/components/hub/OverviewTab.tsx"
      provides: "Drill Weak Areas CTA button in Progress Hub overview"
      contains: "router.push.*drill"
    - path: "src/components/results/TestResultsScreen.tsx"
      provides: "End-of-practice drill suggestion when weak areas detected"
      contains: "router.push.*drill"
  key_links:
    - from: "src/components/hub/OverviewTab.tsx"
      to: "/drill"
      via: "router.push('/drill') on Drill Weak Areas button click"
      pattern: "router\\.push.*drill"
    - from: "src/components/results/TestResultsScreen.tsx"
      to: "/drill"
      via: "router.push('/drill') on drill suggestion CTA click"
      pattern: "router\\.push.*drill"
---

<objective>
Add drill mode entry points to the Progress Hub and end-of-practice results screen.

Purpose: The locked decision specifies "Multiple entry points: Dashboard + Progress Hub + end-of-practice suggestion when weak areas detected." Plan 43-02 covers the Dashboard entry point. This plan adds the other two: a "Drill Weak Areas" button on the Progress Hub OverviewTab, and an end-of-practice drill suggestion on the TestResultsScreen when weak areas are detected.

Output: Two modified files with drill navigation entry points.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-test-readiness-score-and-drill-mode/43-CONTEXT.md
@src/components/hub/OverviewTab.tsx
@src/components/results/TestResultsScreen.tsx
@src/components/nudges/WeakAreaNudge.tsx
@src/lib/mastery/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Drill Weak Areas CTA to Progress Hub OverviewTab</name>
  <files>
    src/components/hub/OverviewTab.tsx
  </files>
  <action>
    Modify `src/components/hub/OverviewTab.tsx` to add a "Drill Weak Areas" button:

    1. Import Target icon from lucide-react (for drill icon)
    2. Determine if any categories are below 70% mastery:
       - Check `categoryMasteries` record: `const hasWeakCategories = Object.values(categoryMasteries).some(m => m < 70)`
       - Only show drill CTA when hasWeakCategories is true
    3. Add a new StaggeredItem AFTER the stat cards grid (before the Category Mastery section):
       - Wrapped in a conditional: `{hasWeakCategories && ( ... )}`
       - GlassCard tier="medium" with rounded-2xl, p-4
       - Flex row layout: icon + text on left, button on right
       - Left side:
         - Target icon (lucide-react) in orange: text-orange-500, h-5 w-5
         - Text: "Drill Weak Areas" / "အားနည်းသောနေရာများ လေ့ကျင့်ပါ" (font-semibold text-sm)
         - Subtext: "Focus on your weakest questions" / "သင့်အားအနည်းဆုံးမေးခွန်းများကို အာရုံစိုက်ပါ" (text-xs text-muted-foreground)
       - Right side:
         - Button with orange styling: bg-orange-500 hover:bg-orange-600 text-white rounded-xl px-4 py-2 text-sm font-semibold min-h-[44px]
         - Button text: "Start" / "စတင်ပါ"
         - onClick: `router.push('/drill')`
    4. Ensure Burmese text only shows when showBurmese is true (already available from useLanguage)
    5. Ensure the CTA is visually distinct from stat cards but cohesive with the GlassCard family

    ANTI-PATTERNS TO AVOID:
    - Do NOT add new props to OverviewTab -- it already has categoryMasteries, derive hasWeakCategories internally
    - Do NOT show the drill CTA for brand new users (practicedCount === 0 returns WelcomeState before reaching this)
    - Do NOT duplicate the ReadinessRing or any readiness score display -- this is just a navigation entry point
  </action>
  <verify>
    <automated>cd /c/Users/minkk/GitHub/civic-test-2025 && pnpm build 2>&1 | tail -5</automated>
    <manual>Check OverviewTab.tsx contains router.push('/drill') and conditional hasWeakCategories rendering</manual>
  </verify>
  <done>Progress Hub OverviewTab shows a "Drill Weak Areas" CTA card between stat cards and category mastery section. Button navigates to /drill. CTA only appears when categories below 70% exist. All text localized for Burmese. Build succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Add end-of-practice drill suggestion to TestResultsScreen</name>
  <files>
    src/components/results/TestResultsScreen.tsx
  </files>
  <action>
    Modify `src/components/results/TestResultsScreen.tsx` to add a drill suggestion alongside existing weak area nudges:

    1. Find the existing weak area nudge section (around line 893-920 where `detectWeakAreas` is called and WeakAreaNudge components are rendered)
    2. Add a "Drill Weak Areas" CTA ABOVE the individual WeakAreaNudge cards, inside the same FadeIn container:
       - Only show when weak areas are detected (weak.length > 0 -- already the condition for this block)
       - Only show for practice mode (mode === 'practice') -- mock test results have their own flow
       - Card styling: rounded-xl border border-orange-500/20 bg-orange-500/5 dark:bg-orange-500/10 p-3
       - Flex row: Target icon (orange) + text + button
       - Text: "Drill your weak areas" / "အားနည်းသောနေရာများကို လေ့ကျင့်ပါ" (text-sm font-semibold)
       - Subtext: "Focus on the questions you missed" / "သင်လွဲခဲ့သောမေးခွန်းများကို အာရုံစိုက်ပါ" (text-xs text-muted-foreground)
       - Button: "Drill Now" / "ယခု လေ့ကျင့်ပါ" (bg-orange-500 text-white rounded-xl px-3 py-2 text-xs font-semibold min-h-[44px])
       - onClick: `router.push('/drill')` -- navigates to drill in weak-all mode
    3. Import Target from lucide-react (if not already imported)
    4. The existing WeakAreaNudge cards remain below the drill CTA (they link to practice per category, the drill CTA links to the drill page)

    The logic is: existing `detectWeakAreas` already identifies weak categories. When weak areas exist AND mode is practice, show the drill suggestion as a prominent card above the individual weak area nudge cards. This creates the "end-of-practice suggestion when weak areas detected" entry point from the locked decision.

    ANTI-PATTERNS TO AVOID:
    - Do NOT modify the existing WeakAreaNudge component
    - Do NOT change the detectWeakAreas call or threshold
    - Do NOT show drill suggestion in mock test mode (only practice)
    - Do NOT add new props to TestResultsScreen -- use existing router from useRouter()
    - Keep changes minimal: add ~15-25 lines in the existing weak area section
  </action>
  <verify>
    <automated>cd /c/Users/minkk/GitHub/civic-test-2025 && pnpm build 2>&1 | tail -5</automated>
    <manual>Check TestResultsScreen.tsx contains a drill CTA with router.push('/drill') inside the weak areas section, gated by mode === 'practice'</manual>
  </verify>
  <done>TestResultsScreen shows a "Drill your weak areas" CTA card above WeakAreaNudge cards when practice mode detects weak areas. Button navigates to /drill. Only appears in practice mode (not mock test). All text localized for Burmese. Build succeeds.</done>
</task>

</tasks>

<verification>
  <automated>cd /c/Users/minkk/GitHub/civic-test-2025 && pnpm build 2>&1 | tail -5</automated>
  <manual>Progress Hub overview tab shows drill CTA when weak categories exist. After completing a practice session with weak areas, results screen shows drill suggestion above weak area nudges.</manual>
</verification>

<success_criteria>
- Progress Hub OverviewTab shows "Drill Weak Areas" card when any category is below 70%
- Progress Hub drill CTA navigates to /drill on click
- TestResultsScreen shows "Drill your weak areas" CTA in practice mode when weak areas detected
- TestResultsScreen drill CTA navigates to /drill on click
- Both entry points show Burmese text when language mode is active
- Existing WeakAreaNudge functionality preserved unchanged
- pnpm build succeeds
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/43-test-readiness-score-and-drill-mode/43-04-SUMMARY.md`
</output>
