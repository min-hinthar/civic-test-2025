---
phase: 15-progress-hub
plan: 04
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - src/components/hub/AchievementsTab.tsx
  - src/pages/HubPage.tsx
autonomous: true
frontend_design: true

must_haves:
  truths:
    - "Achievements tab shows badges and leaderboard together"
    - "Badges grouped by category (Study, Test, Social, Streak) with section headers"
    - "Unearned badges are greyed out with lock icon and criteria hint text"
    - "Earned badges show progress bars toward criteria"
    - "Leaderboard shows top 5 by default with Show more to expand"
    - "Layout: side by side on desktop, stacked on mobile"
    - "Badge gallery responsive grid: 4 per row desktop, 2 mobile"
    - "Earned badge cards have subtle glow + shimmer effect"
  artifacts:
    - path: "src/components/hub/AchievementsTab.tsx"
      provides: "Achievements tab with badge gallery and leaderboard"
  key_links:
    - from: "src/components/hub/AchievementsTab.tsx"
      to: "src/hooks/useBadges"
      via: "Props from HubPage (earnedBadges, lockedBadges)"
    - from: "src/components/hub/AchievementsTab.tsx"
      to: "src/hooks/useLeaderboard"
      via: "Internal hook call with limit:5"
    - from: "src/components/hub/AchievementsTab.tsx"
      to: "src/components/social/LeaderboardTable"
      via: "Import existing component"
---

<objective>
Build the Achievements tab combining badge gallery and leaderboard in a unified layout with category grouping, earned badge effects, and responsive design.

Purpose: The Achievements tab consolidates the badges and leaderboard from the old SocialHubPage into one premium view. Badges are reorganized by user-friendly categories (Study, Test, Social, Streak) instead of internal category names. Earned badges get visual premium treatment with glow and shimmer effects.

Output: Fully functional Achievements tab with categorized badge gallery, leaderboard, and all visual effects.

**NOTE**: This plan contains visually rich UI (badge glow/shimmer, layout). The executor should use the `/frontend-design` skill for the earned badge card effects and layout design.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/15-progress-hub/15-RESEARCH.md
@.planning/phases/15-progress-hub/15-01-SUMMARY.md
@src/pages/SocialHubPage.tsx
@src/components/social/BadgeGrid.tsx
@src/components/social/LeaderboardTable.tsx
@src/components/social/LeaderboardProfile.tsx
@src/components/social/BadgeCelebration.tsx
@src/hooks/useBadges.ts
@src/hooks/useLeaderboard.ts
@src/lib/social/badgeDefinitions.ts
@src/components/hub/GlassCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AchievementsTab component</name>
  <files>
    src/components/hub/AchievementsTab.tsx
  </files>
  <action>
**AchievementsTab (`src/components/hub/AchievementsTab.tsx`):**

**Props (data passed from HubPage):**
- `earnedBadges`: Badge[] (from useBadges)
- `lockedBadges`: Badge[] (from useBadges)
- `badgeCheckData`: BadgeCheckData | null (for progress calculations)
- `newlyEarnedBadge`: Badge | null (for celebration modal)
- `dismissCelebration`: (id: string) => void
- `isLoading`: boolean

**Internal data/state:**
- Call `useLeaderboard('all-time')` internally (leaderboard is tab-specific, doesn't need lifting)
- Manage leaderboard entry limit: start at 5, "Show more" expands to 25
- Manage social opt-in flow (migrate from SocialHubPage)
- Profile dialog state for leaderboard row clicks

**Layout — Responsive split:**
- Desktop (`lg:` breakpoint): side-by-side with badges on the left (wider, ~60%) and leaderboard on the right (~40%)
  - Use `grid grid-cols-1 lg:grid-cols-5 gap-6` with badges spanning 3 cols and leaderboard 2 cols
- Mobile: stacks vertically (badges on top, leaderboard below)

**Badge Gallery section:**
- **Category grouping** — create a display-layer mapping (do NOT modify badgeDefinitions.ts):
  ```
  coverage → "Study" / "လေ့လာမှု" (icon: BookOpen)
  accuracy → "Test" / "စာမေးပွဲ" (icon: Target)
  (none) → "Social" / "လူမှုရေး" (icon: Users)
  streak → "Streak" / "ဆက်တိုက်" (icon: Flame)
  ```
  - Group badges by their `category` field mapped to display names
  - Each group has a section header with icon and bilingual label
  - Display all 4 categories (Study, Test, Social, Streak) per user decision, in that order
  - Social category currently has no badges — show the section header with a "Coming soon" message (e.g., "Social badges coming soon!" / Burmese equivalent) instead of omitting the section
- **Badge grid**: responsive — 4 per row on desktop (`grid-cols-4`), 2 on mobile (`grid-cols-2`)
- **Earned badges**:
  - Show the badge icon/image with full color
  - Subtle glow effect: CSS `box-shadow` with themed color (use `shadow-[0_0_20px_hsl(var(--primary)/0.3)]`)
  - Shimmer effect: CSS animation using a diagonal gradient sweep (similar to skeleton shimmer but slower and more subtle, on a highlight layer)
  - Progress bar showing progress toward criteria (e.g., "3/5 tests" even if already earned, showing as complete 5/5)
  - Use `badgeCheckData` to compute progress for each badge:
    - streak badges: `currentStreak / threshold` or `longestStreak / threshold`
    - accuracy badges: `bestTestAccuracy / threshold`
    - coverage badges: `uniqueQuestionsAnswered / totalQuestions` or `categoriesMastered / totalCategories`
- **Unearned (locked) badges**:
  - Greyed out with desaturation filter (`grayscale(100%) opacity-50`)
  - Lock icon overlay (Lock from lucide-react)
  - Criteria hint text below: "Complete X to unlock" (derived from badge criteria field)
  - Progress bar showing current progress toward unlock criteria
- **Badge cards**: use GlassCard wrapper for each badge

**Leaderboard section:**
- Section header: "Leaderboard" / "အဆင့်ဇယား" with Trophy icon
- Use existing `LeaderboardTable` component
- Pass `limit: leaderboardLimit` (start at 5)
- "Show more" / "Show less" button to toggle between 5 and 25
- Include existing `LeaderboardProfile` dialog for row clicks
- Social opt-in CTA for non-opted-in users (migrate from SocialHubPage)
- All-time/Weekly toggle (migrate from SocialHubPage)

**Empty state (brand new user with no badges):**
- Welcome message: "Start earning badges!" / Burmese
- First badge hint: "Study 10 questions to earn your first badge"
- Show ALL badges greyed out in the gallery (motivational full gallery view)

**Badge celebration:**
- Render `BadgeCelebration` modal when `newlyEarnedBadge` is non-null
- Pop + shimmer burst animation is already handled by existing BadgeCelebration component

**Animation:**
- FadeIn for section entrances
- StaggeredList for badge grid items
  </action>
  <verify>
Run `npx tsc --noEmit` to verify type safety. Confirm the component handles earned, locked, and empty states. Verify the category grouping mapping works correctly with all existing badge definitions.
  </verify>
  <done>AchievementsTab renders badges grouped by display category (Study, Test, Social, Streak) with earned/locked states, progress bars, glow/shimmer effects, leaderboard with pagination, and empty state.</done>
</task>

<task type="auto">
  <name>Task 2: Wire AchievementsTab into HubPage</name>
  <files>
    src/pages/HubPage.tsx
  </files>
  <action>
In `src/pages/HubPage.tsx`:
- Import `AchievementsTab` from `@/components/hub/AchievementsTab`
- Import `AchievementsSkeleton` from `@/components/hub/HubSkeleton`
- Call `useBadges(badgeCheckData)` at HubPage level (badge data is shared with hub badge dot feature)
- Build `badgeCheckData` at HubPage level following the same pattern as SocialHubPage:
  - Uses streak data (already loaded for Overview tab)
  - Uses test history from auth context
  - Uses categoryMasteries from useCategoryMastery
  - Uses uniqueQuestionsCount from answer history (already loaded for Overview tab)
- Replace the achievements placeholder with:
  ```
  <AchievementsTab
    earnedBadges={earnedBadges}
    lockedBadges={lockedBadges}
    badgeCheckData={badgeCheckData}
    newlyEarnedBadge={newlyEarnedBadge}
    dismissCelebration={dismissCelebration}
    isLoading={isLoadingBadges}
  />
  ```
- Ensure badge celebration modal renders at the HubPage level (outside AnimatePresence) so it persists across tab switches
  </action>
  <verify>
Run `npm run build` to confirm build succeeds. Navigate to `/#/hub/achievements` and verify badges and leaderboard render. Test with no badges earned to see empty state. Test leaderboard "Show more" toggle.
  </verify>
  <done>Achievements tab is wired into HubPage with all badge and leaderboard data connected. Badge celebration modal works across tab switches.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Achievements tab shows badges grouped under Study, Test, Social, Streak headers
3. Earned badges have glow + shimmer effect
4. Locked badges are greyed out with lock icon and criteria hint
5. Progress bars show on both earned and locked badges
6. Leaderboard shows top 5 with "Show more" button
7. Desktop layout: side-by-side (badges left, leaderboard right)
8. Mobile layout: stacked vertically
9. Badge grid: 4 per row desktop, 2 per row mobile
10. Empty state shows all badges greyed out with welcome message
11. Badge celebration modal appears for newly earned badges
</verification>

<success_criteria>
Achievements tab is feature-complete with categorized badge gallery, earned badge premium effects, leaderboard integration, and responsive layout.
</success_criteria>

<output>
After completion, create `.planning/phases/15-progress-hub/15-04-SUMMARY.md`
</output>
