---
milestone: v4.0
audited: 2026-02-25T19:32:00Z
status: gaps_found
scores:
  requirements: 18/38
  phases: 5/9
  integration: 16/18
  flows: 4/6
gaps:
  requirements:
    - id: "RDNS-07"
      status: "unsatisfied"
      phase: "Phase 44"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 44 not started — no phase directory, no plans, no verification"
    - id: "RDNS-08"
      status: "unsatisfied"
      phase: "Phase 44"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 44 not started"
    - id: "RDNS-09"
      status: "unsatisfied"
      phase: "Phase 44"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 44 not started"
    - id: "RDNS-10"
      status: "unsatisfied"
      phase: "Phase 44"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 44 not started"
    - id: "CONT-01"
      status: "unsatisfied"
      phase: "Phase 45"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 45 not started"
    - id: "CONT-02"
      status: "unsatisfied"
      phase: "Phase 45"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 45 not started"
    - id: "CONT-03"
      status: "unsatisfied"
      phase: "Phase 45"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 45 not started"
    - id: "CONT-04"
      status: "unsatisfied"
      phase: "Phase 45"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 45 not started"
    - id: "CONT-05"
      status: "unsatisfied"
      phase: "Phase 45"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 45 not started"
    - id: "CONT-06"
      status: "unsatisfied"
      phase: "Phase 45"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 45 not started"
    - id: "CONT-07"
      status: "unsatisfied"
      phase: "Phase 45"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 45 not started"
    - id: "CONT-08"
      status: "unsatisfied"
      phase: "Phase 45"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 45 not started"
    - id: "SYNC-01"
      status: "unsatisfied"
      phase: "Phase 46"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 46 not started"
    - id: "SYNC-02"
      status: "unsatisfied"
      phase: "Phase 46"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 46 not started"
    - id: "SYNC-03"
      status: "unsatisfied"
      phase: "Phase 46"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 46 not started"
    - id: "SYNC-04"
      status: "unsatisfied"
      phase: "Phase 46"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 46 not started"
    - id: "PERF-01"
      status: "unsatisfied"
      phase: "Phase 47"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 47 not started"
    - id: "PERF-02"
      status: "unsatisfied"
      phase: "Phase 47"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 47 not started"
    - id: "PERF-03"
      status: "unsatisfied"
      phase: "Phase 47"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 47 not started"
    - id: "PERF-04"
      status: "unsatisfied"
      phase: "Phase 47"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 47 not started"
  integration:
    - from: "DrillResults / TestResultsScreen / ReviewSession"
      to: "PracticePage"
      issue: "/practice?category=X URL parameter silently ignored — PracticePage does not read useSearchParams()"
      severity: "medium"
      affected_requirements: ["RDNS-04", "RDNS-05"]
    - from: "GoogleOneTapSignIn"
      to: "/dashboard (stale route)"
      issue: "fallbackOAuthRedirect hardcodes /dashboard instead of /home — creates unnecessary redirect hop via next.config.mjs"
      severity: "low"
      affected_requirements: ["MIGR-12"]
  flows:
    - flow: "Post-drill Practice [Category] pre-selection"
      breaks_at: "PracticePage does not read ?category= search param"
      severity: "medium"
    - flow: "Google OAuth fallback redirect"
      breaks_at: "GoogleOneTapSignIn redirects to /dashboard not /home"
      severity: "low"
tech_debt:
  - phase: 40-app-router-foundation
    items:
      - "ROADMAP says '12 context providers' but implementation has 10 — ROADMAP authoring error, not code issue"
  - phase: 41-route-migration
    items:
      - "NavigationShell.tsx: usePathname return value unused (kept for future per-route layout logic)"
  - phase: 42-csp-nonce-migration-and-pwa-update
    items:
      - "HASH_REDIRECT_SCRIPT removed — legacy #/path bookmarks not served by a client-side redirect anymore (covered by next.config.mjs redirects for known routes only)"
  - phase: 43-test-readiness-score-and-drill-mode
    items:
      - "SUMMARY frontmatters missing requirements-completed field — 3-source cross-reference reduced to 2 sources"
---

# v4.0 Next-Gen Architecture — Milestone Audit Report

**Milestone:** v4.0 Next-Gen Architecture
**Audited:** 2026-02-25T19:32:00Z
**Status:** GAPS FOUND — 20 requirements in unstarted phases 44-47

## Executive Summary

Phases 39-43 (App Router migration + Readiness/Drill features) are **fully verified**. All 18 requirements mapped to these phases are satisfied with passing verifications. Cross-phase integration is solid with only 2 minor wiring gaps. The milestone is incomplete because phases 44-47 (Test Date Countdown, Content Enrichment, Cross-Device Sync, Performance Optimization) have not been started, leaving 20 of 38 requirements unsatisfied.

## Phase Verification Summary

| Phase | Status | Score | Requirements | Tech Debt |
|-------|--------|-------|-------------|-----------|
| 39. Next.js 16 Upgrade | human_needed | 11/12 | MIGR-01, MIGR-02, MIGR-03 (3/3) | None |
| 40. App Router Foundation | passed | 4/4 | MIGR-04, MIGR-07 (2/2) | ROADMAP "12 providers" typo |
| 41. Route Migration | passed | 5/5 | MIGR-05, MIGR-06, MIGR-08, MIGR-11, MIGR-12 (5/5) | Unused usePathname return |
| 42. CSP Nonce Migration | passed | 9/9 | MIGR-09, MIGR-10 (2/2) | HASH_REDIRECT_SCRIPT removed |
| 43. Readiness & Drill | passed | 34/34 | RDNS-01 to RDNS-06 (6/6) | Missing SUMMARY frontmatter fields |
| **44. Test Date Countdown** | **NOT STARTED** | — | RDNS-07 to RDNS-10 (0/4) | — |
| **45. Content Enrichment** | **NOT STARTED** | — | CONT-01 to CONT-08 (0/8) | — |
| **46. Cross-Device Sync** | **NOT STARTED** | — | SYNC-01 to SYNC-04 (0/4) | — |
| **47. Performance Optimization** | **NOT STARTED** | — | PERF-01 to PERF-04 (0/4) | — |

**Completed:** 5/9 phases, 18/38 requirements

## Requirements Cross-Reference (3-Source)

### Satisfied Requirements (18)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|--------|-------------|-------------|---------|-----------------|-------|
| MIGR-01 | Next.js 16 build | passed | missing field | [x] Complete | **satisfied** |
| MIGR-02 | proxy.ts rename | passed | missing field | [x] Complete | **satisfied** |
| MIGR-03 | Sentry App Router | passed | missing field | [x] Complete | **satisfied** |
| MIGR-04 | Root layout + ClientProviders | passed | missing field | [x] Complete | **satisfied** |
| MIGR-05 | All routes file-based | passed | missing field | [x] Complete | **satisfied** |
| MIGR-06 | react-router-dom removed | passed | missing field | [x] Complete | **satisfied** |
| MIGR-07 | Auth guard layout | passed | missing field | [x] Complete | **satisfied** |
| MIGR-08 | Page transitions template.tsx | passed | missing field | [x] Complete | **satisfied** |
| MIGR-09 | Nonce-based CSP | passed | missing field | [x] Complete | **satisfied** |
| MIGR-10 | SW App Router caching | passed | missing field | [x] Complete | **satisfied** |
| MIGR-11 | API Route Handlers | passed | missing field | [x] Complete | **satisfied** |
| MIGR-12 | Clean URLs | passed | missing field | [x] Complete | **satisfied** |
| RDNS-01 | Readiness score on Dashboard | passed | missing field | [x] Complete | **satisfied** |
| RDNS-02 | Per-dimension breakdown | passed | missing field | [x] Complete | **satisfied** |
| RDNS-03 | Zero-coverage cap + FSRS | passed | missing field | [x] Complete | **satisfied** |
| RDNS-04 | Weak-area drill from Dashboard | passed | missing field | [x] Complete | **satisfied** |
| RDNS-05 | Category drill buttons | passed | missing field | [x] Complete | **satisfied** |
| RDNS-06 | Pre/post mastery delta | passed | missing field | [x] Complete | **satisfied** |

### Unsatisfied Requirements (20) — Phases Not Started

| REQ-ID | Description | Phase | Status |
|--------|-------------|-------|--------|
| RDNS-07 | Test date in Settings | Phase 44 | Phase not started |
| RDNS-08 | Countdown display | Phase 44 | Phase not started |
| RDNS-09 | Daily study targets | Phase 44 | Phase not started |
| RDNS-10 | Adaptive daily targets | Phase 44 | Phase not started |
| CONT-01 | Mnemonic fields | Phase 45 | Phase not started |
| CONT-02 | Fun fact fields | Phase 45 | Phase not started |
| CONT-03 | Common mistake fields | Phase 45 | Phase not started |
| CONT-04 | Citation fields | Phase 45 | Phase not started |
| CONT-05 | Mnemonic visual treatment | Phase 45 | Phase not started |
| CONT-06 | Category study tips | Phase 45 | Phase not started |
| CONT-07 | Tricky question badges | Phase 45 | Phase not started |
| CONT-08 | Related question chips | Phase 45 | Phase not started |
| SYNC-01 | Answer history sync | Phase 46 | Phase not started |
| SYNC-02 | Bookmarks sync | Phase 46 | Phase not started |
| SYNC-03 | Settings sync | Phase 46 | Phase not started |
| SYNC-04 | Streak sync | Phase 46 | Phase not started |
| PERF-01 | Dynamic imports | Phase 47 | Phase not started |
| PERF-02 | optimizePackageImports | Phase 47 | Phase not started |
| PERF-03 | Bundle size audit | Phase 47 | Phase not started |
| PERF-04 | Web Vitals baseline | Phase 47 | Phase not started |

## Cross-Phase Integration

### Verified Connections (16/18)

All critical cross-phase wiring for completed phases is functional:

- **proxy.ts nonce chain**: proxy.ts → x-nonce header → layout.tsx → `<script nonce>` → all pages including /drill
- **Auth nonce chain**: proxy.ts → x-nonce → auth/page.tsx → AuthPage → GoogleOneTapSignIn `<Script nonce>`
- **Provider tree**: ClientProviders in layout.tsx → all routes (10 contexts)
- **Auth guard**: (protected)/layout.tsx → useAuth() → all protected routes including /drill
- **Readiness chain**: readinessEngine.ts → useReadinessScore → Dashboard → ReadinessHeroCard
- **Drill chain**: Dashboard/OverviewTab/TestResultsScreen → /drill → DrillConfig → PracticeSession → DrillResults
- **Navigation**: All routes use next/navigation hooks, next/link, template.tsx transitions
- **API routes**: 4 Route Handlers under app/api/push/ with proper exports

### Integration Gaps (2)

**1. `/practice?category=X` parameter dropped (Medium)**
- **From:** DrillResults, TestResultsScreen, ReviewSession navigate to `/practice?category=X`
- **To:** PracticePage does not call `useSearchParams()` — category param silently ignored
- **Impact:** Post-drill "Practice [Category]" button opens practice without category pre-selected
- **Affected:** RDNS-04 (adjacent), RDNS-05 (adjacent) — drill flow itself unaffected
- **Fix:** Add `useSearchParams()` to PracticePage/PracticeConfig + Suspense boundary

**2. GoogleOneTapSignIn stale redirect (Low)**
- **From:** `GoogleOneTapSignIn.tsx` line 76: `redirectTo: /dashboard`
- **To:** Should be `/home` (canonical route since Phase 41)
- **Impact:** Extra redirect hop via next.config.mjs permanent redirect
- **Affected:** MIGR-12 (minor)
- **Fix:** Change string to `${window.location.origin}/home`

## E2E Flow Verification

| # | Flow | Status | Notes |
|---|------|--------|-------|
| 1 | Landing → Auth → Dashboard with readiness card | COMPLETE | Full chain verified |
| 2 | Dashboard → Drill (config → session → results) | COMPLETE | 3-phase state machine works |
| 3 | Practice results → drill suggestion → /drill | COMPLETE | Conditional on practice mode + weak areas |
| 4 | Progress Hub → drill CTA → /drill | COMPLETE | Conditional on categories < 70% |
| 5 | Post-drill → Practice [Category] pre-selection | BROKEN | ?category= param dropped by PracticePage |
| 6 | Google OAuth fallback → /home | DEGRADED | Extra redirect hop via /dashboard → /home |

## Tech Debt Summary

| Phase | Items | Severity |
|-------|-------|----------|
| 40 | ROADMAP "12 providers" typo (actual: 10) | Info |
| 41 | NavigationShell.tsx unused usePathname return | Info |
| 42 | HASH_REDIRECT_SCRIPT removed — legacy #/ bookmarks rely on next.config.mjs redirects for known routes only | Low |
| 43 | SUMMARY frontmatters missing requirements-completed field | Info |

**Total:** 4 items across 4 phases (all info/low severity)

---

_Audited: 2026-02-25T19:32:00Z_
_Auditor: Claude (audit-milestone workflow)_
