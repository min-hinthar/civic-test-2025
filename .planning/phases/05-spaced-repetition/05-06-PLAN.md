---
phase: 05-spaced-repetition
plan: 06
type: execute
wave: 3
depends_on: ["05-03"]
files_modified:
  - src/components/srs/ReviewCard.tsx
  - src/components/srs/RatingButtons.tsx
  - src/components/srs/SessionSetup.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a flashcard-style review card with 3D flip (reusing Flashcard3D)"
    - "User can rate Easy (swipe right) or Hard (swipe left) with tap button fallback"
    - "Swipe shows progressive color gradient (green right / orange left) with edge labels"
    - "After rating, user briefly sees next review interval before advancing"
    - "User can choose session size before starting (10, 20, all due)"
  artifacts:
    - path: "src/components/srs/ReviewCard.tsx"
      provides: "Review card with flip + swipe-to-rate gestures"
      exports: ["ReviewCard"]
    - path: "src/components/srs/RatingButtons.tsx"
      provides: "Easy/Hard tap buttons with bilingual labels"
      exports: ["RatingButtons"]
    - path: "src/components/srs/SessionSetup.tsx"
      provides: "Pre-session setup: session size picker, timer toggle"
      exports: ["SessionSetup"]
  key_links:
    - from: "src/components/srs/ReviewCard.tsx"
      to: "src/components/study/Flashcard3D.tsx"
      via: "Reuses Flashcard3D for card flip"
      pattern: "Flashcard3D"
    - from: "src/components/srs/ReviewCard.tsx"
      to: "motion/react"
      via: "drag gestures for swipe-to-rate"
      pattern: "motion.*drag"
---

<objective>
Create the review UI atoms: ReviewCard with swipe-to-rate gestures, RatingButtons for tap fallback, and SessionSetup for pre-session configuration.

Purpose: These components are the building blocks of the review session experience. The swipe-to-rate gesture with 3D flip card is the core interaction pattern (per locked decision: reuse 3D flip card, swipe right = Easy, left = Hard).
Output: Three SRS UI components ready for the ReviewSession orchestrator.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-spaced-repetition/05-RESEARCH.md
@src/components/study/Flashcard3D.tsx
@src/components/study/FlashcardStack.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ReviewCard with swipe-to-rate and Flashcard3D integration</name>
  <files>
    src/components/srs/ReviewCard.tsx
    src/components/srs/RatingButtons.tsx
  </files>
  <action>
    1. Create `src/components/srs/RatingButtons.tsx`:
       **Props:** `{ onRate: (isEasy: boolean) => void; disabled?: boolean }`

       - Two buttons side by side, full width on mobile
       - Left button (Hard): orange/warning color, `RotateCcw` icon from lucide-react
         - Bilingual label: "Hard / ခက်သည်"
         - Background: `bg-warning-50 dark:bg-warning-500/10 border-warning-500/30`
       - Right button (Easy): green/success color, `Check` icon from lucide-react
         - Bilingual label: "Easy / လွယ်သည်"
         - Background: `bg-success-50 dark:bg-success-500/10 border-success-500/30`
       - Per discretion: Place buttons below the flipped card, centered, Easy on right (matches swipe direction)
       - min-h-[44px] touch targets
       - motion/react spring scale animation on press (stiffness 400, damping 17)
       - Buttons show bilingual text (use useLanguage().showBurmese)
       - Icons on both buttons (per locked decision)

    2. Create `src/components/srs/ReviewCard.tsx`:
       **Props:**
       ```
       {
         record: SRSCardRecord;
         onRate: (isEasy: boolean) => void;
         isFlipped: boolean;
         onFlip: () => void;
         showRatingFeedback: { isEasy: boolean; intervalText: { en: string; my: string } } | null;
       }
       ```

       **Card display:**
       - Reuse the existing `Flashcard3D` component for the 3D flip effect
       - Front face: question text (English + Burmese), category badge, speech button
       - Back face: answer text, WhyButton for explanation (tap-to-expand, not auto-shown per locked decision)
       - Look up full question data from `civicsQuestions` by `record.questionId`

       **Swipe-to-rate gesture (follows FlashcardStack.tsx drag pattern):**
       - Use `motion.div` with `drag="x"` wrapping the Flashcard3D
       - `const x = useMotionValue(0)`
       - SWIPE_THRESHOLD = 80 (higher than navigation swipe 50 for intentional rating)
       - SWIPE_VELOCITY = 400
       - `handleDragEnd`: if offset.x > 80 or velocity.x > 400 -> onRate(true) (Easy). If offset.x < -80 or velocity.x < -400 -> onRate(false) (Hard). Otherwise snap back.
       - `dragConstraints={{ left: 0, right: 0 }}` with `dragElastic={0.3}`

       **Progressive color gradient during swipe (per locked decision: gradient + text labels):**
       - Use `useTransform` on x value to interpolate background color:
         - x: [-200, -50, 0, 50, 200]
         - colors: [orange-400/0.3, orange-400/0.1, transparent, green-400/0.1, green-400/0.3]
       - Edge labels visible during swipe:
         - Left edge: "Hard / ခက်သည်" in orange, opacity derived from negative x
         - Right edge: "Easy / လွယ်သည်" in green, opacity derived from positive x
         - Use `useTransform` for opacity: show when |x| > 30

       **Rating feedback overlay (per locked decision: green flash for Easy, orange flash for Hard, plus interval text):**
       - When `showRatingFeedback` is not null, overlay a brief colored flash:
         - Easy: green-400/20 background flash
         - Hard: orange-400/20 background flash
       - Show bilingual next review interval text centered: "Next review: X days / နောက်ပြန်လှည့်: X ရက်"
       - If Hard: also show brief bilingual encouragement message (per locked decision): "Keep going, you've got this! / ဆက်ကြိုးစားပါ၊ သင်လုပ်နိုင်ပါတယ်!" This matches the app's anxiety-reducing philosophy.
       - Feedback auto-dismisses after ~1.5s (parent controls via timeout)

       **Reduced motion support:**
       - Use `useReducedMotion()` hook (existing)
       - If reduced motion: disable drag, rely on RatingButtons only
       - Snap transitions instead of spring animations
  </action>
  <verify>
    - `pnpm exec tsc --noEmit` passes
    - ReviewCard renders with question data from Flashcard3D
    - RatingButtons render with bilingual labels
    - Swipe gesture code compiles (runtime testing in later plan)
  </verify>
  <done>
    - ReviewCard displays question with Flashcard3D flip
    - Swipe right = Easy, swipe left = Hard with progressive gradient and edge labels
    - RatingButtons provide tap fallback below card
    - Rating feedback shows colored flash + next review interval
    - Hard rating shows bilingual encouragement
    - Reduced motion support disables drag
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SessionSetup pre-session configuration screen</name>
  <files>src/components/srs/SessionSetup.tsx</files>
  <action>
    Create `src/components/srs/SessionSetup.tsx`:

    **Props:**
    ```
    {
      totalDue: number;
      onStart: (sessionSize: number, timerEnabled: boolean) => void;
      onBack: () => void;
    }
    ```

    **Layout:**
    - Header: "Review Session / ပြန်လှည့်စစ်ဆေးခြင်း" with back button
    - Due count display: large number showing how many cards are due
    - Session size picker (per locked decision: user chooses 10, 20, or all due):
      - Three option buttons: "10 Cards", "20 Cards", "All (X) Cards"
      - Pre-select based on totalDue: if <= 10, select "All"; if <= 20, select "10"; else select "10"
      - Visual: pill-style radio buttons, selected has primary background
      - If totalDue < 10, only show "All (X)" option
      - Bilingual: "ကတ် ၁၀", "ကတ် ၂၀", "အားလုံး (X) ကတ်"
    - Timer toggle (per locked decision: optional timer):
      - Switch/checkbox with label "Enable Timer / အချိန်တိုင်းကိရိယာ ဖွင့်ပါ"
      - Default: off
      - Brief description: "Practice with time pressure / အချိန်ဖိအားဖြင့် လေ့ကျင့်ပါ"
    - Start button: prominent, primary variant
      - "Start Review / ပြန်လှည့်ခြင်းစတင်ပါ"
      - Disabled if totalDue === 0
    - Encouraging message if totalDue === 0:
      - "All caught up! Come back later. / အားလုံးပြန်လှည့်ပြီးပါပြီ! နောက်မှပြန်လာပါ။"
      - Show next due time if available

    **Visual:**
    - Use Card component for container
    - StaggeredList for animated option entry
    - Consistent with PracticePage config screen (Phase 4 04-08 pattern)
  </action>
  <verify>
    - `pnpm exec tsc --noEmit` passes
    - Component renders with 0 due cards (shows caught-up state)
    - Component renders with >0 due cards (shows size picker)
  </verify>
  <done>
    - Session size picker with 10/20/all options (bilingual)
    - Optional timer toggle
    - Start button with due count
    - Context-aware empty state for all-caught-up
  </done>
</task>

</tasks>

<verification>
- `pnpm exec tsc --noEmit` passes
- All three components export correctly
- No ESLint errors (no useMemo<T>(), no setState in effects)
</verification>

<success_criteria>
- ReviewCard reuses Flashcard3D with swipe-to-rate gesture overlay
- Swipe shows progressive color gradient (green right / orange left) with bilingual edge labels
- Rating feedback shows colored flash + bilingual next review interval text
- Hard rating shows bilingual encouragement message
- SessionSetup lets user choose session size (10/20/all) and toggle timer
- RatingButtons provide tap fallback with bilingual labels and icons
</success_criteria>

<output>
After completion, create `.planning/phases/05-spaced-repetition/05-06-SUMMARY.md`
</output>
