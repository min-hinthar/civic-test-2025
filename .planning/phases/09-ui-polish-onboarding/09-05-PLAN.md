---
phase: 09-ui-polish-onboarding
plan: 05
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/styles/globals.css
  - src/components/BilingualToast.tsx
  - src/components/ui/use-toast.ts
  - src/contexts/OfflineContext.tsx
  - src/components/AppNavigation.tsx
  - src/pages/TestPage.tsx
  - src/hooks/useSyncQueue.ts
  - src/lib/mastery/fsrsEngine.ts
autonomous: true

must_haves:
  truths:
    - "No bg-red-500 or text-red-600 remains in any src/ component"
    - "Destructive variant (warm red) used ONLY for data-loss and auth failure scenarios"
    - "Non-data-loss errors (sync failures, navigation locks, test errors) use warning variant"
    - "BilingualToast supports variant: 'warning' with orange styling"
    - "Form validation errors use warning orange, not destructive red"
  artifacts:
    - path: "src/components/BilingualToast.tsx"
      provides: "Warning variant added to toast with orange styling"
      contains: "warning"
    - path: "src/components/ui/use-toast.ts"
      provides: "Updated toast type to include warning variant"
      contains: "warning"
  key_links:
    - from: "src/components/BilingualToast.tsx"
      to: "src/components/ui/use-toast.ts"
      via: "Shared variant type definition"
      pattern: "variant"
    - from: "src/contexts/OfflineContext.tsx"
      to: "src/components/ui/use-toast.ts"
      via: "Toast calls reclassified from destructive to warning"
      pattern: "variant.*warning"
---

<objective>
Audit and fix all red color token usage. Reclassify non-data-loss destructive usages to a new warning variant. Add warning variant to the toast system. Replace the one remaining bg-red-500 in fsrsEngine.ts.

Purpose: The destructive token now uses warm red (hue ~10, set in plan 01). Non-data-loss errors must NOT show red -- they must use warning orange. This prevents the hue shift from making sync/nav errors look alarming.
Output: Clean red token audit with proper semantic color usage across the codebase.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-ui-polish-onboarding/09-RESEARCH.md

@src/components/BilingualToast.tsx
@src/components/ui/use-toast.ts
@src/contexts/OfflineContext.tsx
@src/components/AppNavigation.tsx
@src/pages/TestPage.tsx
@src/hooks/useSyncQueue.ts
@src/lib/mastery/fsrsEngine.ts
</context>

<instructions>
Use the /frontend-design skill for all UI design and implementation work in this phase. This is a locked user decision.

Red token replacement rules (locked decisions):
- Red allowed ONLY for: data-loss (delete account, clear history) AND auth failures (wrong password, session expired)
- Red uses warm red tone (rose/coral, hue ~5-15) -- already set in plan 01's destructive token
- Patriotic decorative red stays standard patriotic red
- All other error/incorrect states use warning-500 orange
- Form validation errors use warning orange
- Audit scope: own components in src/ only -- third-party libraries keep defaults
</instructions>

<tasks>

<task type="auto">
  <name>Task 1: Add Warning Variant to Toast System</name>
  <files>src/components/ui/use-toast.ts, src/components/BilingualToast.tsx</files>
  <action>
**use-toast.ts:**
- Find the variant type definition (likely `'default' | 'destructive'`)
- Add `'warning'` to the union: `'default' | 'destructive' | 'warning'`

**BilingualToast.tsx:**
- Find where toast styling is applied based on variant
- Add warning variant styling using orange tokens:
  - Background: `bg-warning-500` or `bg-warning-500/10` depending on the existing pattern
  - Text: `text-warning-foreground` or `text-warning-600`
  - Border: `border-warning-500/50`
  - Match the existing destructive variant pattern but with warning colors
- If BilingualToast uses a separate Toast primitive (like from Radix), update that primitive's variant styling too
- The warning variant should feel informational/cautionary, not alarming

Verify the existing toast API supports the new variant throughout the chain (toast function -> hook -> component rendering).
  </action>
  <verify>Run `npx tsc --noEmit`. Grep for `variant.*warning` in BilingualToast.tsx to confirm styling exists. Grep use-toast.ts for the variant type to confirm 'warning' is included.</verify>
  <done>Toast system supports variant: 'warning' with orange styling. Type definitions updated. BilingualToast renders warning variant correctly.</done>
</task>

<task type="auto">
  <name>Task 2: Reclassify Non-Data-Loss Destructive Usages and Fix Remaining Red</name>
  <files>src/contexts/OfflineContext.tsx, src/components/AppNavigation.tsx, src/pages/TestPage.tsx, src/hooks/useSyncQueue.ts, src/lib/mastery/fsrsEngine.ts</files>
  <action>
Systematically reclassify each non-data-loss `variant: 'destructive'` to `variant: 'warning'`:

**Reclassify to 'warning' (these are NOT data-loss scenarios):**
1. `OfflineContext.tsx` (~line 163): sync failure toast -> change `variant: 'destructive'` to `variant: 'warning'`
2. `AppNavigation.tsx` (~line 55): locked navigation toast -> change `variant: 'destructive'` to `variant: 'warning'`
3. `useSyncQueue.ts` (~line 87): sync failure toast -> change `variant: 'destructive'` to `variant: 'warning'`
4. `TestPage.tsx` (~lines 240, 283): test-related errors (not data loss) -> change to `variant: 'warning'`

**KEEP as 'destructive' (these ARE data-loss or auth failure):**
- `GoogleOneTapSignIn.tsx` (~lines 33, 93): auth errors -> KEEP destructive
- `PasswordUpdatePage.tsx` (~lines 21, 33, 41): auth errors -> KEEP destructive
- Any delete/clear-history confirmations -> KEEP destructive

**Fix remaining red class:**
5. `fsrsEngine.ts` (~line 186): Replace `bg-red-500` with `bg-warning-500` (due card indicator is not dangerous, it's informational)

**Full scan:** Run a search for `red-` across all `src/` files to catch any remaining hardcoded red classes. Exclude:
- Comments
- `patriotic-red` references (these are decorative and correct)
- Any in CSS variable definitions (those are already handled)
- Third-party library files

Replace any found `text-red-*` or `bg-red-*` with appropriate token:
- If data-loss context: `text-destructive` / `bg-destructive`
- If error/incorrect context: `text-warning-500` / `bg-warning-500`
- If decorative/patriotic: `text-patriotic-red` or keep as-is
  </action>
  <verify>Run `npx tsc --noEmit`. Run grep for `bg-red-` and `text-red-` across src/ -- should find zero matches (excluding patriotic-red CSS variables and comments). Run `npm run lint` to verify no lint errors.</verify>
  <done>All non-data-loss destructive usages reclassified to warning. No bg-red-500 or text-red-600 remains in components. fsrsEngine.ts uses bg-warning-500. Auth failures correctly remain destructive (warm red).</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- `grep -r "bg-red-" src/ --include="*.tsx" --include="*.ts"` returns only patriotic-red variable definitions or comments
- `grep -r "text-red-" src/ --include="*.tsx" --include="*.ts"` returns only patriotic-red variable definitions or comments
- OfflineContext sync failure toast uses `variant: 'warning'`
- AppNavigation locked nav toast uses `variant: 'warning'`
- GoogleOneTapSignIn auth error toast uses `variant: 'destructive'` (unchanged)
</verification>

<success_criteria>
Red token audit is complete. Destructive (warm red) reserved for data-loss and auth failures only. All other errors use warning (orange). No hardcoded red-* classes remain in components.
</success_criteria>

<output>
After completion, create `.planning/phases/09-ui-polish-onboarding/09-05-SUMMARY.md`
</output>
