---
phase: 30-mobile-native-feel
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/haptics.ts
autonomous: true
requirements:
  - MOBI-05

must_haves:
  truths:
    - "hapticLight(), hapticMedium(), and hapticHeavy() are all exported from haptics.ts"
    - "hapticHeavy() fires a multi-burst 'ta-da-da' vibration pattern (not a single pulse)"
    - "All haptic functions gracefully no-op on iOS/desktop where Vibration API is unsupported"
    - "hapticDouble() is retained for backward compatibility with existing consumers"
  artifacts:
    - path: "src/lib/haptics.ts"
      provides: "Three-tier haptic feedback utility with celebration pattern"
      exports: ["hapticLight", "hapticMedium", "hapticHeavy", "hapticDouble"]
  key_links:
    - from: "src/lib/haptics.ts"
      to: "navigator.vibrate"
      via: "Vibration API with feature detection"
      pattern: "navigator\\.vibrate"
---

<objective>
Expand the haptics.ts utility to implement the full three-tier haptic feedback system.

Purpose: Establish the centralized haptic feedback utility that all components will import from. The three-tier system (light/medium/heavy) matches the user's locked decisions for native-feel tactile feedback on every interaction type.

Output: Updated haptics.ts with hapticLight (10ms), hapticMedium (20ms), hapticHeavy (multi-burst ta-da-da pattern), and backward-compatible hapticDouble.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-mobile-native-feel/30-RESEARCH.md

@src/lib/haptics.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand haptics.ts with three-tier system and celebration pattern</name>
  <files>src/lib/haptics.ts</files>
  <action>
  Rewrite `src/lib/haptics.ts` to implement the full three-tier haptic feedback system per user decisions:

  **Keep existing:**
  - `supportsVibration` feature detection constant (already correct)
  - `hapticLight()` -- 10ms single pulse for every button tap, toggle, nav tap, TTS speak (already correct)
  - `hapticMedium()` -- 20ms single pulse for card flip, answer grade, mic start/stop, share success (already correct)
  - `hapticDouble()` -- [10, 50, 10] pattern for backward compatibility (already used in TestPage, PracticeSession, SkippedReviewPhase, useSortSession)

  **Add new:**
  - `hapticHeavy()` -- Multi-burst "ta-da-da" celebration pattern for streak rewards, badge unlocks, milestone celebrations. Use `navigator.vibrate([15, 30, 15, 30, 40])` which produces two short pulses with a longer final pulse (festive feel). Wrap in try/catch with silent ignore like existing functions.

  **Update JSDoc comments:**
  - `hapticLight`: "Light: every button tap, toggle, nav tap, TTS speak button (10ms)"
  - `hapticMedium`: "Medium: card flip, answer grade, mic start/stop, share success (20ms)"
  - `hapticHeavy`: "Heavy: streak reward, badge unlock, milestone -- multi-burst ta-da-da pattern"
  - `hapticDouble`: "Legacy double-tap pattern -- retained for backward compatibility"

  **Do NOT:**
  - Remove hapticDouble (existing consumers depend on it)
  - Add any React hooks or context -- this is a pure utility module
  - Call these from render or effects -- JSDoc should note "Call from event handlers only"
  </action>
  <verify>
  - `npm run typecheck` passes
  - `npm run lint` passes
  - Grep confirms all 4 exports: hapticLight, hapticMedium, hapticHeavy, hapticDouble
  - Grep confirms multi-burst pattern `[15, 30, 15, 30, 40]` in hapticHeavy
  - Existing consumers still compile: grep for `import.*haptic` in src/ shows no TypeScript errors
  </verify>
  <done>
  haptics.ts exports all four functions (light, medium, heavy, double). hapticHeavy implements multi-burst celebration pattern. All functions have updated JSDoc. Existing consumers unaffected.
  </done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- `npm run lint` passes
- haptics.ts exports hapticLight, hapticMedium, hapticHeavy, hapticDouble
- hapticHeavy uses multi-burst vibration pattern
- No existing import breaks
</verification>

<success_criteria>
1. hapticHeavy() exists and uses navigator.vibrate([15, 30, 15, 30, 40])
2. All existing exports retained (hapticLight, hapticMedium, hapticDouble)
3. JSDoc comments describe the three-tier system
4. typecheck and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/30-mobile-native-feel/30-02-SUMMARY.md`
</output>
