---
phase: 18-language-mode
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - src/components/navigation/Sidebar.tsx
  - src/components/navigation/BottomTabBar.tsx
autonomous: true

must_haves:
  truths:
    - "Desktop sidebar shows dual-flag toggle in utility controls area instead of Languages icon"
    - "Mobile bottom tab bar shows dual-flag toggle instead of Languages icon button"
    - "Flag toggle appears far right in nav, before settings/theme icons"
    - "First-time tooltip appears once pointing at the flag toggle, auto-dismisses after 5 seconds"
    - "In English mode, all nav labels show English text only (no Burmese label text)"
    - "In Myanmar mode, nav labels show Burmese text with font-myanmar class"
  artifacts:
    - path: "src/components/navigation/Sidebar.tsx"
      provides: "Desktop sidebar with FlagToggle replacing Languages icon"
    - path: "src/components/navigation/BottomTabBar.tsx"
      provides: "Mobile bottom bar with FlagToggle replacing Languages button"
  key_links:
    - from: "src/components/navigation/Sidebar.tsx"
      to: "src/components/ui/FlagToggle.tsx"
      via: "import and render"
      pattern: "FlagToggle"
    - from: "src/components/navigation/BottomTabBar.tsx"
      to: "src/components/ui/FlagToggle.tsx"
      via: "import and render"
      pattern: "FlagToggle"
---

<objective>
Wire the new FlagToggle component into both navigation surfaces (Sidebar and BottomTabBar), replacing the old Languages icon toggle. Add a one-time first-time tooltip.

Purpose: Users need to see and use the dual-flag toggle from the main navigation on both desktop and mobile.

Output: Updated Sidebar.tsx and BottomTabBar.tsx with FlagToggle integration and first-time tooltip.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/18-language-mode/18-01-SUMMARY.md
@src/components/navigation/Sidebar.tsx
@src/components/navigation/BottomTabBar.tsx
@src/components/ui/FlagToggle.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace Languages icon with FlagToggle in Sidebar</name>
  <files>src/components/navigation/Sidebar.tsx</files>
  <action>
1. **Remove** the `Languages` import from lucide-react (keep all other icon imports).

2. **Add import**: `import { FlagToggle } from '@/components/ui/FlagToggle';`

3. **Replace the language toggle SidebarUtilityButton** (the one with `icon={Languages}`, around lines 182-189) with a direct `FlagToggle` component render. In the utility controls section:

**Before:**
```tsx
<SidebarUtilityButton
  icon={Languages}
  label={showBurmese ? 'English' : 'မြန်မာ'}
  isExpanded={isExpanded}
  onClick={toggleMode}
  tooltip={showBurmese ? 'English' : 'Myanmar'}
  spring={spring}
/>
```

**After:**
```tsx
{/* Language toggle -- dual flag */}
<div className={isExpanded ? 'px-3 py-2' : 'flex justify-center py-2'}>
  <FlagToggle compact={!isExpanded} />
</div>
```

4. **Remove `toggleMode` from the useLanguage destructure** since FlagToggle handles toggling internally. Keep `showBurmese` (still used by NavItem).

5. **First-time tooltip**: Add a small one-time popover near the FlagToggle in Sidebar. Implementation:
   - Create a small local hook or inline state using `useState` + `localStorage`:
     ```typescript
     const TOOLTIP_KEY = 'civic-test-lang-tooltip-shown';
     const [showTooltip, setShowTooltip] = useState(() => {
       if (typeof window === 'undefined') return false;
       return !localStorage.getItem(TOOLTIP_KEY);
     });
     ```
   - Render a small absolute-positioned `motion.div` tooltip to the right of the FlagToggle when `showTooltip` is true:
     ```tsx
     {showTooltip && (
       <motion.div
         initial={{ opacity: 0, x: -8 }}
         animate={{ opacity: 1, x: 0 }}
         className="absolute left-full ml-2 top-1/2 -translate-y-1/2 z-50 whitespace-nowrap rounded-lg bg-foreground text-background px-3 py-1.5 text-xs font-medium shadow-lg"
       >
         Switch language mode
         <span className="absolute left-0 top-1/2 -translate-x-1 -translate-y-1/2 border-4 border-transparent border-r-foreground" />
       </motion.div>
     )}
     ```
   - Auto-dismiss after 5 seconds with `useEffect` + `setTimeout` that calls `setShowTooltip(false)` and `localStorage.setItem(TOOLTIP_KEY, 'true')`.
   - Wrap the FlagToggle + tooltip in a `relative` container div.
   - Only show tooltip in sidebar expanded mode (skip for collapsed sidebar).

6. **Position**: The FlagToggle should appear FIRST in the utility controls section (before theme toggle and logout), matching the "far right, before settings icon" decision (in sidebar this translates to "first utility control, before theme").
  </action>
  <verify>
- `npx tsc --noEmit` passes
- Sidebar renders FlagToggle instead of Languages icon
- No `Languages` import remains (unless used elsewhere -- check)
- First-time tooltip logic uses localStorage correctly
  </verify>
  <done>Sidebar displays dual-flag FlagToggle with first-time tooltip. Languages icon removed from language toggle position.</done>
</task>

<task type="auto">
  <name>Task 2: Replace Languages icon with FlagToggle in BottomTabBar</name>
  <files>src/components/navigation/BottomTabBar.tsx</files>
  <action>
1. **Remove** `Languages` from the lucide-react import (keep Sun, Moon, LogOut).

2. **Add import**: `import { FlagToggle } from '@/components/ui/FlagToggle';`

3. **Replace the language toggle button** (the `<button>` block around lines 83-101 that shows the Languages icon) with:
```tsx
{/* Language toggle -- dual flag */}
<div className="flex shrink-0 items-center justify-center min-w-[60px] min-h-[56px]">
  <FlagToggle compact />
</div>
```

4. **Remove `toggleMode` from the useLanguage destructure**. Keep `showBurmese` (still used by NavItem and utility label rendering).

5. **Update utility button labels** (theme toggle, sign out labels around lines 115-149): These already use `showBurmese` correctly for bilingual labels. No changes needed to them.

6. **First-time tooltip**: For BottomTabBar, use the same `TOOLTIP_KEY` localStorage check as Sidebar. If the tooltip was already shown in Sidebar, it won't show again in BottomTabBar (they share the same key). If the user first sees the app on mobile, show a small tooltip above the FlagToggle:
```tsx
{showTooltip && (
  <motion.div
    initial={{ opacity: 0, y: 4 }}
    animate={{ opacity: 1, y: 0 }}
    className="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 z-50 whitespace-nowrap rounded-lg bg-foreground text-background px-3 py-1.5 text-xs font-medium shadow-lg"
  >
    Switch language
    <span className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-foreground" />
  </motion.div>
)}
```
  - Same auto-dismiss logic (5 second timer + localStorage).
  - Wrap FlagToggle + tooltip in a `relative` container.
  </action>
  <verify>
- `npx tsc --noEmit` passes
- BottomTabBar renders FlagToggle instead of Languages icon
- `Languages` import removed
- Tooltip auto-dismisses and persists to localStorage
  </verify>
  <done>BottomTabBar displays dual-flag FlagToggle with first-time tooltip. Languages icon removed from language toggle position.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npm run lint` passes
- Both Sidebar and BottomTabBar import and render FlagToggle
- Old Languages icon is no longer used for language toggling in either component
- First-time tooltip shares localStorage key between both surfaces
</verification>

<success_criteria>
- Desktop sidebar shows FlagToggle with flag icons instead of Languages icon
- Mobile bottom bar shows FlagToggle with flag icons instead of Languages button
- First-time tooltip appears once and auto-dismisses
- Navigation labels still respect showBurmese for bilingual display
- No TypeScript or ESLint errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-language-mode/18-02-SUMMARY.md`
</output>
