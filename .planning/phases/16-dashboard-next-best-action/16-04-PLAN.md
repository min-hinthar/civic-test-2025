---
phase: 16-dashboard-next-best-action
plan: 04
type: execute
wave: 3
depends_on: [16-02, 16-03]
files_modified:
  - src/pages/Dashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard renders UpdateBanner at the very top"
    - "NBA hero card is the dominant visual element below the banner"
    - "Compact stat row with 4 glass cards appears below the NBA card"
    - "Category preview and Recent Activity cards appear side-by-side on desktop, stacked on mobile"
    - "Milestone and Badge celebration modals still function"
    - "Old sections removed: Quick Action Buttons, ReadinessIndicator, SRSWidget, StreakWidget, InterviewWidget, BadgeHighlights, LeaderboardWidget, CategoryGrid, SuggestedFocus, Overall Accuracy, Category Accuracy, Empty State"
    - "Welcome header is merged into NBA card (no separate welcome section)"
    - "Dashboard is dramatically simplified from ~655 lines to a clean composition"
  artifacts:
    - path: "src/pages/Dashboard.tsx"
      provides: "Simplified dashboard composing NBA + stats + previews + modals"
      contains: "NBAHeroCard"
  key_links:
    - from: "src/pages/Dashboard.tsx"
      to: "src/hooks/useNextBestAction.ts"
      via: "imports useNextBestAction hook"
      pattern: "useNextBestAction"
    - from: "src/pages/Dashboard.tsx"
      to: "src/components/dashboard/NBAHeroCard.tsx"
      via: "renders NBAHeroCard component"
      pattern: "NBAHeroCard"
    - from: "src/pages/Dashboard.tsx"
      to: "src/components/dashboard/CompactStatRow.tsx"
      via: "renders CompactStatRow component"
      pattern: "CompactStatRow"
    - from: "src/pages/Dashboard.tsx"
      to: "src/components/dashboard/CategoryPreviewCard.tsx"
      via: "renders CategoryPreviewCard component"
      pattern: "CategoryPreviewCard"
    - from: "src/pages/Dashboard.tsx"
      to: "src/components/dashboard/RecentActivityCard.tsx"
      via: "renders RecentActivityCard component"
      pattern: "RecentActivityCard"
---

<objective>
Rewrite Dashboard.tsx to compose the new NBA-focused layout, removing all redundant sections and dramatically simplifying the page.

Purpose: This is the culmination of Phase 16 -- transforming the overwhelming 16-section dashboard into a focused 5-section layout: UpdateBanner, NBA Hero Card, Compact Stat Row, Preview Cards, and Celebration Modals. The dashboard drops from ~655 lines to a clean ~150-200 line composition.

Output: Rewritten `src/pages/Dashboard.tsx` with the new layout.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/16-dashboard-next-best-action/16-RESEARCH.md
@.planning/phases/16-dashboard-next-best-action/16-01-SUMMARY.md
@.planning/phases/16-dashboard-next-best-action/16-02-SUMMARY.md
@.planning/phases/16-dashboard-next-best-action/16-03-SUMMARY.md
@src/pages/Dashboard.tsx (current 655-line file to rewrite)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite Dashboard.tsx with new NBA-focused layout</name>
  <files>src/pages/Dashboard.tsx</files>
  <action>
**Rewrite** (not modify) `src/pages/Dashboard.tsx`. The new dashboard is a simple composition of new components.

**New layout (top to bottom):**

1. **UpdateBanner** (kept as-is from current dashboard)
2. **NBA Hero Card** (or skeleton while loading)
3. **Compact Stat Row** (4 glass cards)
4. **Preview Cards** (Category + Recent Activity, side by side on md+)
5. **Milestone Celebration Modal** (kept)
6. **Badge Celebration Modal** (kept)

**Removed sections:**
- Welcome header with flags (merged into NBA card)
- ReadinessIndicator hero section
- Quick Action Buttons (Study/Test/Interview)
- SRS Widget
- Streak Widget
- Interview Dashboard Widget
- Badge Highlights
- Leaderboard Widget
- Category Progress (collapsible section)
- Suggested Focus
- Overall Accuracy
- Category Accuracy Breakdown
- Empty State (replaced by NBA new-user state)
- Settings icon button (available via sidebar/bottom bar nav)
- AmericanFlag/MyanmarFlag decorative components

**New imports needed:**
```typescript
import { useNextBestAction } from '@/hooks/useNextBestAction';
import { NBAHeroCard, NBAHeroSkeleton } from '@/components/dashboard/NBAHeroCard';
import { CompactStatRow } from '@/components/dashboard/CompactStatRow';
import { CategoryPreviewCard } from '@/components/dashboard/CategoryPreviewCard';
import { RecentActivityCard } from '@/components/dashboard/RecentActivityCard';
import { UpdateBanner } from '@/components/update/UpdateBanner';
import { MasteryMilestone } from '@/components/progress/MasteryMilestone';
import { BadgeCelebration } from '@/components/social/BadgeCelebration';
```

**Hooks needed in Dashboard:**
- `useNextBestAction()` -> `{ nbaState, isLoading: nbaLoading }`
- `useAuth()` -> `{ user }` (for testHistory for preview + badge checks)
- `useCategoryMastery()` -> `{ categoryMasteries, overallMastery, isLoading: masteryLoading }`
- `useStreak()` -> `{ currentStreak, longestStreak }`
- `useSRSWidget()` -> `{ dueCount: srsDueCount, isLoading: srsLoading }`
- `useMasteryMilestones()` -> `{ currentMilestone, dismissMilestone }`
- `useBadges()` -> `{ newlyEarnedBadge, dismissCelebration, earnedBadges }`
- `useLanguage()` -> `{ showBurmese }`
- `useOnboarding()` -> `{ shouldShow: isOnboarding }`
- `useReducedMotion()` -> `shouldReduceMotion`

**NOTE:** Some of these hooks (streak, SRS, mastery) are also called inside useNextBestAction. This is acceptable because React hooks are idempotent and the data is cached via useState/useMemo within each hook. The alternative (lifting all data out of useNextBestAction) would make the hook less self-contained. The hooks access the same IndexedDB data and the loading is not duplicated at the network level.

However, to compute uniqueQuestionsCount for the stat row, load it in Dashboard the same way HubPage does (getAnswerHistory -> unique set). This avoids exposing internal useNextBestAction state.

**Badge check data computation:**
Keep the existing badgeCheckData useMemo pattern from current Dashboard (it's needed for useBadges + composite score sync). Simplify if possible, but preserve the composite score sync useEffect.

**Stagger animation:**
Use motion.div with stagger delays for each section (NBA card, stat row, preview cards), matching the existing stagger pattern but with fewer items:
- NBA card: stagger(0) -- immediate
- Stat row: stagger(1) -- 0.08s delay
- Preview cards: stagger(2) -- 0.16s delay

When shouldReduceMotion, skip stagger animation props entirely.

**Responsive layout:**
```tsx
<div className="page-shell">
  <UpdateBanner showBurmese={showBurmese} className="mb-0" />
  <div className="mx-auto max-w-6xl px-4 sm:px-6 py-6 sm:py-10">
    {/* NBA Hero Card */}
    <motion.section className="mb-6" {...stagger(0)}>
      {nbaState ? <NBAHeroCard nbaState={nbaState} /> : <NBAHeroSkeleton />}
    </motion.section>

    {/* Compact Stat Row */}
    <motion.section className="mb-6" {...stagger(1)}>
      <CompactStatRow
        streak={currentStreak}
        mastery={overallMastery}
        srsDue={srsDueCount}
        practiced={uniqueQuestionsCount}
        totalQuestions={totalQuestions}
        isLoading={masteryLoading || streakLoading || srsLoading}
      />
    </motion.section>

    {/* Preview Cards */}
    <motion.div className="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4" {...stagger(2)}>
      <CategoryPreviewCard
        categoryMasteries={categoryMasteries}
        isLoading={masteryLoading}
      />
      <RecentActivityCard
        testHistory={history}
        isLoading={authLoading}
      />
    </motion.div>

    {/* Celebration modals */}
    <MasteryMilestone ... />
    <BadgeCelebration ... />
  </div>
</div>
```

**Preserve from current Dashboard:**
- Composite score sync to Supabase (the useEffect that calls updateCompositeScore)
- Badge check data computation (badgeCheckData useMemo)
- MasteryMilestone and BadgeCelebration with onboarding suppression
- `'use client'` directive

**Remove unused imports after rewrite:**
CategoryGrid, SuggestedFocus, SRSWidget, InterviewDashboardWidget, StreakWidget, BadgeHighlights, LeaderboardWidget, ReadinessIndicator, ProgressWithLabel, SectionHeading, AmericanFlag, MyanmarFlag, Settings icon, BookOpenCheck, ChevronDown, Flag, Mic, etc.

Also remove unused state: answerHistory, isCategoryCollapsed, categoryBreakdown, accuracy, recentTests, readinessScore, motivationalMessage, MOTIVATIONAL_MESSAGES, COLLAPSE_KEY, studyCardsLink, etc.

**Target: ~150-200 lines** (down from 655).
  </action>
  <verify>`npx tsc --noEmit` passes; `npm run build` succeeds with no errors</verify>
  <done>Dashboard.tsx is rewritten as a clean composition of NBA hero card, compact stat row, preview cards, and celebration modals; all old sections removed; file is ~150-200 lines</done>
</task>

<task type="auto">
  <name>Task 2: Clean up unused component imports and dead code</name>
  <files>src/pages/Dashboard.tsx</files>
  <action>
After the rewrite, verify there are no orphaned imports or dead code:

1. Run `npx tsc --noEmit` to catch any type errors
2. Run `npm run build` to verify the full build succeeds
3. Check that removed components (ReadinessIndicator, etc.) are still imported by other files. If any component is ONLY used by Dashboard.tsx and is now removed, note it but do NOT delete the component file (it may be useful in Phase 17 or other contexts).
4. Verify the Dashboard still:
   - Renders at the /home route (check AppShell.tsx or routes config if needed)
   - Has the `data-tour` attributes needed for onboarding (if any tour steps target dashboard elements). Check the onboarding tour config for dashboard-specific targets.
   - Exports as default export

**Tour target check:**
The current Dashboard has `data-tour="study-action"`, `data-tour="test-action"`, `data-tour="srs-deck"`, `data-tour="interview-sim"`. These were on the Quick Action Buttons and SRS widget which are now removed. Check the onboarding tour configuration to see if these targets are still referenced. If they are, the tour was likely updated in Phase 14-06 to target nav items instead. Verify and note any discrepancy.

5. Ensure the composite score sync useEffect has correct dependencies and doesn't reference removed variables.
  </action>
  <verify>`npm run build` succeeds with zero errors and zero warnings about unused variables; `npx tsc --noEmit` passes</verify>
  <done>Dashboard builds cleanly with no unused imports, no dead code, tour targets verified, composite score sync preserved</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds with zero errors
- `npx tsc --noEmit` passes
- Dashboard.tsx is under 250 lines
- NBA hero card renders as first prominent element
- Stat row renders with 4 stats
- Preview cards render in grid
- Milestone and badge celebration modals still present
- No removed components are accidentally still imported
</verification>

<success_criteria>
- Dashboard layout matches specification: Banner > NBA Card > Stat Row > Preview Cards > Modals
- All 11+ removed sections are gone (Quick Actions, Readiness, SRS Widget, Streak Widget, Interview Widget, Badges, Leaderboard, Category Grid, Suggested Focus, Accuracy, Empty State)
- Welcome header merged into NBA card (no separate header section)
- File reduced from ~655 lines to ~150-200 lines
- Build passes with no errors
- Composite score sync and badge detection preserved
</success_criteria>

<output>
After completion, create `.planning/phases/16-dashboard-next-best-action/16-04-SUMMARY.md`
</output>
