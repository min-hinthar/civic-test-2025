---
phase: 21-test-practice-ux
plan: 11
type: execute
wave: 4
depends_on: ["21-06", "21-07"]
files_modified:
  - src/components/quiz/StreakReward.tsx
  - src/components/quiz/XPPopup.tsx
  - src/pages/TestPage.tsx
  - src/components/practice/PracticeSession.tsx
  - src/lib/i18n/strings.ts
  - .planning/REQUIREMENTS.md
autonomous: true

must_haves:
  truths:
    - "Streak/XP micro-reward animation shows after consecutive correct answers"
    - "All quiz navigation works with keyboard only (TPUX-06)"
    - "Context-sensitive Enter key: Check when answer selected, Continue when feedback showing"
    - "Visible focus ring on all interactive quiz elements"
    - "INTV requirements added to REQUIREMENTS.md traceability"
  artifacts:
    - path: "src/components/quiz/StreakReward.tsx"
      provides: "Streak counter micro-reward animation"
      exports: ["StreakReward"]
    - path: "src/components/quiz/XPPopup.tsx"
      provides: "XP gain popup animation"
      exports: ["XPPopup"]
  key_links:
    - from: "src/pages/TestPage.tsx"
      to: "src/components/quiz/StreakReward.tsx"
      via: "renders streak animation on correct answers"
      pattern: "StreakReward"
---

<objective>
Add streak/XP micro-reward animations, finalize keyboard navigation polish, add new bilingual strings, and update REQUIREMENTS.md with INTV requirements.

Purpose: Complete the TPUX-08 (streak/XP animations), TPUX-06 (keyboard nav polish), and requirements traceability for interview features.
Output: StreakReward.tsx, XPPopup.tsx, keyboard nav polish, updated strings, INTV requirements in REQUIREMENTS.md
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-test-practice-ux/21-CONTEXT.md
@.planning/phases/21-test-practice-ux/21-06-SUMMARY.md
@.planning/phases/21-test-practice-ux/21-07-SUMMARY.md

@src/pages/TestPage.tsx
@src/components/practice/PracticeSession.tsx
@src/lib/i18n/strings.ts
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Streak/XP micro-reward animations</name>
  <files>src/components/quiz/StreakReward.tsx, src/components/quiz/XPPopup.tsx</files>
  <action>
**StreakReward.tsx** per locked decision (streak counter shows "X in a row!" badge):

Props:
```typescript
interface StreakRewardProps {
  count: number;         // Current streak count
  show: boolean;         // Trigger animation
}
```

Implementation:
- AnimatePresence + motion.div with scale + y entrance
- Shows at streak milestones: 3, 5, 7, 10, 15, 20 (not every single correct)
- At streak 3: "3 in a row!" with flame emoji icon (orange badge)
- At streak 5: "5 in a row!" with star (gold badge, slightly larger)
- At streak 10+: "10 in a row!" with trophy (purple badge, even larger, playStreak() sound)
- Badge floats up and fades out after 2 seconds
- Position: above the feedback panel, centered
- Bilingual: "X in a row!" / "X ဆက်တိုက်မှန်ပါတယ်!"
- Reduced motion: simple fade instead of scale+float

**XPPopup.tsx** (TPUX-08: streak/XP micro-reward):

Props:
```typescript
interface XPPopupProps {
  points: number;       // XP gained
  show: boolean;
}
```

Implementation:
- Small "+10 XP" popup that floats up from the answer area
- Correct answer: +10 XP (or +15 during streak)
- Uses motion.div with `initial={{ y: 0, opacity: 1 }}` -> `animate={{ y: -40, opacity: 0 }}` over 1.5s
- Gold/amber text color
- Position: top-right of the quiz area, absolute positioned
- Only shows briefly -- auto-removes after animation completes
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint`. Both components export correctly and animate.</verify>
  <done>StreakReward shows "X in a row!" badges at milestone streaks with celebratory animation and sound. XPPopup shows floating "+10 XP" gain indicator.</done>
</task>

<task type="auto">
  <name>Task 2: Keyboard nav polish, bilingual strings, and REQUIREMENTS.md update</name>
  <files>src/pages/TestPage.tsx, src/components/practice/PracticeSession.tsx, src/lib/i18n/strings.ts, .planning/REQUIREMENTS.md</files>
  <action>
**Keyboard navigation polish (TPUX-06):**

Add a `useQuizKeyboard` hook or inline keyboard handler in TestPage and PracticeSession:

- Context-sensitive Enter key per locked decision:
  - In 'answering' phase with selectedAnswer: dispatch CHECK
  - In 'feedback' phase: dispatch CONTINUE
  - In no phase or no selection: no-op
- Escape key: opens ExitConfirmDialog (already wired in QuizHeader, ensure it works globally)
- Tab order verified: options -> Skip -> Check per locked decision
- Auto-focus Continue button when feedback panel appears: already in FeedbackPanel (plan 03)
- Visible focus ring: ensure `ring-2 ring-primary ring-offset-2` is applied on all interactive quiz elements (Check button, Skip button, Continue button, answer options)
- Focus rings are ALWAYS visible (not just on keyboard focus) per locked decision -- use `focus:ring-2` not `focus-visible:ring-2`

Integrate StreakReward and XPPopup into both TestPage and PracticeSession:
- After SHOW_FEEDBACK action with isCorrect=true, show StreakReward if at milestone
- Show XPPopup for every correct answer
- Both render above the feedback panel

**Bilingual strings:**

Add to `src/lib/i18n/strings.ts` under appropriate sections:

```typescript
quiz: {
  check: { en: 'Check', my: 'စစ်ဆေးရန်' },
  continue: { en: 'Continue', my: 'ဆက်လက်ရန်' },
  skip: { en: 'Skip', my: 'ကျော်ရန်' },
  exitQuiz: { en: 'Exit Quiz?', my: 'စာမေးပွဲမှ ထွက်မည်လား?' },
  exitPractice: { en: 'Exit Practice?', my: 'လေ့ကျင့်ခန်းမှ ထွက်မည်လား?' },
  exitInterview: { en: 'Exit Interview?', my: 'အင်တာဗျူးမှ ထွက်မည်လား?' },
  progressSaved: { en: 'Your progress is saved. You can resume this session later.', my: 'သင်၏ တိုးတက်မှုကို သိမ်းဆည်းထားပါသည်။ နောက်မှ ပြန်လည်ဆက်လက်နိုင်ပါသည်။' },
  keepGoing: { en: 'Keep Going', my: 'ဆက်လက်ရန်' },
  exit: { en: 'Exit', my: 'ထွက်ရန်' },
  streakInRow: { en: 'in a row!', my: 'ဆက်တိုက်မှန်ပါတယ်!' },
  reviewingSkipped: { en: 'Reviewing Skipped Questions', my: 'ကျော်ထားသောမေးခွန်းများ ပြန်လည်စစ်ဆေးခြင်း' },
  finishWithoutReview: { en: 'Finish Without Reviewing', my: 'မစစ်ဆေးဘဲ ပြီးဆုံးရန်' },
  addAllToReviewDeck: { en: 'Add all wrong answers to review deck', my: 'မှားသောအဖြေများအားလုံးကို ပြန်လည်လေ့လာစာရင်းသို့ ထည့်ရန်' },
},
```

**REQUIREMENTS.md update:**

Add INTV requirements to the Requirements file (they are referenced in roadmap success criteria 6-8 but not yet defined):

```markdown
### Interview UX

- [ ] **INTV-01**: Interview uses chat-style layout with animated examiner character and voice input
- [ ] **INTV-02**: Interview offers Practice mode (per-question feedback) and Real mode (USCIS 2025 rules)
- [ ] **INTV-03**: Real mode follows USCIS 2025 rules: 20 questions, pass at 12 correct, fail at 9 incorrect
- [ ] **INTV-04**: Interview shows full transcript with per-answer grading and confidence scores in results
- [ ] **INTV-05**: User sees transcription before grading and can re-record up to 3 times
```

Add to Traceability table:
```
| INTV-01 | Phase 21 | Pending |
| INTV-02 | Phase 21 | Pending |
| INTV-03 | Phase 21 | Pending |
| INTV-04 | Phase 21 | Pending |
| INTV-05 | Phase 21 | Pending |
```

Update coverage count.
  </action>
  <verify>Run `npx tsc --noEmit`, `npm run lint`, `npm run build`. Verify keyboard navigation works: arrow keys move selection, Enter checks/continues, Escape exits. Verify REQUIREMENTS.md has INTV section.</verify>
  <done>Keyboard navigation polished with context-sensitive Enter, visible focus rings, and proper tab order. Streak/XP animations integrated. Bilingual strings added. INTV requirements documented in REQUIREMENTS.md.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- `npm run build` succeeds
- Arrow keys navigate answer options
- Enter triggers Check when answer selected, Continue when feedback showing
- Escape opens exit confirmation
- Streak badge appears at milestones (3, 5, 10)
- XP popup shows on correct answers
- REQUIREMENTS.md has INTV-01 through INTV-05
</verification>

<success_criteria>
- TPUX-06 (keyboard navigation) fully implemented
- TPUX-08 (streak/XP micro-rewards) fully implemented
- All bilingual strings added for quiz flow
- INTV requirements documented
</success_criteria>

<output>
After completion, create `.planning/phases/21-test-practice-ux/21-11-SUMMARY.md`
</output>
