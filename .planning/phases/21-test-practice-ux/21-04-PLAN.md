---
phase: 21-test-practice-ux
plan: 04
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - src/components/quiz/SegmentedProgressBar.tsx
  - src/components/quiz/QuizHeader.tsx
  - src/components/quiz/SkipButton.tsx
autonomous: true

must_haves:
  truths:
    - "Segmented progress bar shows color-coded segments per question"
    - "Current segment pulses with animation"
    - "Quiz header shows exit button, question info, and timer"
    - "Skip button exists alongside Check button"
  artifacts:
    - path: "src/components/quiz/SegmentedProgressBar.tsx"
      provides: "Full-width segmented progress bar with color-coded segments"
      exports: ["SegmentedProgressBar"]
    - path: "src/components/quiz/QuizHeader.tsx"
      provides: "Top bar with exit, question counter, timer slot"
      exports: ["QuizHeader"]
    - path: "src/components/quiz/SkipButton.tsx"
      provides: "Secondary skip button component"
      exports: ["SkipButton"]
  key_links:
    - from: "src/components/quiz/SegmentedProgressBar.tsx"
      to: "src/lib/quiz/quizTypes.ts"
      via: "uses QuizState for segment derivation"
      pattern: "import.*quizTypes"
---

<objective>
Create the SegmentedProgressBar, QuizHeader, and SkipButton components.

Purpose: These components provide the visual framework around the quiz flow -- progress tracking, navigation controls, and skip mechanics.
Output: SegmentedProgressBar.tsx, QuizHeader.tsx, SkipButton.tsx
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-test-practice-ux/21-CONTEXT.md
@.planning/phases/21-test-practice-ux/21-RESEARCH.md
@.planning/phases/21-test-practice-ux/21-01-SUMMARY.md

@src/lib/quiz/quizTypes.ts
@src/components/test/CircularTimer.tsx
@src/components/ui/Progress.tsx
@src/styles/tokens.css
@src/lib/motion-config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: SegmentedProgressBar component</name>
  <files>src/components/quiz/SegmentedProgressBar.tsx</files>
  <action>
Create `src/components/quiz/SegmentedProgressBar.tsx` implementing ALL locked decisions:

Props:
```typescript
type SegmentStatus = 'correct' | 'incorrect' | 'skipped' | 'current' | 'unanswered';

interface SegmentedProgressBarProps {
  segments: SegmentStatus[];
  currentIndex: number;
  totalCount: number;
  correctCount?: number;          // For live score (Practice only)
  allowTap?: boolean;             // Practice mode only
  onSegmentTap?: (index: number) => void;
  showLiveScore?: boolean;        // Practice only, hidden in Mock Test
  showBurmese: boolean;
}
```

Locked decisions:
- Full-width horizontal bar at top of quiz area (NOT sticky -- scrolls with content)
- Segment colors from design token palette:
  - correct: `bg-success` (green)
  - incorrect: `bg-warning` (amber/red)
  - unanswered: `bg-muted/30` (gray)
  - current: `bg-primary` (blue) with animated pulse (`animate-pulse` class)
  - skipped: `bg-amber-400` (amber-yellow, distinct from incorrect)
- Rounded/pill-like segment corners: `rounded-full`
- Smooth color fill transition: `transition-colors duration-300`
- Fraction label (e.g., "3/10") displayed alongside the bar
- Tappable segments in Practice mode only (NOT Mock Test) -- `allowTap` prop
- Review via segment tap is read-only (cannot change answers)
- Live score tally ("7/8 correct") in Practice mode only, hidden in Mock Test
- Completion animation: sparkle/glow effect when all segments filled -- use CSS box-shadow glow (`shadow-[0_0_12px_hsl(var(--success))]`) with transition
- Call `playCompletionSparkle()` sound effect when all segments filled

Performance optimization per research pitfall:
- Use `React.memo` on individual segments to avoid re-rendering all 20 on each state change
- Use CSS transitions (not motion/react) for segment color changes
- Only the current/active segment uses motion/react for pulse animation

Segment width strategy (Claude's discretion):
- For <=20 questions: equal flex segments (`flex-1`) with 2px gap
- Min segment width 8px on mobile, gracefully shrink
- On mobile: fraction label above bar (stacked), on desktop: inline alongside

Accessibility: `role="progressbar"` with `aria-valuenow` and `aria-valuemax`. Each segment has `aria-label="Question N: status"`.
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint`. Verify React.memo is applied to segment sub-component.</verify>
  <done>SegmentedProgressBar renders color-coded segments with animated current indicator, fraction label, optional live score, and tappable segments in Practice mode.</done>
</task>

<task type="auto">
  <name>Task 2: QuizHeader and SkipButton components</name>
  <files>src/components/quiz/QuizHeader.tsx, src/components/quiz/SkipButton.tsx</files>
  <action>
Create `src/components/quiz/QuizHeader.tsx`:

Props:
```typescript
interface QuizHeaderProps {
  questionNumber: number;
  totalQuestions: number;
  mode: 'mock-test' | 'practice';
  onExit: () => void;
  timerSlot?: React.ReactNode;   // CircularTimer or null
  showBurmese: boolean;
}
```

Implementation per locked decisions:
- Top bar with back/exit button (X icon from lucide-react), question info, and timer
- Exit button (X) triggers onExit callback which will show confirmation dialog
- Question number header: "Question 3 of 10" text
- Timer slot on the right side (renders CircularTimer for mock test, nothing for practice without timer)
- Sticky at top? No -- per user decision everything scrolls together. Just part of the scrollable flow.
- Escape key triggers exit: add `useEffect` with keydown listener for 'Escape' key -> calls onExit
- Bilingual question label when showBurmese

Create `src/components/quiz/SkipButton.tsx`:

Props:
```typescript
interface SkipButtonProps {
  onSkip: () => void;
  disabled?: boolean;
  showBurmese: boolean;
}
```

Implementation per locked decisions:
- Dedicated Skip button next to Check (side by side)
- Secondary/outline style (vs Check's primary/solid): `border-2 border-border bg-transparent text-muted-foreground`
- 3D chunky style matching Check but lighter visual weight
- Calls `playSkip()` sound effect and `hapticMedium()` on click
- SkipForward icon from lucide-react
- Tab order: options -> Skip -> Check (standard) per locked decision
- Min height 48px for touch target

Both components should use the existing BilingualButton pattern where appropriate. Import strings from `@/lib/i18n/strings` for bilingual labels.

Add skip/check labels to strings if they don't exist: `strings.quiz.skip`, `strings.quiz.check`, `strings.quiz.continue`.
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint`. Verify Escape key handler exists in QuizHeader.</verify>
  <done>QuizHeader provides exit button with Escape key binding, question counter, and timer slot. SkipButton provides outline-style skip with sound/haptic feedback. Tab order: options -> Skip -> Check.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- SegmentedProgressBar renders 5 segment states with correct colors
- SegmentedProgressBar calls `playCompletionSparkle()` when all segments filled (sound effect wiring)
- QuizHeader has Escape key listener
- SkipButton calls `playSkip()` and `hapticMedium()` on click (sound/haptic wiring)
</verification>

<success_criteria>
- SegmentedProgressBar implements all locked decisions (colors, pulse, fraction, tappable, live score, completion glow)
- QuizHeader has exit button, question info, timer slot, and Escape key handler
- SkipButton is secondary/outline style with proper tab order
</success_criteria>

<output>
After completion, create `.planning/phases/21-test-practice-ux/21-04-SUMMARY.md`
</output>
