---
phase: 05-spaced-repetition
plan: 07
type: execute
wave: 4
depends_on: ["05-05", "05-06"]
files_modified:
  - src/components/srs/ReviewSession.tsx
  - src/components/srs/SessionSummary.tsx
  - src/pages/StudyGuidePage.tsx
autonomous: true

must_haves:
  truths:
    - "User enters review session from Study Guide and sees cards one at a time with progress bar"
    - "User rates each card Easy/Hard and sees progress ('Card 7 of 15')"
    - "User can exit mid-session and reviewed cards save, remaining stay in queue"
    - "End-of-session shows summary stats and nudge to practice weak categories"
  artifacts:
    - path: "src/components/srs/ReviewSession.tsx"
      provides: "Full review session orchestrator (setup -> reviewing -> summary)"
      exports: ["ReviewSession"]
    - path: "src/components/srs/SessionSummary.tsx"
      provides: "End-of-session stats and weak category nudge"
      exports: ["SessionSummary"]
  key_links:
    - from: "src/components/srs/ReviewSession.tsx"
      to: "src/hooks/useSRSReview.ts"
      via: "useSRSReview() state machine"
      pattern: "useSRSReview"
    - from: "src/components/srs/ReviewSession.tsx"
      to: "src/components/srs/ReviewCard.tsx"
      via: "ReviewCard for each card display"
      pattern: "ReviewCard"
    - from: "src/pages/StudyGuidePage.tsx"
      to: "src/components/srs/ReviewSession.tsx"
      via: "hash route #review"
      pattern: "#review"
---

<objective>
Create the ReviewSession orchestrator that ties together SessionSetup, ReviewCard, and SessionSummary into a complete review experience, and wire it into the StudyGuidePage #review route.

Purpose: This is the core user-facing review flow -- the main feature of Phase 5. Users go through their due cards one at a time, rating each, and see their progress and results.
Output: Complete review session flow accessible from Study Guide.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-spaced-repetition/05-RESEARCH.md
@src/hooks/useSRSReview.ts
@src/components/srs/ReviewCard.tsx
@src/components/srs/RatingButtons.tsx
@src/components/srs/SessionSetup.tsx
@src/pages/StudyGuidePage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ReviewSession orchestrator and SessionSummary</name>
  <files>
    src/components/srs/ReviewSession.tsx
    src/components/srs/SessionSummary.tsx
  </files>
  <action>
    1. Create `src/components/srs/SessionSummary.tsx`:

    **Props:**
    ```
    {
      results: ReviewResult[];
      onDone: () => void;          // Go back to deck
      onPracticeWeak: () => void;  // Navigate to category practice
    }
    ```

    **Layout (per locked decision: summary stats + nudge to practice weak categories):**
    - Header: "Session Complete / စစ်ဆေးခြင်းပြီးပါပြီ"
    - Stats cards in a grid:
      - Total reviewed: results.length
      - Easy: results.filter(r => r.rating === 'easy').length (with green accent)
      - Hard: results.filter(r => r.rating === 'hard').length (with orange accent)
    - If any Hard results, show weak category nudge:
      - Group hard questions by category
      - "You might want to practice these categories: / ဤအမျိုးအစားများကို လေ့ကျင့်ပါ:"
      - List category names with "Practice" button linking to `/practice?category=X`
      - This connects to Phase 4 category practice (per user specific idea)
    - Encouraging bilingual message:
      - If all Easy: "Great memory! Keep it up! / မှတ်ဉာဏ်ကောင်းတယ်! ဆက်ကြိုးစားပါ!"
      - If mixed: "Good effort! Review builds strength. / ကောင်းတဲ့ကြိုးစားမှု! ပြန်လှည့်ခြင်းက အားတည်ဆောက်ပေးတယ်!"
      - If all Hard: "Every review helps! Keep going! / ပြန်လှည့်တိုင်းက အကူအညီပေးတယ်! ဆက်ကြိုးစားပါ!"
    - "Done" button: returns to deck manager
    - Use FadeIn animation for stats reveal

    2. Create `src/components/srs/ReviewSession.tsx`:

    **Props:** `{ onExit: () => void }` (called when user exits back to deck/study guide)

    **Implementation:**
    - Use `useSRSReview()` hook for state machine
    - Use `useSRS()` for dueCount (for SessionSetup totalDue)

    **Phase rendering:**

    a) **setup phase:** Render `<SessionSetup>` with:
       - totalDue from context
       - onStart: calls `startSession(size, timerEnabled)`
       - onBack: calls `onExit()`

    b) **reviewing phase:**
       - Progress bar at top: `<ProgressWithLabel>` showing `currentIndex / sessionSize`
       - Card count text: "Card {currentIndex + 1} of {sessionSize}" / "ကတ် {X} / {Y}" (per locked decision)
       - Optional timer display (if timerEnabled): simple count-up timer showing elapsed seconds. No auto-cutoff, just visual pressure simulation per user decision.
       - Current card: `<ReviewCard>` with:
         - record: cards[currentIndex]
         - isFlipped: local state, starts false for each new card
         - onFlip: toggle local flip state
         - onRate: async handler that:
           1. Shows rating feedback overlay (set showRatingFeedback state)
           2. Calls `rateCard(isEasy)` from hook
           3. After ~1.5s delay, clear feedback, reset flip state for next card
         - showRatingFeedback: local state for the feedback overlay
       - RatingButtons below card (visible after card is flipped -- only show when user can see the answer)
       - Exit button in corner: "Exit Session / ထွက်ပါ". Calls `exitSession()` which saves progress for reviewed cards (per locked decision: exit saves progress).

    c) **summary phase:** Render `<SessionSummary>` with:
       - results from hook
       - onDone: calls `onExit()`
       - onPracticeWeak: navigate to `/practice?category=X` for the first weak category

    **Card transition animation:**
    - Use AnimatePresence with key={currentIndex} for card entry/exit
    - Exit: slide out in swipe direction (left for Hard, right for Easy)
    - Enter: slide in from right with fade
    - Respect reduced motion

    IMPORTANT React Compiler rules:
    - Use useCallback for handlers passed to child components
    - No useMemo<T>() generics
    - Timer uses useEffect with cleanup (setInterval pattern, not ref-based)
  </action>
  <verify>
    - `pnpm exec tsc --noEmit` passes
    - ReviewSession renders in setup phase
    - SessionSummary renders with mock results
  </verify>
  <done>
    - ReviewSession orchestrates setup -> reviewing -> summary lifecycle
    - Progress bar and card count shown during session
    - Rating feedback with colored flash and interval text
    - Card transitions animated with AnimatePresence
    - Mid-session exit saves progress
    - SessionSummary shows stats and weak category nudge
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire ReviewSession into StudyGuidePage #review route</name>
  <files>src/pages/StudyGuidePage.tsx</files>
  <action>
    1. Replace the temporary #review placeholder (from plan 05) with the actual ReviewSession component:
       - When `isReviewView` is true: render `<ReviewSession onExit={() => navigate('/study#deck')} />`
       - Wrap in the standard page shell (AppNavigation at top)

    2. Update the DeckManager's "Start Review" button:
       - The `onStartReview` prop should navigate to `/study#review`
       - This was already set up in plan 05, but verify it connects correctly

    3. Ensure the flow works end-to-end:
       - /study -> "Review Deck" button -> /study#deck (DeckManager)
       - DeckManager "Start Review" -> /study#review (SessionSetup)
       - SessionSetup "Start" -> reviewing phase (cards)
       - Rating all cards or exit -> summary phase
       - Summary "Done" -> /study#deck (DeckManager)

    4. Add keyboard shortcut for rating during review:
       - Left arrow or 'h' key = Hard
       - Right arrow or 'e' key = Easy
       - Space or Enter = Flip card
       - Add useEffect with keydown listener in ReviewSession reviewing phase
       - Only active when card is flipped (answer visible)
  </action>
  <verify>
    - `pnpm exec tsc --noEmit` passes
    - /study#review renders ReviewSession
    - Navigation flow: study -> deck -> review -> summary -> deck
  </verify>
  <done>
    - ReviewSession live at /study#review
    - Full navigation flow: study guide -> deck -> review session -> summary -> back to deck
    - Keyboard shortcuts for rating (arrow keys, h/e keys)
    - Complete review experience accessible from Study Guide tab
  </done>
</task>

</tasks>

<verification>
- `pnpm exec tsc --noEmit` passes
- Full review flow compiles and renders
- Navigation: /study -> /study#deck -> /study#review -> summary -> /study#deck
- No ESLint errors
</verification>

<success_criteria>
- User enters review session, sees setup screen with session size options
- User reviews cards one at a time with progress bar ("Card X of Y")
- User rates Easy/Hard via swipe or tap buttons
- After rating, sees next review interval briefly
- Mid-session exit saves reviewed cards, remaining stay in queue
- End of session shows summary stats and nudge to practice weak categories
- Full flow navigable within Study Guide hash routes
</success_criteria>

<output>
After completion, create `.planning/phases/05-spaced-repetition/05-07-SUMMARY.md`
</output>
