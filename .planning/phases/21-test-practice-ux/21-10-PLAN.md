---
phase: 21-test-practice-ux
plan: 10
type: execute
wave: 4
depends_on: ["21-08"]
files_modified:
  - src/components/interview/InterviewResults.tsx
  - src/components/interview/InterviewTranscript.tsx
  - src/types/index.ts
autonomous: true

must_haves:
  truths:
    - "Interview results show full scrollable transcript with per-answer grading"
    - "Each answer bubble has color border (green/red) and check/X icon"
    - "Per-answer confidence score showing match quality"
    - "Early termination point shown in results"
    - "Interview-specific design distinct from test results"
  artifacts:
    - path: "src/components/interview/InterviewResults.tsx"
      provides: "Redesigned interview-specific results screen"
    - path: "src/components/interview/InterviewTranscript.tsx"
      provides: "Full scrollable transcript with per-answer grading"
      exports: ["InterviewTranscript"]
  key_links:
    - from: "src/components/interview/InterviewResults.tsx"
      to: "src/components/interview/InterviewTranscript.tsx"
      via: "renders transcript"
      pattern: "InterviewTranscript"
    - from: "src/components/interview/InterviewResults.tsx"
      to: "src/components/celebrations/Confetti.tsx"
      via: "renders confetti on pass"
      pattern: "Confetti"
---

<objective>
Redesign the interview results screen with full transcript, confidence scores, comparison to previous attempts, and interview-specific aesthetics.

Purpose: Create an interview-specific results experience that matches the chat/interview aesthetic and provides detailed performance analysis.
Output: Refactored InterviewResults.tsx, new InterviewTranscript.tsx
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-test-practice-ux/21-CONTEXT.md
@.planning/phases/21-test-practice-ux/21-08-SUMMARY.md

@src/components/interview/InterviewResults.tsx
@src/components/interview/ExaminerCharacter.tsx
@src/components/interview/ChatBubble.tsx
@src/components/celebrations/Confetti.tsx
@src/components/celebrations/CountUpScore.tsx
@src/components/social/ShareButton.tsx
@src/components/srs/AddToDeckButton.tsx
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update InterviewResult type and InterviewTranscript component</name>
  <files>src/types/index.ts, src/components/interview/InterviewTranscript.tsx</files>
  <action>
**Update `src/types/index.ts`:**

Extend the InterviewResult interface to include new fields (backward compatible -- all new fields optional):

```typescript
export interface InterviewResult {
  questionId: string;
  questionText_en: string;
  questionText_my: string;
  correctAnswers: Array<{ text_en: string; text_my: string }>;
  selfGrade: 'correct' | 'incorrect';
  category: Category;
  // New fields for speech recognition interview:
  transcript?: string;          // What user said (transcribed)
  confidence?: number;          // 0-1 match quality from grader
  responseTimeMs?: number;      // Time from question end to answer submit
  matchedKeywords?: string[];   // Keywords that matched
  missingKeywords?: string[];   // Keywords user missed
  difficulty?: 'easy' | 'medium' | 'hard';  // Based on historical data
}
```

Also add difficulty classification helper:
```typescript
// In a new file or inline: derive difficulty from category + historical pass rate
// Easy: >80% pass rate historically, Medium: 50-80%, Hard: <50%
```

**InterviewTranscript.tsx:**

Props:
```typescript
interface InterviewTranscriptProps {
  results: InterviewResult[];
  mode: InterviewMode;
  endReason: InterviewEndReason;
  earlyTerminationIndex?: number;  // Question index where interview ended early
  showBurmese: boolean;
}
```

Implementation per locked decisions:
- Full scrollable transcript using ChatBubble components
- For each question/answer pair:
  - Examiner ChatBubble with question text (left-aligned)
  - User ChatBubble with transcript or "[Self-graded]" (right-aligned)
  - Color border: green for correct, red for incorrect per locked decision
  - Check/X icon in corner of user bubble per locked decision
  - Confidence badge showing "85% match" per locked decision
  - Difficulty indicator per question (easy/medium/hard pill badge)
  - Incorrect answers: tap to reveal correct answer (expandable, NOT inline per locked decision) -- use a collapsed section with "Show correct answer" link
- Early termination point: visual marker in transcript (e.g., "Interview ended at question 15 — you passed!") per locked decision -- horizontal divider with message
- Auto-scroll to the first incorrect answer for quick review
- AddToDeckButton on each incorrect answer for SRS integration
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint`. Verify InterviewResult type is backward compatible (all new fields optional).</verify>
  <done>InterviewResult type extended with transcript, confidence, responseTime fields. InterviewTranscript renders full chat-style transcript with color-coded answers, confidence scores, difficulty indicators, and expandable correct answers.</done>
</task>

<task type="auto">
  <name>Task 2: InterviewResults screen redesign</name>
  <files>src/components/interview/InterviewResults.tsx</files>
  <action>
Major refactor of InterviewResults.tsx per locked decisions:

**Interview-specific design** (NOT shared with test results per locked decision):
- Darker/moody color theme matching interview session (gradient background)
- US flag SVG motif in background (subtle, low opacity)
- ExaminerCharacter at top in 'idle' state
- Uses ChatBubble aesthetic for sections

**Score Section:**
- Big CountUpScore component with animated count-up
- Pass/fail indicator: glowing green badge for pass, amber for fail
- Examiner closing statement via TTS: "Congratulations, you passed!" or "You'll do better next time"
- Confetti on passing (same as test mode per locked decision): confetti + glow badge + sound effect

**Analytics Section:**
- Score breakdown: X/20 correct, time taken
- Comparison to previous attempts (fetch from interviewStore.getInterviewHistory())
- Show improvement/regression from last attempt
- Category breakdown (which topics strong/weak)
- Per-answer confidence score distribution (average confidence, min/max)
- Performance trend chart (Claude's discretion: include as simple sparkline using existing recharts dependency)

**Transcript Section:**
- Render `<InterviewTranscript>` with full results
- Early termination point shown (e.g., "Interview ended at question 15 — you passed!")

**Action Buttons per locked decisions:**
- Retry: Start new interview with same mode
- Review: Scroll to transcript section
- Home: Navigate to dashboard
- Share: ShareButton with interview-branded format ("USCIS Interview Simulation" branding)

**SRS Integration per locked decision:**
- Batch offer: "Add X wrong answers to your review deck?" banner with "Add All" button
- Same pattern as test results but with interview branding

**Personalized recommendation (Claude's discretion):**
- If score >= 16/20: "You're ready for the real interview! Consider scheduling your appointment."
- If score 12-15/20: "You're close! Focus on [weak category] to boost your score."
- If score < 12/20: "Keep practicing! Review the topics below and try again."

Keep the existing data persistence (saveInterviewSession, recordAnswer) and chart functionality (recharts line chart for history).
  </action>
  <verify>Run `npx tsc --noEmit`, `npm run lint`, `npm run build`. Navigate to interview results after completing an interview -- verify score, transcript, confetti, and action buttons render.</verify>
  <done>InterviewResults redesigned with interview-specific dark aesthetic, full transcript, confidence scores, comparison to previous attempts, SRS batch offer, and personalized recommendations.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- `npm run build` succeeds
- Interview results show full transcript with color-coded answers
- Confidence scores displayed per answer
- Early termination point marked in transcript
- Confetti on passing, sound effect plays
- Share button works with interview branding
</verification>

<success_criteria>
- Interview-specific results design distinct from test results
- Full transcript with per-answer grading, confidence, difficulty
- Early termination point visible
- SRS batch offer for wrong answers
- Comparison to previous attempts
- All locked decisions implemented
</success_criteria>

<output>
After completion, create `.planning/phases/21-test-practice-ux/21-10-SUMMARY.md`
</output>
