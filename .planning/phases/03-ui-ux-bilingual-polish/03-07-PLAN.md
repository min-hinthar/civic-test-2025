---
phase: 03-ui-ux-bilingual-polish
plan: 07
type: execute
wave: 3
depends_on: ["03-01", "03-02"]
files_modified:
  - src/components/study/Flashcard3D.tsx
  - src/components/study/FlashcardStack.tsx
  - src/components/onboarding/OnboardingTour.tsx
  - src/hooks/useOnboarding.ts
autonomous: true

must_haves:
  truths:
    - "Flashcards flip with 3D rotation animation"
    - "Card has physical paper-like texture"
    - "First-time users see guided tooltip walkthrough"
    - "Onboarding is skippable but completion encouraged"
  artifacts:
    - path: "src/components/study/Flashcard3D.tsx"
      provides: "3D flip flashcard with paper texture"
      exports: ["Flashcard3D"]
    - path: "src/components/study/FlashcardStack.tsx"
      provides: "Swipeable flashcard stack for mobile"
      exports: ["FlashcardStack"]
    - path: "src/components/onboarding/OnboardingTour.tsx"
      provides: "Joyride-based guided walkthrough"
      exports: ["OnboardingTour"]
    - path: "src/hooks/useOnboarding.ts"
      provides: "Onboarding state management"
      exports: ["useOnboarding"]
  key_links:
    - from: "src/components/study/Flashcard3D.tsx"
      to: "motion/react"
      via: "3D transform animation"
      pattern: "rotateY"
    - from: "src/components/onboarding/OnboardingTour.tsx"
      to: "react-joyride"
      via: "Tour component"
      pattern: "Joyride"
---

<objective>
Create 3D flip flashcard component for study guide and guided onboarding walkthrough for first-time users.

Purpose: Physical flashcard aesthetic makes studying feel tactile and engaging. Onboarding walkthrough helps new users (especially those less tech-comfortable) discover features without feeling lost.

Output: Flashcard3D with 3D flip, FlashcardStack with swipe gestures, OnboardingTour with Joyride.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-ui-ux-bilingual-polish/03-CONTEXT.md
@.planning/phases/03-ui-ux-bilingual-polish/03-RESEARCH.md
@src/pages/StudyGuidePage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Flashcard3D component with 3D flip animation</name>
  <files>
    src/components/study/Flashcard3D.tsx
  </files>
  <action>
Create directory `src/components/study/` if it doesn't exist.

Create `src/components/study/Flashcard3D.tsx`:

```typescript
'use client';

import { useState, useCallback, KeyboardEvent } from 'react';
import { motion } from 'motion/react';
import { Volume2 } from 'lucide-react';
import { clsx } from 'clsx';
import { useReducedMotion } from '@/hooks/useReducedMotion';
import SpeechButton from '@/components/ui/SpeechButton';

interface Flashcard3DProps {
  /** Question text (front of card) */
  questionEn: string;
  questionMy: string;
  /** Answer text (back of card) */
  answerEn: string;
  answerMy: string;
  /** Category for gradient styling */
  category?: string;
  /** Called when card is flipped */
  onFlip?: (isFlipped: boolean) => void;
  /** Additional class names */
  className?: string;
}

// Category to gradient mapping
const categoryGradients: Record<string, string> = {
  'Principles of American Democracy': 'from-rose-500/10 to-pink-500/10',
  'System of Government': 'from-blue-500/10 to-cyan-500/10',
  'Rights and Responsibilities': 'from-emerald-500/10 to-lime-500/10',
  'American History: Colonial Period and Independence': 'from-amber-500/10 to-orange-500/10',
  'American History: 1800s': 'from-fuchsia-500/10 to-purple-500/10',
  'Recent American History and Other Important Historical Information': 'from-sky-500/10 to-indigo-500/10',
  'Civics: Symbols and Holidays': 'from-slate-500/10 to-stone-500/10',
};

/**
 * 3D flip flashcard with physical paper-like texture.
 *
 * Features:
 * - 3D rotation in Y-axis space
 * - Paper-like texture with subtle shadow
 * - Tap/click to flip
 * - Keyboard accessible (Enter/Space to flip)
 * - TTS buttons for both languages
 * - Respects prefers-reduced-motion (instant flip)
 *
 * Usage:
 * ```tsx
 * <Flashcard3D
 *   questionEn="What is the supreme law of the land?"
 *   questionMy="á€á€­á€¯á€„á€ºá€¸á€•á€¼á€Šá€ºáá€¡á€™á€¼á€„á€·á€ºá€†á€¯á€¶á€¸á€¥á€•á€’á€±á€€á€¬á€¸á€¡á€˜á€šá€ºá€”á€Šá€ºá€¸á‹"
 *   answerEn="The Constitution"
 *   answerMy="á€–á€½á€²á€·á€…á€Šá€ºá€¸á€•á€¯á€¶á€¡á€á€¼á€±á€á€¶á€¥á€•á€’á€±"
 * />
 * ```
 */
export function Flashcard3D({
  questionEn,
  questionMy,
  answerEn,
  answerMy,
  category,
  onFlip,
  className,
}: Flashcard3DProps) {
  const [isFlipped, setIsFlipped] = useState(false);
  const shouldReduceMotion = useReducedMotion();

  const handleFlip = useCallback(() => {
    const newState = !isFlipped;
    setIsFlipped(newState);
    onFlip?.(newState);
  }, [isFlipped, onFlip]);

  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        handleFlip();
      }
    },
    [handleFlip]
  );

  const gradient = category ? categoryGradients[category] : 'from-primary-500/10 to-primary-600/10';

  // Common card styles
  const cardFaceClasses = clsx(
    'absolute inset-0 w-full h-full',
    'rounded-2xl border border-border/60',
    'bg-card shadow-xl',
    'p-6 flex flex-col',
    'backface-hidden' // CSS for hiding back face
  );

  // Paper texture overlay
  const paperTexture = (
    <div
      className="absolute inset-0 rounded-2xl opacity-30 pointer-events-none"
      style={{
        backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`,
        mixBlendMode: 'overlay',
      }}
      aria-hidden="true"
    />
  );

  return (
    <div
      className={clsx(
        'relative w-full aspect-[3/4] max-w-sm mx-auto cursor-pointer',
        'perspective-1000', // Enable 3D space
        className
      )}
      style={{ perspective: '1000px' }}
      onClick={handleFlip}
      onKeyDown={handleKeyDown}
      tabIndex={0}
      role="button"
      aria-pressed={isFlipped}
      aria-label={isFlipped ? 'Flip to question' : 'Flip to answer'}
    >
      <motion.div
        className="relative w-full h-full"
        style={{ transformStyle: 'preserve-3d' }}
        animate={{
          rotateY: isFlipped ? 180 : 0,
        }}
        transition={
          shouldReduceMotion
            ? { duration: 0 }
            : { type: 'spring', stiffness: 300, damping: 25 }
        }
      >
        {/* Front - Question */}
        <div
          className={cardFaceClasses}
          style={{ backfaceVisibility: 'hidden' }}
        >
          <div className={clsx('absolute inset-0 rounded-2xl bg-gradient-to-br', gradient)} />
          {paperTexture}

          <div className="relative z-10 flex-1 flex flex-col">
            {/* Category badge */}
            {category && (
              <span className="text-xs uppercase tracking-wider text-muted-foreground mb-2">
                {category}
              </span>
            )}

            {/* Question label */}
            <div className="text-sm font-medium text-primary-500 mb-2">
              Question / á€™á€±á€¸á€á€½á€”á€ºá€¸
            </div>

            {/* Question text */}
            <div className="flex-1 flex flex-col justify-center">
              <p className="text-lg font-semibold text-foreground leading-relaxed">
                {questionEn}
              </p>
              <p className="mt-2 text-base font-myanmar text-muted-foreground leading-relaxed">
                {questionMy}
              </p>
            </div>

            {/* TTS and flip hint */}
            <div className="flex items-center justify-between mt-4">
              <SpeechButton text={questionEn} lang="en" size="sm" />
              <span className="text-xs text-muted-foreground">
                Tap to flip Â· á€œá€¾á€Šá€·á€ºá€›á€”á€º á€”á€¾á€­á€•á€ºá€•á€«
              </span>
            </div>
          </div>
        </div>

        {/* Back - Answer */}
        <div
          className={cardFaceClasses}
          style={{
            backfaceVisibility: 'hidden',
            transform: 'rotateY(180deg)',
          }}
        >
          <div className="absolute inset-0 rounded-2xl bg-gradient-to-br from-success-500/10 to-emerald-500/10" />
          {paperTexture}

          <div className="relative z-10 flex-1 flex flex-col">
            {/* Answer label */}
            <div className="text-sm font-medium text-success-500 mb-2">
              Answer / á€¡á€–á€¼á€±
            </div>

            {/* Answer text */}
            <div className="flex-1 flex flex-col justify-center">
              <p className="text-xl font-bold text-foreground leading-relaxed">
                {answerEn}
              </p>
              <p className="mt-3 text-lg font-myanmar text-muted-foreground leading-relaxed">
                {answerMy}
              </p>
            </div>

            {/* TTS and flip hint */}
            <div className="flex items-center justify-between mt-4">
              <div className="flex gap-2">
                <SpeechButton text={answerEn} lang="en" size="sm" />
                <SpeechButton text={answerMy} lang="my" size="sm" />
              </div>
              <span className="text-xs text-muted-foreground">
                Tap to flip Â· á€œá€¾á€Šá€·á€ºá€›á€”á€º á€”á€¾á€­á€•á€ºá€•á€«
              </span>
            </div>
          </div>
        </div>
      </motion.div>
    </div>
  );
}
```

Add CSS for backface-hidden to globals.css:

```css
/* Add to globals.css */
.backface-hidden {
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}
```
  </action>
  <verify>
Import Flashcard3D in StudyGuidePage.
Render with question and answer props.
Click card - verify 3D rotation animation.
Press Enter/Space - should also flip.
  </verify>
  <done>
Flashcard3D component with 3D rotation, paper texture, and accessibility.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FlashcardStack with swipe gestures</name>
  <files>
    src/components/study/FlashcardStack.tsx
  </files>
  <action>
Create `src/components/study/FlashcardStack.tsx`:

```typescript
'use client';

import { useState, useCallback } from 'react';
import { motion, AnimatePresence, PanInfo } from 'motion/react';
import { ChevronLeft, ChevronRight } from 'lucide-react';
import { clsx } from 'clsx';
import { useReducedMotion } from '@/hooks/useReducedMotion';
import { Flashcard3D } from './Flashcard3D';
import type { Question } from '@/types';

interface FlashcardStackProps {
  /** Array of questions to display */
  questions: Question[];
  /** Starting index */
  startIndex?: number;
  /** Called when index changes */
  onIndexChange?: (index: number) => void;
  /** Additional class names */
  className?: string;
}

const SWIPE_THRESHOLD = 50;

/**
 * Swipeable flashcard stack for mobile.
 *
 * Features:
 * - Horizontal swipe left/right to navigate
 * - Stacked card visual (next card peeking behind)
 * - Navigation arrows for desktop
 * - Progress indicator
 * - Respects prefers-reduced-motion
 *
 * Usage:
 * ```tsx
 * <FlashcardStack questions={civicsQuestions} />
 * ```
 */
export function FlashcardStack({
  questions,
  startIndex = 0,
  onIndexChange,
  className,
}: FlashcardStackProps) {
  const [currentIndex, setCurrentIndex] = useState(startIndex);
  const [direction, setDirection] = useState(0);
  const shouldReduceMotion = useReducedMotion();

  const goToNext = useCallback(() => {
    if (currentIndex < questions.length - 1) {
      setDirection(1);
      const newIndex = currentIndex + 1;
      setCurrentIndex(newIndex);
      onIndexChange?.(newIndex);
    }
  }, [currentIndex, questions.length, onIndexChange]);

  const goToPrev = useCallback(() => {
    if (currentIndex > 0) {
      setDirection(-1);
      const newIndex = currentIndex - 1;
      setCurrentIndex(newIndex);
      onIndexChange?.(newIndex);
    }
  }, [currentIndex, onIndexChange]);

  const handleDragEnd = useCallback(
    (_: unknown, info: PanInfo) => {
      const offset = info.offset.x;
      const velocity = info.velocity.x;

      if (offset < -SWIPE_THRESHOLD || velocity < -500) {
        goToNext();
      } else if (offset > SWIPE_THRESHOLD || velocity > 500) {
        goToPrev();
      }
    },
    [goToNext, goToPrev]
  );

  const currentQuestion = questions[currentIndex];

  // Slide variants
  const variants = {
    enter: (dir: number) => ({
      x: dir > 0 ? 300 : -300,
      opacity: 0,
    }),
    center: {
      x: 0,
      opacity: 1,
    },
    exit: (dir: number) => ({
      x: dir > 0 ? -300 : 300,
      opacity: 0,
    }),
  };

  return (
    <div className={clsx('relative', className)}>
      {/* Progress indicator */}
      <div className="text-center mb-4 text-sm text-muted-foreground">
        <span className="font-semibold text-foreground">{currentIndex + 1}</span>
        <span className="mx-1">/</span>
        <span>{questions.length}</span>
        <span className="ml-2 font-myanmar">
          ({currentIndex + 1} á€™á€¾ {questions.length})
        </span>
      </div>

      {/* Card container with swipe */}
      <div className="relative min-h-[400px]">
        <AnimatePresence mode="wait" custom={direction}>
          <motion.div
            key={currentIndex}
            custom={direction}
            variants={shouldReduceMotion ? {} : variants}
            initial={shouldReduceMotion ? 'center' : 'enter'}
            animate="center"
            exit={shouldReduceMotion ? 'center' : 'exit'}
            transition={{
              type: 'spring',
              stiffness: 300,
              damping: 30,
            }}
            drag={shouldReduceMotion ? false : 'x'}
            dragConstraints={{ left: 0, right: 0 }}
            dragElastic={0.2}
            onDragEnd={handleDragEnd}
            className="cursor-grab active:cursor-grabbing"
          >
            <Flashcard3D
              questionEn={currentQuestion.question_en}
              questionMy={currentQuestion.question_my}
              answerEn={currentQuestion.answers.find(a => a.correct)?.text_en ?? ''}
              answerMy={currentQuestion.answers.find(a => a.correct)?.text_my ?? ''}
              category={currentQuestion.category}
            />
          </motion.div>
        </AnimatePresence>

        {/* Navigation arrows */}
        <button
          onClick={goToPrev}
          disabled={currentIndex === 0}
          className={clsx(
            'absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4',
            'h-12 w-12 rounded-full bg-card border border-border shadow-lg',
            'flex items-center justify-center',
            'text-muted-foreground hover:text-foreground hover:bg-muted/50',
            'transition-all disabled:opacity-30 disabled:cursor-not-allowed',
            'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500',
            'hidden sm:flex' // Hide on mobile (swipe instead)
          )}
          aria-label="Previous card"
        >
          <ChevronLeft className="h-6 w-6" />
        </button>

        <button
          onClick={goToNext}
          disabled={currentIndex === questions.length - 1}
          className={clsx(
            'absolute right-0 top-1/2 -translate-y-1/2 translate-x-4',
            'h-12 w-12 rounded-full bg-card border border-border shadow-lg',
            'flex items-center justify-center',
            'text-muted-foreground hover:text-foreground hover:bg-muted/50',
            'transition-all disabled:opacity-30 disabled:cursor-not-allowed',
            'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500',
            'hidden sm:flex'
          )}
          aria-label="Next card"
        >
          <ChevronRight className="h-6 w-6" />
        </button>
      </div>

      {/* Swipe hint for mobile */}
      <p className="text-center text-xs text-muted-foreground mt-4 sm:hidden">
        Swipe left/right to navigate Â· á€˜á€šá€ºá€Šá€¬á€•á€½á€á€ºá€†á€½á€²á€•á€«
      </p>
    </div>
  );
}

export default FlashcardStack;
```
  </action>
  <verify>
Import FlashcardStack with an array of questions.
Swipe left on mobile/touch device - should go to next.
Click arrows on desktop - should navigate.
Progress counter should update.
  </verify>
  <done>
FlashcardStack with horizontal swipe navigation and progress indicator.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create OnboardingTour with react-joyride</name>
  <files>
    src/components/onboarding/OnboardingTour.tsx
    src/hooks/useOnboarding.ts
  </files>
  <action>
Create directory `src/components/onboarding/` if it doesn't exist.

Create `src/hooks/useOnboarding.ts`:

```typescript
'use client';

import { useState, useCallback, useEffect } from 'react';

const ONBOARDING_KEY = 'civic-test-onboarding-complete';

export interface OnboardingState {
  hasCompleted: boolean;
  shouldShow: boolean;
  complete: () => void;
  skip: () => void;
  reset: () => void;
}

/**
 * Hook to manage onboarding tour state.
 *
 * Features:
 * - Persists completion to localStorage
 * - Can be reset for testing
 * - SSR-safe lazy initialization
 */
export function useOnboarding(): OnboardingState {
  const [hasCompleted, setHasCompleted] = useState(() => {
    if (typeof window === 'undefined') return true; // SSR: assume complete
    return localStorage.getItem(ONBOARDING_KEY) === 'true';
  });

  const complete = useCallback(() => {
    setHasCompleted(true);
    localStorage.setItem(ONBOARDING_KEY, 'true');
  }, []);

  const skip = useCallback(() => {
    setHasCompleted(true);
    localStorage.setItem(ONBOARDING_KEY, 'true');
  }, []);

  const reset = useCallback(() => {
    setHasCompleted(false);
    localStorage.removeItem(ONBOARDING_KEY);
  }, []);

  return {
    hasCompleted,
    shouldShow: !hasCompleted,
    complete,
    skip,
    reset,
  };
}
```

Create `src/components/onboarding/OnboardingTour.tsx`:

```typescript
'use client';

import { useState, useCallback } from 'react';
import Joyride, { Step, CallBackProps, STATUS, EVENTS, ACTIONS } from 'react-joyride';
import { useOnboarding } from '@/hooks/useOnboarding';
import { useReducedMotion } from '@/hooks/useReducedMotion';

// Tour steps with bilingual content
const tourSteps: Step[] = [
  {
    target: '[data-tour="dashboard"]',
    content: (
      <div>
        <h3 className="font-bold text-lg mb-2">Welcome to Your Dashboard!</h3>
        <p className="text-muted-foreground">
          This is your home base. Track your progress, see recent tests, and find areas to improve.
        </p>
        <p className="font-myanmar text-sm text-muted-foreground mt-2">
          á€¤á€á€Šá€ºá€™á€¾á€¬ á€á€„á€·á€ºá€•á€„á€ºá€™á€…á€¬á€™á€»á€€á€ºá€”á€¾á€¬á€–á€¼á€…á€ºá€•á€«á€á€Šá€ºá‹ á€á€„á€·á€ºá€á€­á€¯á€¸á€á€€á€ºá€™á€¾á€¯á€€á€­á€¯ á€á€¼á€±á€›á€¬á€á€¶á€•á€«á‹
        </p>
      </div>
    ),
    placement: 'bottom',
    disableBeacon: true,
  },
  {
    target: '[data-tour="study-guide"]',
    content: (
      <div>
        <h3 className="font-bold text-lg mb-2">Study with Flashcards</h3>
        <p className="text-muted-foreground">
          Flip through bilingual flashcards to learn all 100 civics questions. Tap to reveal answers!
        </p>
        <p className="font-myanmar text-sm text-muted-foreground mt-2">
          á€™á€±á€¸á€á€½á€”á€ºá€¸ áá€á€ á€œá€¯á€¶á€¸á€€á€­á€¯ á€œá€±á€·á€œá€¬á€›á€”á€º á€€á€á€ºá€™á€»á€¬á€¸á€œá€¾á€Šá€·á€ºá€•á€«á‹
        </p>
      </div>
    ),
    placement: 'bottom',
  },
  {
    target: '[data-tour="mock-test"]',
    content: (
      <div>
        <h3 className="font-bold text-lg mb-2">Practice with Mock Tests</h3>
        <p className="text-muted-foreground">
          Take timed practice tests just like the real interview. You need 6 correct out of 10 to pass!
        </p>
        <p className="font-myanmar text-sm text-muted-foreground mt-2">
          á€á€€á€šá€·á€ºá€¡á€„á€ºá€á€¬á€—á€»á€°á€¸á€”á€²á€·á€¡á€á€°á€á€° á€…á€¬á€™á€±á€¸á€•á€½á€²á€–á€¼á€±á€•á€«á‹ áá€ á€á€¯á€™á€¾ á† á€á€¯á€™á€¾á€”á€ºá€›á€•á€«á€™á€Šá€ºá‹
        </p>
      </div>
    ),
    placement: 'bottom',
  },
  {
    target: '[data-tour="theme-toggle"]',
    content: (
      <div>
        <h3 className="font-bold text-lg mb-2">Customize Your Experience</h3>
        <p className="text-muted-foreground">
          Toggle between light and dark mode. Study comfortably day or night!
        </p>
        <p className="font-myanmar text-sm text-muted-foreground mt-2">
          á€¡á€œá€„á€ºá€¸á€”á€¾á€„á€·á€º á€¡á€™á€¾á€±á€¬á€„á€ºá€™á€¯á€’á€º á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹
        </p>
      </div>
    ),
    placement: 'bottom',
  },
  {
    target: 'body',
    content: (
      <div className="text-center">
        <h3 className="font-bold text-xl mb-2">You're All Set!</h3>
        <p className="text-muted-foreground">
          Every question you practice brings you closer to your citizenship. Good luck!
        </p>
        <p className="font-myanmar text-muted-foreground mt-2">
          á€á€„á€ºá€œá€±á€·á€€á€»á€„á€·á€ºá€á€™á€»á€¾ á€™á€±á€¸á€á€½á€”á€ºá€¸á€á€­á€¯á€„á€ºá€¸á€€ á€á€„á€·á€ºá€”á€­á€¯á€„á€ºá€„á€¶á€á€¬á€¸á€–á€¼á€…á€ºá€™á€¾á€¯á€”á€®á€¸á€…á€±á€•á€«á€á€šá€ºá‹ á€€á€¶á€€á€±á€¬á€„á€ºá€¸á€•á€«á€…á€±!
        </p>
        <div className="mt-4 text-4xl">ğŸ‰ğŸ‡ºğŸ‡¸âœ¨</div>
      </div>
    ),
    placement: 'center',
  },
];

interface OnboardingTourProps {
  /** Force run even if completed before */
  forceRun?: boolean;
}

/**
 * Guided tooltip walkthrough for first-time users.
 *
 * Features:
 * - Step-by-step tooltips highlighting key features
 * - Bilingual content (English + Burmese)
 * - Skip button (less prominent) to encourage completion
 * - Persists completion to localStorage
 * - Respects prefers-reduced-motion
 */
export function OnboardingTour({ forceRun = false }: OnboardingTourProps) {
  const { shouldShow, complete, skip } = useOnboarding();
  const shouldReduceMotion = useReducedMotion();
  const [stepIndex, setStepIndex] = useState(0);
  const [run, setRun] = useState(forceRun || shouldShow);

  const handleCallback = useCallback(
    (data: CallBackProps) => {
      const { status, action, index, type } = data;

      // Handle step changes
      if (type === EVENTS.STEP_AFTER) {
        setStepIndex(index + (action === ACTIONS.PREV ? -1 : 1));
      }

      // Handle completion
      if (status === STATUS.FINISHED) {
        complete();
        setRun(false);
      }

      // Handle skip
      if (status === STATUS.SKIPPED) {
        skip();
        setRun(false);
      }
    },
    [complete, skip]
  );

  if (!run && !forceRun) return null;

  return (
    <Joyride
      steps={tourSteps}
      stepIndex={stepIndex}
      run={run}
      continuous
      showSkipButton
      showProgress
      callback={handleCallback}
      disableScrolling={false}
      spotlightClicks
      locale={{
        back: 'Back Â· á€”á€±á€¬á€€á€ºá€á€­á€¯á€·',
        close: 'Close Â· á€•á€­á€á€ºá€•á€«',
        last: 'Finish Â· á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®',
        next: 'Next Â· á€›á€¾á€±á€·á€á€­á€¯á€·',
        skip: 'Skip tour',
      }}
      styles={{
        options: {
          primaryColor: 'hsl(217 91% 60%)', // Primary blue
          zIndex: 1000,
        },
        tooltip: {
          borderRadius: 16,
          padding: 20,
        },
        tooltipContent: {
          padding: 0,
        },
        buttonNext: {
          borderRadius: 9999,
          padding: '8px 20px',
          fontWeight: 600,
        },
        buttonBack: {
          borderRadius: 9999,
          padding: '8px 20px',
          marginRight: 8,
        },
        buttonSkip: {
          color: 'hsl(var(--muted-foreground))',
          fontSize: 12,
        },
        spotlight: {
          borderRadius: 16,
        },
      }}
      floaterProps={{
        disableAnimation: shouldReduceMotion,
      }}
    />
  );
}

export default OnboardingTour;
```

Create index file `src/components/onboarding/index.ts`:

```typescript
export { OnboardingTour } from './OnboardingTour';
export { useOnboarding } from '@/hooks/useOnboarding';
```
  </action>
  <verify>
Clear localStorage and reload app.
Onboarding tour should start automatically.
Click through all steps - verify bilingual content.
Click Skip - should persist and not show again on reload.
  </verify>
  <done>
OnboardingTour with react-joyride and useOnboarding hook for state management.
  </done>
</task>

</tasks>

<verification>
1. `pnpm run build` completes without errors
2. Flashcard3D flips with 3D rotation on tap
3. Flashcard shows paper-like texture
4. FlashcardStack swipes left/right on mobile
5. FlashcardStack arrows work on desktop
6. OnboardingTour shows for first-time users
7. Tour has bilingual tooltips
8. Skip persists to localStorage
9. All animations disabled with prefers-reduced-motion
</verification>

<success_criteria>
- Flashcard3D has 3D rotateY animation
- Card has physical paper texture overlay
- FlashcardStack supports swipe gestures
- Progress indicator shows "X of Y"
- OnboardingTour uses react-joyride
- Tour steps have bilingual content
- Skip button is less prominent than Next
- Tour state persists to localStorage
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-ui-ux-bilingual-polish/03-07-SUMMARY.md`
</output>
