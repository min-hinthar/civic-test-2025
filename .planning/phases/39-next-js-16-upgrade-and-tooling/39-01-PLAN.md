---
phase: 39-next-js-16-upgrade-and-tooling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-lock.yaml
autonomous: true
requirements:
  - MIGR-01

must_haves:
  truths:
    - "A git tag v3.0-pre-upgrade exists marking the exact pre-upgrade state"
    - "All non-Next.js dependencies are updated to their latest versions"
    - "All existing Vitest tests pass after the non-Next dependency upgrades"
    - "pnpm-lock.yaml is regenerated from a clean state"
  artifacts:
    - path: "package.json"
      provides: "Updated dependency versions (all deps except next)"
      contains: "react"
    - path: "pnpm-lock.yaml"
      provides: "Clean regenerated lockfile"
  key_links:
    - from: "package.json"
      to: "pnpm-lock.yaml"
      via: "pnpm install"
      pattern: "pnpm install"
---

<objective>
Create a pre-upgrade safety tag and upgrade all non-Next.js dependencies to latest versions in a separate commit.

Purpose: Isolate dependency upgrade breakage from Next.js upgrade breakage per user decision. If tests break, `git bisect` can pinpoint whether it was a dep upgrade or the Next.js bump.

Output: Git tag `v3.0-pre-upgrade`, updated `package.json` with all non-Next deps at latest, clean `pnpm-lock.yaml`, all tests passing.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-next-js-16-upgrade-and-tooling/39-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pre-upgrade git tag and upgrade non-Next dependencies</name>
  <files>package.json, pnpm-lock.yaml</files>
  <action>
1. Create git tag `v3.0-pre-upgrade` on the current HEAD commit for easy rollback:
   ```bash
   git tag v3.0-pre-upgrade
   ```

2. Delete `pnpm-lock.yaml` for a clean slate per user decision:
   ```bash
   rm pnpm-lock.yaml
   ```

3. Update ALL dependencies in `package.json` to their latest versions EXCEPT `next` (keep `next` at `15.5.12` for now). Use `pnpm update` or manually update version ranges. Key deps to upgrade:
   - `react` and `react-dom`: keep at `^19.2.0` (already latest range)
   - `@sentry/nextjs`: upgrade to latest `^10.x` (currently `^10.26.0`)
   - `@serwist/next` and `serwist`: keep at `^9.5.4` (already latest)
   - `@next/bundle-analyzer`: already at `^16.1.6` (fine)
   - All other deps: upgrade to latest patch/minor
   - `@types/react` and `@types/react-dom`: upgrade to latest `^19.x`
   - All devDependencies: upgrade to latest

4. Evaluate whether any dependencies are redundant and can be dropped. Per CONTEXT, check:
   - `next-themes`: NOT in package.json (already absent, no action needed)
   - Other candidates: review if any are unused

5. Regenerate lockfile:
   ```bash
   pnpm install
   ```

6. If peer dependency conflicts arise, add `pnpm.overrides` entries in `package.json` with `// TODO:` comments explaining why.

7. Run full test suite and verify all pass:
   ```bash
   pnpm test:run
   pnpm typecheck
   ```

8. If any tests fail due to dependency API changes, fix them. No `.skip()` or `.todo()` allowed.
  </action>
  <verify>
    <automated>pnpm test:run && pnpm typecheck</automated>
    <manual>Verify git tag exists: `git tag -l v3.0-pre-upgrade`</manual>
  </verify>
  <done>Git tag v3.0-pre-upgrade exists. All non-Next dependencies are at latest versions. pnpm-lock.yaml regenerated. All tests pass. No .skip() or .todo() in test changes.</done>
</task>

</tasks>

<verification>
- `git tag -l v3.0-pre-upgrade` shows the tag
- `pnpm test:run` passes all tests
- `pnpm typecheck` passes
- `package.json` shows `"next": "15.5.12"` still (NOT upgraded yet)
- `pnpm-lock.yaml` exists and is valid
</verification>

<success_criteria>
Pre-upgrade tag exists for rollback. All non-Next dependencies are at latest versions. Tests pass. Lockfile is clean. Next.js version unchanged.
</success_criteria>

<output>
After completion, create `.planning/phases/39-next-js-16-upgrade-and-tooling/39-01-SUMMARY.md`
</output>
