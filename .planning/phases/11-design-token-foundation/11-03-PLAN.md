---
phase: 11-design-token-foundation
plan: 03
type: execute
wave: 2
depends_on: [01]
files_modified:
  - src/lib/tokens.ts
  - src/lib/design-tokens.ts
autonomous: true

must_haves:
  truths:
    - "Canvas and chart code can read CSS variable values at runtime via getTokenColor()"
    - "design-tokens.ts is deleted (was dead code with zero imports)"
    - "getToken() and getTokenColor() return correct resolved HSL values"
  artifacts:
    - path: "src/lib/tokens.ts"
      provides: "JS utility to read CSS custom properties for canvas/chart use"
      exports: ["getToken", "getTokenColor"]
    - path: "src/lib/design-tokens.ts"
      provides: "DELETED"
  key_links:
    - from: "src/lib/tokens.ts"
      to: "src/styles/tokens.css"
      via: "getComputedStyle reading CSS variables"
      pattern: "getComputedStyle"
---

<objective>
Create the JS token access utility (`getToken` and `getTokenColor`) for canvas/chart contexts that need imperative color values, and delete the dead `design-tokens.ts` file.

Purpose: Enable canvas-based components (CircularTimer, AudioWaveform) and Recharts charts (ProgressPage, HistoryPage, InterviewResults) to read token colors at runtime. Remove dead code.
Output: src/lib/tokens.ts (new), src/lib/design-tokens.ts (deleted)
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-design-token-foundation/11-01-SUMMARY.md
@.planning/phases/11-design-token-foundation/11-RESEARCH.md (Pattern 4: JS Token Access Helper)
@src/lib/design-tokens.ts (to be deleted)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create JS token utility and delete design-tokens.ts</name>
  <files>src/lib/tokens.ts, src/lib/design-tokens.ts</files>
  <action>
**Create `src/lib/tokens.ts`:**

A thin utility with two exported functions:

```typescript
/**
 * Read a CSS custom property value from the document root.
 * Returns the raw value (e.g., "217 91% 60%") or fallback.
 *
 * @param name - CSS variable name including -- prefix (e.g., "--color-primary")
 * @param fallback - Value to return if variable is not found or on server
 */
export function getToken(name: string, fallback = ''): string {
  if (typeof window === 'undefined') return fallback;
  return getComputedStyle(document.documentElement)
    .getPropertyValue(name)
    .trim() || fallback;
}

/**
 * Read a color token and return it as an HSL string for canvas/SVG use.
 * The CSS variables store HSL channels only (e.g., "217 91% 60%"),
 * so this wraps them with hsl() for direct use in canvas contexts.
 *
 * @param name - CSS variable name (e.g., "--color-primary")
 * @param alpha - Optional alpha value (0-1) for transparency
 */
export function getTokenColor(name: string, alpha?: number): string {
  const raw = getToken(name);
  if (!raw) return '';
  return alpha !== undefined
    ? `hsl(${raw} / ${alpha})`
    : `hsl(${raw})`;
}
```

This is the ENTIRE file -- small, focused, no dependencies. The functions are used by:
- Canvas API contexts (which can't resolve CSS variables natively)
- Recharts stroke/fill props (which need resolved color strings)
- react-countdown-circle-timer (which needs hex/hsl color strings)

**Delete `src/lib/design-tokens.ts`:**

Verify it has zero imports first:
```bash
grep -r "design-tokens" src/ --include="*.ts" --include="*.tsx" | grep -v "design-tokens.ts"
```

If zero results: delete the file entirely. This was confirmed dead code (zero imports) in the research audit.

If any imports exist (unexpected): update those imports to use the new `@/lib/tokens` utility instead, adjusting the usage pattern from `colors.primary[500]` to `getTokenColor('--color-primary')`.
  </action>
  <verify>
- `src/lib/tokens.ts` exists with `getToken` and `getTokenColor` exports
- `src/lib/design-tokens.ts` does NOT exist
- `npx next build` passes (no broken imports)
- `grep -r "design-tokens" src/` returns zero results (excluding test files that might reference it)
  </verify>
  <done>JS token access utility exists at src/lib/tokens.ts. design-tokens.ts is deleted. No broken imports in the build.</done>
</task>

</tasks>

<verification>
- src/lib/tokens.ts exports getToken and getTokenColor
- design-tokens.ts is deleted
- npx next build passes
- No remaining references to design-tokens.ts in the codebase
</verification>

<success_criteria>
Canvas/chart code has a clean utility to read CSS variable values at runtime. Dead code (design-tokens.ts) is removed. Build passes.
</success_criteria>

<output>
After completion, create `.planning/phases/11-design-token-foundation/11-03-SUMMARY.md`
</output>
