---
phase: 17-ui-system-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/prismatic-border.css
  - src/styles/globals.css
  - src/styles/tokens.css
  - src/styles/animations.css
autonomous: true

must_haves:
  truths:
    - "Glass surfaces show three distinct blur/opacity levels (heavy, medium, light) visible in both themes"
    - "Prismatic rainbow borders animate continuously along edges of elements using the prismatic-border class"
    - "Fixed gradient mesh background is visible behind content in both light and dark mode"
    - "Reduced motion users see static prismatic gradient but no animation"
  artifacts:
    - path: "src/styles/prismatic-border.css"
      provides: "CSS @property animated prismatic border system"
      contains: "@property --prismatic-angle"
    - path: "src/styles/globals.css"
      provides: "Three-tier glass classes (glass-light, glass-medium, glass-heavy) and upgraded mesh background"
      contains: "glass-heavy"
    - path: "src/styles/tokens.css"
      provides: "Glass tier CSS custom properties"
      contains: "--glass-heavy-blur"
  key_links:
    - from: "src/styles/globals.css"
      to: "src/styles/prismatic-border.css"
      via: "@import"
      pattern: "@import.*prismatic"
    - from: "src/styles/globals.css"
      to: "src/styles/tokens.css"
      via: "CSS variable references"
      pattern: "var\\(--glass-"
---

<objective>
Create the CSS foundation for the premium glass-morphism visual system: three-tier glass classes, animated prismatic rainbow borders, and upgraded gradient mesh background.

Purpose: All subsequent plans depend on these CSS classes existing. This is the pure-CSS infrastructure that enables the premium look.
Output: Four CSS files with glass tiers, prismatic borders, mesh background, and view transitions support.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-ui-system-polish/17-RESEARCH.md
@src/styles/globals.css
@src/styles/tokens.css
@src/styles/animations.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create prismatic border CSS system and add glass tier tokens</name>
  <files>src/styles/prismatic-border.css, src/styles/tokens.css</files>
  <action>
  **Create `src/styles/prismatic-border.css`:**

  1. Define `@property --prismatic-angle` with syntax `<angle>`, initial-value `0deg`, inherits `false`
  2. Create `@keyframes prismatic-rotate` that animates `--prismatic-angle` from 0deg to 360deg
  3. Create `.prismatic-border` class with `position: relative` and `isolation: isolate`
  4. Create `.prismatic-border::before` pseudo-element:
     - `content: ''`, `position: absolute`, `inset: 0`, `border-radius: inherit`
     - `padding: 1px` (border width)
     - Light mode: `conic-gradient(from var(--prismatic-angle))` with 7 HSL stops around the spectrum at 40% opacity (hsl(0 80% 60% / 0.4), hsl(60...), hsl(120...), hsl(180...), hsl(240...), hsl(300...), hsl(0...))
     - Mask using `-webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)` and `-webkit-mask-composite: xor` / `mask-composite: exclude` to show only the border ring
     - `animation: prismatic-rotate 4s linear infinite`
     - `pointer-events: none`, `z-index: 1`
  5. Dark mode (`.dark .prismatic-border::before`): Higher opacity (0.7 for key hues, 0.6 for others), add `filter: blur(0.5px)` for glow
  6. Hover/focus intensification: `.prismatic-border:hover::before, .prismatic-border:focus-within::before` → `padding: 1.5px`, `filter: brightness(1.3)`
  7. Dark hover: `.dark .prismatic-border:hover::before, .dark .prismatic-border:focus-within::before` → `filter: blur(0.5px) brightness(1.4)` for neon glow
  8. Reduced motion: `@media (prefers-reduced-motion: reduce)` → `animation: none`, `--prismatic-angle: 45deg` (static diagonal)
  9. Add `@supports not (animation-timeline: scroll)` fallback for browsers without @property support: hide the pseudo-element and show a simple `border: 1px solid hsl(var(--color-border) / 0.4)` instead

  **Update `src/styles/tokens.css`:**

  Add glass tier tokens inside `:root` (in the non-color tokens section):
  ```
  --glass-light-blur: 16px;
  --glass-light-opacity: 0.65;
  --glass-medium-blur: 24px;
  --glass-medium-opacity: 0.55;
  --glass-heavy-blur: 32px;
  --glass-heavy-opacity: 0.45;
  ```

  Add dark mode overrides inside `.dark`:
  ```
  --glass-light-opacity: 0.5;
  --glass-medium-opacity: 0.4;
  --glass-heavy-opacity: 0.3;
  ```
  </action>
  <verify>Run `npx next build` -- should compile with zero errors. Verify prismatic-border.css exists and contains @property declaration.</verify>
  <done>prismatic-border.css exists with @property animation, three shimmer speed variants, dark mode neon-bright overrides, and reduced motion fallback. tokens.css has glass tier variables.</done>
</task>

<task type="auto">
  <name>Task 2: Upgrade glass classes and mesh background in globals.css</name>
  <files>src/styles/globals.css</files>
  <action>
  **Add import for prismatic border CSS:**
  At the top of globals.css after the existing imports, add: `@import './prismatic-border.css';`

  **Replace existing `.glass-card` and `.glass-nav` with three-tier system:**

  Replace the `.glass-card` block in `@layer components` with three new classes:

  1. `.glass-light` (replaces old `.glass-card`):
     - `background: hsl(var(--color-surface) / var(--glass-light-opacity))`
     - `backdrop-filter: blur(var(--glass-light-blur))` + `-webkit-` prefix
     - `border: 1px solid hsl(var(--color-border) / 0.3)`
     - `border-radius: var(--radius-2xl)`
     - Inner light reflection: `box-shadow: inset 0 1px 0 0 hsl(0 0% 100% / 0.12), 0 4px 12px -2px hsl(var(--color-overlay) / 0.1)`
     - `transition: box-shadow 0.3s ease, transform 0.3s ease`

  2. `.glass-medium`:
     - Same pattern but uses `--glass-medium-*` variables
     - Border opacity: 0.35
     - `box-shadow: inset 0 1px 0 0 hsl(0 0% 100% / 0.15), 0 8px 24px -4px hsl(var(--color-overlay) / 0.15)`

  3. `.glass-heavy`:
     - Same pattern but uses `--glass-heavy-*` variables
     - Border opacity: 0.4
     - `box-shadow: inset 0 1px 0 0 hsl(0 0% 100% / 0.2), 0 12px 40px -8px hsl(var(--color-overlay) / 0.2)`

  **Dark mode variants for all three tiers:**
  Each tier in `.dark` gets: reduced opacity (from tokens), a subtle `background-image: linear-gradient(135deg, hsl(var(--color-accent-purple) / 0.03), transparent)` for brand purple tint, adjusted inner glow `inset 0 0 0 1px hsl(0 0% 100% / 0.05)`, and heavier drop shadow.

  **Keep `.glass-card` as backward compat alias** pointing to `.glass-light` (same properties, or just make `.glass-card { @apply ...same as glass-light... }`). Do NOT delete `.glass-card` -- other components reference it.

  **Keep `.glass-card-interactive`** but update hover effects:
  - `transform: scale(1.01)` → `transform: translateY(-2px)` (lift, not scale)
  - `box-shadow: 0 8px 24px -4px hsl(var(--color-overlay) / 0.15)` (already there)

  **Upgrade `.glass-nav`** to match the heavy tier blur (32px instead of 20px):
  - `backdrop-filter: blur(var(--glass-heavy-blur))` + `-webkit-` prefix
  - Keep existing gradient `background-image`
  - Add inner light reflection: `box-shadow` should include `inset 0 1px 0 0 hsl(0 0% 100% / 0.15)` alongside existing shadow

  **Fallback for all tiers:**
  ```css
  @supports not (backdrop-filter: blur(1px)) {
    .glass-light, .glass-medium, .glass-heavy, .glass-card {
      background: hsl(var(--color-surface) / 0.95);
    }
    .dark .glass-light, .dark .glass-medium, .dark .glass-heavy, .dark .glass-card {
      background: hsl(var(--color-surface) / 0.9);
    }
  }
  ```

  **Upgrade mesh background:**

  Update `body::before` to use brand purple + blue blobs per user decision:
  ```css
  body::before {
    background:
      radial-gradient(ellipse at 15% 20%, hsl(var(--color-accent-purple) / 0.18), transparent 55%),
      radial-gradient(ellipse at 80% 10%, hsl(var(--color-primary) / 0.2), transparent 55%),
      radial-gradient(ellipse at 50% 80%, hsl(var(--color-primary) / 0.12), transparent 60%);
    filter: blur(80px);
    opacity: 1;
  }
  ```

  Update `.dark body::before` with deep purple + dark magenta (richer/more dramatic):
  ```css
  .dark body::before {
    background:
      radial-gradient(ellipse at 10% 20%, hsl(var(--color-accent-purple) / 0.3), transparent 55%),
      radial-gradient(ellipse at 85% 10%, hsl(270 60% 30% / 0.25), transparent 60%),
      radial-gradient(ellipse at 50% 85%, hsl(320 60% 25% / 0.2), transparent 60%);
    opacity: 0.7;
  }
  ```

  Also upgrade `.page-shell::before` similarly (shift from patriotic-red to accent-purple + primary blobs for consistency).

  **Add View Transitions CSS** at the end of globals.css (outside @layer):
  ```css
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation: none;
    mix-blend-mode: normal;
  }
  ```

  **Add overscroll behavior to body:**
  ```css
  body {
    overscroll-behavior: auto;
    -webkit-overflow-scrolling: touch;
  }
  ```
  </action>
  <verify>Run `npx next build` -- zero errors. Visually: open the app in dev mode, check that existing glass-card usage still renders (backward compat alias works), and that the mesh background is visible.</verify>
  <done>globals.css has three glass tiers (glass-light, glass-medium, glass-heavy), backward compat .glass-card alias, upgraded .glass-nav with heavy blur, premium mesh background in both themes, view transitions CSS, and @supports fallback for no-backdrop-filter browsers.</done>
</task>

</tasks>

<verification>
1. `npx next build` succeeds with zero TypeScript/CSS errors
2. prismatic-border.css exists and contains `@property --prismatic-angle`
3. globals.css contains `.glass-light`, `.glass-medium`, `.glass-heavy` classes
4. globals.css still contains `.glass-card` (backward compat)
5. `.glass-nav` uses `var(--glass-heavy-blur)` for 32px blur
6. tokens.css contains `--glass-heavy-blur: 32px`
7. Dark mode mesh background uses deep purple + magenta (distinct from light mode)
</verification>

<success_criteria>
Three-tier glass CSS system, animated prismatic borders, and premium mesh background are all defined and the build passes. All existing glass-card references continue to work via backward compat alias.
</success_criteria>

<output>
After completion, create `.planning/phases/17-ui-system-polish/17-01-SUMMARY.md`
</output>
