---
phase: 03-ui-ux-bilingual-polish
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/ui/Dialog.tsx
  - src/components/ui/Toast.tsx
  - src/components/ui/Progress.tsx
  - src/components/ui/toaster.tsx
  - src/components/ui/use-toast.ts
autonomous: true

must_haves:
  truths:
    - "Dialogs are keyboard accessible with focus trapping"
    - "Toasts slide up from bottom center"
    - "Progress bars have accessible role=progressbar"
    - "All components announce to screen readers"
  artifacts:
    - path: "src/components/ui/Dialog.tsx"
      provides: "Accessible modal dialog with bottom-sheet animation"
      exports: ["Dialog", "DialogContent", "DialogTitle", "DialogDescription"]
    - path: "src/components/ui/Toast.tsx"
      provides: "Radix toast with Motion animation"
      exports: ["Toast", "ToastProvider", "ToastViewport"]
    - path: "src/components/ui/Progress.tsx"
      provides: "Accessible progress bar"
      exports: ["Progress"]
  key_links:
    - from: "src/components/ui/Dialog.tsx"
      to: "@radix-ui/react-dialog"
      via: "Radix primitives"
      pattern: "@radix-ui/react-dialog"
    - from: "src/components/ui/Toast.tsx"
      to: "@radix-ui/react-toast"
      via: "Radix toast"
      pattern: "@radix-ui/react-toast"
---

<objective>
Replace existing toast system and add accessible Dialog and Progress components using Radix UI primitives with Motion animations.

Purpose: Radix UI provides WAI-ARIA compliant accessibility (focus trapping, keyboard navigation, screen reader announcements) that would take weeks to build from scratch. Motion adds the slide/fade animations per user decision.

Output: Dialog, Toast, and Progress components with full accessibility and animations.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-ui-ux-bilingual-polish/03-CONTEXT.md
@.planning/phases/03-ui-ux-bilingual-polish/03-RESEARCH.md
@src/components/ui/toaster.tsx
@src/components/ui/use-toast.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Radix Dialog component with bottom-sheet animation</name>
  <files>
    src/components/ui/Dialog.tsx
  </files>
  <action>
Create `src/components/ui/Dialog.tsx`:

```typescript
'use client';

import { ReactNode, forwardRef } from 'react';
import * as DialogPrimitive from '@radix-ui/react-dialog';
import { motion, AnimatePresence } from 'motion/react';
import { X } from 'lucide-react';
import { clsx } from 'clsx';
import { useReducedMotion } from '@/hooks/useReducedMotion';

// Animation variants for bottom-sheet style modal
const overlayVariants = {
  hidden: { opacity: 0 },
  visible: { opacity: 1 },
};

const contentVariants = {
  hidden: { opacity: 0, y: 50, scale: 0.95 },
  visible: { opacity: 1, y: 0, scale: 1 },
};

const springTransition = {
  type: 'spring' as const,
  stiffness: 300,
  damping: 25,
};

export interface DialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  children: ReactNode;
}

/**
 * Accessible modal dialog with bottom-sheet slide-up animation.
 *
 * Features:
 * - WAI-ARIA compliant (DialogPrimitive handles all accessibility)
 * - Focus trapping
 * - Keyboard navigation (Escape to close)
 * - Bottom-sheet slide-up animation
 * - Respects prefers-reduced-motion
 */
export function Dialog({ open, onOpenChange, children }: DialogProps) {
  return (
    <DialogPrimitive.Root open={open} onOpenChange={onOpenChange}>
      {children}
    </DialogPrimitive.Root>
  );
}

export const DialogTrigger = DialogPrimitive.Trigger;

export const DialogPortal = DialogPrimitive.Portal;

export const DialogClose = DialogPrimitive.Close;

/**
 * Dialog overlay (backdrop)
 */
export const DialogOverlay = forwardRef<
  HTMLDivElement,
  DialogPrimitive.DialogOverlayProps
>(({ className, ...props }, ref) => {
  const shouldReduceMotion = useReducedMotion();

  return (
    <DialogPrimitive.Overlay asChild ref={ref} {...props}>
      <motion.div
        variants={overlayVariants}
        initial={shouldReduceMotion ? 'visible' : 'hidden'}
        animate="visible"
        exit={shouldReduceMotion ? 'visible' : 'hidden'}
        transition={{ duration: 0.2 }}
        className={clsx(
          'fixed inset-0 z-50 bg-black/50 backdrop-blur-sm',
          className
        )}
      />
    </DialogPrimitive.Overlay>
  );
});
DialogOverlay.displayName = 'DialogOverlay';

/**
 * Dialog content container
 */
export const DialogContent = forwardRef<
  HTMLDivElement,
  DialogPrimitive.DialogContentProps & { showCloseButton?: boolean }
>(({ className, children, showCloseButton = true, ...props }, ref) => {
  const shouldReduceMotion = useReducedMotion();

  return (
    <DialogPortal>
      <DialogOverlay />
      <DialogPrimitive.Content asChild ref={ref} {...props}>
        <motion.div
          variants={contentVariants}
          initial={shouldReduceMotion ? 'visible' : 'hidden'}
          animate="visible"
          exit={shouldReduceMotion ? 'visible' : 'hidden'}
          transition={springTransition}
          className={clsx(
            // Positioning
            'fixed left-1/2 top-1/2 z-50 -translate-x-1/2 -translate-y-1/2',
            // Sizing
            'w-[90vw] max-w-lg max-h-[85vh] overflow-auto',
            // Styling
            'rounded-2xl bg-card border border-border/60 p-6',
            'shadow-2xl shadow-black/20',
            // Focus
            'focus:outline-none',
            className
          )}
        >
          {children}
          {showCloseButton && (
            <DialogPrimitive.Close
              className={clsx(
                'absolute right-4 top-4',
                'rounded-full p-2',
                'text-muted-foreground hover:text-foreground',
                'hover:bg-muted/50',
                'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500',
                'transition-colors'
              )}
            >
              <X className="h-4 w-4" />
              <span className="sr-only">Close</span>
            </DialogPrimitive.Close>
          )}
        </motion.div>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
});
DialogContent.displayName = 'DialogContent';

/**
 * Dialog title (required for accessibility)
 */
export const DialogTitle = forwardRef<
  HTMLHeadingElement,
  DialogPrimitive.DialogTitleProps
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={clsx('text-lg font-bold text-foreground', className)}
    {...props}
  />
));
DialogTitle.displayName = 'DialogTitle';

/**
 * Dialog description
 */
export const DialogDescription = forwardRef<
  HTMLParagraphElement,
  DialogPrimitive.DialogDescriptionProps
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={clsx('mt-2 text-sm text-muted-foreground', className)}
    {...props}
  />
));
DialogDescription.displayName = 'DialogDescription';

/**
 * Dialog footer for action buttons
 */
export function DialogFooter({
  className,
  children,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={clsx(
        'mt-6 flex flex-col-reverse gap-2 sm:flex-row sm:justify-end',
        className
      )}
      {...props}
    >
      {children}
    </div>
  );
}
```
  </action>
  <verify>
Import Dialog and render with open state.
Verify slide-up animation on open.
Press Escape key - dialog should close.
Tab key should cycle within dialog (focus trap).
  </verify>
  <done>
Accessible Dialog component with bottom-sheet animation, focus trapping, and keyboard navigation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Radix Toast with slide-up animation</name>
  <files>
    src/components/ui/Toast.tsx
    src/components/ui/toaster.tsx
    src/components/ui/use-toast.ts
  </files>
  <action>
Create `src/components/ui/Toast.tsx`:

```typescript
'use client';

import { forwardRef, ReactNode } from 'react';
import * as ToastPrimitive from '@radix-ui/react-toast';
import { motion, AnimatePresence } from 'motion/react';
import { X, CheckCircle, AlertCircle, Info } from 'lucide-react';
import { clsx } from 'clsx';
import { useReducedMotion } from '@/hooks/useReducedMotion';

// Toast variants for styling
const toastVariants = {
  default: 'bg-card border-border',
  success: 'bg-success-50 border-success-500 dark:bg-success-500/10',
  warning: 'bg-warning-50 border-warning-500 dark:bg-warning-500/10',
  destructive: 'bg-destructive/10 border-destructive',
};

const iconMap = {
  default: Info,
  success: CheckCircle,
  warning: AlertCircle,
  destructive: AlertCircle,
};

const iconColorMap = {
  default: 'text-primary-500',
  success: 'text-success-500',
  warning: 'text-warning-500',
  destructive: 'text-destructive',
};

export type ToastVariant = keyof typeof toastVariants;

export interface ToastProps {
  id: string;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  title?: string;
  titleMy?: string; // Burmese title
  description?: string;
  descriptionMy?: string; // Burmese description
  variant?: ToastVariant;
  duration?: number;
}

/**
 * Individual toast item with slide-up animation.
 */
export const Toast = forwardRef<HTMLLIElement, ToastProps>(
  (
    {
      id,
      open,
      onOpenChange,
      title,
      titleMy,
      description,
      descriptionMy,
      variant = 'default',
      duration = 5000,
    },
    ref
  ) => {
    const shouldReduceMotion = useReducedMotion();
    const Icon = iconMap[variant];

    return (
      <ToastPrimitive.Root
        ref={ref}
        open={open}
        onOpenChange={onOpenChange}
        duration={duration}
        asChild
        forceMount
      >
        <motion.li
          initial={shouldReduceMotion ? { opacity: 1 } : { y: 100, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          exit={shouldReduceMotion ? { opacity: 0 } : { y: 100, opacity: 0 }}
          transition={{ type: 'spring', stiffness: 300, damping: 25 }}
          className={clsx(
            // Layout
            'relative flex items-start gap-3 p-4',
            // Styling
            'rounded-2xl border shadow-lg',
            // Width
            'w-full max-w-sm',
            // Variant
            toastVariants[variant]
          )}
        >
          <Icon className={clsx('h-5 w-5 mt-0.5 shrink-0', iconColorMap[variant])} />
          <div className="flex-1 min-w-0">
            {(title || titleMy) && (
              <ToastPrimitive.Title className="font-semibold text-foreground">
                {title}
                {titleMy && (
                  <span className="block text-sm font-normal text-muted-foreground font-myanmar mt-0.5">
                    {titleMy}
                  </span>
                )}
              </ToastPrimitive.Title>
            )}
            {(description || descriptionMy) && (
              <ToastPrimitive.Description className="mt-1 text-sm text-muted-foreground">
                {description}
                {descriptionMy && (
                  <span className="block font-myanmar mt-0.5">{descriptionMy}</span>
                )}
              </ToastPrimitive.Description>
            )}
          </div>
          <ToastPrimitive.Close
            className={clsx(
              'rounded-full p-1',
              'text-muted-foreground hover:text-foreground',
              'hover:bg-muted/50',
              'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500',
              'transition-colors'
            )}
          >
            <X className="h-4 w-4" />
            <span className="sr-only">Close</span>
          </ToastPrimitive.Close>
        </motion.li>
      </ToastPrimitive.Root>
    );
  }
);
Toast.displayName = 'Toast';

/**
 * Toast viewport (container for all toasts)
 * Positioned at bottom center per user decision
 */
export function ToastViewport() {
  return (
    <ToastPrimitive.Viewport
      className={clsx(
        'fixed bottom-4 left-1/2 -translate-x-1/2 z-[100]',
        'flex flex-col gap-2',
        'w-full max-w-sm px-4',
        'outline-none'
      )}
    />
  );
}

/**
 * Toast provider wrapper
 */
export function ToastProvider({ children }: { children: ReactNode }) {
  return (
    <ToastPrimitive.Provider swipeDirection="down">
      {children}
      <ToastViewport />
    </ToastPrimitive.Provider>
  );
}
```

Update `src/components/ui/use-toast.ts` to use the new toast system:

```typescript
'use client';

import { useState, useCallback, createContext, useContext, ReactNode } from 'react';
import { ToastVariant } from './Toast';

export interface ToastMessage {
  id: string;
  title?: string;
  titleMy?: string;
  description?: string;
  descriptionMy?: string;
  variant?: ToastVariant;
  duration?: number;
}

interface ToastContextValue {
  toasts: ToastMessage[];
  toast: (message: Omit<ToastMessage, 'id'>) => string;
  dismiss: (id: string) => void;
  dismissAll: () => void;
}

const ToastContext = createContext<ToastContextValue | null>(null);

let toastCount = 0;

export function ToastContextProvider({ children }: { children: ReactNode }) {
  const [toasts, setToasts] = useState<ToastMessage[]>([]);

  const toast = useCallback((message: Omit<ToastMessage, 'id'>) => {
    const id = `toast-${++toastCount}`;
    setToasts(prev => [...prev, { ...message, id }]);
    return id;
  }, []);

  const dismiss = useCallback((id: string) => {
    setToasts(prev => prev.filter(t => t.id !== id));
  }, []);

  const dismissAll = useCallback(() => {
    setToasts([]);
  }, []);

  return (
    <ToastContext.Provider value={{ toasts, toast, dismiss, dismissAll }}>
      {children}
    </ToastContext.Provider>
  );
}

export function useToast() {
  const context = useContext(ToastContext);
  if (!context) {
    throw new Error('useToast must be used within ToastContextProvider');
  }
  return context;
}

// Legacy compatibility - export toast function that works with existing code
// This will be replaced once we integrate the new provider
export const toast = (options: {
  title?: string;
  description?: string;
  variant?: 'default' | 'destructive';
}) => {
  // Legacy shim - this gets overridden by the context provider
  console.warn('Toast called outside of ToastContextProvider');
};
```

Update `src/components/ui/toaster.tsx` to use the new components:

```typescript
'use client';

import { AnimatePresence } from 'motion/react';
import { Toast, ToastProvider } from './Toast';
import { useToast, ToastContextProvider } from './use-toast';

function ToasterContent() {
  const { toasts, dismiss } = useToast();

  return (
    <AnimatePresence mode="popLayout">
      {toasts.map(toast => (
        <Toast
          key={toast.id}
          id={toast.id}
          open={true}
          onOpenChange={open => {
            if (!open) dismiss(toast.id);
          }}
          title={toast.title}
          titleMy={toast.titleMy}
          description={toast.description}
          descriptionMy={toast.descriptionMy}
          variant={toast.variant}
          duration={toast.duration}
        />
      ))}
    </AnimatePresence>
  );
}

/**
 * Toaster component - renders all active toasts.
 * Must be placed inside ToastContextProvider.
 */
export function Toaster() {
  return (
    <ToastProvider>
      <ToasterContent />
    </ToastProvider>
  );
}

/**
 * Combined provider and toaster for easy setup.
 * Wrap your app with this.
 */
export function ToastSetup({ children }: { children: React.ReactNode }) {
  return (
    <ToastContextProvider>
      {children}
      <Toaster />
    </ToastContextProvider>
  );
}
```
  </action>
  <verify>
Replace Toaster in _app.tsx with ToastSetup wrapper.
Call toast({ title: 'Test', titleMy: 'စမ်းသပ်' }).
Verify toast slides up from bottom center.
Verify bilingual text displays (English above, Burmese below).
Swipe down on toast should dismiss it.
  </verify>
  <done>
Radix Toast with bilingual support, slide-up animation, bottom-center positioning.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Radix Progress component</name>
  <files>
    src/components/ui/Progress.tsx
  </files>
  <action>
Create `src/components/ui/Progress.tsx`:

```typescript
'use client';

import { forwardRef } from 'react';
import * as ProgressPrimitive from '@radix-ui/react-progress';
import { motion } from 'motion/react';
import { clsx } from 'clsx';
import { useReducedMotion } from '@/hooks/useReducedMotion';

export interface ProgressProps {
  /** Current value (0-100) */
  value: number;
  /** Maximum value (default: 100) */
  max?: number;
  /** Color variant */
  variant?: 'default' | 'success' | 'warning';
  /** Show percentage label */
  showLabel?: boolean;
  /** Size variant */
  size?: 'sm' | 'md' | 'lg';
  /** Additional class names */
  className?: string;
}

const sizeClasses = {
  sm: 'h-2',
  md: 'h-3',
  lg: 'h-4',
};

const variantClasses = {
  default: 'bg-primary-500',
  success: 'bg-success-500',
  warning: 'bg-warning-500',
};

/**
 * Accessible progress bar with smooth animation.
 *
 * Features:
 * - WAI-ARIA progressbar role
 * - Animated fill transition
 * - Multiple size and color variants
 * - Optional percentage label
 * - Respects prefers-reduced-motion
 */
export const Progress = forwardRef<HTMLDivElement, ProgressProps>(
  (
    {
      value,
      max = 100,
      variant = 'default',
      showLabel = false,
      size = 'md',
      className,
    },
    ref
  ) => {
    const shouldReduceMotion = useReducedMotion();
    const percentage = Math.min(100, Math.max(0, (value / max) * 100));

    return (
      <div className={clsx('relative', className)}>
        <ProgressPrimitive.Root
          ref={ref}
          value={value}
          max={max}
          className={clsx(
            'relative overflow-hidden rounded-full bg-muted',
            sizeClasses[size]
          )}
        >
          <ProgressPrimitive.Indicator asChild>
            <motion.div
              initial={shouldReduceMotion ? { width: `${percentage}%` } : { width: 0 }}
              animate={{ width: `${percentage}%` }}
              transition={
                shouldReduceMotion
                  ? { duration: 0 }
                  : { type: 'spring', stiffness: 100, damping: 20 }
              }
              className={clsx(
                'h-full rounded-full',
                variantClasses[variant]
              )}
            />
          </ProgressPrimitive.Indicator>
        </ProgressPrimitive.Root>
        {showLabel && (
          <span className="absolute right-0 top-1/2 -translate-y-1/2 text-xs font-medium text-muted-foreground ml-2">
            {Math.round(percentage)}%
          </span>
        )}
      </div>
    );
  }
);
Progress.displayName = 'Progress';

/**
 * Progress bar with bilingual label
 */
export function ProgressWithLabel({
  value,
  max = 100,
  labelEn,
  labelMy,
  ...props
}: ProgressProps & { labelEn?: string; labelMy?: string }) {
  const percentage = Math.min(100, Math.max(0, (value / max) * 100));

  return (
    <div className="space-y-1">
      {(labelEn || labelMy) && (
        <div className="flex justify-between text-sm">
          <span className="text-foreground">
            {labelEn}
            {labelMy && (
              <span className="ml-2 text-muted-foreground font-myanmar">
                {labelMy}
              </span>
            )}
          </span>
          <span className="text-muted-foreground">{Math.round(percentage)}%</span>
        </div>
      )}
      <Progress value={value} max={max} {...props} />
    </div>
  );
}
```
  </action>
  <verify>
Render Progress with value={50}.
Verify smooth animated fill from 0 to 50%.
Verify progressbar role in DevTools Accessibility tab.
Test ProgressWithLabel with labelEn and labelMy.
  </verify>
  <done>
Accessible Progress bar with animated fill and bilingual label support.
  </done>
</task>

</tasks>

<verification>
1. `pnpm run build` completes without errors
2. Dialog opens with slide-up animation, closes on Escape, traps focus
3. Toast appears at bottom center, slides up, auto-dismisses
4. Toast displays bilingual content (English above, Burmese below)
5. Progress bar animates smoothly when value changes
6. Screen reader announces dialog title and toast content
</verification>

<success_criteria>
- Dialog has bottom-sheet slide-up animation
- Dialog traps focus and closes on Escape key
- Toast slides up from bottom center
- Toast supports bilingual title/description
- Toast auto-dismisses after duration
- Progress bar has progressbar role
- Progress bar animates fill smoothly
- All components respect prefers-reduced-motion
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-ui-ux-bilingual-polish/03-03-SUMMARY.md`
</output>
