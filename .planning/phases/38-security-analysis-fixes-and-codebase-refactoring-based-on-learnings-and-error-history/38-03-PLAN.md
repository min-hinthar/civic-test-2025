---
phase: 38-security-analysis-fixes-and-codebase-refactoring-based-on-learnings-and-error-history
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/dashboard/NBAHeroCard.tsx
  - src/components/dashboard/CompactStatRow.tsx
  - src/components/ui/TTSFallbackBadge.tsx
  - src/components/social/LeaderboardTable.tsx
  - src/components/flashcards/Flashcard3D.tsx
  - src/lib/audio/soundEffects.ts
  - src/lib/audio/audioPlayer.ts
  - src/lib/nativeBridge.ts
autonomous: true
requirements: [CONTEXT-dead-code-audit, CONTEXT-css-dark-mode-audit, CONTEXT-refactoring-learnings]

must_haves:
  truths:
    - "All 5 dark-mode-deficient components have proper dark: variant classes"
    - "Unused AudioPlayerState and OscillatorWaveType exports are removed or internalized"
    - "nativeBridge.ts is removed if confirmed orphaned (no imports from source files)"
    - "No TypeScript or lint errors introduced by changes"
  artifacts:
    - path: "src/components/dashboard/NBAHeroCard.tsx"
      provides: "Dark mode color variants for icon map"
      contains: "dark:"
    - path: "src/components/social/LeaderboardTable.tsx"
      provides: "Dark mode variant for 3rd place text"
      contains: "dark:text-amber"
  key_links:
    - from: "src/components/dashboard/NBAHeroCard.tsx"
      to: "Tailwind dark mode"
      via: "dark: prefix classes"
      pattern: "dark:text-"
---

<objective>
Fix the 5 components with missing dark mode variants and remove confirmed dead code (orphaned exports, orphaned files).

Purpose: The research audit found 5 files with missing dark: variants causing poor dark mode readability, plus 2-3 unused exports and a potentially orphaned nativeBridge.ts file.
Output: Dark-mode-complete components and cleaner codebase with dead code removed
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/38-security-analysis-fixes-and-codebase-refactoring-based-on-learnings-and-error-history/38-RESEARCH.md
@src/components/dashboard/NBAHeroCard.tsx
@src/components/dashboard/CompactStatRow.tsx
@src/components/ui/TTSFallbackBadge.tsx
@src/components/social/LeaderboardTable.tsx
@src/components/flashcards/Flashcard3D.tsx
@src/lib/audio/soundEffects.ts
@src/lib/audio/audioPlayer.ts
@src/lib/nativeBridge.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix missing dark mode variants in 5 components</name>
  <files>src/components/dashboard/NBAHeroCard.tsx, src/components/dashboard/CompactStatRow.tsx, src/components/ui/TTSFallbackBadge.tsx, src/components/social/LeaderboardTable.tsx, src/components/flashcards/Flashcard3D.tsx</files>
  <action>
    Fix each component per the research findings:

    1. **NBAHeroCard.tsx** (lines 49-68): `ICON_COLOR_MAP` uses colors like `text-amber-500`, `text-orange-500`, `text-blue-500`, `text-green-500`, `text-purple-500` without dark variants. Add `dark:text-amber-400`, `dark:text-orange-400`, `dark:text-blue-400`, `dark:text-green-400`, `dark:text-purple-400` respectively (one shade lighter for dark mode readability).

    2. **CompactStatRow.tsx** (lines 44-48): Check color functions for missing dark variants. Add `dark:` pairs using one shade lighter for dark backgrounds (e.g., `-500` → `dark:-400`, `-700` → `dark:-500`).

    3. **TTSFallbackBadge.tsx** (line 33): Has `bg-amber-500/20 text-amber-400` without dark variants. Add `dark:bg-amber-500/30 dark:text-amber-300` for better contrast on dark backgrounds.

    4. **LeaderboardTable.tsx** (line 43): `text-amber-700` for 3rd place rank is too dark in dark mode. Add `dark:text-amber-400`.

    5. **Flashcard3D.tsx** (lines 95-104): Category gradient overlays use fixed opacity. Add `dark:` gradient classes with increased opacity for better visibility on dark cards.

    **Convention:** Follow the project's existing dark mode pattern — use `dark:` prefix with Tailwind utilities. One shade lighter for text in dark mode (500→400, 700→500). Slightly higher opacity for semi-transparent backgrounds.
  </action>
  <verify>
    - `npm run typecheck` passes
    - `npm run lint` passes
    - `grep -c "dark:" src/components/dashboard/NBAHeroCard.tsx` shows increased count
    - `grep "dark:" src/components/social/LeaderboardTable.tsx` shows new dark variant
  </verify>
  <done>All 5 components render with proper contrast in dark mode — no washed-out or hard-to-read text on dark backgrounds</done>
</task>

<task type="auto">
  <name>Task 2: Remove dead code — unused exports and orphaned files</name>
  <files>src/lib/audio/soundEffects.ts, src/lib/audio/audioPlayer.ts, src/lib/nativeBridge.ts</files>
  <action>
    1. **`AudioPlayerState` export in audioPlayer.ts** (lines 17-19): Search ALL source files for `AudioPlayerState` imports. If only used internally within audioPlayer.ts, remove the `export` keyword but keep the type. If used by SpeechButton.tsx or burmeseAudio.ts (as grep suggested), keep it.

    2. **`OscillatorWaveType` export in soundEffects.ts** (line 65): Search ALL source files for `OscillatorWaveType` imports. If only used internally, remove the `export` keyword. If not used at all (not even internally), remove the type entirely.

    3. **`nativeBridge.ts`**: Search ALL source files (`src/` directory, excluding node_modules and tests) for any import of `nativeBridge`. If zero imports found, delete the file entirely. If imports exist, keep it. The research found 0 imports from other files — the only grep match was the file itself.

    **Safety protocol (CRITICAL):** Before removing ANY export:
    - Search for static imports: `import.*{.*ExportName.*}.*from`
    - Search for dynamic imports: `import\(.*path.*\)`
    - Search for type imports: `import type.*{.*ExportName.*}`
    - Only remove if ALL searches return zero results (excluding the defining file itself and test files)
  </action>
  <verify>
    - `npm run typecheck` passes (no broken imports)
    - `npm run build` succeeds (no runtime import failures)
    - `npm run test:run` passes (no test breakage)
    - If nativeBridge.ts was removed: `ls src/lib/nativeBridge.ts` returns "No such file"
  </verify>
  <done>All confirmed dead code removed without breaking any imports or runtime behavior. Orphaned nativeBridge.ts removed if confirmed unused.</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- `npm run typecheck` passes
- `npm run lint` passes
- `npm run test:run` passes
- No dark: variant missing in the 5 targeted components
</verification>

<success_criteria>
- 5 components have proper dark mode contrast
- No unused exports remain in audio modules
- Orphaned files removed
- Build, types, lint, and tests all pass
</success_criteria>

<output>
After completion, create `.planning/phases/38-security-analysis-fixes-and-codebase-refactoring-based-on-learnings-and-error-history/38-03-SUMMARY.md`
</output>
