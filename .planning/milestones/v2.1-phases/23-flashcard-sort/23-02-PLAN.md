---
phase: 23-flashcard-sort
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/audio/soundEffects.ts
  - src/lib/sessions/sessionTypes.ts
autonomous: true

must_haves:
  truths:
    - "playFling, playKnow, playDontKnow, playMasteryComplete sound functions are available"
    - "SortSnapshot type exists in the session snapshot union"
    - "Session store accepts sort-type snapshots without version bump"
  artifacts:
    - path: "src/lib/audio/soundEffects.ts"
      provides: "Sort mode sound effects: playFling, playKnow, playDontKnow, playMasteryComplete"
      exports: ["playFling", "playKnow", "playDontKnow", "playMasteryComplete"]
    - path: "src/lib/sessions/sessionTypes.ts"
      provides: "SortSnapshot interface and extended SessionSnapshot union"
      contains: "SortSnapshot"
  key_links:
    - from: "src/lib/sessions/sessionTypes.ts"
      to: "src/lib/sessions/sessionStore.ts"
      via: "SessionSnapshot union used by store CRUD functions"
      pattern: "SessionSnapshot"
---

<objective>
Add sort-mode sound effects and extend session types for sort persistence.

Purpose: These are independent infrastructure pieces that other plans consume. Sound effects are called from gesture handlers. The SortSnapshot type enables session persistence (Plan 08). Both can be built in parallel with the reducer (Plan 01).

Output: Extended `soundEffects.ts` with 4 new functions, extended `sessionTypes.ts` with SortSnapshot.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/lib/audio/soundEffects.ts (extend with new functions)
@src/lib/sessions/sessionTypes.ts (extend union)
@.planning/phases/23-flashcard-sort/23-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Sort mode sound effects</name>
  <files>src/lib/audio/soundEffects.ts</files>
  <action>
Add four new exported functions to `src/lib/audio/soundEffects.ts`, following the existing pattern (mute check, getContext, try/catch, silent ignore):

**`playFling()`** -- Whoosh for card fling:
- Frequency sweep: 800 Hz -> 300 Hz over 0.2s using exponentialRampToValueAtTime
- Sine wave, gain 0.12, gain ramp to 0.001 over 0.2s
- Creates own oscillator (not playNote helper, needs frequency ramp)

**`playKnow()`** -- Ding for "Know" sort:
- Ascending two-note similar to playCorrect
- C5 (523 Hz) at t=0, 0.12 gain, 0.2s duration
- E5 (659 Hz) at t=0.1, 0.12 gain, 0.2s duration
- Use playNote helper

**`playDontKnow()`** -- Thud for "Don't Know":
- Low single note, triangle wave
- 200 Hz, t=0, gain 0.15, 0.15s duration
- Use playNote helper with 'triangle' wave type

**`playMasteryComplete()`** -- Triumphant chime for 100% mastery:
- Five-note ascending pattern:
  - C5 (523), t=0, gain 0.4, 0.3s
  - E5 (659), t=0, gain 0.4, 0.3s (chord with C5)
  - G5 (784), t=0, gain 0.4, 0.3s (chord)
  - C6 (1047), t=0.3, gain 0.5, 0.3s
  - E6 (1319), t=0.5, gain 0.5, 0.25s

Add a new section comment `// Sort mode sounds` between the existing quiz sounds and any future sections. Add JSDoc comments matching the existing style.
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint -- --no-warn-ignored` -- compiles and lints cleanly.</verify>
  <done>All four sort sound functions exported from soundEffects.ts: playFling, playKnow, playDontKnow, playMasteryComplete. Each follows mute-check + try/catch pattern.</done>
</task>

<task type="auto">
  <name>Task 2: SortSnapshot type and session union extension</name>
  <files>src/lib/sessions/sessionTypes.ts</files>
  <action>
Extend `src/lib/sessions/sessionTypes.ts` to add sort session support:

1. **Add `'sort'` to BaseSessionSnapshot type discriminant:**
   Update the `type` field union: `'mock-test' | 'practice' | 'interview' | 'sort'`

2. **Add RoundResult interface** (inline to avoid circular deps -- **NOTE:** this mirrors `RoundResult` in `src/lib/sort/sortTypes.ts`; any structural changes to one must be applied to the other):
```typescript
/** Stats for a completed sort round (used in SortSnapshot persistence) */
export interface SortRoundResult {
  round: number;
  totalCards: number;
  knownCount: number;
  unknownCount: number;
  durationMs: number;
  unknownIds: string[];
}
```

3. **Add SortSnapshot interface:**
```typescript
export interface SortSnapshot extends BaseSessionSnapshot {
  type: 'sort';
  /** Full card set for the session (question IDs only for compact storage) */
  sourceCardIds: string[];
  /** Current round number */
  round: number;
  /** Question IDs sorted as Know this round */
  knownIds: string[];
  /** Question IDs sorted as Don't Know this round */
  unknownIds: string[];
  /** Cumulative Don't Know IDs across all rounds */
  allUnknownIds: string[];
  /** Card IDs remaining in current round (shuffled order) */
  remainingCardIds: string[];
  /** Current card index in the round */
  currentIndex: number;
  /** Previous round results for improvement delta */
  roundHistory: SortRoundResult[];
  /** Category filter if applied */
  categoryFilter?: string;
  /** Date.now() of round start for duration calculation */
  startTime: number;
}
```

4. **Extend SessionSnapshot union:**
```typescript
export type SessionSnapshot = MockTestSnapshot | PracticeSnapshot | InterviewSnapshot | SortSnapshot;
```

**Do NOT bump SESSION_VERSION** -- adding a new union member is backward-compatible per research recommendation. Existing mock-test/practice/interview snapshots remain valid.

Note: Store card IDs (not full Question objects) to keep IndexedDB payloads small. The consumer reconstructs Question objects from `allQuestions` by ID.
  </action>
  <verify>Run `npx tsc --noEmit` -- all existing sessionStore consumers still compile. Run `npm run lint -- --no-warn-ignored`.</verify>
  <done>SortSnapshot interface exists with all persistence fields. SessionSnapshot union includes 'sort'. BaseSessionSnapshot type field includes 'sort'. SESSION_VERSION unchanged.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes -- no type errors in session store or sound effects
2. `npm run lint -- --no-warn-ignored` passes
3. Existing session-related tests still pass: `npx vitest run --reporter=verbose src/lib/sessions/`
4. No circular dependency between sessionTypes.ts and sortTypes.ts
</verification>

<success_criteria>
- Four sound effects (playFling, playKnow, playDontKnow, playMasteryComplete) exported and follow existing patterns
- SortSnapshot type defined with ID-based storage (not full Question objects)
- SessionSnapshot union extended with SortSnapshot
- No version bump to SESSION_VERSION
- Zero regressions in existing session persistence code
</success_criteria>

<output>
After completion, create `.planning/phases/23-flashcard-sort/23-02-SUMMARY.md`
</output>
