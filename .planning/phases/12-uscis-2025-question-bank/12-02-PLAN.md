---
phase: 12-uscis-2025-question-bank
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/data/state-representatives.json
  - src/contexts/StateContext.tsx
  - src/AppShell.tsx
autonomous: true

must_haves:
  truths:
    - "User's state selection persists across page refreshes via localStorage"
    - "StateContext provides selectedState, setSelectedState, and stateInfo to all descendants"
    - "State data includes governor, senators, and capital for all 50 states + DC + 5 territories"
    - "Territories correctly show null senators (DC, PR, GU, VI, AS, MP have no U.S. Senators)"
  artifacts:
    - path: "src/data/state-representatives.json"
      provides: "Static fallback data for 56 states/territories"
      contains: "California"
    - path: "src/contexts/StateContext.tsx"
      provides: "StateProvider context and useUserState hook"
      exports: ["StateProvider", "useUserState"]
    - path: "src/AppShell.tsx"
      provides: "StateProvider wrapping the app"
      contains: "StateProvider"
  key_links:
    - from: "src/contexts/StateContext.tsx"
      to: "src/data/state-representatives.json"
      via: "JSON import for state data lookup"
      pattern: "state-representatives"
    - from: "src/AppShell.tsx"
      to: "src/contexts/StateContext.tsx"
      via: "StateProvider wrapping Router"
      pattern: "StateProvider"
---

<objective>
Create the state personalization data layer and context provider.

Purpose: Enables state-specific dynamic answers (governor, senators, capital) for USCIS questions. Users select their state once and see personalized answers throughout the app.

Output: Static JSON data file with all 56 states/territories, StateContext provider with localStorage persistence, integrated into AppShell provider hierarchy.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-uscis-2025-question-bank/12-RESEARCH.md
@src/contexts/LanguageContext.tsx
@src/AppShell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create state representative data and StateContext provider</name>
  <files>
    src/data/state-representatives.json
    src/contexts/StateContext.tsx
  </files>
  <action>
**Step 1: Create `src/data/state-representatives.json`**

Create the `src/data/` directory and the JSON file containing data for all 50 states + DC + 5 territories (56 entries total).

Structure per entry:
```json
{
  "CA": {
    "name": "California",
    "capital": "Sacramento",
    "governor": "Gavin Newsom",
    "senators": ["Alex Padilla", "Adam Schiff"],
    "lastUpdated": "2026-02-09"
  }
}
```

For territories (DC, PR, GU, VI, AS, MP):
- `senators`: `null` (no U.S. Senators)
- `governor`: The actual governor/mayor (DC has a mayor, not governor -- use "Muriel Bowser" with a note)
- `capital`: The actual capital city

Include all 50 states with current (as of Feb 2026) governor and senators. Research accuracy is important but the data ships as a static fallback that can be manually updated after elections.

Key data points to get right:
- All state capitals (these are static/permanent)
- Current governors (some changed in 2025/2026 elections)
- Current senators (some changed in 2024 election cycle)

**Step 2: Create `src/contexts/StateContext.tsx`**

Follow the `LanguageContext.tsx` pattern exactly to avoid React Compiler lint violations:

```typescript
'use client';

import { createContext, useContext, useState, useCallback, useEffect, type ReactNode } from 'react';
import stateRepresentatives from '@/data/state-representatives.json';

const STATE_KEY = 'civic-prep-user-state';

export interface StateInfo {
  name: string;
  capital: string;
  governor: string;
  senators: [string, string] | null;
  lastUpdated: string;
}

interface StateContextValue {
  /** Two-letter state/territory code, or null if not set */
  selectedState: string | null;
  /** Set the user's state (persists to localStorage) */
  setSelectedState: (code: string | null) => void;
  /** Resolved state info from data file, or null if no state selected */
  stateInfo: StateInfo | null;
  /** All available states/territories for the picker */
  allStates: Array<{ code: string; name: string }>;
}

const StateContext = createContext<StateContextValue | null>(null);
```

Provider implementation:
- Use `useState` with lazy initializer for SSR safety (same pattern as LanguageContext)
- `useEffect` for localStorage hydration on mount
- `useCallback` for `setSelectedState` that writes to localStorage
- Derive `stateInfo` from `stateRepresentatives[selectedState]`
- Derive `allStates` array from the JSON keys, sorted alphabetically by name
- Export `StateProvider` and `useUserState` hook (throw if used outside provider)

IMPORTANT: Do NOT use `useMemo<Type>()` generic syntax -- use `const x: Type = useMemo(...)` per project MEMORY.md to avoid React Compiler issues.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `npx eslint src/contexts/StateContext.tsx src/data/ --no-warn-ignored` passes
3. JSON file is valid: `node -e "const d = require('./src/data/state-representatives.json'); console.log(Object.keys(d).length)"` outputs 56
4. All 50 states + DC + 5 territories present in JSON
5. No `useMemo<` generic syntax in StateContext.tsx
  </verify>
  <done>
- state-representatives.json has 56 entries (50 states + DC + PR + GU + VI + AS + MP)
- Each entry has name, capital, governor, senators (null for territories), lastUpdated
- StateContext exports StateProvider and useUserState
- localStorage persistence works with SSR-safe initialization
- TypeScript and ESLint pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate StateProvider into AppShell</name>
  <files>
    src/AppShell.tsx
  </files>
  <action>
Add `StateProvider` to the provider hierarchy in `src/AppShell.tsx`.

1. Import `StateProvider` from `@/contexts/StateContext`
2. Wrap it around the `Router` component, inside `SRSProvider` (so state is available to all route components)

The provider nesting should be:
```
ErrorBoundary > LanguageProvider > ThemeProvider > ToastProvider > OfflineProvider > AuthProvider > SocialProvider > SRSProvider > StateProvider > Router
```

StateProvider goes after SRSProvider because it's a simple data provider with no dependencies on other contexts. It should be as close to the Router as possible since its consumers are page components.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `npx eslint src/AppShell.tsx --no-warn-ignored` passes
3. `StateProvider` appears in the provider nesting in AppShell.tsx
4. `npm run build` passes (Next.js build)
  </verify>
  <done>
- StateProvider is integrated into AppShell.tsx
- App builds and starts without errors
- useUserState is accessible from any route component
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- full type check passes
2. `npm run build` -- Next.js build passes
3. State data JSON has 56 entries with correct structure
4. StateProvider wraps Router in AppShell
5. No React Compiler lint violations
</verification>

<success_criteria>
- 56 states/territories in JSON with governor, senators (nullable), capital, lastUpdated
- StateContext provides selectedState, setSelectedState, stateInfo, allStates
- localStorage key `civic-prep-user-state` persists selection
- SSR-safe initialization (null default, hydrate from localStorage in useEffect)
- StateProvider integrated into AppShell provider hierarchy
</success_criteria>

<output>
After completion, create `.planning/phases/12-uscis-2025-question-bank/12-02-SUMMARY.md`
</output>
