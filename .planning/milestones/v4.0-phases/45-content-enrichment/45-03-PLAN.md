---
phase: 45-content-enrichment
plan: 03
type: execute
wave: 3
depends_on: [01, 02]
files_modified:
  - src/views/DrillPage.tsx
  - src/components/study/Flashcard3D.tsx
  - src/components/quiz/FeedbackPanel.tsx
autonomous: true
requirements: [CONT-05, CONT-06, CONT-07, CONT-08]

must_haves:
  truths:
    - "DrillPage shows StudyTipCard at top of category drill for the active category"
    - "Flashcard3D back shows TrickyBadge when question has tricky: true"
    - "FeedbackPanel shows TrickyBadge in header area when question is tricky"
    - "Related question chips already render in ExplanationCard (CONT-08 verified)"
  artifacts:
    - path: "src/views/DrillPage.tsx"
      provides: "StudyTipCard integrated at top of drill"
      contains: "StudyTipCard"
    - path: "src/components/study/Flashcard3D.tsx"
      provides: "TrickyBadge in metadata badges area"
      contains: "TrickyBadge"
    - path: "src/components/quiz/FeedbackPanel.tsx"
      provides: "TrickyBadge in feedback header"
      contains: "TrickyBadge"
  key_links:
    - from: "src/views/DrillPage.tsx"
      to: "src/components/drill/StudyTipCard.tsx"
      via: "import and render before DrillConfig/PracticeSession"
      pattern: "StudyTipCard"
    - from: "src/views/DrillPage.tsx"
      to: "src/constants/studyTips.ts"
      via: "getStudyTip lookup by category"
      pattern: "getStudyTip"
    - from: "src/components/study/Flashcard3D.tsx"
      to: "src/components/quiz/TrickyBadge.tsx"
      via: "import, render in metadata badges when tricky prop is true"
      pattern: "TrickyBadge"
---

<objective>
Wire TrickyBadge and StudyTipCard into their rendering contexts. Verify CONT-08 (related questions) is already complete.

Purpose: Complete integration of all enrichment UI components into their rendering contexts (CONT-05 already wired by Plan 02's ExplanationCard update, this wires CONT-06, CONT-07, and verifies CONT-08).
Output: DrillPage shows study tips, Flashcard3D and FeedbackPanel show tricky badges
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/45-content-enrichment/45-CONTEXT.md
@.planning/phases/45-content-enrichment/45-01-SUMMARY.md
@.planning/phases/45-content-enrichment/45-02-SUMMARY.md

@src/views/DrillPage.tsx
@src/components/study/Flashcard3D.tsx
@src/components/quiz/FeedbackPanel.tsx
@src/components/quiz/TrickyBadge.tsx
@src/components/drill/StudyTipCard.tsx
@src/constants/studyTips.ts

<interfaces>
<!-- Key interfaces the executor needs for wiring -->
From src/components/quiz/TrickyBadge.tsx:
```typescript
export function TrickyBadge({ showBurmese = false }: { showBurmese?: boolean }): JSX.Element;
```

From src/components/drill/StudyTipCard.tsx:
```typescript
export function StudyTipCard({ category, tipEn, tipMy, className }: StudyTipCardProps): JSX.Element | null;
```

From src/constants/studyTips.ts:
```typescript
export function getStudyTip(category: Category): StudyTip | undefined;
```

From src/types/index.ts (Question — after Plan 01):
```typescript
export interface Question {
  // ... existing fields ...
  tricky?: boolean;
}
```

From src/components/study/Flashcard3D.tsx (props):
```typescript
interface Flashcard3DProps {
  // ... existing props including difficulty, masteryState ...
  // Wiring needs: add tricky prop OR read from question data
}
```

DrillPage state flow:
- DrillPage has `phase: 'config' | 'session' | 'results'`
- Category available via DrillConfig selection or searchParams
- PracticeSession renders questions with FeedbackPanel
- DrillResults shows final results
- Study tip card should show during 'config' phase or at start of 'session'

FeedbackPanel props (line 24-38):
```typescript
interface FeedbackPanelProps {
  isCorrect: boolean;
  show: boolean;
  correctAnswer: string;
  explanation?: Explanation;
  questionId?: string;
  // No tricky prop currently — needs adding or deriving from question data
}
```

Flashcard3D metadata badges area (lines 473-539):
- Already renders category badge, difficulty badge, mastery badge
- TrickyBadge should be added alongside these existing badges
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire StudyTipCard into DrillPage and TrickyBadge into Flashcard3D and FeedbackPanel</name>
  <files>src/views/DrillPage.tsx, src/components/study/Flashcard3D.tsx, src/components/quiz/FeedbackPanel.tsx</files>
  <action>
**1. Wire StudyTipCard into DrillPage:**

In `src/views/DrillPage.tsx`:

a. Add imports:
```typescript
import { StudyTipCard } from '@/components/drill/StudyTipCard';
import { getStudyTip } from '@/constants/studyTips';
```

b. In the render section, when the drill is in 'config' phase, render the StudyTipCard ABOVE the DrillConfig component. The study tip card should show for the selected category:

Find where DrillConfig is rendered (likely in a conditional on `phase === 'config'`) and add the StudyTipCard before it:

```typescript
{phase === 'config' && (
  <>
    {selectedCategory && (() => {
      const tip = getStudyTip(selectedCategory as Category);
      return tip ? (
        <StudyTipCard
          category={tip.category}
          tipEn={tip.tipEn}
          tipMy={tip.tipMy}
          className="mb-4"
        />
      ) : null;
    })()}
    <DrillConfig ... />
  </>
)}
```

Note: The exact variable name for the selected category may differ — check the DrillPage code. It could be derived from searchParams or state. Look for the category that's passed to PracticeSession or DrillConfig.

If the category is not readily available during 'config' phase (e.g., user hasn't selected yet), show the study tip once a category is selected or during the 'session' phase before questions start. The key constraint from CONTEXT.md is: "Appear at the top of category practice/drill only (DrillPage)."

**2. Wire TrickyBadge into Flashcard3D:**

In `src/components/study/Flashcard3D.tsx`:

a. Add import:
```typescript
import { TrickyBadge } from '@/components/quiz/TrickyBadge';
```

b. Add `tricky` prop to `Flashcard3DProps`:
```typescript
interface Flashcard3DProps {
  // ... existing props ...
  /** Whether this question is commonly tricky */
  tricky?: boolean;
}
```

c. Destructure in component:
```typescript
export function Flashcard3D({
  // ... existing props ...
  tricky,
  className,
}: Flashcard3DProps) {
```

d. In the metadata badges area on the card back (after the existing difficulty/mastery badges, around line 490-539), add the TrickyBadge:
```typescript
{/* Tricky question badge */}
{tricky && (
  <TrickyBadge showBurmese={showBurmese} />
)}
```

**3. Wire TrickyBadge into FeedbackPanel:**

In `src/components/quiz/FeedbackPanel.tsx`:

a. Add import:
```typescript
import { TrickyBadge } from '@/components/quiz/TrickyBadge';
```

b. Add `tricky` prop to `FeedbackPanelProps`:
```typescript
interface FeedbackPanelProps {
  // ... existing props ...
  /** Whether this question is commonly tricky */
  tricky?: boolean;
}
```

c. Destructure in component and render the TrickyBadge in the header area, next to the streak badge (around line 309):
```typescript
{/* Tricky badge */}
{tricky && (
  <div className="mt-1">
    <TrickyBadge showBurmese={showBurmese} />
  </div>
)}
```

**4. Thread tricky prop through callers:**

Search for all places that render `<Flashcard3D` and `<FeedbackPanel` and pass the `tricky` prop from the question data:

For Flashcard3D callers, add: `tricky={question.tricky}`
For FeedbackPanel callers, add: `tricky={currentQuestion?.tricky}`

Use grep to find all callers:
```bash
grep -rn "Flashcard3D\|FeedbackPanel" src/ --include="*.tsx" | grep -v "import\|export\|test\|\.d\.ts"
```

For each caller, pass the `tricky` prop from the question being displayed.
  </action>
  <verify>
    <automated>pnpm typecheck && pnpm vitest run src/constants/questions/questions.test.ts</automated>
    No type errors. All question tests pass. TrickyBadge renders where tricky is true.
  </verify>
  <done>StudyTipCard shows at top of DrillPage category drill. TrickyBadge shows in Flashcard3D back metadata and FeedbackPanel header for tricky questions. All callers pass tricky prop.</done>
</task>

<task type="auto">
  <name>Task 2: Full build verification and CONT-08 confirmation</name>
  <files></files>
  <action>
1. Run the full build pipeline:
   ```bash
   pnpm lint
   pnpm lint:css
   pnpm format:check
   pnpm typecheck
   pnpm test
   pnpm build
   ```

2. Fix any build/lint/type errors that surface. Common issues:
   - Unused imports (Brain icon removed from ExplanationCard)
   - Missing prop threading (tricky prop not passed in some callers)
   - i18n string access path issues

3. Verify CONT-08 (related questions):
   - Confirm `relatedQuestionIds` is populated for all 128 questions (should already be 128/128 from existing data)
   - Confirm `RelatedQuestions` component is rendered inside `ExplanationCard`
   - Confirm `ExplanationCard` is rendered in both `Flashcard3D` (back) and `FeedbackPanel` (study) contexts
   - This requirement should already be satisfied — just verify, no code changes needed.

4. Run formatting to fix any style issues:
   ```bash
   pnpm format:write
   ```
  </action>
  <verify>
    <automated>pnpm lint && pnpm typecheck && pnpm test && pnpm build</automated>
    Full pipeline passes: lint clean, types correct, all tests green, build succeeds.
  </verify>
  <done>Full build passes. All CONT-01 through CONT-08 requirements verified: enrichment data complete (01-04), mnemonic treatment updated (05), study tips wired (06), tricky badges wired (07), related questions confirmed (08).</done>
</task>

</tasks>

<verification>
- `pnpm build` — successful production build
- `pnpm test` — all tests pass including enrichment completeness
- `pnpm lint` — no lint errors
- `pnpm typecheck` — no type errors
- DrillPage renders StudyTipCard for active category
- Flashcard3D back shows TrickyBadge when tricky: true
- FeedbackPanel shows TrickyBadge when tricky: true
- ExplanationCard renders RelatedQuestions (CONT-08 preexisting)
</verification>

<success_criteria>
- StudyTipCard visible at top of category drill in DrillPage
- TrickyBadge visible on tricky questions in Flashcard3D and FeedbackPanel
- All 128 questions have relatedQuestionIds and they render via RelatedQuestions
- Full build pipeline (lint, typecheck, test, build) passes
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/45-content-enrichment/45-03-SUMMARY.md`
</output>
