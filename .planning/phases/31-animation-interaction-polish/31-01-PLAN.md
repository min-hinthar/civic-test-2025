---
phase: 31-animation-interaction-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/Button.tsx
  - src/components/bilingual/BilingualButton.tsx
  - src/lib/motion-config.ts
autonomous: true
requirements: [ANIM-01]

must_haves:
  truths:
    - "Primary buttons show 3D chunky press with visible bottom edge, spring-back release, and lift on hover"
    - "Secondary buttons scale to 0.97 with shadow reduction on press"
    - "Tertiary buttons transition to 0.7 opacity on press in ~100ms"
    - "Disabled buttons show muted press animation (slight opacity change)"
    - "Button tier is set via explicit variant prop (primary/secondary/tertiary)"
    - "All button animations respect prefers-reduced-motion with instant state changes"
    - "Dark mode 3D edges use lighter rim-lit colors instead of darker shades"
  artifacts:
    - path: "src/components/ui/Button.tsx"
      provides: "Three-tier button press system with 3D chunky primary, scale secondary, opacity tertiary"
      contains: "chunky3D"
    - path: "src/components/bilingual/BilingualButton.tsx"
      provides: "BilingualButton aligned with Button.tsx tier system"
      contains: "springTransition"
    - path: "src/lib/motion-config.ts"
      provides: "SPRING_PRESS_DOWN config for fast down press"
      exports: ["SPRING_PRESS_DOWN"]
  key_links:
    - from: "src/components/ui/Button.tsx"
      to: "src/lib/motion-config.ts"
      via: "import SPRING_PRESS_DOWN and SPRING_BOUNCY"
      pattern: "import.*SPRING_PRESS_DOWN.*motion-config"
---

<objective>
Implement the three-tier button press feedback system across Button.tsx and BilingualButton.tsx.

Purpose: Every button in the app communicates its importance level through tactile, physically-inspired feedback. Primary buttons feel like arcade buttons (3D chunky press), secondary buttons give subtle scale feedback, and tertiary buttons use simple opacity transitions. This creates a clear visual hierarchy and a playful, game-like interaction feel.

Output: Updated Button.tsx with explicit tier-based press behavior, updated BilingualButton.tsx aligned to the same system, and new spring config in motion-config.ts.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/ui/Button.tsx
@src/components/bilingual/BilingualButton.tsx
@src/lib/motion-config.ts
@src/hooks/useReducedMotion.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SPRING_PRESS_DOWN config and enhance Button.tsx with three-tier press system</name>
  <files>src/lib/motion-config.ts, src/components/ui/Button.tsx</files>
  <action>
**motion-config.ts:**
Add a new spring config for fast button press-down:
```typescript
export const SPRING_PRESS_DOWN = {
  type: 'spring' as const,
  stiffness: 800,
  damping: 30,
  mass: 0.5,
}; // ~50ms settle time for instant press feel
```

**Button.tsx — Tier system overhaul:**

1. **Keep existing `chunky3D`, `chunkyDestructive3D`, `chunkySuccess3D` CSS strings** for the primary tier. These handle shadow + translateY on `:active` via CSS transitions.

2. **Add dark mode rim-lit edge classes.** The current chunky3D uses `hsl(var(--primary-700))` for the bottom edge. In dark mode, switch to a lighter shade for the rim-lit glow effect. Add dark mode variants:
   - Primary: `dark:shadow-[0_4px_0_hsl(var(--primary-300)/0.6)]` at rest, pressed: `dark:active:shadow-[0_1px_0_hsl(var(--primary-300)/0.6),0_0_20px_hsl(var(--color-primary)/0.4)]`
   - Destructive: `dark:shadow-[0_4px_0_hsl(10_70%_65%/0.6)]` and similar
   - Success: `dark:shadow-[0_4px_0_hsl(142_76%_55%/0.6)]` and similar

3. **Refactor `variants` object** to map to tiers:
   - `primary`, `chunky`, `destructive`, `chunky-destructive`, `success`, `chunky-success` → PRIMARY tier (3D chunky press, scale 0.95 + y shift on tap, spring-back release)
   - `secondary`, `outline` → SECONDARY tier (scale 0.97, slight shadow reduction, no 3D edge)
   - `ghost` → TERTIARY tier (opacity 0.7 via CSS, no motion animation)

4. **Update `motionVariants` to be tier-aware.** Instead of one fixed set of motion variants, compute them based on the variant's tier:
   ```typescript
   const tier = getTier(variant); // 'primary' | 'secondary' | 'tertiary'

   const motionVariants = {
     idle: { scale: 1 },
     hover: shouldReduceMotion ? {} : (
       tier === 'primary' ? { scale: 1.03, y: -1 } :  // lift on hover
       tier === 'secondary' ? { scale: 1.02 } :
       {} // tertiary: no hover animation
     ),
     tap: shouldReduceMotion ? {} : (
       tier === 'primary' ? { scale: 0.95 } :
       tier === 'secondary' ? { scale: 0.97 } :
       {} // tertiary: opacity handled by CSS
     ),
   };
   ```

5. **Add CSS for tertiary opacity transition.** For ghost variant, add: `transition-opacity duration-100 active:opacity-70` to the variant class string.

6. **Add CSS for secondary shadow reduction on press.** For secondary/outline: add `active:shadow-sm` or reduce shadow on `:active`.

7. **Disabled state muted animation.** When disabled, use a very subtle tap variant: `{ scale: 0.99, opacity: 0.9 }` — hints at interactivity without full response. Use a CSS-only approach: add `disabled:active:opacity-45` class.

8. **Animated focus ring.** Replace static `focus-visible:ring-2 focus-visible:ring-ring` with an animated version:
   - Add `focus-visible:ring-2 focus-visible:ring-primary/60 focus-visible:ring-offset-2 focus-visible:animate-[focusRing_0.3s_ease-out]`
   - The `focusRing` keyframe should be defined in globals.css (note for glass audit plan) or use `transition-[box-shadow] duration-300` which is simpler.
   - Simpler approach: keep `focus-visible:ring-2` but add `transition-shadow duration-200` so the ring fades in. Actually, Tailwind ring utilities use box-shadow, so `transition-shadow` already covers this. Just ensure `transition-[box-shadow] duration-200` is in the base classes.

9. **Skip ripple effect** per Claude's discretion — the 3D chunky press with prismatic glow is already bold and distinctive. Adding ripple would create visual noise.

10. **Use hybrid CSS+spring approach** per Claude's discretion — CSS handles immediate shadow/translateY on `:active`, motion/react handles scale spring on `whileTap`/`whileHover`. This prevents the double-transform conflict noted in pitfall 7 — motion handles scale only, CSS handles shadow and translateY.
  </action>
  <verify>
- `npm run typecheck` passes
- `npm run lint` passes
- Button component renders with all variant types without errors
  </verify>
  <done>
Button.tsx has three distinct tiers of press feedback: primary (3D chunky with spring-back), secondary (subtle scale 0.97), tertiary (opacity 0.7 fade). Dark mode uses lighter rim-lit edges. Disabled buttons show muted feedback. Focus ring transitions smoothly. motion-config.ts exports SPRING_PRESS_DOWN.
  </done>
</task>

<task type="auto">
  <name>Task 2: Align BilingualButton.tsx with Button.tsx tier system</name>
  <files>src/components/bilingual/BilingualButton.tsx</files>
  <action>
BilingualButton.tsx currently has its own `springTransition` config and `chunky3D` string that are out of sync with Button.tsx. Align it:

1. **Import shared configs** from `motion-config.ts`: `SPRING_BOUNCY`, `SPRING_PRESS_DOWN`

2. **Replace local `springTransition`** with `SPRING_BOUNCY` (same spring behavior as Button.tsx).

3. **Replace local `chunky3D`** with the same dark-mode-aware 3D edge classes from Button.tsx Task 1. Consider extracting shared chunky3D class strings to a shared constant or just duplicating (since BilingualButton uses hardcoded HSL values like `hsl(224_76%_48%)` while Button uses token-based `hsl(var(--primary-700))`). Prefer token-based approach: update BilingualButton to use `hsl(var(--primary-700))` tokens instead of hardcoded colors, matching Button.tsx.

4. **Add tier-aware motionVariants** following the same pattern as Button.tsx Task 1:
   - `primary`, `chunky` → PRIMARY tier
   - `secondary` → SECONDARY tier
   - `outline`, `ghost` → TERTIARY tier

5. **Add the same dark mode rim-lit edge** classes to the chunky variant.

6. **Add animated focus ring transition** matching Button.tsx.
  </action>
  <verify>
- `npm run typecheck` passes
- `npm run lint` passes
- BilingualButton uses shared spring configs from motion-config.ts
  </verify>
  <done>
BilingualButton.tsx uses the same spring configs, 3D edge tokens, tier-based press feedback, and dark mode rim-lit edges as Button.tsx. No duplicate local spring/shadow definitions.
  </done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes with no errors
- `npm run lint` passes
- `npm run build` completes without errors
- Button.tsx exports function with tier-aware variants
- BilingualButton.tsx imports from motion-config.ts (no local spring config)
- All three tiers produce visually distinct press feedback
</verification>

<success_criteria>
All buttons in the app respond with tier-appropriate feedback: primary buttons depress with 3D chunky depth and spring back, secondary buttons scale subtly, and tertiary buttons fade. Dark mode shows rim-lit lighter edges on 3D buttons. Disabled buttons give muted feedback. Focus rings transition smoothly on keyboard navigation.
</success_criteria>

<output>
After completion, create `.planning/phases/31-animation-interaction-polish/31-01-SUMMARY.md`
</output>
