---
phase: 02-pwa-offline
plan: 05
type: execute
wave: 4
depends_on: ["02-04"]
files_modified:
  - src/components/pwa/IOSTip.tsx
  - src/components/AppNavigation.tsx
  - src/hooks/useInstallPrompt.ts
autonomous: true

must_haves:
  truths:
    - "iOS Safari user sees friendly one-time tip about weekly visits"
    - "Tip is warm and helpful, not alarming"
    - "Tip only shows once per device"
    - "Tip does NOT appear on non-iOS devices"
  artifacts:
    - path: "src/components/pwa/IOSTip.tsx"
      provides: "One-time iOS data persistence tip"
      exports: ["IOSTip"]
  key_links:
    - from: "src/components/pwa/IOSTip.tsx"
      to: "localStorage"
      via: "dismissal tracking"
      pattern: "localStorage.*ios-tip"
---

<objective>
Create iOS Safari-specific tip about data persistence.

Purpose: Per user decision - iOS Safari has 7-day data eviction for non-home-screen apps. Show a one-time friendly tip (not a warning) advising users to open the app weekly to keep their data saved. No persistent storage API request.
Output: Friendly bilingual tip that appears once for iOS users.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-pwa-offline/02-RESEARCH.md
@.planning/phases/02-pwa-offline/02-04-SUMMARY.md

@src/hooks/useInstallPrompt.ts
@src/components/AppNavigation.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create iOS tip component</name>
  <files>
    src/components/pwa/IOSTip.tsx
  </files>
  <action>
Create src/components/pwa/IOSTip.tsx with a warm, friendly tone (per user decision: not alarming):

```typescript
import React from "react";
import { X, Lightbulb } from "lucide-react";

const IOS_TIP_SHOWN_KEY = "ios-tip-shown";

interface IOSTipProps {
  onDismiss: () => void;
}

export function IOSTip({ onDismiss }: IOSTipProps) {
  const handleDismiss = () => {
    localStorage.setItem(IOS_TIP_SHOWN_KEY, "true");
    onDismiss();
  };

  return (
    <div className="relative rounded-lg border border-amber-200 bg-amber-50 p-4 dark:border-amber-800 dark:bg-amber-900/20">
      {/* Close button */}
      <button
        onClick={handleDismiss}
        className="absolute right-2 top-2 p-1 text-amber-600 hover:text-amber-800 dark:text-amber-400 dark:hover:text-amber-200"
        aria-label="Dismiss tip"
      >
        <X className="h-4 w-4" />
      </button>

      <div className="flex items-start gap-3 pr-6">
        <div className="flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-amber-100 dark:bg-amber-800">
          <Lightbulb className="h-4 w-4 text-amber-600 dark:text-amber-400" />
        </div>
        <div>
          {/* Friendly tip - not a warning */}
          <p className="text-sm font-medium text-amber-800 dark:text-amber-200">
            Quick tip for the best experience
          </p>
          <p className="font-myanmar text-sm text-amber-700 dark:text-amber-300">
            အကောင်းဆုံး အတွေ့အကြုံအတွက် အကြံပြုချက်
          </p>

          <p className="mt-2 text-sm text-amber-700 dark:text-amber-300">
            Open the app at least once a week to keep your study progress saved.
            Better yet, add it to your home screen for the fullest experience!
          </p>
          <p className="mt-1 font-myanmar text-sm text-amber-600 dark:text-amber-400">
            သင့်လေ့လာမှု တိုးတက်မှုကို သိမ်းဆည်းထားဖို့ တစ်ပတ်လျှင် အနည်းဆုံး
            တစ်ကြိမ် အက်ပ်ကို ဖွင့်ပါ။ Home screen မှာ ထည့်ရင် ပိုကောင်းပါတယ်!
          </p>
        </div>
      </div>
    </div>
  );
}

export function shouldShowIOSTip(): boolean {
  if (typeof window === "undefined") return false;

  // Only show on iOS
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  if (!isIOS) return false;

  // Don't show if already installed as PWA (standalone mode)
  if (window.matchMedia("(display-mode: standalone)").matches) return false;
  if ((navigator as unknown as { standalone?: boolean }).standalone) return false;

  // Don't show if already dismissed
  if (localStorage.getItem(IOS_TIP_SHOWN_KEY)) return false;

  return true;
}
```

Design notes:
- Uses amber/yellow color scheme (friendly, not red/warning)
- Lightbulb icon (helpful tip, not warning icon)
- Positive framing: "for the best experience" not "or you'll lose data"
- Suggests adding to home screen as the better option
- Only shows once (localStorage tracks dismissal)
  </action>
  <verify>
    pnpm run typecheck passes
    pnpm run lint passes
  </verify>
  <done>
    IOSTip component with warm tone, shouldShowIOSTip detection function
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate iOS tip into app</name>
  <files>
    src/AppShell.tsx
  </files>
  <action>
1. Update src/AppShell.tsx to show iOS tip:
   - Import IOSTip and shouldShowIOSTip from "@/components/pwa/IOSTip"
   - Add state: `const [showIOSTip, setShowIOSTip] = useState(false)`
   - On mount, check `shouldShowIOSTip()` and set state accordingly
   - Render IOSTip conditionally after welcome modal flow completes

2. Placement and timing:
   - Show AFTER welcome modal (if applicable) is dismissed
   - Show as a toast-like banner at bottom of screen (not blocking modal)
   - Position: fixed bottom with margin
   - Should not interfere with main app usage

3. Update AppShell render:
   ```tsx
   {/* iOS tip - shows after welcome flow, at bottom */}
   {showIOSTip && (
     <div className="fixed bottom-4 left-4 right-4 z-40 mx-auto max-w-md">
       <IOSTip onDismiss={() => setShowIOSTip(false)} />
     </div>
   )}
   ```

4. Timing logic:
   - If user just completed install/welcome flow, delay iOS tip by 2 seconds
   - If returning user on iOS (no welcome needed), show immediately
   - This prevents overwhelming with too many messages at once
  </action>
  <verify>
    pnpm run build succeeds
    On iOS Safari, tip appears (test with DevTools device emulation)
    Tip does not appear on Chrome desktop
    Dismissing tip sets localStorage flag
    Tip does not reappear after dismissal
  </verify>
  <done>
    iOS tip integrated, appears only on iOS Safari, dismissable, shows once
  </done>
</task>

</tasks>

<verification>
1. Test on iOS Safari (or Chrome DevTools with iOS device emulation)
2. Clear localStorage and visit app
3. After welcome flow completes, iOS tip should appear at bottom
4. Tip should have warm amber styling with lightbulb icon
5. Click X to dismiss - should not reappear on refresh
6. Test on Chrome desktop - tip should NOT appear
7. Test when app is in standalone mode (via home screen) - tip should NOT appear
</verification>

<success_criteria>
- Tip only appears on iOS Safari (not other browsers)
- Tip does not appear if app is installed to home screen
- Tip has friendly amber styling with lightbulb icon
- Tone is warm and helpful ("Quick tip" not "Warning")
- Text is bilingual (English + Burmese)
- Dismissal is permanent (localStorage tracked)
- Tip appears as bottom banner, not blocking modal
- Does not interfere with app usage
</success_criteria>

<output>
After completion, create `.planning/phases/02-pwa-offline/02-05-SUMMARY.md`
</output>
