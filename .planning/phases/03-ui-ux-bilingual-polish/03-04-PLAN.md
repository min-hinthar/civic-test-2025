---
phase: 03-ui-ux-bilingual-polish
plan: 04
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/animations/PageTransition.tsx
  - src/components/animations/StaggeredList.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Pages slide and fade on navigation"
    - "List items fade in sequentially (staggered)"
    - "Animations complete without blocking interaction"
  artifacts:
    - path: "src/components/animations/PageTransition.tsx"
      provides: "AnimatePresence wrapper for page routes"
      exports: ["PageTransition"]
    - path: "src/components/animations/StaggeredList.tsx"
      provides: "Staggered entrance animation for lists"
      exports: ["StaggeredList", "StaggeredItem"]
  key_links:
    - from: "src/App.tsx"
      to: "src/components/animations/PageTransition.tsx"
      via: "Wraps Routes component"
      pattern: "PageTransition"
    - from: "src/components/animations/PageTransition.tsx"
      to: "motion/react"
      via: "AnimatePresence"
      pattern: "AnimatePresence"
---

<objective>
Add page transitions (slide+fade) and staggered list entrance animations throughout the app.

Purpose: Page transitions make navigation feel smooth and app-like. Staggered list animations (study guide categories, test history) make the UI feel alive and polished.

Output: PageTransition wrapper for routes, StaggeredList component for lists, integration into App.tsx.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-ui-ux-bilingual-polish/03-CONTEXT.md
@.planning/phases/03-ui-ux-bilingual-polish/03-RESEARCH.md
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PageTransition component</name>
  <files>
    src/components/animations/PageTransition.tsx
  </files>
  <action>
Create directory `src/components/animations/` if it doesn't exist.

Create `src/components/animations/PageTransition.tsx`:

```typescript
'use client';

import { ReactNode } from 'react';
import { motion, AnimatePresence } from 'motion/react';
import { useLocation } from 'react-router-dom';
import { useReducedMotion } from '@/hooks/useReducedMotion';

// Page transition variants - slide + fade per user decision
const pageVariants = {
  initial: {
    opacity: 0,
    x: 20,
  },
  enter: {
    opacity: 1,
    x: 0,
  },
  exit: {
    opacity: 0,
    x: -20,
  },
};

// Snappy timing per user decision (150-250ms)
const pageTransition = {
  type: 'tween',
  ease: 'easeInOut',
  duration: 0.2,
};

// Reduced motion variants - instant transition
const reducedMotionVariants = {
  initial: { opacity: 1, x: 0 },
  enter: { opacity: 1, x: 0 },
  exit: { opacity: 1, x: 0 },
};

interface PageTransitionProps {
  children: ReactNode;
}

/**
 * Page transition wrapper with slide+fade animation.
 *
 * Features:
 * - Slide + fade combo between pages (modern app feel)
 * - Uses route pathname as key for proper exit animations
 * - mode="wait" ensures old page exits before new enters
 * - Respects prefers-reduced-motion
 *
 * Usage:
 * ```tsx
 * <PageTransition>
 *   <Routes>
 *     <Route path="/" element={<Home />} />
 *   </Routes>
 * </PageTransition>
 * ```
 */
export function PageTransition({ children }: PageTransitionProps) {
  const location = useLocation();
  const shouldReduceMotion = useReducedMotion();

  return (
    <AnimatePresence mode="wait" initial={false}>
      <motion.div
        key={location.pathname}
        variants={shouldReduceMotion ? reducedMotionVariants : pageVariants}
        initial="initial"
        animate="enter"
        exit="exit"
        transition={shouldReduceMotion ? { duration: 0 } : pageTransition}
        className="min-h-screen"
      >
        {children}
      </motion.div>
    </AnimatePresence>
  );
}

/**
 * Simpler fade-only transition for modals/overlays
 */
export function FadeTransition({ children, show }: { children: ReactNode; show: boolean }) {
  const shouldReduceMotion = useReducedMotion();

  return (
    <AnimatePresence mode="wait">
      {show && (
        <motion.div
          initial={shouldReduceMotion ? { opacity: 1 } : { opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={shouldReduceMotion ? { opacity: 1 } : { opacity: 0 }}
          transition={{ duration: 0.15 }}
        >
          {children}
        </motion.div>
      )}
    </AnimatePresence>
  );
}
```
  </action>
  <verify>
Import PageTransition in App.tsx.
Navigate between pages - should see slide+fade animation.
Test with reduced motion enabled - should be instant.
  </verify>
  <done>
PageTransition component with slide+fade animation and reduced-motion support.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create StaggeredList component</name>
  <files>
    src/components/animations/StaggeredList.tsx
  </files>
  <action>
Create `src/components/animations/StaggeredList.tsx`:

```typescript
'use client';

import { ReactNode, Children } from 'react';
import { motion, Variants } from 'motion/react';
import { useReducedMotion } from '@/hooks/useReducedMotion';
import { clsx } from 'clsx';

// Container variants for orchestrating children
const containerVariants: Variants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.08, // 80ms between each item
      delayChildren: 0.1,    // 100ms initial delay
    },
  },
};

// Item variants - fade + slide up
const itemVariants: Variants = {
  hidden: {
    opacity: 0,
    y: 10,
  },
  visible: {
    opacity: 1,
    y: 0,
    transition: {
      type: 'spring',
      stiffness: 300,
      damping: 24,
    },
  },
};

// Reduced motion variants
const reducedContainerVariants: Variants = {
  hidden: { opacity: 1 },
  visible: { opacity: 1 },
};

const reducedItemVariants: Variants = {
  hidden: { opacity: 1, y: 0 },
  visible: { opacity: 1, y: 0 },
};

interface StaggeredListProps {
  children: ReactNode;
  className?: string;
  /** Delay before animation starts (ms) */
  delay?: number;
  /** Time between each item animation (ms) */
  stagger?: number;
}

/**
 * Container for staggered list item animations.
 *
 * Features:
 * - Items fade/slide in sequentially
 * - Configurable stagger timing
 * - Respects prefers-reduced-motion
 *
 * Usage:
 * ```tsx
 * <StaggeredList>
 *   {items.map(item => (
 *     <StaggeredItem key={item.id}>
 *       <Card>{item.content}</Card>
 *     </StaggeredItem>
 *   ))}
 * </StaggeredList>
 * ```
 */
export function StaggeredList({
  children,
  className,
  delay = 100,
  stagger = 80,
}: StaggeredListProps) {
  const shouldReduceMotion = useReducedMotion();

  const customContainerVariants: Variants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: stagger / 1000,
        delayChildren: delay / 1000,
      },
    },
  };

  return (
    <motion.div
      variants={shouldReduceMotion ? reducedContainerVariants : customContainerVariants}
      initial="hidden"
      animate="visible"
      className={className}
    >
      {children}
    </motion.div>
  );
}

interface StaggeredItemProps {
  children: ReactNode;
  className?: string;
}

/**
 * Individual item within a StaggeredList.
 */
export function StaggeredItem({ children, className }: StaggeredItemProps) {
  const shouldReduceMotion = useReducedMotion();

  return (
    <motion.div
      variants={shouldReduceMotion ? reducedItemVariants : itemVariants}
      className={className}
    >
      {children}
    </motion.div>
  );
}

/**
 * Staggered grid for card layouts
 */
export function StaggeredGrid({
  children,
  className,
  columns = 3,
  ...props
}: StaggeredListProps & { columns?: number }) {
  return (
    <StaggeredList
      className={clsx(
        'grid gap-4',
        columns === 1 && 'grid-cols-1',
        columns === 2 && 'grid-cols-1 sm:grid-cols-2',
        columns === 3 && 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3',
        columns === 4 && 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-4',
        className
      )}
      {...props}
    >
      {Children.map(children, child => (
        <StaggeredItem>{child}</StaggeredItem>
      ))}
    </StaggeredList>
  );
}

/**
 * Simple fade-in animation for single elements
 */
export function FadeIn({
  children,
  className,
  delay = 0,
}: {
  children: ReactNode;
  className?: string;
  delay?: number;
}) {
  const shouldReduceMotion = useReducedMotion();

  return (
    <motion.div
      initial={shouldReduceMotion ? { opacity: 1 } : { opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      transition={
        shouldReduceMotion
          ? { duration: 0 }
          : { delay: delay / 1000, duration: 0.3, ease: 'easeOut' }
      }
      className={className}
    >
      {children}
    </motion.div>
  );
}
```
  </action>
  <verify>
Import StaggeredList and StaggeredItem in a page.
Render a list of items - should fade/slide in sequentially.
Test StaggeredGrid with cards.
Verify reduced motion shows items immediately.
  </verify>
  <done>
StaggeredList, StaggeredItem, StaggeredGrid, and FadeIn animation components.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate PageTransition into App.tsx</name>
  <files>
    src/App.tsx
  </files>
  <action>
Read the current `src/App.tsx` file.

Wrap the Routes component with PageTransition. The key change is:

1. Import PageTransition:
```typescript
import { PageTransition } from '@/components/animations/PageTransition';
```

2. Find the `<Routes>` component and wrap it:

Before:
```tsx
<Routes>
  <Route path="/" element={<LandingPage />} />
  {/* ... other routes */}
</Routes>
```

After:
```tsx
<PageTransition>
  <Routes>
    <Route path="/" element={<LandingPage />} />
    {/* ... other routes */}
  </Routes>
</PageTransition>
```

Important notes:
- Keep the existing structure intact
- PageTransition must be inside the Router (it uses useLocation)
- PageTransition should wrap Routes, not individual Route elements
- Do NOT wrap elements that are outside the page content (like AppShell/navigation)

The page transition will automatically trigger on route changes because PageTransition uses location.pathname as the animation key.
  </action>
  <verify>
Navigate from Landing to Dashboard - should see slide+fade.
Navigate from Dashboard to Study - should animate.
Back button navigation should also animate.
No console errors about missing keys or Motion warnings.
  </verify>
  <done>
Page transitions integrated into App.tsx, all route changes now animate.
  </done>
</task>

</tasks>

<verification>
1. `pnpm run build` completes without errors
2. Navigate between pages - see slide+fade animation
3. Animation takes ~200ms (snappy, not slow)
4. StaggeredList items animate in sequence
5. With prefers-reduced-motion enabled, transitions are instant
6. No layout shift or flicker during transitions
</verification>

<success_criteria>
- Page transitions work on all route changes
- Transitions are slide+fade combo (x: 20px movement)
- Transition timing is snappy (200ms)
- StaggeredList staggers items 80ms apart
- StaggeredGrid works for card layouts
- FadeIn works for single elements
- All animations respect prefers-reduced-motion
- No console errors or warnings
</success_criteria>

<output>
After completion, create `.planning/phases/03-ui-ux-bilingual-polish/03-04-SUMMARY.md`
</output>
