---
phase: 39-next-js-16-upgrade-and-tooling
plan: 04
type: execute
wave: 4
depends_on: ["39-03"]
files_modified: []
autonomous: false
requirements:
  - MIGR-01
  - MIGR-02
  - MIGR-03

must_haves:
  truths:
    - "Full CI verification suite passes: lint, lint:css, format:check, typecheck, test:run, build"
    - "App loads in the browser and navigates between all existing routes"
    - "All existing features work identically to v3.0"
    - "Bundle size is documented with before/after comparison"
  artifacts: []
  key_links: []
---

<objective>
Run the full verification suite and perform a manual smoke test to confirm the Next.js 16 upgrade preserves all existing functionality.

Purpose: The upgrade is only complete when we can prove no regressions. This plan runs every automated check and provides a structured smoke test checklist for the user.

Output: All CI checks green, bundle size documented, smoke test passed.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-next-js-16-upgrade-and-tooling/39-RESEARCH.md
@.planning/phases/39-next-js-16-upgrade-and-tooling/39-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full CI verification suite and document bundle sizes</name>
  <files></files>
  <action>
1. Clean build directory to avoid stale cache:
   ```bash
   rm -rf .next
   ```

2. Run ALL verification commands sequentially:
   ```bash
   pnpm lint
   pnpm lint:css
   pnpm format:check
   pnpm typecheck
   pnpm test:run
   pnpm build
   ```

3. If any command fails, fix the issue and re-run. All must pass.

4. Document bundle size by running the build with ANALYZE:
   ```bash
   ANALYZE=true pnpm build
   ```
   Record the output sizes (First Load JS, route sizes). Compare with known v3.0 baseline if available, or at minimum document the post-upgrade sizes for future comparison.

5. Note any significant size changes (>10% increase) in the commit message.

6. Verify the dev server starts correctly:
   ```bash
   npx kill-port 3000 3001 3002 3003
   pnpm dev &
   ```
   Wait for "Ready" message, then kill the server. This confirms Turbopack dev mode works.

7. Also verify webpack dev mode:
   ```bash
   npx kill-port 3000 3001 3002 3003
   pnpm dev:webpack &
   ```
   Wait for "Ready" message, then kill the server.
  </action>
  <verify>
    <automated>pnpm lint && pnpm lint:css && pnpm format:check && pnpm typecheck && pnpm test:run && pnpm build</automated>
  </verify>
  <done>All 6 CI commands pass. Bundle sizes documented. Both dev modes (Turbopack and webpack) start successfully.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Manual smoke test for feature parity with v3.0</name>
  <files></files>
  <action>
Present the smoke test checklist to the user. The user will manually verify each feature area works identically to v3.0 in the browser.

What was built: Next.js 16 upgrade with middleware-to-proxy rename, Sentry reconfiguration, and all automated checks passing.

Smoke test checklist:

1. **Start dev server**: `pnpm dev` then open http://localhost:3000

2. **Auth flow**:
   - [ ] App loads at `#/` (home page)
   - [ ] Navigate to `#/auth` — login page renders
   - [ ] Google One Tap OAuth button appears (if configured)
   - [ ] Can log in / log out

3. **Quiz/Test flow**:
   - [ ] Navigate to `#/test` — can start a mock test
   - [ ] Answer questions — navigation works
   - [ ] Score page shows with celebrations
   - [ ] Questions display in both English and Burmese

4. **SRS + Dashboard**:
   - [ ] Navigate to `#/dashboard` — dashboard loads
   - [ ] Spaced repetition deck shows progress
   - [ ] Mastery milestones display

5. **TTS**:
   - [ ] Text-to-speech buttons produce audio
   - [ ] Both English and Burmese TTS work

6. **PWA + Offline**:
   - [ ] Service worker installs (check DevTools > Application)
   - [ ] App works offline after initial load

7. **Visual parity**:
   - [ ] No CSS/layout regressions visible
   - [ ] Dark mode toggle works
   - [ ] Language toggle works
   - [ ] Animations and transitions work normally

8. **Sentry verification** (optional if Sentry DSN configured):
   - [ ] Navigate to `/dev-sentry-test` — test page renders
   - [ ] Click "Throw in Click Handler" — error captured in Sentry dashboard

Resume signal: Type "approved" if all checklist items pass, or describe specific issues found.
  </action>
  <verify>User approves all smoke test checklist items</verify>
  <done>All smoke test items verified by user. App functions identically to v3.0 on Next.js 16.</done>
</task>

</tasks>

<verification>
- All 6 CI verification commands pass
- Both dev modes start (Turbopack and webpack)
- Manual smoke test approved by user
- Bundle sizes documented
- No visual regressions
</verification>

<success_criteria>
The app builds, runs, and functions identically to v3.0 on Next.js 16. All automated and manual checks pass. The phase is complete.
</success_criteria>

<output>
After completion, create `.planning/phases/39-next-js-16-upgrade-and-tooling/39-04-SUMMARY.md`
</output>
