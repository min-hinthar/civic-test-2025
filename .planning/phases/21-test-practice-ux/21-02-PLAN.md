---
phase: 21-test-practice-ux
plan: 02
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/lib/interview/answerGrader.ts
  - src/lib/interview/answerGrader.test.ts
autonomous: true

must_haves:
  truths:
    - "Spoken answers graded by keyword matching with configurable threshold"
    - "Multiple correct answers supported (civics questions often have several valid responses)"
    - "Confidence score 0-1 reflects match quality"
  artifacts:
    - path: "src/lib/interview/answerGrader.ts"
      provides: "Keyword-based fuzzy answer grading for interview"
      exports: ["gradeAnswer", "normalize", "extractKeywords"]
    - path: "src/lib/interview/answerGrader.test.ts"
      provides: "Test suite for answer grader (15+ test cases)"
  key_links:
    - from: "src/lib/interview/answerGrader.ts"
      to: "src/types/index.ts"
      via: "imports StudyAnswer type"
      pattern: "import.*StudyAnswer"
---

<objective>
Create a keyword-based fuzzy answer grader for interview spoken responses using TDD.

Purpose: Grade spoken civics answers by extracting keywords and comparing against expected answer keywords. Civics answers are short predictable phrases -- no NLP library needed per research recommendation.
Output: Tested answer grader module with 15+ test cases covering exact matches, partial matches, synonyms, and edge cases.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-test-practice-ux/21-CONTEXT.md
@.planning/phases/21-test-practice-ux/21-RESEARCH.md

@src/types/index.ts
@src/constants/questions/index.ts
</context>

<feature>
  <name>Answer Grader</name>
  <files>src/lib/interview/answerGrader.ts, src/lib/interview/answerGrader.test.ts</files>
  <behavior>
  Interface:
  ```typescript
  interface GradeResult {
    isCorrect: boolean;
    confidence: number;  // 0-1 match quality
    matchedKeywords: string[];
    missingKeywords: string[];
    bestMatchAnswer: string;  // Which expected answer matched best
  }

  function gradeAnswer(
    transcript: string,
    expectedAnswers: Array<{ text_en: string; text_my?: string }>,
    threshold?: number  // Default 0.5 (lenient per user decision)
  ): GradeResult;

  function normalize(text: string): string;
  function extractKeywords(answer: string): string[];
  ```

  Test cases (RED phase):
  1. Exact match: "George Washington" for Q: "Who was the first president?" → correct, confidence 1.0
  2. Case-insensitive: "george washington" → correct
  3. With articles: "the George Washington" → correct (strips stop words)
  4. Partial match: "Washington" for expected "George Washington" → confidence 0.5
  5. Multiple correct answers: Q about freedom → "freedom of speech" matches one of several
  6. Paraphrased: "free speech" for "freedom of speech" → partial match (shares keyword "speech")
  7. Completely wrong: "Abraham Lincoln" for first president → isCorrect false, confidence 0
  8. Empty transcript: "" → isCorrect false
  9. Numeric answers: "50" for "fifty (50)" → match (handle number variants)
  10. Multi-word keywords: "freedom of speech" → "freedom" and "speech" as keywords
  11. Threshold at 0.5: Matches with 50%+ keywords pass at default threshold
  12. Threshold at 0.8: Stricter grading
  13. Multiple valid answers in array: picks best match across all
  14. Special characters stripped: "it's the president" → normalized correctly
  15. Long answer with extra words: "I think it was George Washington who was first" → extracts keywords, matches

  Implementation (GREEN phase):
  - `normalize()`: lowercase, strip punctuation, collapse whitespace, handle number words
  - `extractKeywords()`: split by space, remove stop words (the, a, an, of, to, in, is, was, are, for, and, or, it, he, she, they, we, that, this), keep words > 2 chars
  - `gradeAnswer()`: For each expected answer, extract keywords from both transcript and expected, compute overlap ratio. Return best match. isCorrect = confidence >= threshold.
  - Common number words map: { "one": "1", "two": "2", ... "fifty": "50", "hundred": "100" } for numeric matching
  - Common synonym map for civics: { "freedom": ["liberty"], "president": ["chief executive"], "law": ["legislation", "statute"] }
  </behavior>
  <implementation>
  RED: Write all 15+ test cases. Run tests -- all fail.
  GREEN: Implement normalize, extractKeywords, gradeAnswer. Run tests -- all pass.
  REFACTOR: Clean up, ensure exports are clean.
  </implementation>
</feature>

<verification>
- `npm run test:run -- src/lib/interview/answerGrader.test.ts` -- all tests pass
- `npx tsc --noEmit` -- no type errors
- GradeResult includes confidence score and matched/missing keywords
</verification>

<success_criteria>
- 15+ test cases covering exact, partial, synonym, edge cases
- All tests pass
- Threshold defaults to 0.5 (lenient) per user decision
- Confidence score accurately reflects match quality
</success_criteria>

<output>
After completion, create `.planning/phases/21-test-practice-ux/21-02-SUMMARY.md`
</output>
