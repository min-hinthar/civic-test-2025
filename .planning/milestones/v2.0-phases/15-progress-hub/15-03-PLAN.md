---
phase: 15-progress-hub
plan: 03
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - src/components/hub/HistoryTab.tsx
  - src/pages/HubPage.tsx
autonomous: true

must_haves:
  truths:
    - "History tab shows mock tests section on top and interviews section below"
    - "Entries are expandable — tap to reveal per-question right/wrong results"
    - "Interview entries show stage reached and per-question results"
    - "Empty state shows encouraging CTA with buttons to take first mock test or start interview"
    - "Share button on individual test history entries works"
    - "Last 20 entries shown with Load more button for additional batches"
  artifacts:
    - path: "src/components/hub/HistoryTab.tsx"
      provides: "History tab with mock tests and interviews sections"
  key_links:
    - from: "src/components/hub/HistoryTab.tsx"
      to: "useAuth"
      via: "Props from HubPage (user.testHistory)"
    - from: "src/components/hub/HistoryTab.tsx"
      to: "src/lib/interview"
      via: "getInterviewHistory for interview sessions"
---

<objective>
Build the History tab showing mock test and interview session timelines with expandable detail, share buttons, and pagination.

Purpose: The History tab consolidates the mock test timeline from the old HistoryPage into a cleaner format, adding interview history as a second section. Users see their complete assessment history in one place.

Output: Fully functional History tab with mock tests and interviews, expandable entries, share, empty states, and load-more pagination.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/15-progress-hub/15-RESEARCH.md
@.planning/phases/15-progress-hub/15-01-SUMMARY.md
@src/pages/HistoryPage.tsx
@src/components/social/ShareButton.tsx
@src/components/hub/GlassCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HistoryTab component</name>
  <files>
    src/components/hub/HistoryTab.tsx
  </files>
  <action>
**HistoryTab (`src/components/hub/HistoryTab.tsx`):**

This component migrates the mock tests tab and interview tab content from the old HistoryPage into a unified view. It does NOT include the practice sessions tab (per decision: "Shows mock tests AND real interviews, not practice/study sessions").

**Props (data passed from HubPage):**
- `testHistory`: TestSession[] (from user.testHistory)
- `isLoading`: boolean

**Internal data fetching:**
- Load interview sessions via `getInterviewHistory()` in a useEffect (same pattern as existing HistoryPage)
- This is tab-specific data that doesn't need to be lifted to HubPage level

**Layout — Two sections:**

1. **Mock Tests section** (top):
   - Section header: "Mock Tests" / "စမ်းသပ်စာမေးပွဲများ" with ClipboardList icon
   - Show last 20 entries initially
   - "Load more" button to show 20 more (increment page state)
   - Each entry is a GlassCard with:
     - Date (relative: "Today", "Yesterday", "3 days ago", "Feb 5" — use flat chronological per discretion)
     - Score (X/Y) with percentage, colored by pass/fail (success/warning)
     - Duration in minutes
     - End reason text (from reasonCopy mapping)
     - Progress bar (existing Progress component)
     - ShareButton (compact variant, same ShareCardData construction as HistoryPage)
     - Expand/collapse button → shows per-question results
   - Expanded detail: scrollable list of question results with correct/incorrect indicators, question text (bilingual), category badge, and speech buttons
   - Migrate the detailed question review UI from HistoryPage's tests tab

2. **Interviews section** (below):
   - Section header: "Interviews" / "အင်တာဗျူးများ" with Mic2 icon
   - Same pagination pattern (last 20 + load more)
   - Each entry shows:
     - Date, mode badge (Realistic/Practice), score
     - Stage reached: derive from endReason + score context
     - Duration, pass/fail status
     - Expand → per-question results with selfGrade correct/incorrect
   - Migrate interview detail UI from HistoryPage's interview tab

**Empty states:**
- If no mock tests: encouraging card with "Take your first mock test!" + button navigating to `/test`
- If no interviews: encouraging card with "Try a mock interview!" + button navigating to `/interview`
- Both empty states should be bilingual and use the existing `BilingualHeading` + `BilingualButton`

**Relative date formatting:**
- Create a small helper function `formatRelativeDate(dateStr: string): string`
- Today → "Today", Yesterday → "Yesterday", within 7 days → "X days ago", older → "MMM D" format
- Keep it simple, no external library needed

**Animation:**
- Use StaggeredList/StaggeredItem for entry list animations
- Use FadeIn for empty states
  </action>
  <verify>
Run `npx tsc --noEmit` to verify type safety. Confirm the component handles both populated and empty states for both sections.
  </verify>
  <done>HistoryTab renders mock tests and interview sections with expandable entries, share buttons, pagination, relative dates, and empty states.</done>
</task>

<task type="auto">
  <name>Task 2: Wire HistoryTab into HubPage</name>
  <files>
    src/pages/HubPage.tsx
  </files>
  <action>
In `src/pages/HubPage.tsx`:
- Import `HistoryTab` from `@/components/hub/HistoryTab`
- Import `HistorySkeleton` from `@/components/hub/HubSkeleton`
- Replace the history placeholder with `<HistoryTab testHistory={history} isLoading={isLoadingAuth} />`
- The `history` data (user.testHistory) should already be available from `useAuth` called at HubPage level
- Pass loading state from auth context

Note: If HubPage doesn't yet call useAuth, add it. The testHistory comes from `user?.testHistory ?? []`.
  </action>
  <verify>
Run `npm run build` to confirm build succeeds. Navigate to `/#/hub/history` and verify the tab renders with mock test and interview sections. Test expand/collapse on entries. Test "Load more" pagination.
  </verify>
  <done>History tab is wired into HubPage and renders correctly with all data sources connected.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. History tab shows "Mock Tests" section at top with test entries
3. History tab shows "Interviews" section below with interview entries
4. Entries expand on tap to show per-question results
5. Share button works on test entries
6. Only 20 entries shown initially; "Load more" button reveals more
7. Empty states show when no tests/interviews exist
8. Relative dates display correctly (Today, Yesterday, X days ago, etc.)
9. Interview entries show mode badge and stage information
</verification>

<success_criteria>
History tab is feature-complete, showing all mock test and interview data with expandable detail, sharing, and pagination.
</success_criteria>

<output>
After completion, create `.planning/phases/15-progress-hub/15-03-SUMMARY.md`
</output>
