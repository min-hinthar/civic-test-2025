---
phase: 11-design-token-foundation
plan: 04
type: execute
wave: 3
depends_on: [01, 03]
files_modified:
  - src/components/CircularTimer.tsx
  - src/components/AudioWaveform.tsx
  - src/components/SkillTreePath.tsx
  - src/components/Card.tsx
  - src/components/StreakHeatmap.tsx
  - src/pages/ProgressPage.tsx
  - src/pages/HistoryPage.tsx
  - src/components/interview/InterviewResults.tsx
  - src/components/WelcomeModal.tsx
  - src/components/NotificationSettings.tsx
  - src/components/InstallPrompt.tsx
  - src/components/IOSTip.tsx
  - src/components/NotificationPrePrompt.tsx
  - src/pages/SettingsPage.tsx
autonomous: true

must_haves:
  truths:
    - "Recharts charts use getTokenColor() for dynamic theme-aware colors"
    - "Components with many dark: overrides have them replaced by semantic token classes"
    - "Canvas/inline-style colors use semantic tokens or getTokenColor()"
    - "All 14 high/medium complexity files are migrated to semantic tokens"
  artifacts:
    - path: "src/pages/ProgressPage.tsx"
      provides: "Chart colors via getTokenColor"
      contains: "getTokenColor"
    - path: "src/pages/HistoryPage.tsx"
      provides: "Chart colors via getTokenColor"
      contains: "getTokenColor"
    - path: "src/components/interview/InterviewResults.tsx"
      provides: "Chart colors via getTokenColor"
      contains: "getTokenColor"
  key_links:
    - from: "src/pages/ProgressPage.tsx"
      to: "src/lib/tokens.ts"
      via: "getTokenColor import"
      pattern: "import.*getTokenColor.*from.*tokens"
---

<objective>
Migrate the high and medium complexity files: Recharts charts, canvas-based components, and components with 8+ dark: overrides. These files require careful per-file attention due to canvas API usage, inline styles, or heavy dark: prefix usage.

Purpose: Convert the hardest migration targets first. These files have the most complex color patterns (canvas API, Recharts props, inline style objects, many dark: overrides).
Output: 14 files migrated to semantic tokens with minimal dark: prefixes remaining.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-design-token-foundation/11-01-SUMMARY.md
@.planning/phases/11-design-token-foundation/11-03-SUMMARY.md
@.planning/phases/11-design-token-foundation/11-RESEARCH.md (file complexity list, canvas/chart patterns)
@src/lib/tokens.ts (getTokenColor utility)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Recharts charts and canvas components</name>
  <files>
    src/pages/ProgressPage.tsx
    src/pages/HistoryPage.tsx
    src/components/interview/InterviewResults.tsx
    src/components/AudioWaveform.tsx
    src/components/CircularTimer.tsx
    src/components/SkillTreePath.tsx
    src/components/Card.tsx
  </files>
  <action>
**Recharts files (ProgressPage, HistoryPage, InterviewResults):**
1. Import `{ getTokenColor }` from `@/lib/tokens`
2. Import `{ useThemeContext }` from `@/contexts/ThemeContext` (triggers re-render on theme toggle)
3. Replace ALL hardcoded hex color strings in Recharts `<Line stroke="...">`, `<Area fill="...">`, `<Bar fill="...">`, `<CartesianGrid stroke="...">`, `<XAxis tick={{ fill: '...' }}>` etc. with `getTokenColor()` calls
4. Map colors:
   - Blue chart lines: `getTokenColor('--color-chart-blue')`
   - Amber/yellow chart lines: `getTokenColor('--color-chart-amber')`
   - Green chart lines: `getTokenColor('--color-chart-emerald')`
   - Grid lines: `getTokenColor('--color-border')`
   - Axis text: `getTokenColor('--color-text-secondary')`
   - Tooltip backgrounds: `getTokenColor('--color-surface')`
5. Call `useThemeContext()` (even if destructured theme value isn't directly used) to ensure the component re-renders when theme changes, picking up new resolved CSS variable values
6. Remove any `dark:` prefixes on Recharts wrapper elements that become unnecessary

**AudioWaveform.tsx:**
1. Import `{ getTokenColor }` from `@/lib/tokens`
2. Replace hardcoded canvas colors with `getTokenColor('--color-primary')` and `getTokenColor('--color-primary-subtle')`
3. If the component reads colors in a `useEffect` or animation frame, make sure it reads fresh values each frame (or memoize with theme as dependency)

**CircularTimer.tsx:**
Per research recommendation: keep the timer stage colors (blue->yellow->orange->red) as hardcoded constants. These are semantic timer stages, not theme colors. The library (`react-countdown-circle-timer`) requires hex/hsl string props. HOWEVER:
1. Replace any non-timer hardcoded colors (backgrounds, text colors) with semantic Tailwind classes
2. Remove `dark:` overrides on surrounding elements, replacing with semantic token classes
3. If the component has inline fontSize, leave it (research notes only 1 inline fontSize in CircularTimer)

**SkillTreePath.tsx:**
1. Replace inline `rgba()` boxShadow values with `hsl(var(--color-primary) / 0.25)` pattern
2. Replace non-semantic Tailwind palette classes with semantic equivalents
3. The 7 sub-category colors (rose, blue, emerald, amber, fuchsia, sky, slate) should use the new `--color-category-*` tokens. These are data-viz colors that stay stable across themes. Replace e.g. `bg-rose-500` with a class referencing the token, or leave as palette classes since they're available in Tailwind config.

**Card.tsx:**
1. Replace inline `rgba()` boxShadow values with semantic token shadows
2. Replace non-semantic Tailwind classes with semantic equivalents
3. Remove `dark:` overrides that the token system now handles

**For ALL files in this task:**
- Replace `text-gray-*` / `text-slate-*` with `text-foreground` or `text-muted-foreground`
- Replace `bg-white` with `bg-surface` or `bg-card`
- Replace `bg-blue-*` with `bg-primary-*` or `bg-primary`
- Replace `border-gray-*` / `border-slate-*` with `border-border`
- Remove `dark:bg-*`, `dark:text-*`, `dark:border-*` overrides that are now handled by the token system
  </action>
  <verify>
- `npx next build` passes
- grep for `getTokenColor` in ProgressPage, HistoryPage, InterviewResults returns results
- Hardcoded hex colors in Recharts props are eliminated
- No `#3B82F6` or similar hex literals remain in chart code
  </verify>
  <done>All Recharts charts use getTokenColor for theme-aware colors. Canvas components use token values. Inline rgba() styles use token references. Timer stage colors kept as pragmatic constants.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate medium-complexity components (heavy dark: override files)</name>
  <files>
    src/components/WelcomeModal.tsx
    src/components/NotificationSettings.tsx
    src/components/InstallPrompt.tsx
    src/components/IOSTip.tsx
    src/components/StreakHeatmap.tsx
    src/components/NotificationPrePrompt.tsx
    src/pages/SettingsPage.tsx
  </files>
  <action>
These files have 8-20 `dark:` prefix overrides each. The migration pattern is the same for all:

1. **Replace non-semantic palette classes with semantic ones:**
   - `text-gray-500` / `text-gray-600` / `text-slate-500` -> `text-muted-foreground`
   - `text-gray-800` / `text-gray-900` / `text-slate-900` -> `text-foreground`
   - `bg-white` -> `bg-surface` or `bg-card`
   - `bg-gray-50` / `bg-gray-100` / `bg-slate-50` -> `bg-surface-muted` or `bg-muted`
   - `bg-blue-500` / `bg-blue-600` -> `bg-primary`
   - `text-blue-500` / `text-blue-600` -> `text-primary`
   - `border-gray-200` / `border-gray-300` / `border-slate-200` -> `border-border`
   - `bg-green-*` for success states -> `bg-success` or `bg-success-*`
   - `bg-amber-*` / `bg-orange-*` for warning -> `bg-warning` or `bg-warning-*`

2. **Remove `dark:` overrides that semantic tokens handle:**
   - `dark:bg-gray-800` / `dark:bg-slate-800` (handled by --color-surface)
   - `dark:text-gray-200` / `dark:text-gray-300` (handled by --color-text-primary)
   - `dark:text-gray-400` (handled by --color-text-secondary)
   - `dark:border-gray-700` (handled by --color-border)
   - `dark:bg-gray-900` / `dark:bg-slate-900` (handled by --color-background)

3. **Keep `dark:` only where genuinely conditional:**
   - Gradient decorations that are structurally different in dark mode (not just color swaps)
   - Truly conditional dark-mode-only visual elements (rare)

4. **Snap-to-token (per migration fidelity decision):**
   - If a component uses `text-gray-400` in one place and `text-gray-500` in another for the same semantic purpose, consolidate both to `text-muted-foreground`
   - This is intentional simplification, not a regression

**StreakHeatmap.tsx special note:**
- Heatmap cells likely use inline style colors for intensity levels. If these are data-visualization colors (heat scale), they can stay as computed values. If they reference theme colors, convert to getTokenColor().

**Per file, count dark: overrides before and after to verify reduction. Target: >80% reduction in dark: prefixes per file.**
  </action>
  <verify>
- `npx next build` passes
- grep for `dark:` in each file shows significant reduction (count before vs after)
- No hardcoded hex colors remain in className strings
- Semantic classes (`text-foreground`, `bg-surface`, `border-border`, etc.) are used
  </verify>
  <done>All 7 medium-complexity files migrated. dark: override count reduced by >80% per file. Non-semantic palette classes replaced with semantic equivalents.</done>
</task>

</tasks>

<verification>
- `npx next build` passes
- All 14 files are migrated
- Recharts charts use getTokenColor()
- dark: prefix count reduced significantly across medium-complexity files
- No regression in canvas/chart rendering (colors resolve correctly)
</verification>

<success_criteria>
All high and medium complexity files (canvas, charts, heavy dark: overrides) are migrated to semantic tokens. Charts dynamically adapt to theme changes via getTokenColor(). Medium-complexity files have >80% fewer dark: prefixes.
</success_criteria>

<output>
After completion, create `.planning/phases/11-design-token-foundation/11-04-SUMMARY.md`
</output>
