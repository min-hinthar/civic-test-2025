---
phase: 28-interview-ux-voice-flow-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/interview/TextAnswerInput.tsx
  - src/components/interview/KeywordHighlight.tsx
  - src/components/interview/KeywordHighlight.test.tsx
autonomous: true
requirements: [IVPOL-03, IVPOL-04]
must_haves:
  truths:
    - "User sees a multi-line textarea with Send button when speech recognition is unavailable"
    - "Typed answer is graded using the same gradeAnswer() keyword matcher"
    - "User's answer shows matched keywords highlighted in green and missing keywords listed"
    - "iOS Safari users see 'For voice input, try Chrome' suggestion before text fallback"
  artifacts:
    - path: "src/components/interview/TextAnswerInput.tsx"
      provides: "Text input fallback for interviews"
      exports: ["TextAnswerInput"]
    - path: "src/components/interview/KeywordHighlight.tsx"
      provides: "Keyword highlighting in graded answers"
      exports: ["KeywordHighlight"]
    - path: "src/components/interview/KeywordHighlight.test.tsx"
      provides: "Unit tests for keyword highlighting"
  key_links:
    - from: "src/components/interview/TextAnswerInput.tsx"
      to: "src/lib/interview/answerGrader.ts"
      via: "consumer passes typed text to gradeAnswer() externally"
      pattern: "onSubmit"
    - from: "src/components/interview/KeywordHighlight.tsx"
      to: "src/lib/interview/answerGrader.ts"
      via: "consumes GradeResult.matchedKeywords and .missingKeywords"
      pattern: "GradeResult"
---

<objective>
Create the text answer input fallback and keyword highlight components.

Purpose: Enable text-based answering when speech recognition is unavailable (Firefox, Safari iOS) and provide educational feedback by highlighting which keywords the user got right/missed.

Output: `TextAnswerInput.tsx` and `KeywordHighlight.tsx` components
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/lib/interview/answerGrader.ts
@src/components/interview/InterviewSession.tsx
@src/components/interview/SelfGradeButtons.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TextAnswerInput component</name>
  <files>src/components/interview/TextAnswerInput.tsx</files>
  <action>
Create `src/components/interview/TextAnswerInput.tsx`:

Props interface:
- `onSubmit: (text: string) => void` -- called when user taps Send
- `disabled?: boolean` -- disables input during grading/transition
- `placeholder?: string` -- textarea placeholder text
- `showIOSSafariHint?: boolean` -- shows "For voice input, try Chrome" notice
- `previousTranscription?: string` -- shows what was previously heard (for re-record context)

Implementation:
1. Multi-line `<textarea>` with 3 rows, styled with dark interview aesthetic (bg-slate-800 border-slate-600 text-white placeholder-slate-400)
2. Explicit Send button (lucide `Send` icon) -- NO Enter key submit per user decision
3. Send button disabled when textarea is empty or `disabled` prop is true
4. Clear textarea after successful submit
5. Auto-focus textarea when mounted (with `preventScroll: true`)
6. If `showIOSSafariHint`, render a subtle hint above the textarea: "For voice input, try Chrome" with Safari icon indicator
7. If `previousTranscription`, show it above textarea in a small muted text: "Previously heard: {text}"
8. Min height 44px on Send button (WCAG touch target)
9. Use existing dark interview color scheme (consistent with ChatBubble styling)
10. No Enter key listener -- textarea accepts multiline text naturally

iOS Safari detection: check `navigator.userAgent` for 'Safari' + NOT 'Chrome' + 'iPhone|iPad'
  </action>
  <verify>TypeScript compiles. Component renders in test.</verify>
  <done>TextAnswerInput provides text-based answering with Send button, iOS hint, and previous transcription display</done>
</task>

<task type="auto">
  <name>Task 2: Create KeywordHighlight component</name>
  <files>src/components/interview/KeywordHighlight.tsx</files>
  <action>
Create `src/components/interview/KeywordHighlight.tsx`:

Props interface:
- `userAnswer: string` -- the user's transcribed or typed answer
- `matchedKeywords: string[]` -- keywords that were found (from GradeResult)
- `missingKeywords: string[]` -- keywords that were expected but not found
- `showMissing?: boolean` -- whether to show missing keywords section (default true)
- `compact?: boolean` -- compact mode for transcript view (smaller text)

Implementation:
1. Parse userAnswer text and wrap each occurrence of a matched keyword in a `<mark>` element
   - Use case-insensitive matching for keyword wrapping
   - Style matched marks: `bg-success/20 text-success-600 dark:text-success px-0.5 rounded`
   - Use word boundary matching to avoid highlighting partial words
2. Render the highlighted answer text in a paragraph
3. If `showMissing` and there are missing keywords:
   - Show a "Missing:" label with missing keywords as small pills/chips
   - Style: `bg-warning/20 text-warning text-xs px-2 py-0.5 rounded-full`
4. If compact, use `text-sm` sizing; otherwise `text-base`
5. Handle empty answer gracefully (show "No answer given" in muted text)

Export `highlightKeywords(text, matchedKeywords)` as a pure utility for testing.
  </action>
  <verify>TypeScript compiles. Component renders correctly.</verify>
  <done>KeywordHighlight wraps matched keywords in green marks and lists missing keywords as warning chips</done>
</task>

<task type="auto">
  <name>Task 3: Unit tests for KeywordHighlight</name>
  <files>src/components/interview/KeywordHighlight.test.tsx</files>
  <action>
Create `src/components/interview/KeywordHighlight.test.tsx`:

Test the `highlightKeywords` utility function:
1. Highlights exact keyword match in answer text
2. Case-insensitive: "president" matches "President" in answer
3. Multiple keywords highlighted independently
4. Word boundary: "the" doesn't match "their" or "there"
5. Empty matchedKeywords returns original text unchanged
6. Empty answer returns empty/placeholder

Test the KeywordHighlight component rendering:
7. Matched keywords render with `<mark>` elements
8. Missing keywords render as pill chips when showMissing=true
9. Missing keywords section hidden when showMissing=false
10. Compact mode applies smaller text classes
11. Empty answer shows "No answer given" text

Use @testing-library/react for component tests.
  </action>
  <verify>`npm run test:run -- src/components/interview/KeywordHighlight.test.tsx` passes</verify>
  <done>All keyword highlight tests pass including word boundary edge cases</done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- `npm run test:run -- src/components/interview/KeywordHighlight.test.tsx` passes
- No new lint errors
</verification>

<success_criteria>
- TextAnswerInput renders textarea + Send button with no Enter key submit
- iOS Safari hint shows when detected
- KeywordHighlight wraps matched keywords in green marks
- Missing keywords shown as warning pills
- Word boundary matching prevents partial-word highlights
</success_criteria>

<output>
After completion, create `.planning/phases/28-interview-ux-voice-flow-polish/28-02-SUMMARY.md`
</output>
