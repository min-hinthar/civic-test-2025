---
phase: 28-interview-ux-voice-flow-polish
plan: 05
type: execute
wave: 2
depends_on: [28-02]
files_modified:
  - src/components/interview/InterviewTimer.tsx
  - src/components/interview/ModeBadge.tsx
  - src/components/interview/InterviewProgress.tsx
  - src/components/interview/LongPressButton.tsx
autonomous: true
requirements: [IVPOL-05, IVPOL-06]
must_haves:
  truths:
    - "Small REAL or PRACTICE badge in corner indicates current mode"
    - "Real mode timer shows amber at 5s, red at 3s with gentle pulse animation"
    - "Real mode progress bar uses monochrome segments (no green/red coloring)"
    - "Practice mode progress shows colored segments as normal"
    - "Progress shows both Q3/20 text AND visual progress bar"
    - "Long-press exit button requires 3-second hold to activate in Real mode"
  artifacts:
    - path: "src/components/interview/ModeBadge.tsx"
      provides: "Mode indicator badge (REAL/PRACTICE)"
      exports: ["ModeBadge"]
    - path: "src/components/interview/InterviewProgress.tsx"
      provides: "Dual-indicator progress (text + bar) with mode-aware coloring"
      exports: ["InterviewProgress"]
    - path: "src/components/interview/LongPressButton.tsx"
      provides: "3-second long-press exit button for Real mode"
      exports: ["LongPressButton"]
    - path: "src/components/interview/InterviewTimer.tsx"
      provides: "Enhanced timer with amber/red color transitions and pulse"
  key_links:
    - from: "src/components/interview/InterviewProgress.tsx"
      to: "src/components/interview/InterviewSession.tsx"
      via: "receives mode, currentIndex, results props"
      pattern: "InterviewProgress"
---

<objective>
Create mode-differentiated UI components for Real vs Practice interview modes.

Purpose: Real mode feels like a USCIS simulation (hidden score, monochrome progress, urgent timer), while Practice mode feels educational (colored segments, relaxed pace). These components enforce the visual distinction.

Output: ModeBadge, InterviewProgress, LongPressButton, enhanced InterviewTimer
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/components/interview/InterviewTimer.tsx
@src/components/interview/InterviewSession.tsx
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ModeBadge and InterviewProgress</name>
  <files>src/components/interview/ModeBadge.tsx, src/components/interview/InterviewProgress.tsx</files>
  <action>
**ModeBadge** (`src/components/interview/ModeBadge.tsx`):
Props: `mode: InterviewMode` (from `@/types`)

Implementation:
- Small pill badge in top-right corner: `fixed top-4 right-4 z-40`
- Real mode: `bg-primary/20 text-primary` with Shield icon, text "REAL"
- Practice mode: `bg-accent/20 text-accent-foreground` with BookOpen icon, text "PRACTICE"
- Text in uppercase, `text-xs font-bold tracking-wider`
- Subtle entry animation: fade + translateX from right
- Respects reduced motion (opacity only)

**InterviewProgress** (`src/components/interview/InterviewProgress.tsx`):
Props:
- `mode: InterviewMode`
- `currentIndex: number` -- current question (0-based)
- `totalQuestions: number` -- total questions (20)
- `results: Array<{ isCorrect: boolean } | null>` -- grading results per question (null = not yet answered)

Implementation:
1. **Text indicator**: "Q{currentIndex+1}/{totalQuestions}" in bold, centered above bar
2. **Segmented progress bar**: thin horizontal bar divided into totalQuestions segments
   - Each segment represents one question
   - Real mode coloring (monochrome):
     - Answered: `bg-slate-400` (no green/red distinction -- score hidden)
     - Current: `bg-white` with subtle pulse
     - Unanswered: `bg-slate-700`
   - Practice mode coloring:
     - Correct: `bg-success` (green)
     - Incorrect: `bg-destructive` (red)
     - Current: `bg-primary` with subtle pulse
     - Unanswered: `bg-slate-700`
3. Bar height: 4px, rounded segments with 1px gaps
4. Use `role="progressbar"` with `aria-valuenow={currentIndex+1}` and `aria-valuemax={totalQuestions}`
5. sr-only text: "Question {n} of {total}"
  </action>
  <verify>TypeScript compiles. Both components render correctly.</verify>
  <done>ModeBadge shows mode indicator, InterviewProgress shows mode-aware progress with text + bar</done>
</task>

<task type="auto">
  <name>Task 2: Enhance InterviewTimer with color transitions</name>
  <files>src/components/interview/InterviewTimer.tsx</files>
  <action>
Modify `src/components/interview/InterviewTimer.tsx`:

Current behavior: Simple countdown display. Enhance with:

1. **Color transitions based on remaining time**:
   - Normal (>5s): white text on dark bg (current)
   - Warning (5s-3s): `text-warning` amber color
   - Urgent (<3s): `text-destructive` red color with gentle pulse animation
2. **Pulse animation** for urgent phase:
   - Use `motion.div` with `animate={{ scale: [1, 1.05, 1] }}` repeating
   - Transition: `{ duration: 0.6, repeat: Infinity }`
   - Only when timeLeft <= 3
   - Respect reduced motion: no scale, just color change
3. **Ring/arc visual** (optional enhancement):
   - SVG circle that counts down around the number
   - `strokeDashoffset` decreases as time runs out
   - Color follows same amber/red transitions
4. Keep existing timer logic and props
5. Use CSS custom properties for colors: `--color-warning`, `--color-destructive`

The timer should feel more urgent as time runs out in Real mode.
  </action>
  <verify>TypeScript compiles. Timer renders with correct colors at different time thresholds.</verify>
  <done>InterviewTimer shows amber at 5s, red at 3s with pulse animation for urgency</done>
</task>

<task type="auto">
  <name>Task 3: Create LongPressButton component</name>
  <files>src/components/interview/LongPressButton.tsx</files>
  <action>
Create `src/components/interview/LongPressButton.tsx`:

Props:
- `onLongPress: () => void` -- fires after 3-second hold
- `holdDuration?: number` -- duration in ms (default 3000)
- `children: React.ReactNode` -- button content
- `className?: string` -- additional classes

Implementation:
1. Use `onPointerDown` to start a timer, `onPointerUp`/`onPointerLeave`/`onPointerCancel` to cancel
2. Track hold progress with `useState` (0 to 1, updated via `requestAnimationFrame` loop)
3. Show circular fill progress animation around the button during hold:
   - SVG circle with `strokeDashoffset` that decreases during hold
   - Or CSS `conic-gradient` that fills clockwise
4. Use `useRef` for the RAF id and start timestamp (only accessed in handlers, not render -- React Compiler safe)
5. On complete (progress reaches 1): call `onLongPress()`, reset progress
6. On release before complete: animate progress back to 0, cancel timer
7. Haptic feedback (vibrate 50ms) when hold completes on Android
8. The button itself should be subtle (ghost style) -- not obviously an exit button in Real mode
9. Reduced motion: skip the fill animation, just show a loading indicator after 3s

This is used for Real mode's hidden emergency exit. The parent wraps this around a small icon button (like a minimal X or door icon).
  </action>
  <verify>TypeScript compiles. Component tracks hold progress correctly.</verify>
  <done>LongPressButton fires callback after configurable hold duration with visual fill progress</done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- `npm run lint` passes
- All components render without errors
</verification>

<success_criteria>
- ModeBadge clearly indicates Real vs Practice mode
- InterviewProgress shows monochrome (Real) vs colored (Practice) segments with Q/20 text
- InterviewTimer transitions amber/red with urgency pulse
- LongPressButton provides hidden 3-second emergency exit for Real mode
</success_criteria>

<output>
After completion, create `.planning/phases/28-interview-ux-voice-flow-polish/28-05-SUMMARY.md`
</output>
