---
phase: 21-test-practice-ux
plan: 07
type: execute
wave: 3
depends_on: ["21-03", "21-04"]
files_modified:
  - src/components/practice/PracticeSession.tsx
  - src/components/quiz/SkippedReviewPhase.tsx
autonomous: true

must_haves:
  truths:
    - "Practice mode uses same Check/Continue flow as mock test"
    - "Skipped questions are reviewed at end of practice quiz"
    - "Tapping segments in progress bar navigates to answered questions (read-only review)"
    - "Explanation text shown in feedback panel for practice (not mock test)"
    - "Live score tally visible during practice"
  artifacts:
    - path: "src/components/practice/PracticeSession.tsx"
      provides: "Refactored practice session with Check/Continue flow"
    - path: "src/components/quiz/SkippedReviewPhase.tsx"
      provides: "Review phase for skipped questions at end of practice"
      exports: ["SkippedReviewPhase"]
  key_links:
    - from: "src/components/practice/PracticeSession.tsx"
      to: "src/lib/quiz/quizReducer.ts"
      via: "useReducer for quiz state machine"
      pattern: "useReducer.*quizReducer"
    - from: "src/components/practice/PracticeSession.tsx"
      to: "src/components/quiz/SkippedReviewPhase.tsx"
      via: "renders skipped review when phase is skipped-review"
      pattern: "SkippedReviewPhase"
---

<objective>
Refactor PracticeSession to use Check/Continue flow with practice-specific features: explanations in feedback, tappable segments, skip review phase, and live score.

Purpose: Practice mode shares the same Check/Continue flow as mock test but adds educational features -- explanations, live scoring, and a skipped question review phase.
Output: Refactored PracticeSession.tsx, SkippedReviewPhase.tsx
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-test-practice-ux/21-CONTEXT.md
@.planning/phases/21-test-practice-ux/21-03-SUMMARY.md
@.planning/phases/21-test-practice-ux/21-04-SUMMARY.md
@.planning/phases/21-test-practice-ux/21-06-SUMMARY.md

@src/components/practice/PracticeSession.tsx
@src/lib/quiz/quizTypes.ts
@src/lib/quiz/quizReducer.ts
@src/components/quiz/FeedbackPanel.tsx
@src/components/quiz/AnswerOption.tsx
@src/components/quiz/SegmentedProgressBar.tsx
@src/components/quiz/QuizHeader.tsx
@src/components/quiz/SkipButton.tsx
@src/components/quiz/ExitConfirmDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: SkippedReviewPhase component</name>
  <files>src/components/quiz/SkippedReviewPhase.tsx</files>
  <action>
Create `src/components/quiz/SkippedReviewPhase.tsx`:

Props:
```typescript
interface SkippedReviewPhaseProps {
  questions: Question[];
  skippedIndices: number[];
  existingResults: QuestionResult[];
  onComplete: (results: QuestionResult[]) => void;
  showBurmese: boolean;
  sessionId?: string;
  practiceConfig?: PracticeSnapshot['config'];
}
```

Per locked decisions:
- "review skipped" phase at end of quiz presents skipped questions IN ORIGINAL ORDER
- Only in Practice mode (NOT in Mock Test where skipped stays skipped)
- Uses the same Check/Continue flow (reuses AnswerOptionGroup, FeedbackPanel, etc.)
- Has its own internal quiz state for the review questions
- Header shows "Reviewing Skipped Questions" with count (e.g., "2 of 5 skipped")
- Animated entrance -- slide in from bottom with SPRING_GENTLE
- When all skipped questions are answered, calls onComplete with combined results (existing + review)
- Skip button is NOT available during review (you already skipped once -- answer or it's wrong)
- Progress bar shows only the skipped questions as segments (not the full quiz)
- A "Finish Without Reviewing" button to bail out and go straight to results (skipped questions count as incorrect)
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint`. Component compiles.</verify>
  <done>SkippedReviewPhase presents skipped questions in original order with Check/Continue flow, no further skipping allowed, and option to finish without reviewing.</done>
</task>

<task type="auto">
  <name>Task 2: PracticeSession refactor with Check/Continue flow</name>
  <files>src/components/practice/PracticeSession.tsx</files>
  <action>
Refactor PracticeSession.tsx following the same pattern as TestPage (plan 06) but with practice-specific features:

1. **State machine**: Replace scattered booleans with `useReducer(quizReducer, initialQuizState(practiceConfig))`. Configure with `mode: 'practice'`, `allowSkipReview: true`, `allowSegmentTap: true`, `showLiveScore: true`, `showExplanation: true`.

2. **Check/Continue flow**: Same as mock test -- answer selection doesn't auto-commit, Check button required, feedback panel slides up, Continue advances.

3. **Practice-specific FeedbackPanel**: Pass `mode="practice"` and `explanation={currentQuestion.explanation}` to FeedbackPanel. Practice mode shows explanation text in panel (per locked decision: explanation shown in Practice ONLY, NOT mock test).

4. **Live score tally**: SegmentedProgressBar with `showLiveScore={true}` -- shows "7/8 correct" during quiz. Per locked decision: shown in Practice only.

5. **Tappable segments**: SegmentedProgressBar with `allowTap={true}` -- tapping an answered segment opens a read-only review of that question (cannot change answer). Per locked decision: Practice only.

6. **Segment tap review**: When user taps a segment, show a read-only modal or inline view of that question + answer + explanation. Implement as a simple dialog: question text, user's answer (colored), correct answer, explanation. Close returns to current question.

7. **Skip with review**: Skip button available. Skipped questions get amber color in progress bar. At end of quiz, if there are skipped questions, transition to `skipped-review` phase and render `<SkippedReviewPhase>`. When review completes, transition to finished.

8. **Explanation in panel**: TTS SpeechButton on explanation text in feedback panel per locked decision.

9. **Timer**: Keep optional timer. Pauses during feedback phase (same as mock test).

10. **Exit confirmation**: Use ExitConfirmDialog with mode="practice". Session persistence continues working.

11. **Session persistence**: Update snapshot to include quizState.skippedIndices. Fire-and-forget save pattern preserved.

12. **Question transitions**: Same slide-left animation as mock test.

13. **SRS marking**: Batch at end, not per-question (matching mock test pattern from plan 06).

Keep existing props interface (questions, timerEnabled, onComplete, etc.) compatible with PracticePage parent.
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint`. Run `npm run build`. Navigate to /#/practice in browser -- verify Check/Continue flow works with explanations, tappable segments, and skip review.</verify>
  <done>PracticeSession uses quiz state machine with practice-specific features: explanations in feedback, tappable review segments, skipped question review phase, and live score tally.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- `npm run build` succeeds
- Practice mode shows explanations in feedback panel
- Tapping progress bar segments opens read-only review
- Skipped questions reviewed at end
- Live score visible during practice
</verification>

<success_criteria>
- PracticeSession fully refactored with Check/Continue flow
- All practice-specific features working (explanation, tappable segments, skip review, live score)
- Session persistence compatible with new state machine
- PracticePage parent integration intact
</success_criteria>

<output>
After completion, create `.planning/phases/21-test-practice-ux/21-07-SUMMARY.md`
</output>
