---
phase: 30-mobile-native-feel
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/globals.css
  - tailwind.config.js
  - public/manifest.json
  - src/components/navigation/GlassHeader.tsx
  - src/components/navigation/BottomTabBar.tsx
  - src/components/pwa/SyncStatusIndicator.tsx
autonomous: true
requirements:
  - MOBI-01
  - MOBI-02
  - MOBI-03

must_haves:
  truths:
    - "In PWA standalone mode, overscrolling the page does not produce a white flash or rubber-band effect"
    - "On iPhone with Dynamic Island, GlassHeader glass extends behind status bar and content starts below safe area"
    - "On iPhone, BottomTabBar glass extends into home indicator zone with content above safe area"
    - "Tapping buttons, tabs, and navigation elements does not trigger accidental text selection"
    - "Long-pressing educational text (questions, answers, explanations, Burmese text) still allows copy/selection"
    - "Double-tap zoom is disabled while pinch-zoom and scroll remain functional"
  artifacts:
    - path: "src/styles/globals.css"
      provides: "Overscroll guard, user-select guards, touch-action manipulation, tap-highlight removal, text-size-adjust, font-smoothing"
      contains: "overscroll-behavior: none"
    - path: "tailwind.config.js"
      provides: "Safe area utility classes (pt-safe, pb-safe, etc.)"
      contains: "safe-area-inset"
    - path: "public/manifest.json"
      provides: "Portrait orientation lock"
      contains: "orientation"
    - path: "src/components/navigation/GlassHeader.tsx"
      provides: "Safe area top padding on header"
      contains: "safe-area-inset-top"
    - path: "src/components/navigation/BottomTabBar.tsx"
      provides: "Safe area bottom padding on tab bar"
      contains: "safe-area-inset-bottom"
  key_links:
    - from: "src/styles/globals.css"
      to: "html, body"
      via: "CSS display-mode standalone media query"
      pattern: "display-mode: standalone"
    - from: "tailwind.config.js"
      to: "src/components/navigation/GlassHeader.tsx"
      via: "Tailwind safe area utility classes"
      pattern: "pt-safe"
---

<objective>
Add CSS-level mobile native feel guards, safe area inset handling, and manifest orientation lock.

Purpose: Eliminate web-app artifacts (rubber-band overscroll, accidental text selection, double-tap zoom, tap highlight flash) and ensure proper safe area handling for modern devices with notches and home indicators.

Output: Updated globals.css with standalone-mode overscroll guard + selection/tap guards, Tailwind config with safe area utilities, manifest with portrait lock, GlassHeader and BottomTabBar with proper safe area padding.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-mobile-native-feel/30-RESEARCH.md

@src/styles/globals.css
@tailwind.config.js
@public/manifest.json
@src/components/navigation/GlassHeader.tsx
@src/components/navigation/BottomTabBar.tsx
@src/components/pwa/SyncStatusIndicator.tsx
@pages/_document.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CSS mobile guards and Tailwind safe area utilities</name>
  <files>src/styles/globals.css, tailwind.config.js, public/manifest.json</files>
  <action>
  **globals.css changes** -- Add a new section after the base styles block (after the body selector block) called "MOBILE NATIVE GUARDS":

  1. **Overscroll guard (MOBI-01):** Inside `@media (display-mode: standalone)` media query, set `html, body { overscroll-behavior: none; }`. This prevents rubber-band white flash and pull-to-refresh ONLY in installed PWA mode. Change the existing `overscroll-behavior: auto` on `body` to `overscroll-behavior-y: auto` (or remove it entirely since auto is the default). Do NOT set overscroll-behavior: none globally -- only inside the standalone media query.

  2. **User-select guards (MOBI-03):** Add targeted selectors for interactive elements:
  ```css
  button,
  [role="button"],
  [role="radio"],
  [role="tab"],
  [role="switch"],
  a,
  label,
  nav {
    -webkit-user-select: none;
    user-select: none;
  }
  ```
  Then add a counter-rule preserving selection on educational content:
  ```css
  p, article, .font-myanmar, .selectable-content {
    -webkit-user-select: text;
    user-select: text;
  }
  ```
  This is the "guard interactive elements" approach (NOT "global none + whitelist") per research recommendation.

  3. **Touch-action manipulation:** Add `html { touch-action: manipulation; }` globally to disable double-tap zoom while keeping pinch-zoom and scroll.

  4. **Tap highlight removal:** Add `* { -webkit-tap-highlight-color: transparent; }` globally. Phase 31 will add proper press animations to replace this.

  5. **Text-size-adjust:** Add `html { -webkit-text-size-adjust: 100%; text-size-adjust: 100%; }` to prevent Safari auto-scaling in split view. This does NOT disable the iOS accessibility text size slider.

  6. Remove the `-webkit-overflow-scrolling: touch` line from body (deprecated, no longer needed per research).

  **tailwind.config.js changes:** Extend the `padding` section inside `theme.extend` to add safe area utility classes:
  ```javascript
  padding: {
    'safe-top': 'env(safe-area-inset-top, 0px)',
    'safe-bottom': 'env(safe-area-inset-bottom, 0px)',
    'safe-left': 'env(safe-area-inset-left, 0px)',
    'safe-right': 'env(safe-area-inset-right, 0px)',
  },
  ```
  These enable `pt-safe-top`, `pb-safe-bottom`, `pl-safe-left`, `pr-safe-right` classes.

  **manifest.json changes:** Add `"orientation": "portrait"` to lock to portrait mode per user decision.
  </action>
  <verify>
  - `npm run build` succeeds
  - `npm run lint:css` passes (verify no stylelint violations in globals.css)
  - Grep `overscroll-behavior: none` appears inside `@media (display-mode: standalone)` block
  - Grep `touch-action: manipulation` appears in globals.css
  - Grep `safe-area-inset` appears in tailwind.config.js
  - Grep `"orientation"` appears in manifest.json
  </verify>
  <done>
  globals.css has standalone-mode overscroll guard, interactive-element user-select guard with educational content exception, touch-action manipulation, tap-highlight removal, and text-size-adjust. Tailwind config has safe area padding utilities. Manifest has portrait orientation lock.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply safe area insets to GlassHeader, BottomTabBar, and SyncStatusIndicator</name>
  <files>src/components/navigation/GlassHeader.tsx, src/components/navigation/BottomTabBar.tsx, src/components/pwa/SyncStatusIndicator.tsx</files>
  <action>
  **GlassHeader.tsx:** The glass background should extend behind the Dynamic Island / status bar area, with content starting below the safe area inset.
  - Add `style={{ paddingTop: 'env(safe-area-inset-top, 0px)' }}` to the outer `<header>` element. This adds padding INSIDE the glass surface, pushing the content (logo, buttons) below the safe area while the glass effect extends up behind the status bar.
  - The env() value returns 0px on non-notch devices and in browser mode, so this is safe to apply in all modes (not just standalone).

  **BottomTabBar.tsx:** Already has `paddingBottom: 'env(safe-area-inset-bottom, 0px)'` inline style. Verify it's correct:
  - Glass effect should extend INTO the home indicator zone (the paddingBottom pushes the tab content above the safe area while the glass background fills down).
  - No changes needed if the current implementation is already correct. If the style is only on the outer `<nav>`, it's already correct.

  **SyncStatusIndicator.tsx:** Currently uses `bottom-20` (hardcoded 5rem / 80px) to clear the tab bar. This doesn't account for safe area insets.
  - Change the positioning to use an inline style: `style={{ bottom: 'calc(env(safe-area-inset-bottom, 0px) + 5rem)' }}` and remove the `bottom-20` Tailwind class.
  - This ensures the sync indicator clears both the tab bar AND the home indicator on notch devices.
  </action>
  <verify>
  - `npm run build` succeeds
  - `npm run typecheck` passes
  - Grep `safe-area-inset-top` appears in GlassHeader.tsx
  - Grep `safe-area-inset-bottom` appears in both BottomTabBar.tsx and SyncStatusIndicator.tsx
  - No duplicate safe area padding (verify page-shell doesn't double up with GlassHeader -- page-shell uses `--safe-area-top` for its own padding which is separate from the header)
  </verify>
  <done>
  GlassHeader extends glass behind Dynamic Island with content below safe area. BottomTabBar extends glass into home indicator zone. SyncStatusIndicator properly clears safe area + tab bar height.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds with no errors
- `npm run lint:css` passes for globals.css
- `npm run typecheck` passes
- In PWA standalone mode, overscroll-behavior is set to none on html/body
- GlassHeader has safe area top padding
- BottomTabBar has safe area bottom padding
- Interactive elements have user-select: none
- Educational content (p, .font-myanmar) has user-select: text
- Manifest has orientation: portrait
</verification>

<success_criteria>
1. CSS guards (overscroll, user-select, touch-action, tap-highlight) are in globals.css
2. Safe area utilities exist in Tailwind config
3. GlassHeader and BottomTabBar use safe area insets
4. SyncStatusIndicator accounts for safe area
5. Manifest locks to portrait orientation
6. Build, typecheck, and lint all pass
</success_criteria>

<output>
After completion, create `.planning/phases/30-mobile-native-feel/30-01-SUMMARY.md`
</output>
