---
phase: 15-progress-hub
plan: 05
type: execute
wave: 3
depends_on: ["15-02", "15-03", "15-04"]
files_modified:
  - src/pages/HubPage.tsx
  - src/components/navigation/useNavBadges.ts
  - pages/api/push/send.ts
  - src/AppShell.tsx
  - src/lib/i18n/strings.ts
autonomous: true

must_haves:
  truths:
    - "Tab content slides horizontally with direction awareness when switching tabs"
    - "Each tab remembers its scroll position when switching away and back"
    - "Hub tab in bottom bar shows dot badge when user has unseen earned badge"
    - "Push notification general reminder navigates to /home (not /)"
    - "Old page components (ProgressPage, HistoryPage, SocialHubPage) are deleted"
    - "Swipe gestures on mobile switch between tabs"
  artifacts:
    - path: "src/pages/HubPage.tsx"
      provides: "Complete HubPage with scroll memory, swipe gestures"
    - path: "src/components/navigation/useNavBadges.ts"
      provides: "Hub badge dot wired to unseen earned badges"
  key_links:
    - from: "src/components/navigation/useNavBadges.ts"
      to: "src/hooks/useBadges"
      via: "Import to check for newly earned badges"
    - from: "pages/api/push/send.ts"
      to: "url: '/home'"
      via: "Updated push notification URL"
---

<objective>
Add scroll position memory, swipe gestures, wire the hub badge dot indicator, update push notification URLs, and delete old page components.

Purpose: This plan adds the interaction polish (scroll memory, swipe) and performs the cleanup work (old page deletion, push notification URL updates, badge dot wiring) that depends on all 3 tabs being complete.

Output: Hub is fully interactive with scroll memory, swipe gestures, badge dot, and all legacy pages deleted.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/15-progress-hub/15-RESEARCH.md
@.planning/phases/15-progress-hub/15-01-SUMMARY.md
@.planning/phases/15-progress-hub/15-02-SUMMARY.md
@.planning/phases/15-progress-hub/15-03-SUMMARY.md
@.planning/phases/15-progress-hub/15-04-SUMMARY.md
@src/pages/HubPage.tsx
@src/components/navigation/useNavBadges.ts
@pages/api/push/send.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scroll memory, swipe gestures, and i18n strings</name>
  <files>
    src/pages/HubPage.tsx
    src/lib/i18n/strings.ts
  </files>
  <action>
**Scroll position memory (`src/pages/HubPage.tsx`):**
- Add a `useState<Map<string, number>>` (not useRef — React Compiler safe) to store scroll positions keyed by tab name
- Before navigating to a new tab, save `window.scrollY` for the current tab
- After tab content renders, restore the saved scroll position using `requestAnimationFrame` (per research Pitfall 3) to avoid race condition with rendering
- The tab change handler in HubPage should: (1) save current scroll, (2) navigate, (3) after render, restore target tab's scroll
- Use a `useEffect` triggered by the current tab that does the scroll restoration via rAF

**Swipe gestures (`src/pages/HubPage.tsx`):**
- Use motion/react `drag="x"` on the tab content wrapper
- Add `onDragEnd` handler: if drag distance > 50px, navigate to adjacent tab
- Swipe left (negative x) → next tab (if not last)
- Swipe right (positive x) → previous tab (if not first)
- Set `dragConstraints={{ left: 0, right: 0 }}` to snap back
- Set `dragElastic={0.2}` for subtle rubber-band feel
- Disable swipe when there's no adjacent tab in that direction

**i18n strings (`src/lib/i18n/strings.ts`):**
- Add Hub-specific strings under a new `hub` key:
  ```
  hub: {
    pageTitle: { en: 'My Progress', my: 'ကျွန်ုပ်၏ တိုးတက်မှု' },
    overview: { en: 'Overview', my: 'အခြေအနေ' },
    history: { en: 'History', my: 'မှတ်တမ်း' },
    achievements: { en: 'Achievements', my: 'အောင်မြင်မှုများ' },
    categoryMastery: { en: 'Category Mastery', my: 'အမျိုးအစားအလိုက် ကျွမ်းကျင်မှု' },
    loadMore: { en: 'Load more', my: 'ထပ်ကြည့်ရန်' },
    showMore: { en: 'Show more', my: 'ထပ်ပြရန်' },
    showLess: { en: 'Show less', my: 'လျှော့ပြရန်' },
    mockTests: { en: 'Mock Tests', my: 'စမ်းသပ်စာမေးပွဲများ' },
    interviews: { en: 'Interviews', my: 'အင်တာဗျူးများ' },
    leaderboard: { en: 'Leaderboard', my: 'အဆင့်ဇယား' },
  }
  ```
- Update HubPage and tab components to use these strings instead of inline text
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Test tab switching and verify scroll position is maintained when switching back to a previously scrolled tab. Test swipe gestures on mobile viewport.
  </verify>
  <done>Tab switching preserves scroll position per tab. Swipe gestures navigate between tabs on mobile. All user-facing strings are in the i18n strings file.</done>
</task>

<task type="auto">
  <name>Task 2: Wire hub badge dot, update push URL, delete old pages</name>
  <files>
    src/components/navigation/useNavBadges.ts
    pages/api/push/send.ts
    src/AppShell.tsx
  </files>
  <action>
**Hub badge dot (`src/components/navigation/useNavBadges.ts`):**
- The `hubHasUpdate` field is currently hardcoded to `false`
- Wire it to detect unseen earned badges:
  - Import the badge detection logic — check localStorage for a key like `civic-prep-last-seen-badge-count`
  - Compare current earned badge count to last-seen count
  - If earned count > last seen → `hubHasUpdate: true`
  - When user visits the Achievements tab, update the last-seen count in localStorage
  - Approach: Since `useNavBadges` is called in NavigationProvider (outside Hub), keep it lightweight:
    - Read `localStorage.getItem('civic-prep-earned-badge-count')` in a useMemo
    - Read `localStorage.getItem('civic-prep-seen-badge-count')` in a useMemo
    - If earned > seen → true
  - In HubPage, when Achievements tab is active, update `localStorage.setItem('civic-prep-seen-badge-count', ...)` with current earned count
  - The earned-badge-count is set by the useBadges hook or BadgeCelebration flow — add a `localStorage.setItem('civic-prep-earned-badge-count', String(earnedBadges.length))` in HubPage whenever earnedBadges changes
- NOTE: Avoid importing heavy hooks (useBadges) into useNavBadges. Use localStorage as a lightweight bridge.

**Push notification URL (`pages/api/push/send.ts`):**
- Change `url: '/'` to `url: '/home'` on line 78
- This is the only push notification URL that needs updating (confirmed by research audit)
- SRS reminder (`/study#review`) and weak area nudge (`/practice?category=...`) stay unchanged

**Delete old page components:**
- Delete `src/pages/ProgressPage.tsx` — all content migrated to OverviewTab
- Delete `src/pages/HistoryPage.tsx` — all content migrated to HistoryTab
- Delete `src/pages/SocialHubPage.tsx` — all content migrated to AchievementsTab
- In `src/AppShell.tsx`: remove the `import ProgressPage` line (if still there from Plan 01)
- Verify no other files import these deleted pages:
  - `grep -r "ProgressPage\|HistoryPage\|SocialHubPage" src/` should return nothing after deletion
- Note: The Dashboard may link to `/progress` or `/history` — those routes now redirect to Hub tabs, so the links still work
  </action>
  <verify>
Run `npm run build` to confirm build succeeds with deleted pages and no broken imports. Verify `hubHasUpdate` shows a dot badge on the Hub nav tab when a badge is earned. Verify push notification `send.ts` has `url: '/home'`. Run `grep -r "ProgressPage\|HistoryPage\|SocialHubPage" src/` to confirm no remaining references.
  </verify>
  <done>Hub badge dot lights up for unseen badges. Push notification URL updated. All three old page components deleted with no broken imports.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Scroll position is preserved when switching between tabs and returning
3. Swipe left/right on mobile navigates between tabs
4. Hub tab in bottom nav shows a dot badge when a new badge has been earned
5. Visiting Achievements tab clears the badge dot
6. Push notification general reminder URL is `/home`
7. `src/pages/ProgressPage.tsx` is deleted
8. `src/pages/HistoryPage.tsx` is deleted
9. `src/pages/SocialHubPage.tsx` is deleted
10. No remaining imports of deleted pages in the codebase
11. All Hub strings are in `src/lib/i18n/strings.ts`
</verification>

<success_criteria>
Hub interactions are polished (scroll memory, swipe), badge dot indicator works, push notification URL is updated, and all legacy pages are removed.
</success_criteria>

<output>
After completion, create `.planning/phases/15-progress-hub/15-05-SUMMARY.md`
</output>
