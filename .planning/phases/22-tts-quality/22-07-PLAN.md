---
phase: 22-tts-quality
plan: 07
type: execute
wave: 3
depends_on: [22-04, 22-05]
files_modified:
  - src/components/study/FlashcardStack.tsx
  - src/components/study/Flashcard3D.tsx
  - src/pages/StudyGuidePage.tsx
  - src/components/test/TestPage.tsx
  - src/components/practice/PracticeSession.tsx
autonomous: true

must_haves:
  truths:
    - "Auto-read fires on question change in test and practice modes"
    - "Auto-read fires on card navigate/flip in flashcards and study guide"
    - "Study guide auto-reads question on front, answer on back; explanation is manual only"
    - "Auto-read respects per-session override and language setting"
    - "Speed label appears on speech buttons during test/practice/study sessions"
    - "Burmese speech buttons appear alongside English speech buttons in Myanmar mode"
  artifacts:
    - path: "src/components/study/FlashcardStack.tsx"
      provides: "Auto-read on card navigate, Burmese speech buttons"
    - path: "src/components/test/TestPage.tsx"
      provides: "Auto-read on question change, speed label, Burmese buttons"
    - path: "src/components/practice/PracticeSession.tsx"
      provides: "Auto-read on question change, speed label, Burmese buttons"
  key_links:
    - from: "src/components/study/FlashcardStack.tsx"
      to: "src/hooks/useAutoRead.ts"
      via: "useAutoRead(text, triggerKey=cardIndex)"
      pattern: "useAutoRead"
    - from: "src/components/test/TestPage.tsx"
      to: "src/hooks/useAutoRead.ts"
      via: "useAutoRead(questionText, triggerKey=questionIndex)"
      pattern: "useAutoRead"
---

<objective>
Wire useAutoRead and BurmeseSpeechButton into all content screens: FlashcardStack, StudyGuide, TestPage, and PracticeSession. Add speed labels to speech buttons. Add Burmese speech buttons alongside English ones in Myanmar mode.

Purpose: Users experience auto-read and Burmese audio across all learning contexts. Speed is visible on buttons during sessions.
Output: Auto-read active on test/practice/flashcard/study screens, Burmese speech buttons in Myanmar mode, speed labels on all speech buttons.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/22-tts-quality/22-RESEARCH.md
@.planning/phases/22-tts-quality/22-05-SUMMARY.md

@src/hooks/useAutoRead.ts
@src/components/ui/SpeechButton.tsx
@src/components/ui/BurmeseSpeechButton.tsx
@src/components/study/FlashcardStack.tsx
@src/components/study/Flashcard3D.tsx
@src/pages/StudyGuidePage.tsx
@src/components/test/TestPage.tsx
@src/components/practice/PracticeSession.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire auto-read and Burmese buttons into study screens</name>
  <files>src/components/study/FlashcardStack.tsx, src/components/study/Flashcard3D.tsx, src/pages/StudyGuidePage.tsx</files>
  <action>
**FlashcardStack.tsx:**
1. Import `useAutoRead` from `@/hooks/useAutoRead`
2. Import `useTTSSettings` for auto-read settings and `useLanguage` for showBurmese
3. Import `BurmeseSpeechButton` from `@/components/ui/BurmeseSpeechButton`
4. Read auto-read settings: `const { settings: tts } = useTTSSettings();`
5. Determine auto-read text based on card side and language:
   - Front: question_en (always) + question_my (if autoReadLang includes 'burmese' or 'both')
   - Back: studyAnswer text_en + text_my based on autoReadLang
6. Call `useAutoRead({ text: autoReadText, enabled: tts.autoRead, triggerKey: `${cardIndex}-${side}`, lang: 'en-US' })`
   - For "both" language: speak English first, then Burmese. However, useAutoRead only handles one speak call. For "both", call useAutoRead for English, then after it completes, trigger Burmese. Actually, keep it simple: useAutoRead handles English only. For Burmese auto-read, add a second useAutoRead with `lang: 'my-MM'` and `enabled: tts.autoRead && tts.autoReadLang !== 'english'`. But useAutoRead uses speak() which goes through SpeechSynthesis (no Myanmar voices). For Burmese auto-read, we need to use the BurmesePlayer directly.
   - **Revised approach**: useAutoRead handles English auto-read via SpeechSynthesis. Burmese auto-read is NOT auto-triggered (browsers can't speak Myanmar). Instead, Burmese speech buttons are prominently displayed for manual tap. Auto-read only auto-reads in the language that has TTS support (English). This is practical -- auto-read in Burmese requires the pre-generated MP3 adapter which needs to be integrated into the auto-read flow more carefully.
   - For now: `useAutoRead` handles English text auto-read. Burmese buttons are manual.
7. Add `BurmeseSpeechButton` next to existing `SpeechButton` (only visible when `showBurmese`):
   - On front: `<BurmeseSpeechButton questionId={question.id} audioType="q" label="နားထောင်ရန်" />`
   - On back: `<BurmeseSpeechButton questionId={question.id} audioType="a" label="နားထောင်ရန်" />`
8. Add `showSpeedLabel` and computed `speedLabel` to existing SpeechButton instances:
   ```
   const speedLabel = { slow: '0.75x', normal: '1x', fast: '1.25x' }[tts.rate];
   ```

**StudyGuidePage.tsx:**
1. Similar treatment: add useAutoRead for question text on front, answer text on back
2. Per user decision: explanation has manual audio button only (no auto-read for explanation)
3. Add BurmeseSpeechButton for question (front), answer (back), and explanation (back, manual)
4. Add speed labels to all speech buttons

**Flashcard3D.tsx:**
1. If speech buttons exist inside Flashcard3D, add BurmeseSpeechButton alongside them
2. Pass speed label props down
  </action>
  <verify>
`npx tsc --noEmit` passes.
`npx eslint src/components/study/FlashcardStack.tsx src/components/study/Flashcard3D.tsx src/pages/StudyGuidePage.tsx` passes.
  </verify>
  <done>
Study guide and flashcard screens have auto-read on navigate/flip, Burmese speech buttons visible in Myanmar mode, and speed labels on all speech buttons. Explanation has manual-only buttons.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire auto-read and Burmese buttons into test and practice screens</name>
  <files>src/components/test/TestPage.tsx, src/components/practice/PracticeSession.tsx</files>
  <action>
**TestPage.tsx:**
1. Import `useAutoRead`, `useTTSSettings`, `useLanguage`, `BurmeseSpeechButton`
2. Accept per-session overrides from PreTestScreen via props or route state:
   - If props: add `speedOverride?: 'slow' | 'normal' | 'fast'` and `autoReadOverride?: boolean` to TestPage props
   - The speed override should be used for the speech buttons' rate prop and speed label
   - The auto-read override should gate useAutoRead
3. Call useAutoRead:
   ```
   const effectiveAutoRead = autoReadOverride ?? tts.autoRead;
   const effectiveSpeed = speedOverride ?? tts.rate;
   useAutoRead({
     text: currentQuestion.question_en,
     enabled: effectiveAutoRead,
     triggerKey: currentQuestionIndex,
   });
   ```
4. Add speed label to existing SpeechButton for questions:
   ```
   <SpeechButton ... showSpeedLabel speedLabel={speedLabelMap[effectiveSpeed]} />
   ```
5. Add BurmeseSpeechButton next to English SpeechButton (only when `showBurmese`):
   ```
   {showBurmese && <BurmeseSpeechButton questionId={question.id} audioType="q" label="မြန်မာ" showSpeedLabel speedLabel={speedLabelMap[effectiveSpeed]} />}
   ```
6. Auto-read fires when question changes (triggerKey = question index)

**PracticeSession.tsx:**
1. Same treatment as TestPage
2. Accept speedOverride and autoReadOverride props from PracticeConfig
3. Wire useAutoRead for question text on question change
4. Add BurmeseSpeechButton and speed labels
5. Auto-read should NOT fire during the feedback phase (only on new question). Use the quiz state to gate: `enabled: effectiveAutoRead && quizPhase === 'ANSWERING'` (or whatever the answering phase is named)

**Note on per-session speed:**
The speed override from pre-screens affects:
- The `rate` passed to `speak()` in SpeechButton (via the rate prop)
- The speed label displayed on the button
- The `rate` passed to BurmeseSpeechButton (via `playbackRate` on HTMLAudioElement)

To pass the per-session speed to SpeechButton, use the existing `rate` prop which gets forwarded to `speak()` overrides. Compute the numeric rate: `const numericRate = { slow: 0.7, normal: 0.98, fast: 1.3 }[effectiveSpeed];`
  </action>
  <verify>
`npx tsc --noEmit` passes.
`npx eslint src/components/test/TestPage.tsx src/components/practice/PracticeSession.tsx` passes.
`npm run build` succeeds.
  </verify>
  <done>
TestPage and PracticeSession have auto-read on question change, Burmese speech buttons in Myanmar mode, speed labels on speech buttons, and respect per-session overrides from pre-screens. Auto-read gates correctly during feedback phases.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npx tsc --noEmit` passes
3. `npm run lint` passes
4. Flashcard navigate triggers auto-read (when enabled)
5. Test question change triggers auto-read (when enabled)
6. Practice question change triggers auto-read (when enabled, not during feedback)
7. Burmese speech buttons appear alongside English buttons in Myanmar mode
8. Speed labels show correct value on all speech buttons
9. Study guide explanation has manual audio only (no auto-read)
</verification>

<success_criteria>
- Auto-read fires on: flashcard navigate, flashcard flip, test question advance, practice question advance
- Auto-read does NOT fire on: explanation view, feedback phase, unmounted components
- Burmese speech buttons appear only in Myanmar mode with Myanmar flag icon
- Speed label reflects per-session override or global setting
- All speech buttons maintain existing animation, error, and paused states
</success_criteria>

<output>
After completion, create `.planning/phases/22-tts-quality/22-07-SUMMARY.md`
</output>
