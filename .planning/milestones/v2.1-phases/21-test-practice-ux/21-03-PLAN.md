---
phase: 21-test-practice-ux
plan: 03
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - src/components/quiz/FeedbackPanel.tsx
  - src/components/quiz/AnswerOption.tsx
  - src/hooks/useRovingFocus.ts
autonomous: true

must_haves:
  truths:
    - "Feedback panel slides up from bottom with green/amber color band"
    - "Answer options support keyboard navigation via arrow keys"
    - "Continue button OR tapping panel advances to next question"
    - "Animated checkmark bounces in for correct, X shakes for incorrect"
  artifacts:
    - path: "src/components/quiz/FeedbackPanel.tsx"
      provides: "Slide-up feedback panel with Duolingo-style color coding"
      exports: ["FeedbackPanel"]
    - path: "src/components/quiz/AnswerOption.tsx"
      provides: "Selectable answer option with keyboard nav and visual states"
      exports: ["AnswerOption", "AnswerOptionGroup"]
    - path: "src/hooks/useRovingFocus.ts"
      provides: "Roving focus hook for radiogroup keyboard navigation"
      exports: ["useRovingFocus"]
  key_links:
    - from: "src/components/quiz/FeedbackPanel.tsx"
      to: "src/lib/quiz/quizTypes.ts"
      via: "imports QuizPhase type"
      pattern: "import.*quizTypes"
    - from: "src/components/quiz/AnswerOption.tsx"
      to: "src/hooks/useRovingFocus.ts"
      via: "uses roving focus hook"
      pattern: "useRovingFocus"
---

<objective>
Create the FeedbackPanel and AnswerOption components with full keyboard navigation support.

Purpose: These are the core interactive components for the Check/Continue quiz flow -- the feedback panel users see after checking, and the answer options they select from.
Output: FeedbackPanel.tsx, AnswerOption.tsx with AnswerOptionGroup, useRovingFocus.ts hook
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-test-practice-ux/21-CONTEXT.md
@.planning/phases/21-test-practice-ux/21-RESEARCH.md
@.planning/phases/21-test-practice-ux/21-01-SUMMARY.md

@src/lib/quiz/quizTypes.ts
@src/lib/quiz/quizReducer.ts
@src/lib/haptics.ts
@src/lib/audio/soundEffects.ts
@src/lib/motion-config.ts
@src/components/test/AnswerFeedback.tsx
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: FeedbackPanel component</name>
  <files>src/components/quiz/FeedbackPanel.tsx</files>
  <action>
Create `src/components/quiz/FeedbackPanel.tsx` implementing ALL locked decisions for feedback panel:

Props interface:
```typescript
interface FeedbackPanelProps {
  isCorrect: boolean;
  show: boolean;
  correctAnswer: string;
  correctAnswerMy?: string;
  userAnswer?: string;           // Dimmed/gray for incorrect
  userAnswerMy?: string;
  explanation?: Explanation;     // Practice mode only
  streakCount: number;           // Shows "X in a row!" when > 1
  mode: 'mock-test' | 'practice';
  onContinue: () => void;
  showBurmese: boolean;
}
```

Implementation per locked decisions:
- Slide-up from bottom using `motion/react` AnimatePresence: `initial={{ y: '100%', opacity: 0 }}`, `animate={{ y: 0, opacity: 1 }}`, `exit={{ y: '100%', opacity: 0 }}` with SPRING_SNAPPY transition
- Full-width color band background: green for correct (`bg-success-subtle border-t-4 border-success`), amber for incorrect (`bg-warning-subtle border-t-4 border-warning`)
- NO overlay/dimming on question area above (just positioned below)
- `role="status"` and `aria-live="polite"` for screen reader announcement
- Correct: "Correct!" message + user's selected answer text + animated bouncing checkmark (motion.div with SPRING_BOUNCY scale 0->1)
- Incorrect: user's wrong pick dimmed/gray + correct answer shown + explanation (Practice mode ONLY, NOT mock test)
- Bilingual feedback: Burmese translations when showBurmese
- Streak counter: "X in a row!" badge shown when streakCount > 1 (animated entrance)
- TTS SpeechButton on explanation text in Practice mode
- Continue button at bottom of panel (primary/solid style, 3D chunky)
- onClick on the entire panel ALSO calls onContinue (both work per user decision)
- NO swipe dismiss per user decision
- Animated icons: Check icon bounces in (SPRING_BOUNCY) for correct, X icon shakes (spring stiffness 600, damping 12) for incorrect -- per locked decision
- Reduced motion support via useReducedMotion hook
- Panel height: dynamic (Claude's discretion) -- grows to fit content, min-height for consistent feel
- Auto-focus the Continue button when panel appears using ref.focus({ preventScroll: true })
  </action>
  <verify>Run `npx tsc --noEmit` -- compiles. Component exports FeedbackPanel. Check that AnimatePresence is properly imported from motion/react.</verify>
  <done>FeedbackPanel slides up from bottom with correct/incorrect styling, bilingual content, streak badge, animated icons, and Continue button. Tapping panel or button advances.</done>
</task>

<task type="auto">
  <name>Task 2: AnswerOption component with keyboard navigation</name>
  <files>src/hooks/useRovingFocus.ts, src/components/quiz/AnswerOption.tsx</files>
  <action>
Create `src/hooks/useRovingFocus.ts`:

```typescript
export function useRovingFocus(itemCount: number) {
  const [focusedIndex, setFocusedIndex] = useState(0);

  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {
    switch (e.key) {
      case 'ArrowDown':
      case 'ArrowRight':
        e.preventDefault();
        setFocusedIndex(prev => (prev + 1) % itemCount);
        break;
      case 'ArrowUp':
      case 'ArrowLeft':
        e.preventDefault();
        setFocusedIndex(prev => (prev - 1 + itemCount) % itemCount);
        break;
    }
  }, [itemCount]);

  return { focusedIndex, setFocusedIndex, handleKeyDown };
}
```

Create `src/components/quiz/AnswerOption.tsx`:

Two exports: `AnswerOption` (individual option) and `AnswerOptionGroup` (container with keyboard nav).

**AnswerOptionGroup** props:
```typescript
interface AnswerOptionGroupProps {
  answers: Answer[];
  selectedAnswer: Answer | null;
  isLocked: boolean;          // After check -- options disabled
  correctAnswer?: Answer;     // Shown after check for coloring
  onSelect: (answer: Answer) => void;
  showBurmese: boolean;
}
```

Implementation:
- Wraps answers in `role="radiogroup"` container with `onKeyDown` from useRovingFocus
- Up/Down arrow keys directly select (highlight) answer options per locked decision
- Each AnswerOption is `role="radio"` with `aria-checked`
- Roving `tabIndex`: focused option gets tabIndex=0, others get tabIndex=-1
- When focusedIndex changes, call ref.focus() on the corresponding option element
- Visible focus ring on focused option: ALWAYS visible (not just focus-visible) per locked decision -- use `ring-2 ring-primary ring-offset-2`
- Standard Tab order in the group per W3C radiogroup pattern

**AnswerOption** props:
```typescript
interface AnswerOptionProps {
  answer: Answer;
  isSelected: boolean;
  isFocused: boolean;
  isLocked: boolean;
  isCorrectReveal?: boolean;  // Show green after check
  isIncorrectReveal?: boolean; // Show red after check
  onSelect: () => void;
  showBurmese: boolean;
  index: number;
}
```

Styling per locked decisions:
- Selected: highlighted border + subtle background fill (`border-primary bg-primary-subtle`)
- User can freely change selection before Check (just select different option)
- After Check: correct option green (`border-success bg-success-subtle`), wrong pick amber (`border-warning bg-warning-subtle`), others dimmed
- After Check: options visually locked/disabled (pointer-events-none, opacity-50 for non-relevant)
- Text only, no letter prefixes (A, B, C, D) per locked decision
- 3D chunky button style: `shadow-[0_4px_0_hsl(var(--border))]` with active press down
- Motion entrance animation: staggered with index * 0.05s delay
- Min height 56px for touch target

Use `useRef` array for option elements to manage focus programmatically.
  </action>
  <verify>Run `npx tsc --noEmit` -- compiles. Run `npm run lint` -- passes. Verify role="radiogroup" and role="radio" attributes present.</verify>
  <done>AnswerOption with keyboard navigation via arrow keys, visible focus rings, 3D chunky styling, and post-check color reveals. AnswerOptionGroup orchestrates roving focus per W3C radiogroup pattern.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- FeedbackPanel animates with slide-up, green/amber coloring, streak badge
- FeedbackPanel calls `playPanelReveal()` when it slides up (sound effect wiring)
- AnswerOptionGroup handles arrow key navigation with roving tabIndex
- All ARIA attributes correctly applied
- Reduced motion respected
</verification>

<success_criteria>
- FeedbackPanel implements all locked decisions (slide-up, color band, animated icons, streak, bilingual, continue+tap)
- AnswerOption supports keyboard navigation with visible focus rings
- Both components compile and lint cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/21-test-practice-ux/21-03-SUMMARY.md`
</output>
