---
phase: 32-celebration-system-elevation
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/practice/PracticeSession.tsx
  - src/pages/TestPage.tsx
autonomous: true
gap_closure: true
requirements:
  - CELB-09

must_haves:
  truths:
    - "XP counter appears in quiz session header during practice sessions"
    - "XP counter appears in quiz session header during mock test sessions"
    - "XP counter pulses with spring animation when user earns points on correct answer"
  artifacts:
    - path: "src/components/practice/PracticeSession.tsx"
      provides: "XPCounter wired into QuizHeader via xpSlot"
      contains: "XPCounter"
    - path: "src/pages/TestPage.tsx"
      provides: "XPCounter wired into QuizHeader via xpSlot"
      contains: "XPCounter"
  key_links:
    - from: "src/components/practice/PracticeSession.tsx"
      to: "src/components/quiz/XPCounter.tsx"
      via: "import and render as xpSlot"
      pattern: "xpSlot=.*XPCounter"
    - from: "src/pages/TestPage.tsx"
      to: "src/components/quiz/XPCounter.tsx"
      via: "import and render as xpSlot"
      pattern: "xpSlot=.*XPCounter"
---

<objective>
Wire the existing XPCounter component into quiz session consumers (PracticeSession and TestPage) so the XP counter actually appears in the quiz header during gameplay.

Purpose: Close the CELB-09 verification gap — XPCounter and QuizHeader's xpSlot prop both exist but no consumer connects them. The XP counter never renders in any actual quiz session.

Output: Both PracticeSession.tsx and TestPage.tsx pass `<XPCounter>` as xpSlot to QuizHeader with cumulative XP tracking.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-celebration-system-elevation/32-04-SUMMARY.md
@src/components/quiz/XPCounter.tsx
@src/components/quiz/QuizHeader.tsx
@src/components/practice/PracticeSession.tsx
@src/pages/TestPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire XPCounter into PracticeSession and TestPage quiz headers</name>
  <files>
    src/components/practice/PracticeSession.tsx
    src/pages/TestPage.tsx
  </files>
  <action>
Both files already have `xpPoints` (10 or 15 per correct answer) and `showXP` state for the existing per-answer XPPopup micro-reward. The XPCounter needs cumulative XP, not per-answer.

In **both** PracticeSession.tsx and TestPage.tsx:

1. **Import XPCounter:**
   ```typescript
   import { XPCounter } from '@/components/quiz/XPCounter';
   ```

2. **Add cumulative XP state** (alongside existing `xpPoints`/`showXP` state):
   ```typescript
   const [totalXp, setTotalXp] = useState(0);
   const [prevTotalXp, setPrevTotalXp] = useState(0);
   ```

3. **Update cumulative XP in the handleCheck correct-answer branch** (where `setXpPoints` and `setShowXP` are already called):
   After the existing `setXpPoints(newStreak >= 3 ? 15 : 10);` line, add:
   ```typescript
   const earned = newStreak >= 3 ? 15 : 10;
   setPrevTotalXp(totalXp);
   setTotalXp(prev => prev + earned);
   ```
   NOTE: The existing `setXpPoints(...)` line already computes the same value — reuse the same `earned` variable to avoid duplication. Replace the existing `setXpPoints(newStreak >= 3 ? 15 : 10)` with `setXpPoints(earned)`.

4. **Pass XPCounter as xpSlot to QuizHeader:**
   Find the `<QuizHeader` JSX in each file and add the `xpSlot` prop:
   ```tsx
   <QuizHeader
     questionNumber={quizState.currentIndex + 1}
     totalQuestions={questions.length}
     mode={...}
     onExit={handleExitRequest}
     xpSlot={<XPCounter xp={totalXp} previousXp={prevTotalXp} />}
     timerSlot={...}
     showBurmese={showBurmese}
   />
   ```

5. **Verify the XPPopup still works independently.** The existing `<XPPopup points={xpPoints} show={showXP} />` renders separately from the header XPCounter. Both should coexist — XPCounter shows cumulative total in header, XPPopup shows per-answer floating "+N" near the answer area.

Key constraint: Do NOT use setState in effects (React Compiler rule). The cumulative XP update happens in the handleCheck callback (event handler), which is safe.
  </action>
  <verify>
    Run `npm run typecheck` — no TypeScript errors.
    Run `npm run lint` — no ESLint errors (especially no react-hooks/set-state-in-effect violations).
    Run `npm run test:run` — all existing tests pass.
    Grep for `xpSlot` in PracticeSession.tsx and TestPage.tsx — both must contain `xpSlot={<XPCounter`.
    Grep for `import { XPCounter }` in both files — import present.
  </verify>
  <done>
    XPCounter renders in the quiz header for both practice and mock test sessions. Cumulative XP increments on each correct answer. Spring pulse animation fires when XP increases. Existing XPPopup per-answer micro-reward still works independently.
  </done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- `npm run lint` passes
- `npm run test:run` passes (all existing tests)
- Both PracticeSession.tsx and TestPage.tsx import XPCounter and pass it as xpSlot to QuizHeader
- XPCounter receives cumulative xp and previousXp props (not per-answer values)
</verification>

<success_criteria>
The XP counter appears in the quiz session header for both practice and mock test modes, showing cumulative XP earned during the session. It pulses with spring animation on each correct answer.
</success_criteria>

<output>
After completion, create `.planning/phases/32-celebration-system-elevation/32-07-SUMMARY.md`
</output>
