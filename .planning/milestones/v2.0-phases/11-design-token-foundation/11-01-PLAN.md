---
phase: 11-design-token-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/tokens.css
  - src/styles/globals.css
  - tailwind.config.js
autonomous: true

must_haves:
  truths:
    - "All color, spacing, shadow, border-radius, and motion tokens are defined as CSS custom properties in src/styles/tokens.css"
    - "Tailwind config references CSS variables for all color, shadow, and radius values (no hardcoded HSL literals)"
    - "globals.css imports tokens.css and has all :root and .dark variable blocks removed (moved to tokens.css)"
    - "Existing app renders identically after changes (no visual regression from token wiring)"
  artifacts:
    - path: "src/styles/tokens.css"
      provides: "Complete two-tier design token system (primitives + semantic + dark mode)"
      contains: "--color-primary"
    - path: "tailwind.config.js"
      provides: "Tailwind config consuming CSS variables"
      contains: "hsl(var(--color-"
    - path: "src/styles/globals.css"
      provides: "Slimmed globals.css importing tokens.css"
      contains: "@import './tokens.css'"
  key_links:
    - from: "src/styles/tokens.css"
      to: "src/styles/globals.css"
      via: "@import directive"
      pattern: "@import.*tokens"
    - from: "src/styles/tokens.css"
      to: "tailwind.config.js"
      via: "CSS variable references"
      pattern: "var\\(--color-"
---

<objective>
Create the complete design token foundation: a single `tokens.css` file containing all primitive and semantic tokens (colors, spacing, shadows, radii, motion, typography) with dark mode overrides, wire Tailwind config to consume CSS variables instead of hardcoded values, and slim down globals.css by moving all variable definitions to tokens.css.

Purpose: Establish the single source of truth that all subsequent migration plans will reference.
Output: tokens.css (new), tailwind.config.js (restructured), globals.css (slimmed)
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-design-token-foundation/11-RESEARCH.md (full token architecture, code examples, codebase audit)
@src/styles/globals.css (current variable definitions to migrate)
@tailwind.config.js (current config to restructure)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tokens.css with two-tier token architecture</name>
  <files>src/styles/tokens.css</files>
  <action>
Create `src/styles/tokens.css` with the complete two-tier token system per locked decisions:

**PRIMITIVE LAYER** (`:root` block):
All raw palette values as HSL channels only (no `hsl()` wrapper). Use the exact HSL values from the existing globals.css and tailwind.config.js (preserve visual continuity, not Tailwind defaults).

Palettes to include:
- Blue (--blue-50 through --blue-900): Use values from existing --primary-50 through --primary-900 in globals.css
- Purple (--purple-50, --purple-500, --purple-600, --purple-700): From design-tokens.ts accent
- Green (--green-50, --green-100, --green-500, --green-600): From success colors
- Amber (--amber-50, --amber-100, --amber-500, --amber-600): From warning colors
- Red (--red-500, --red-600, --red-700): From destructive (hue ~10, warm coral per user decision)
- Slate (--slate-50, --slate-100, --slate-200, --slate-400, --slate-500, --slate-600, --slate-900): Derived from existing foreground/muted values
- Patriotic red (--patriotic-red): From existing `0 72% 51%`
- Cyan (--cyan-300): From existing secondary `192 95% 68%`
- Orange (--orange-400): From existing accent `18 92% 70%`
- Rose (--rose-500): `350 89% 60%` for category-democracy
- Fuchsia (--fuchsia-500): `292 84% 61%` for category-1800s
- Sky (--sky-500): `199 89% 48%` for category-recent

**SEMANTIC LAYER** (separate `:root` block):
~30 semantic color tokens with inline documentation comments. Use the semantic names and mappings from the research RESEARCH.md "Semantic Naming Convention" section. Key groups:
- Surfaces: --color-background, --color-surface, --color-surface-raised, --color-surface-muted, --color-overlay
- Text: --color-text-primary, --color-text-secondary, --color-text-on-primary, --color-text-on-destructive
- Primary states: --color-primary, --color-primary-hover, --color-primary-active, --color-primary-disabled, --color-primary-subtle, --color-primary-50a
- Secondary, Accent, Accent-purple
- Destructive states: --color-destructive, --color-destructive-hover, --color-destructive-foreground
- Success: --color-success, --color-success-subtle, --color-success-foreground
- Warning: --color-warning, --color-warning-subtle, --color-warning-foreground
- Borders: --color-border, --color-border-muted, --color-input
- Focus: --color-ring
- Decorative: --color-patriotic-red
- Status: --color-status-online, --color-status-offline, --color-status-syncing, --color-status-error
- Chart/category colors: --color-chart-blue, --color-chart-amber, --color-chart-emerald, plus 7 sub-category tokens

**NON-COLOR TOKENS**:
- Spacing: --space-1 through --space-8 (informational, Tailwind handles these)
- Border radius: --radius-sm through --radius-full
- Shadows: --shadow-sm, --shadow-md, --shadow-lg, --shadow-xl, --shadow-chunky, --shadow-chunky-active
- Motion: --duration-instant through --duration-page, --ease-out, --ease-in-out, --ease-spring
- Typography: --font-sans, --font-myanmar, --font-weight-normal through --font-weight-extrabold

**DARK THEME** (`.dark` block):
Only override semantic tokens, not primitives. Use the dark values from the research's complete example. Key changes:
- Soft dark backgrounds (deep navy, not pure black): --color-background at `222 47% 11%`
- Brighter primary using --blue-400
- Adjusted text contrast
- Darker shadow intensities
- Focus ring uses --blue-400 for visibility

Include section headers with `/* ═══ */` dividers and inline comments on each semantic token.

**CRITICAL FORMAT RULES:**
- Store HSL channels only: `--blue-500: 217 91% 60%;` (NOT `hsl(217 91% 60%)`)
- Semantic tokens reference primitives via `var()`: `--color-primary: var(--blue-500);`
- Some semantic tokens need direct HSL channels (for colors not in primitive palette): `--color-surface: 0 0% 100%;`
- Opacity tokens include alpha: `--color-primary-50a: 217 91% 60% / 0.12;`
  </action>
  <verify>
- File exists at src/styles/tokens.css
- Contains `:root` blocks with primitives and semantics
- Contains `.dark` block with overrides
- No `hsl()` wrappers in token values (channels only)
- grep for `--color-primary:` returns a result
- grep for `--color-background:` returns results in both `:root` and `.dark`
  </verify>
  <done>Complete two-tier token system exists in tokens.css with primitives, ~30 semantic colors, non-color tokens, and dark mode overrides. All values are HSL channels only.</done>
</task>

<task type="auto">
  <name>Task 2: Restructure Tailwind config and slim down globals.css</name>
  <files>tailwind.config.js, src/styles/globals.css</files>
  <action>
**tailwind.config.js changes:**

Restructure the `theme.extend.colors` to reference CSS variables from tokens.css. Two categories:

1. **Semantic colors (preferred):** Reference semantic token names.
```js
colors: {
  background: 'hsl(var(--color-background))',
  foreground: 'hsl(var(--color-text-primary))',
  surface: {
    DEFAULT: 'hsl(var(--color-surface))',
    raised: 'hsl(var(--color-surface-raised))',
    muted: 'hsl(var(--color-surface-muted))',
  },
  primary: {
    DEFAULT: 'hsl(var(--color-primary))',
    foreground: 'hsl(var(--color-text-on-primary))',
    hover: 'hsl(var(--color-primary-hover))',
    active: 'hsl(var(--color-primary-active))',
    disabled: 'hsl(var(--color-primary-disabled))',
    subtle: 'hsl(var(--color-primary-subtle))',
  },
  // ... all other semantic groups
}
```

2. **Primitive colors (available for flexibility):** Reference primitive token names.
```js
'primary-50': 'hsl(var(--blue-50))',
'primary-100': 'hsl(var(--blue-100))',
// ... through primary-900
```

Also update:
- `borderRadius` to reference `var(--radius-*)` tokens
- `boxShadow` to reference `var(--shadow-*)` tokens
- Add `transitionDuration` with `var(--duration-*)` tokens
- Keep `darkMode: ['class']`
- Keep existing `keyframes`, `animation`, `container` config
- Keep `plugins: [require('tailwindcss-animate')]`

**IMPORTANT BACKWARD COMPATIBILITY:** The existing codebase uses class names like `bg-primary`, `text-foreground`, `bg-card`, `border-border`, `bg-muted`, `text-muted-foreground`, `bg-accent`, `text-accent-foreground`, `bg-destructive`, `text-destructive-foreground`, `bg-popover`, `text-popover-foreground`, `bg-card-foreground`. All of these MUST continue to work. Map them to the new semantic tokens:
- `card` -> references `--color-surface` (same visual)
- `card-foreground` -> references `--color-text-primary`
- `popover` -> references `--color-surface-raised`
- `popover-foreground` -> references `--color-text-primary`
- `muted` -> references `--color-surface-muted`
- `muted-foreground` -> references `--color-text-secondary`
- `accent` -> references `--color-accent`
- `accent-foreground` -> references `--color-accent-foreground`
- `accent-purple` -> references `--color-accent-purple`
- Keep `success`, `warning`, `patriotic` color groups referencing tokens

**globals.css changes:**

1. Add `@import './tokens.css';` BEFORE the `@tailwind` directives (after the font import)
2. Remove ALL `:root { }` variable blocks (lines 8-66) -- these are now in tokens.css
3. Remove the `.dark { }` variable block (lines 68-134) -- now in tokens.css
4. Remove ALL `.dark .bg-*` / `.dark .text-*` / `.dark .shadow-*` / `.dark .border-*` override blocks (lines 136-194) -- the token system handles these
5. Keep: body styles (reference tokens via `hsl(var(--color-background))`), .page-shell and its ::before, body::before, `.dark .page-shell::before`, `.dark body::before`, `.font-myanmar`, `.nav-safe-area`, `.card-edge-safe`, `.flip-card` CSS, `.focus-ring`, `@layer components` block, animations, `::selection`, `html` scroll behavior, `a` color inherit
6. Update body `background-color` and `color` to use new token names: `hsl(var(--color-background))` and `hsl(var(--color-text-primary))`
7. Update .page-shell similarly
8. Keep `--app-viewport-height`, `--safe-area-top`, `--safe-area-bottom`, `--bottom-tab-height`, `--app-viewport-offset-*` as layout variables in globals.css (NOT in tokens.css -- these are layout, not design tokens)
9. Keep `--radius` variable TEMPORARILY for backward compat (some components use `var(--radius)`) -- set to `var(--radius-xl)` to reference the token

**CRITICAL:** After these changes, run `npx next build` to verify the build still passes. The app should render identically because all the same CSS variable values exist, just in a different file.
  </action>
  <verify>
- `npx next build` succeeds without errors
- globals.css has `@import './tokens.css'` near the top
- globals.css has NO `:root { --background:` blocks
- globals.css has NO `.dark { --background:` blocks
- globals.css has NO `.dark .bg-primary-500` override blocks
- tailwind.config.js references `hsl(var(--color-*))` for colors
- Tailwind classes like `bg-primary`, `text-foreground`, `bg-card`, `border-border` still work (build passes)
  </verify>
  <done>Tailwind config consumes CSS variables from tokens.css. globals.css is slimmed to layout + utilities only. Build passes. All existing Tailwind class names still functional.</done>
</task>

</tasks>

<verification>
- `src/styles/tokens.css` exists with primitives + semantics + dark mode
- `tailwind.config.js` references CSS vars, no hardcoded HSL values in color definitions
- `globals.css` imports tokens.css, contains no `:root` or `.dark` variable blocks
- `npx next build` passes
- App renders identically (same colors, same dark mode behavior)
</verification>

<success_criteria>
All design tokens are defined as CSS custom properties in one file (tokens.css). Tailwind config consumes CSS variables. globals.css is a slim layout/utility file. Build passes. Zero visual regression.
</success_criteria>

<output>
After completion, create `.planning/phases/11-design-token-foundation/11-01-SUMMARY.md`
</output>
