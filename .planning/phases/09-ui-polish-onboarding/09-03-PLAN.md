---
phase: 09-ui-polish-onboarding
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/pwa/SyncStatusIndicator.tsx
  - src/contexts/OfflineContext.tsx
  - src/AppShell.tsx
autonomous: true

must_haves:
  truths:
    - "Floating sync indicator appears at bottom-center only when items are pending sync"
    - "Indicator shows icon + count (language-neutral, no bilingual text)"
    - "Count ticks down with animation as items sync"
    - "Indicator slides away with AnimatePresence when count reaches zero"
    - "Warning state (orange icon) shows when sync attempt fails"
    - "Indicator is informational only -- no tap-to-sync action"
    - "Indicator does not overlap mobile bottom tab bar (offset applied)"
  artifacts:
    - path: "src/components/pwa/SyncStatusIndicator.tsx"
      provides: "Floating bottom-center sync indicator with AnimatePresence"
      contains: "AnimatePresence"
    - path: "src/AppShell.tsx"
      provides: "SyncStatusIndicator mounted in Router scope"
      contains: "SyncStatusIndicator"
  key_links:
    - from: "src/components/pwa/SyncStatusIndicator.tsx"
      to: "src/contexts/OfflineContext.tsx"
      via: "useOffline() hook for pendingSyncCount, isSyncing"
      pattern: "useOffline"
---

<objective>
Redesign the SyncStatusIndicator from a toolbar icon-button to a floating bottom-center toast-like indicator that appears only when items are pending sync, with animated tick-down and slide-away.

Purpose: Users need visible, non-intrusive feedback about offline sync status per locked user decision.
Output: Redesigned SyncStatusIndicator.tsx mounted in AppShell.tsx, consuming OfflineContext (NOT useSyncQueue).
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-ui-polish-onboarding/09-RESEARCH.md
@.planning/phases/09-ui-polish-onboarding/09-01-SUMMARY.md

@src/components/pwa/SyncStatusIndicator.tsx
@src/contexts/OfflineContext.tsx
@src/AppShell.tsx
@src/components/AppNavigation.tsx
</context>

<instructions>
Use the /frontend-design skill for all UI design and implementation work in this phase. This is a locked user decision.
</instructions>

<tasks>

<task type="auto">
  <name>Task 1: Redesign SyncStatusIndicator as Floating Toast</name>
  <files>src/components/pwa/SyncStatusIndicator.tsx</files>
  <action>
Completely rewrite `SyncStatusIndicator.tsx` from toolbar icon to floating indicator:

**Data source:** Switch from `useSyncQueue()` to `useOffline()` from OfflineContext to avoid duplicate sync attempts (critical pitfall from research).

**Layout:**
- Fixed position at bottom-center: `fixed bottom-20 left-1/2 -translate-x-1/2 z-50`
- Use `bottom-20` (80px) to clear the mobile bottom tab bar that will be added in plan 09-06
- Pill-shaped with rounded-full, bg-card/95 backdrop-blur-lg, shadow-lg
- Compact: icon + count number only (language-neutral per locked decision)

**Animation:**
- Wrap in `AnimatePresence` from motion/react
- Show condition: `pendingSyncCount > 0 || isSyncing`
- Enter: `initial={{ y: 20, opacity: 0 }}` -> `animate={{ y: 0, opacity: 1 }}`
- Exit: `exit={{ y: 20, opacity: 0 }}`
- Transition: gentle spring `{ type: 'spring', stiffness: 300, damping: 20 }`
- Count display uses `motion.span` with `key={pendingSyncCount}` for animated number changes

**States:**
- Normal syncing: Cloud icon (Cloud from lucide-react) with pulsing animation + count
- Sync failure/warning: CloudOff or AlertTriangle icon in `text-warning-500` (orange) -- detect via checking if `pendingSyncCount` hasn't changed after a sync cycle
- To detect failure: Check if the OfflineContext exposes any error state. If not, track previous count in a ref and show warning if count didn't decrease after `isSyncing` transitions from true to false.

**Behavior:**
- Informational ONLY -- remove onClick/triggerSync (no tap-to-sync per locked decision)
- Remove the button element, use a plain div
- No expandable detail on tap (locked decision)
- Aria-label with count for screen readers: `aria-label={`${pendingSyncCount} items pending sync`}`

**Remove from AppNavigation:** After redesigning, remove the `<SyncStatusIndicator />` import and usage from AppNavigation.tsx (it's currently in the top bar toolbar). The new floating version will be mounted in AppShell instead.
  </action>
  <verify>Run `npx tsc --noEmit` to verify no type errors. Verify the component uses `useOffline()` not `useSyncQueue()`. Verify no onClick handler exists.</verify>
  <done>SyncStatusIndicator is a floating bottom-center toast using OfflineContext, with AnimatePresence slide animation, warning state for failures, and no interactive action.</done>
</task>

<task type="auto">
  <name>Task 2: Mount Floating Indicator in AppShell and Remove from AppNavigation</name>
  <files>src/AppShell.tsx, src/components/AppNavigation.tsx</files>
  <action>
**AppShell.tsx:**
- Import `SyncStatusIndicator` from `@/components/pwa/SyncStatusIndicator`
- Mount it inside the `<Router>` but outside `<Routes>`, after `<PWAOnboardingFlow />`:
  ```tsx
  <PWAOnboardingFlow />
  <SyncStatusIndicator />
  ```
- This ensures it's always visible on all pages when items are pending

**AppNavigation.tsx:**
- Remove the `import { SyncStatusIndicator } from '@/components/pwa/SyncStatusIndicator'` line
- Remove the `<SyncStatusIndicator />` JSX element from the toolbar area
- The floating version in AppShell replaces this toolbar version entirely
  </action>
  <verify>Run `npx tsc --noEmit` to verify no import errors. Grep AppNavigation.tsx for "SyncStatusIndicator" -- should return zero matches. Verify AppShell.tsx has the import and mount.</verify>
  <done>Floating SyncStatusIndicator is mounted in AppShell (globally visible). Old toolbar version removed from AppNavigation. No duplicate sync indicator renders.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- SyncStatusIndicator uses `useOffline()` not `useSyncQueue()`
- AppNavigation no longer imports or renders SyncStatusIndicator
- AppShell mounts SyncStatusIndicator inside Router
- Component has no onClick handler (informational only)
</verification>

<success_criteria>
Floating sync indicator appears at bottom-center when items are pending, animates tick-down, slides away when empty, shows warning on failure. Accessible via screen reader. No interactive action.
</success_criteria>

<output>
After completion, create `.planning/phases/09-ui-polish-onboarding/09-03-SUMMARY.md`
</output>
