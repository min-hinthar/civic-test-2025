---
phase: 43-test-readiness-score-and-drill-mode
plan: 02
type: execute
wave: 2
depends_on: ["43-01"]
files_modified:
  - src/hooks/useReadinessScore.ts
  - src/components/readiness/ReadinessHeroCard.tsx
  - src/components/readiness/DimensionBreakdown.tsx
  - src/components/readiness/CategoryDrillList.tsx
  - src/views/Dashboard.tsx
autonomous: true
requirements: [RDNS-01, RDNS-02, RDNS-03, RDNS-05]

must_haves:
  truths:
    - "User sees a 0-100% readiness score in a radial ring as the hero card at the top of Dashboard"
    - "Ring animates fill from 0 on every Dashboard load with gradient red->amber->green"
    - "4-tier status label shows below percentage: Getting Started / Building Up / Almost Ready / Test Ready"
    - "User can tap the card to expand it, revealing 3 mini dimension rings and a category list"
    - "Dimension rings show accuracy (blue), coverage (purple), consistency (teal) percentages"
    - "Category list shows 7 sub-categories sorted by ascending mastery with drill buttons on categories below 70%"
    - "60% cap warning badge appears when score is capped, with link to uncovered category"
    - "Zero-coverage categories show red accent with alert icon"
    - "0% empty state shows empty ring with encouraging text"
    - "All text localized for Burmese"
    - "Card has gradient background that shifts with score tier"
    - "Brighter/neon tones in dark mode"
  artifacts:
    - path: "src/hooks/useReadinessScore.ts"
      provides: "React hook composing readiness engine with useCategoryMastery + SRS data"
      exports: ["useReadinessScore"]
    - path: "src/components/readiness/ReadinessHeroCard.tsx"
      provides: "Dashboard hero card with main ReadinessRing, expand/collapse, gradient background"
      exports: ["ReadinessHeroCard"]
    - path: "src/components/readiness/DimensionBreakdown.tsx"
      provides: "3 mini CategoryRing components for accuracy/coverage/consistency with tooltips"
      exports: ["DimensionBreakdown"]
    - path: "src/components/readiness/CategoryDrillList.tsx"
      provides: "7-category list sorted by mastery with drill buttons and zero-coverage warnings"
      exports: ["CategoryDrillList"]
    - path: "src/views/Dashboard.tsx"
      provides: "Dashboard with ReadinessHeroCard as first StaggeredItem"
  key_links:
    - from: "src/hooks/useReadinessScore.ts"
      to: "src/lib/readiness/readinessEngine.ts"
      via: "calculateReadiness(input)"
      pattern: "calculateReadiness"
    - from: "src/hooks/useReadinessScore.ts"
      to: "src/hooks/useCategoryMastery.ts"
      via: "useCategoryMastery() for mastery data"
      pattern: "useCategoryMastery"
    - from: "src/hooks/useReadinessScore.ts"
      to: "src/lib/srs/srsStore.ts"
      via: "getAllSRSCards() for FSRS card data"
      pattern: "getAllSRSCards"
    - from: "src/components/readiness/ReadinessHeroCard.tsx"
      to: "src/components/hub/ReadinessRing.tsx"
      via: "ReadinessRing component for main ring display"
      pattern: "ReadinessRing"
    - from: "src/components/readiness/DimensionBreakdown.tsx"
      to: "src/components/progress/CategoryRing.tsx"
      via: "CategoryRing component for mini dimension rings"
      pattern: "CategoryRing"
    - from: "src/components/readiness/CategoryDrillList.tsx"
      to: "next/navigation"
      via: "router.push('/drill?category=X') for category drill navigation"
      pattern: "router.push.*drill"
    - from: "src/views/Dashboard.tsx"
      to: "src/components/readiness/ReadinessHeroCard.tsx"
      via: "ReadinessHeroCard as first StaggeredItem in Dashboard layout"
      pattern: "ReadinessHeroCard"
---

<objective>
Build the Dashboard readiness hero card with radial ring, expandable dimension breakdown, and category drill list.

Purpose: The readiness score is the centerpiece of the Dashboard -- users see at a glance how prepared they are for the USCIS test and can identify exactly which areas need work.

Output: `useReadinessScore` hook + `ReadinessHeroCard`, `DimensionBreakdown`, `CategoryDrillList` components integrated into Dashboard.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-test-readiness-score-and-drill-mode/43-CONTEXT.md
@.planning/phases/43-test-readiness-score-and-drill-mode/43-RESEARCH.md
@.planning/phases/43-test-readiness-score-and-drill-mode/43-01-SUMMARY.md
@src/views/Dashboard.tsx
@src/hooks/useCategoryMastery.ts
@src/components/hub/ReadinessRing.tsx
@src/components/progress/CategoryRing.tsx
@src/lib/mastery/categoryMapping.ts
@src/lib/srs/srsStore.ts
@src/lib/readiness/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: useReadinessScore hook and ReadinessHeroCard with expandable breakdown</name>
  <files>
    src/hooks/useReadinessScore.ts
    src/components/readiness/ReadinessHeroCard.tsx
    src/components/readiness/DimensionBreakdown.tsx
    src/components/readiness/CategoryDrillList.tsx
  </files>
  <action>
    Create `src/hooks/useReadinessScore.ts`:
    - Import `calculateReadiness` from `@/lib/readiness`
    - Import `useCategoryMastery` for category mastery data
    - Import `getAllSRSCards` from `@/lib/srs/srsStore` for FSRS card data
    - Import `getAnswerHistory` from `@/lib/mastery` for attempted question IDs
    - Import `totalQuestions` from `@/constants/questions`
    - Import `getCategoryQuestionIds`, `USCIS_CATEGORIES` from `@/lib/mastery`
    - Import `allQuestions` from `@/constants/questions`
    - Load SRS cards and answer history via useEffect with cancelled flag pattern (same as Dashboard)
    - Build ReadinessInput from: categoryMasteries (from useCategoryMastery), totalQuestions (128), attemptedQuestionIds (from answer history), srsCards (from SRS store, mapping SRSCardRecord to {questionId, card})
    - IMPORTANT: Coerce card.due to new Date(card.due) if it's a string (IndexedDB serialization)
    - Compute readiness score via useMemo (NOT useMemo<Type>() -- use `const result: ReadinessResult = useMemo(...)`)
    - Return: { readiness: ReadinessResult | null, isLoading: boolean, subCategoryMasteries: Record<string, number> }
    - Hook exposes refresh via useCategoryMastery's refresh

    Create `src/components/readiness/DimensionBreakdown.tsx`:
    - Props: dimensions (DimensionScore), showBurmese (boolean)
    - Render 3 CategoryRing components side-by-side in a flex row:
      - Accuracy: blue color (text-blue-500), size 64, strokeWidth 6
      - Coverage: purple color (text-purple-500), size 64, strokeWidth 6
      - Consistency: teal color (text-teal-500), size 64, strokeWidth 6
    - Each ring shows percentage number inside as children
    - Label below each ring (en + optional Burmese): "Accuracy"/"တိကျမှု", "Coverage"/"ခြုံငုံမှု", "Consistency"/"တသမတ်တည်းမှု"
    - Tooltip on tap (use simple state toggle per ring, NOT Radix popover -- keeps it lightweight):
      - Accuracy: "Average mastery across all categories" / Burmese equivalent
      - Coverage: "% of all 128 questions you've attempted" / Burmese equivalent
      - Consistency: "How well you retain what you've learned (FSRS)" / Burmese equivalent
    - Tooltip shows as small text below the label when active, dismisses on tap elsewhere

    Create `src/components/readiness/CategoryDrillList.tsx`:
    - Props: subCategoryMasteries (Record<string, number>), categoryMasteries (Record<string, number>), showBurmese (boolean)
    - Import SUB_CATEGORY_NAMES, USCIS_CATEGORIES from mastery/categoryMapping
    - List all 7 sub-categories sorted by ascending mastery (weakest first)
    - Each row: category name (localized) + mastery percentage + optional "Drill" button
    - "Drill" button appears ONLY on categories below 70% mastery threshold
    - "Drill" button navigates to `/drill?category={subCategoryName}` via router.push
    - Zero-coverage categories (mastery === 0 AND no answers): red/warning accent background, AlertTriangle icon from lucide-react
    - Category name from SUB_CATEGORY_NAMES (localized)
    - Compact spacing: text-sm, py-2 per row, border-b for separation

    Create `src/components/readiness/ReadinessHeroCard.tsx`:
    - Props: readiness (ReadinessResult), subCategoryMasteries (Record<string, number>), categoryMasteries (Record<string, number>), isLoading (boolean), showBurmese (boolean)
    - Hero card: rounded-2xl, p-6, shadow, gradient background that shifts with score tier:
      - 0-25%: warm red tones (from-red-500/5 to-red-500/10 in light, from-red-500/15 to-red-500/20 in dark)
      - 26-50%: amber tones (from-amber-500/5 to-amber-500/10)
      - 51-75%: blue tones (from-blue-500/5 to-blue-500/10)
      - 76-100%: green tones (from-green-500/5 to-green-500/10)
    - Brighter/neon tones in dark mode: use dark: variants with higher opacity (from-X-500/15 to-X-500/20)
    - Card header: "Test Readiness" / "စာမေးပွဲ အဆင်သင့်ဖြစ်မှု" title + "Based on your study history" / Burmese subtitle
    - Chevron icon (ChevronDown from lucide-react) that rotates 180deg when expanded
    - Main ReadinessRing: size 140, strokeWidth 14, percentage from readiness.score
    - Ring centered in card when collapsed
    - 60% cap warning: when readiness.isCapped, show small warning badge below ring with AlertTriangle icon + text "Score capped -- you haven't studied {categoryName}" with link to `/practice?category={category}`. Use readiness.cappedCategories[0] to get the first uncovered main category, map to USCIS_CATEGORY_NAMES for localized name.
    - 0% empty state: when readiness.score === 0, show empty ring with text "Start studying to see your readiness" / Burmese
    - Expand/collapse: useState(false), tap anywhere on card toggles
    - Expand animation: use motion.div with spring physics (SPRING_GENTLE):
      - Ring shrinks from size 140 to size 80 and slides left
      - Use motion.div layout animation for smooth card height change
      - DimensionBreakdown + CategoryDrillList fade/slide in
      - Content container uses `overflow: hidden` during animation
    - Always starts collapsed on load (not persisted)
    - Subtle micro-interactions: gentle pulse class on score change, soft glow on hover/tap (use ring's built-in glow)
    - Loading state: show skeleton placeholder (pulsing ring outline)
    - "Drill Weak Areas" CTA button below ring when collapsed: navigates to `/drill` (if any categories below 70%)

    ANTI-PATTERNS TO AVOID:
    - Do NOT use `useMemo<Type>()` syntax -- use `const x: Type = useMemo(() => ...)`
    - Do NOT use useRef for render-time values (React Compiler violation)
    - Do NOT persist expanded state to localStorage
    - Do NOT use `overflow: hidden` on `preserve-3d` elements
    - Do NOT animate to `height: 'auto'` directly -- use motion.div with `layout` prop or measure with ref and animate to pixel value
    - SVG gradient IDs: use useId() for unique gradient IDs if multiple ReadinessRing instances could coexist on page
  </action>
  <verify>
    <automated>cd /c/Users/minkk/GitHub/civic-test-2025 && pnpm build 2>&1 | tail -5</automated>
    <manual>Check that ReadinessHeroCard, DimensionBreakdown, CategoryDrillList, and useReadinessScore compile without type errors</manual>
  </verify>
  <done>useReadinessScore hook composes engine with IndexedDB data. ReadinessHeroCard shows main ring with gradient background. DimensionBreakdown shows 3 mini rings. CategoryDrillList shows 7 categories with drill buttons. All compile cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ReadinessHeroCard into Dashboard</name>
  <files>
    src/views/Dashboard.tsx
  </files>
  <action>
    Modify `src/views/Dashboard.tsx`:

    1. Import `useReadinessScore` from `@/hooks/useReadinessScore`
    2. Import `ReadinessHeroCard` from `@/components/readiness/ReadinessHeroCard`
    3. Add `useReadinessScore()` call in Dashboard component alongside existing hooks:
       ```
       const { readiness, isLoading: readinessLoading, subCategoryMasteries: readinessSubMasteries } = useReadinessScore();
       ```
    4. Add readinessLoading to isDashboardLoading check:
       ```
       const isDashboardLoading = authLoading || masteryLoading || streakLoading || srsLoading || practiceCountLoading || readinessLoading;
       ```
    5. Insert ReadinessHeroCard as the FIRST StaggeredItem in the main content (before unfinished session banners), making it the hero/centerpiece:
       ```tsx
       <StaggeredItem className="mb-6">
         <ReadinessHeroCard
           readiness={readiness}
           subCategoryMasteries={readinessSubMasteries ?? subCategoryMasteries}
           categoryMasteries={categoryMasteries}
           isLoading={readinessLoading}
           showBurmese={showBurmese}
         />
       </StaggeredItem>
       ```
    6. Keep all existing Dashboard cards intact (NBA, badges, stats, previews, etc.)
    7. Note: readiness hero card at top, then unfinished banners, then due card review, then NBA, then rest

    The ReadinessHeroCard handles its own 0% empty state, loading skeleton, and 60% cap warning internally.
  </action>
  <verify>
    <automated>cd /c/Users/minkk/GitHub/civic-test-2025 && pnpm build 2>&1 | tail -5</automated>
    <manual>Verify Dashboard.tsx imports and renders ReadinessHeroCard as first StaggeredItem</manual>
  </verify>
  <done>Dashboard shows ReadinessHeroCard as the hero card at the top. Loading state includes readiness. All existing Dashboard content preserved below the hero card. Build succeeds.</done>
</task>

</tasks>

<verification>
  <automated>cd /c/Users/minkk/GitHub/civic-test-2025 && pnpm build 2>&1 | tail -5 && pnpm test:run -- --reporter=verbose 2>&1 | tail -20</automated>
  <manual>Dashboard renders readiness hero card at top. Card expands to show dimension rings and category list. Categories below 70% show drill buttons. 60% cap warning displays when applicable.</manual>
</verification>

<success_criteria>
- ReadinessHeroCard is the first/hero card on Dashboard with radial ring (140px, 14px stroke)
- Ring animates fill from 0 with gradient red->amber->green
- 4-tier status labels appear correctly per user decisions
- Tap-to-expand shows 3 mini dimension rings (accuracy/coverage/consistency)
- Category list shows 7 sub-categories sorted by mastery ascending
- Drill buttons appear on categories below 70%
- 60% cap warning badge visible when score is capped
- 0% empty state shows encouraging text
- All text localized for Burmese
- Gradient background shifts with score tier
- Dark mode uses brighter/neon tones
- pnpm build succeeds
- All existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/43-test-readiness-score-and-drill-mode/43-02-SUMMARY.md`
</output>
