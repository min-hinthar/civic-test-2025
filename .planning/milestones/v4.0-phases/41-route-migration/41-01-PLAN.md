---
phase: 41-route-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(public)/page.tsx
  - app/(public)/auth/page.tsx
  - app/(public)/auth/forgot/page.tsx
  - app/(public)/auth/update-password/page.tsx
  - app/(public)/op-ed/page.tsx
  - app/(public)/about/page.tsx
  - app/(public)/error.tsx
  - app/(protected)/home/page.tsx
  - app/(protected)/hub/[[...tab]]/page.tsx
  - app/(protected)/hub/[[...tab]]/HubPageClient.tsx
  - app/(protected)/test/page.tsx
  - app/(protected)/study/page.tsx
  - app/(protected)/practice/page.tsx
  - app/(protected)/interview/page.tsx
  - app/(protected)/settings/page.tsx
  - app/(protected)/template.tsx
  - app/(protected)/loading.tsx
  - app/(protected)/error.tsx
  - app/not-found.tsx
  - app/error.tsx
  - next.config.mjs
autonomous: true
requirements:
  - MIGR-05
  - MIGR-08
  - MIGR-12

must_haves:
  truths:
    - "Every route has a corresponding page.tsx in the app/ directory"
    - "Protected routes get enter-only directional slide animation on navigation"
    - "Hub sub-routes work via catch-all with server redirect for bare /hub"
    - "Custom 404 page shows friendly message with link back"
    - "Old URL aliases permanently redirect to new canonical routes"
  artifacts:
    - path: "app/(public)/page.tsx"
      provides: "Landing page route wrapper"
    - path: "app/(protected)/home/page.tsx"
      provides: "Dashboard route wrapper"
    - path: "app/(protected)/hub/[[...tab]]/page.tsx"
      provides: "Hub catch-all with server redirect"
    - path: "app/(protected)/template.tsx"
      provides: "Enter-only page transition animation"
      min_lines: 25
    - path: "app/not-found.tsx"
      provides: "Custom 404 page"
    - path: "next.config.mjs"
      provides: "Permanent redirects for legacy URLs"
      contains: "redirects"
  key_links:
    - from: "app/(protected)/template.tsx"
      to: "src/components/navigation/navConfig.ts"
      via: "getSlideDirection import"
      pattern: "getSlideDirection"
    - from: "app/(protected)/hub/[[...tab]]/page.tsx"
      to: "app/(protected)/hub/[[...tab]]/HubPageClient.tsx"
      via: "server page imports client wrapper"
      pattern: "HubPageClient"
    - from: "next.config.mjs"
      to: "app/(protected)/home/page.tsx"
      via: "/dashboard -> /home redirect"
      pattern: "/dashboard.*destination.*home"
---

<objective>
Create the complete App Router route scaffolding: all page.tsx wrappers for public and protected routes, the enter-only page transition template, loading/error/not-found pages, hub catch-all with server redirect, and legacy URL redirects in next.config.mjs.

Purpose: Establish the file-based routing structure that all subsequent migration plans wire into. No existing files are modified except next.config.mjs (adding redirects).
Output: ~20 new files forming the complete route tree, plus config changes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/41-route-migration/41-CONTEXT.md
@.planning/phases/41-route-migration/41-RESEARCH.md
@.planning/phases/41-route-migration/41-INTEGRATION-MAP.md
@app/layout.tsx
@app/(protected)/layout.tsx
@src/components/navigation/navConfig.ts
@src/lib/motion-config.ts
@next.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create public route pages, not-found, and error boundaries</name>
  <files>
    app/(public)/page.tsx
    app/(public)/auth/page.tsx
    app/(public)/auth/forgot/page.tsx
    app/(public)/auth/update-password/page.tsx
    app/(public)/op-ed/page.tsx
    app/(public)/about/page.tsx
    app/(public)/error.tsx
    app/not-found.tsx
    app/error.tsx
  </files>
  <action>
Create thin `'use client'` page wrappers for all 6 public routes. Each page.tsx imports the existing component from `src/pages/` and renders it.

Pattern for each public page (example for landing):
```tsx
'use client';
import LandingPage from '@/pages/LandingPage';
export default function Landing() { return <LandingPage />; }
```

Route-to-component mapping:
- `app/(public)/page.tsx` -> `LandingPage` from `@/pages/LandingPage`
- `app/(public)/auth/page.tsx` -> `AuthPage` from `@/pages/AuthPage`
- `app/(public)/auth/forgot/page.tsx` -> `PasswordResetPage` from `@/pages/PasswordResetPage`
- `app/(public)/auth/update-password/page.tsx` -> `PasswordUpdatePage` from `@/pages/PasswordUpdatePage`
- `app/(public)/op-ed/page.tsx` -> `OpEdPage` from `@/pages/OpEdPage`
- `app/(public)/about/page.tsx` -> `AboutPage` from `@/pages/AboutPage`

Create `app/(public)/error.tsx`:
```tsx
'use client';
export default function PublicError({ error, reset }: { error: Error & { digest?: string }; reset: () => void }) {
  return (
    <div className="flex min-h-screen flex-col items-center justify-center bg-background p-4 text-center">
      <h2 className="mb-4 text-xl font-semibold text-foreground">Something went wrong</h2>
      <p className="mb-6 text-secondary">{error.message || 'An unexpected error occurred.'}</p>
      <button onClick={reset} className="rounded-lg bg-primary px-4 py-2 text-white hover:bg-primary/90">
        Try Again
      </button>
    </div>
  );
}
```

Create `app/error.tsx` (root-level error boundary, similar to public but with Sentry reporting):
```tsx
'use client';
import * as Sentry from '@sentry/nextjs';
import { useEffect } from 'react';

export default function RootError({ error, reset }: { error: Error & { digest?: string }; reset: () => void }) {
  useEffect(() => { Sentry.captureException(error); }, [error]);
  return (
    <div className="flex min-h-screen flex-col items-center justify-center bg-background p-4 text-center">
      <h2 className="mb-4 text-xl font-semibold text-foreground">Something went wrong</h2>
      <p className="mb-6 text-secondary">{error.message || 'An unexpected error occurred.'}</p>
      <button onClick={reset} className="rounded-lg bg-primary px-4 py-2 text-white hover:bg-primary/90">
        Try Again
      </button>
    </div>
  );
}
```

Create `app/not-found.tsx` (custom 404 per user decision):
```tsx
import Link from 'next/link';

export default function NotFound() {
  return (
    <div className="flex min-h-screen flex-col items-center justify-center bg-background p-4 text-center">
      <h1 className="mb-2 text-6xl font-bold text-primary">404</h1>
      <h2 className="mb-4 text-xl font-semibold text-foreground">Page Not Found</h2>
      <p className="mb-6 text-secondary">The page you are looking for does not exist or has been moved.</p>
      <Link href="/" className="rounded-lg bg-primary px-6 py-3 text-white hover:bg-primary/90">
        Go Home
      </Link>
    </div>
  );
}
```

Wire into: Each page.tsx is automatically discovered by Next.js App Router via file conventions. No manual registration needed.
  </action>
  <verify>
    <automated>cd C:/Users/minkk/OneDrive/Documents/GitHub/civic-test-2025 && pnpm typecheck</automated>
    <manual>Verify each file exists in the correct directory structure</manual>
  </verify>
  <done>All 6 public route page.tsx files exist and import correct components, error.tsx exists at root and public group level, not-found.tsx shows friendly 404 with link home, typecheck passes.</done>
</task>

<task type="auto">
  <name>Task 2: Create protected route pages, template.tsx, loading.tsx, hub catch-all, and next.config redirects</name>
  <files>
    app/(protected)/home/page.tsx
    app/(protected)/hub/[[...tab]]/page.tsx
    app/(protected)/hub/[[...tab]]/HubPageClient.tsx
    app/(protected)/test/page.tsx
    app/(protected)/study/page.tsx
    app/(protected)/practice/page.tsx
    app/(protected)/interview/page.tsx
    app/(protected)/settings/page.tsx
    app/(protected)/template.tsx
    app/(protected)/loading.tsx
    app/(protected)/error.tsx
    next.config.mjs
  </files>
  <action>
Create thin `'use client'` page wrappers for 7 protected routes (all except hub):

Pattern (example for Dashboard):
```tsx
'use client';
import Dashboard from '@/pages/Dashboard';
export default function HomePage() { return <Dashboard />; }
```

Route-to-component mapping:
- `app/(protected)/home/page.tsx` -> `Dashboard` from `@/pages/Dashboard`
- `app/(protected)/test/page.tsx` -> `TestPage` from `@/pages/TestPage`
- `app/(protected)/study/page.tsx` -> `StudyGuidePage` from `@/pages/StudyGuidePage`
- `app/(protected)/practice/page.tsx` -> `PracticePage` from `@/pages/PracticePage`
- `app/(protected)/interview/page.tsx` -> `InterviewPage` from `@/pages/InterviewPage`
- `app/(protected)/settings/page.tsx` -> `SettingsPage` from `@/pages/SettingsPage`

Create hub catch-all with server redirect. CRITICAL: Next.js 16 `params` is a Promise -- must await.

`app/(protected)/hub/[[...tab]]/page.tsx` (Server Component -- NOT 'use client'):
```tsx
import { redirect } from 'next/navigation';
import HubPageClient from './HubPageClient';

export default async function HubPage({
  params,
}: {
  params: Promise<{ tab?: string[] }>;
}) {
  const { tab } = await params;

  if (!tab || tab.length === 0) {
    redirect('/hub/overview');
  }

  return <HubPageClient initialTab={tab[0]} />;
}
```

`app/(protected)/hub/[[...tab]]/HubPageClient.tsx`:
```tsx
'use client';
import HubPage from '@/pages/HubPage';

export default function HubPageClient({ initialTab }: { initialTab: string }) {
  return <HubPage initialTab={initialTab} />;
}
```

Wire into: HubPage component in `src/pages/HubPage.tsx` will need to accept `initialTab` prop in Plan 03/04 when its imports are migrated.

Create `app/(protected)/template.tsx` (enter-only page transition per user decision):
- Import `usePathname` from `next/navigation`
- Import `motion` from `motion/react`
- Import `getSlideDirection` from `@/components/navigation/navConfig`
- Import appropriate spring config from `@/lib/motion-config` (use SPRING_SNAPPY or a slightly softer spring -- Claude's discretion per user decision)
- Import/create a reduced motion check
- Read previous path from `sessionStorage` key `'civic-prev-pathname'` (default to `'/home'`)
- Compute direction using `getSlideDirection(prevPath, pathname)`
- Store current pathname in sessionStorage
- If reduced motion preferred, render children without animation
- Otherwise render `<motion.div>` with `initial={{ opacity: 0, x: direction === 'left' ? 30 : -30 }}` and `animate={{ opacity: 1, x: 0 }}` with spring transition
- Do NOT use `key={pathname}` (template.tsx already remounts on navigation -- adding key is redundant)
- Do NOT use AnimatePresence (no exit animation in App Router)
- Do NOT add `scale` to animation (keep it subtle for enter-only)

Create `app/(protected)/loading.tsx` (minimal spinner matching auth guard style):
```tsx
export default function ProtectedLoading() {
  return (
    <div className="flex min-h-screen items-center justify-center bg-background">
      <div className="h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent" />
    </div>
  );
}
```

Create `app/(protected)/error.tsx` (same pattern as public error with Sentry):
```tsx
'use client';
import * as Sentry from '@sentry/nextjs';
import { useEffect } from 'react';

export default function ProtectedError({ error, reset }: { error: Error & { digest?: string }; reset: () => void }) {
  useEffect(() => { Sentry.captureException(error); }, [error]);
  return (
    <div className="flex min-h-screen flex-col items-center justify-center bg-background p-4 text-center">
      <h2 className="mb-4 text-xl font-semibold text-foreground">Something went wrong</h2>
      <p className="mb-6 text-secondary">{error.message || 'An unexpected error occurred.'}</p>
      <button onClick={reset} className="rounded-lg bg-primary px-4 py-2 text-white hover:bg-primary/90">
        Try Again
      </button>
    </div>
  );
}
```

Add permanent redirects to `next.config.mjs`. Add an `async redirects()` function to the `nextConfig` object:
```js
async redirects() {
  return [
    { source: '/dashboard', destination: '/home', permanent: true },
    { source: '/progress', destination: '/hub/overview', permanent: true },
    { source: '/history', destination: '/hub/history', permanent: true },
    { source: '/social', destination: '/hub/achievements', permanent: true },
  ];
},
```
Place it after the existing `async headers()` block.
  </action>
  <verify>
    <automated>cd C:/Users/minkk/OneDrive/Documents/GitHub/civic-test-2025 && pnpm typecheck && pnpm build --webpack 2>&1 | tail -20</automated>
    <manual>Verify template.tsx has motion animation with sessionStorage direction tracking</manual>
  </verify>
  <done>All 7 protected page.tsx wrappers exist, hub catch-all correctly awaits async params and redirects bare /hub, template.tsx implements enter-only slide animation using getSlideDirection + sessionStorage, loading.tsx shows minimal spinner, error.tsx exists for protected group, next.config.mjs has 4 permanent redirects. Build passes.</done>
</task>

</tasks>

<verification>
- `pnpm typecheck` passes (no import errors in new files)
- `pnpm build --webpack` succeeds (validates all route files compile)
- All page.tsx files exist in correct directory structure
- Hub catch-all has async params handling
- Template.tsx uses sessionStorage for direction tracking
- next.config.mjs includes redirect rules
</verification>

<success_criteria>
- 15 page.tsx files exist (6 public + 7 protected + hub server page + hub client wrapper)
- template.tsx, loading.tsx, error.tsx (x3), not-found.tsx all created
- next.config.mjs has 4 permanent redirects
- `pnpm build --webpack` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/41-route-migration/41-01-SUMMARY.md`
</output>
