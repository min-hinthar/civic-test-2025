---
phase: 24-accessibility-performance
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/quiz/StreakReward.tsx
  - src/components/quiz/XPPopup.tsx
  - src/components/sort/SortModeContainer.tsx
  - src/styles/tokens.css
  - src/components/layout/NavigationShell.tsx
autonomous: true

must_haves:
  truths:
    - "Streak/XP celebrations are announced to screen readers via ARIA live regions"
    - "High contrast mode (prefers-contrast: more) increases contrast on muted text, borders, and disabled states"
    - "Skip-to-content link is available as the first focusable element"
    - "Focus moves to feedback panel after Check and to next question area after Continue"
  artifacts:
    - path: "src/components/quiz/StreakReward.tsx"
      provides: "Screen reader announcement for streak milestones"
      contains: "aria-live"
    - path: "src/styles/tokens.css"
      provides: "High contrast mode token overrides"
      contains: "prefers-contrast"
    - path: "src/components/layout/NavigationShell.tsx"
      provides: "Skip-to-content link"
      contains: "skip-to-content"
  key_links:
    - from: "src/components/quiz/StreakReward.tsx"
      to: "screen reader"
      via: "aria-live polite region"
      pattern: "aria-live.*polite"
---

<objective>
Add celebration announcements for screen readers, implement high contrast mode support, add skip-to-content link, and verify focus management in quiz flow.

Purpose: Ensure celebrations are perceivable by screen reader users (locked decision), support high contrast mode (A11Y-07), and improve navigation (A11Y-02).
Output: StreakReward/XPPopup with sr announcements, tokens.css with high-contrast overrides, NavigationShell with skip link, verified focus flow.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@src/components/quiz/StreakReward.tsx
@src/components/quiz/XPPopup.tsx
@src/components/sort/SortModeContainer.tsx
@src/styles/tokens.css
@src/components/layout/NavigationShell.tsx
@src/components/quiz/FeedbackPanel.tsx
@.planning/phases/24-accessibility-performance/24-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Celebration announcements + skip-to-content link</name>
  <files>src/components/quiz/StreakReward.tsx, src/components/quiz/XPPopup.tsx, src/components/sort/SortModeContainer.tsx, src/components/layout/NavigationShell.tsx</files>
  <action>
    **StreakReward (locked decision: celebrations MUST be announced):**

    1. Add a sr-only `aria-live="polite"` div (always in DOM) that announces streak milestones:
       - `"{streakCount} correct in a row!"` when visible
       - Empty string when hidden
    2. The visual animation can remain as-is -- the sr-only div is the announcement channel.

    **XPPopup (locked decision: celebrations MUST be announced):**

    1. Add sr-only `aria-live="polite"` text: `"+{xp} XP earned"` when visible.
    2. Same pattern: persistent div, content toggled by visibility state.

    **SortModeContainer (Claude's discretion: sort result announcement):**

    1. The sort mode already has sr-only announcement divs. Verify they announce:
       - Round completion: `"Round complete. {knownCount} correct, {unknownCount} to study."`
       - Card sort result: `"Sorted as Know"` / `"Sorted as Don't Know"`
    2. If not present, add them. If already there, just verify and move on.

    **Skip-to-Content Link (Claude's discretion: add one):**

    1. In `NavigationShell.tsx` (or the outermost layout component), add as the FIRST child:
       ```tsx
       <a
         href="#main-content"
         className="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-[9999] focus:rounded-lg focus:bg-primary focus:px-4 focus:py-2 focus:text-white focus:shadow-lg"
       >
         Skip to content
       </a>
       ```
    2. Add `id="main-content"` and `tabIndex={-1}` to the main content container (the element after the navigation).
    3. This is standard a11y practice for SPAs -- minimal effort, zero risk.
  </action>
  <verify>
    - `pnpm run typecheck` passes
    - `pnpm run lint` passes
    - Grep for `aria-live` in StreakReward.tsx and XPPopup.tsx confirms announcements
    - Grep for `skip-to-content` or `Skip to content` in NavigationShell
  </verify>
  <done>Streak/XP celebrations announced to screen readers. Skip-to-content link available. Sort results announced.</done>
</task>

<task type="auto">
  <name>Task 2: High contrast mode + focus management audit</name>
  <files>src/styles/tokens.css, src/components/quiz/FeedbackPanel.tsx</files>
  <action>
    **High Contrast Mode (A11Y-07, prefers-contrast: more):**

    1. Add to `tokens.css` at the bottom, after existing `:root` and `.dark` blocks:
       ```css
       @media (prefers-contrast: more) {
         :root {
           --color-text-secondary: var(--slate-600);
           --color-text-tertiary: var(--slate-500);
           --color-border: var(--slate-400);
           --color-muted-foreground: var(--slate-600);
         }
         .dark {
           --color-text-secondary: var(--slate-200);
           --color-text-tertiary: var(--slate-300);
           --color-border: var(--slate-400);
           --color-muted-foreground: var(--slate-300);
         }
       }
       ```
    2. Check that the CSS variable names match what's actually in tokens.css (the research used example names). Use the ACTUAL token names from the file.
    3. This is a spot-check approach per locked decision -- audit known problem areas (muted text, disabled states) and override at the token level.
    4. Verify disabled buttons are distinguishable in high contrast (check common disabled patterns like `opacity-50 cursor-not-allowed`).

    **Focus Management (A11Y-02):**

    1. Verify FeedbackPanel auto-focuses the Continue button when `show` becomes true. The existing code already does this with `preventScroll: true` (confirmed in Phase 21 summary).
    2. After Continue is pressed (CONTINUE dispatch), verify focus moves to the next question's answer options or the question area. If focus is NOT managed after Continue, add a focus call:
       - In the quiz flow (TestPage/PracticeSession), after advancing to the next question, focus the first answer option or the question heading.
       - Use a ref on the question container and call `ref.current?.focus({ preventScroll: true })` after state update.
    3. Also verify: after Check is pressed, focus moves to the feedback panel (the Continue button auto-focus handles this).
    4. Check keyboard trap: Tab should NOT get trapped inside FeedbackPanel when it slides up. Verify Tab moves naturally between panel and rest of page.
  </action>
  <verify>
    - `pnpm run typecheck` passes
    - `pnpm run lint` passes
    - Grep for `prefers-contrast` in tokens.css confirms high contrast overrides
    - Manual: verify focus flow by reading the code paths after CHECK and CONTINUE dispatches
  </verify>
  <done>High contrast mode supported via token overrides. Focus moves to feedback after Check and to next question after Continue.</done>
</task>

</tasks>

<verification>
- `pnpm run typecheck` passes
- `pnpm run lint` passes
- `pnpm test:run` passes (no regressions)
- StreakReward and XPPopup have sr-only live regions
- tokens.css has prefers-contrast: more media query
- NavigationShell has skip-to-content link
- Focus management verified in quiz flow
</verification>

<success_criteria>
- Celebrations announced to screen readers via ARIA live regions
- High contrast mode increases contrast on muted text and borders
- Skip-to-content link is the first focusable element
- Focus moves programmatically after Check (to feedback) and Continue (to next question)
</success_criteria>

<output>
After completion, create `.planning/phases/24-accessibility-performance/24-03-SUMMARY.md`
</output>
