---
phase: 04-learning-explanations-category-progress
plan: 05
type: execute
wave: 3
depends_on: ["04-01", "04-03"]
files_modified:
  - src/pages/StudyGuidePage.tsx
  - src/components/study/FlashcardStack.tsx
autonomous: true

must_haves:
  truths:
    - "User sees expandable explanation below flashcard answer on the back of the card"
    - "Explanation is collapsed by default (tap to expand) to reduce visual clutter"
    - "Explanation content is bilingual with English on top, Burmese below"
  artifacts:
    - path: "src/pages/StudyGuidePage.tsx"
      provides: "Study guide with explanation integration on flip cards"
      contains: "ExplanationCard"
    - path: "src/components/study/FlashcardStack.tsx"
      provides: "Flashcard stack with explanation support"
  key_links:
    - from: "src/pages/StudyGuidePage.tsx"
      to: "src/components/explanations/ExplanationCard.tsx"
      via: "ExplanationCard import for flip card back"
      pattern: "ExplanationCard"
---

<objective>
Add expandable explanation sections to study guide flashcards, both in the individual flip-card view and the FlashcardStack swipeable view.

Purpose: Users can understand WHY answers are correct while studying, reinforcing learning beyond simple memorization. Per CONTEXT.md: "Expandable below answer - answer shows first, tap to expand explanation (less visual clutter)."

Output: Study guide flashcards with expandable bilingual explanations on the back/answer side.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-learning-explanations-category-progress/04-CONTEXT.md
@src/pages/StudyGuidePage.tsx
@src/components/study/FlashcardStack.tsx
@src/components/explanations/ExplanationCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add explanations to flip-card grid view in StudyGuidePage</name>
  <files>src/pages/StudyGuidePage.tsx</files>
  <action>
    In StudyGuidePage.tsx, find both flip-card rendering sections (category detail view and legacy flip-card grid view). For each flip card's BACK side (the answer side), add an expandable ExplanationCard below the answer list.

    1. **Import ExplanationCard:**
       ```typescript
       import { ExplanationCard } from '@/components/explanations/ExplanationCard';
       ```

    2. **Category detail view flip cards** (around line 253-290):
       - After the `<ul>` of study answers on the card back, add:
       ```tsx
       {question.explanation && (
         <div className="mt-3 pt-3 border-t border-white/20">
           <ExplanationCard
             explanation={question.explanation}
             defaultExpanded={false}
             className="bg-black/10 border-white/20 text-white [&_*]:text-white [&_.text-muted-foreground]:text-white/70"
           />
         </div>
       )}
       ```
       - Note: The card back uses gradient background with white text, so ExplanationCard needs color overrides to be visible on dark gradient backgrounds. Use CSS overrides via className.

    3. **Legacy flip-card grid view** (around line 430-470):
       - Same treatment: add ExplanationCard after the answer list on the card back
       - Same styling overrides for dark gradient background

    4. **Ensure ExplanationCard on dark backgrounds is readable:**
       - The trigger "Why?" text should be white/high contrast
       - Expanded content should have white text on semi-transparent dark background
       - If needed, add a `variant="dark"` prop to ExplanationCard and handle in the component (or use CSS overrides via className as shown above)
  </action>
  <verify>
    `npx tsc --noEmit` passes. Navigate to study guide, flip a card, see explanation section below answers. Explanation is collapsed by default and expands on tap.
  </verify>
  <done>
    Both flip-card views in StudyGuidePage show expandable ExplanationCard on the back of each card. Explanation text is readable on gradient backgrounds. Collapsed by default, expands on tap.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add explanations to FlashcardStack swipeable view</name>
  <files>src/components/study/FlashcardStack.tsx</files>
  <action>
    Read the FlashcardStack component to understand its structure, then add explanation support:

    1. **Import ExplanationCard:**
       ```typescript
       import { ExplanationCard } from '@/components/explanations/ExplanationCard';
       ```

    2. **On the card back/answer side:**
       - After the answers section, add ExplanationCard
       - Follow the same pattern as StudyGuidePage: expandable below answer, collapsed by default
       - Apply dark-background color overrides

    3. **Ensure explanation doesn't interfere with swipe gesture:**
       - The ExplanationCard should handle click/tap events WITHOUT triggering a swipe
       - Use `onClick={(e) => e.stopPropagation()}` on the ExplanationCard wrapper if swipe detection is on the parent
       - The expand/collapse should work independently of the card flip/swipe interaction
  </action>
  <verify>
    `npx tsc --noEmit` passes. In FlashcardStack, swiping to back of card shows answer + explanation section. Expanding explanation doesn't trigger swipe. Collapsing works correctly.
  </verify>
  <done>
    FlashcardStack swipeable cards show expandable ExplanationCard on back. Explanation expansion doesn't interfere with swipe gestures. Bilingual content displays correctly.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Study guide flip cards show explanation on back (both category and legacy views)
3. FlashcardStack cards show explanation on back
4. Explanation collapsed by default, expands on tap
5. Text readable on dark gradient card backgrounds
6. Explanation expansion doesn't break card flip or swipe gestures
</verification>

<success_criteria>
- Explanation visible on back of every flip card that has explanation data
- Collapsed by default (per CONTEXT.md: "less visual clutter")
- Bilingual content with EN on top, MY below
- No interference with card flip or swipe interactions
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-learning-explanations-category-progress/04-05-SUMMARY.md`
</output>
