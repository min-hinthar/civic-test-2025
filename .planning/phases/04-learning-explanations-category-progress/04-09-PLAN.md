---
phase: 04-learning-explanations-category-progress
plan: 09
type: execute
wave: 5
depends_on: ["04-07", "04-08"]
files_modified:
  - src/components/nudges/SuggestedFocus.tsx
  - src/components/nudges/WeakAreaNudge.tsx
  - src/components/nudges/StudyGuideHighlight.tsx
  - src/pages/Dashboard.tsx
  - src/pages/TestPage.tsx
  - src/pages/StudyGuidePage.tsx
  - src/pages/HistoryPage.tsx
  - src/lib/mastery/nudgeMessages.ts
  - pages/api/push/weak-area-nudge.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard shows 'Suggested Focus' section with weak categories and quick-start buttons"
    - "Each weak category shows mastery % + 'Practice Now' button + 'Review in Study Guide' link"
    - "When all categories above threshold, 'Level up' mode shows category closest to next milestone"
    - "Nudge messages vary and rotate through different encouraging phrases (bilingual)"
    - "Study guide categories show mastery badges on headers"
    - "Individual wrong-answer questions marked in study guide (orange dot or similar)"
    - "Post-test results show weak area nudge"
    - "History page has 'Practice Sessions' tab separate from regular tests"
    - "Push notifications target weak/stale areas every 2-3 days"
    - "Unattempted categories show 'Not started' distinct from weak categories"
  artifacts:
    - path: "src/components/nudges/SuggestedFocus.tsx"
      provides: "Dashboard section with weak area cards and quick-start buttons"
      exports: ["SuggestedFocus"]
    - path: "src/components/nudges/WeakAreaNudge.tsx"
      provides: "Individual weak area nudge component"
      exports: ["WeakAreaNudge"]
    - path: "src/components/nudges/StudyGuideHighlight.tsx"
      provides: "Study guide category header badge and question mark components"
      exports: ["CategoryHeaderBadge", "QuestionAccuracyDot"]
    - path: "src/lib/mastery/nudgeMessages.ts"
      provides: "Pool of rotating bilingual encouragement messages"
      exports: ["getEncouragingMessage", "getNudgeMessage", "getLevelUpMessage"]
    - path: "pages/api/push/weak-area-nudge.ts"
      provides: "Push notification endpoint for weak area reminders"
      exports: ["default"]
  key_links:
    - from: "src/pages/Dashboard.tsx"
      to: "src/components/nudges/SuggestedFocus.tsx"
      via: "SuggestedFocus component import"
      pattern: "SuggestedFocus"
    - from: "src/pages/StudyGuidePage.tsx"
      to: "src/components/nudges/StudyGuideHighlight.tsx"
      via: "CategoryHeaderBadge and QuestionAccuracyDot imports"
      pattern: "CategoryHeaderBadge|QuestionAccuracyDot"
    - from: "src/pages/HistoryPage.tsx"
      to: "practice sessions tab"
      via: "Tab filtering for sessionType"
      pattern: "Practice Sessions"
---

<objective>
Build the weak area detection system, nudge components, study guide highlighting, history practice tab, and push notification nudges — tying the entire Phase 4 learning system together.

Purpose: This is the "intelligence" layer that guides users toward their weakest areas with warm, encouraging bilingual nudges. Per CONTEXT.md: "Dedicated 'Suggested Focus' section with weak areas + quick-start buttons."

Output: Dashboard SuggestedFocus section, study guide mastery highlighting, post-test nudges, history practice sessions tab, and push notification nudge endpoint.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-learning-explanations-category-progress/04-CONTEXT.md
@src/pages/Dashboard.tsx
@src/pages/TestPage.tsx
@src/pages/StudyGuidePage.tsx
@src/pages/HistoryPage.tsx
@src/lib/mastery/weakAreaDetection.ts
@src/hooks/useCategoryMastery.ts
@src/lib/mastery/categoryMapping.ts
@pages/api/push/send.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create nudge components, messages pool, and integrate into Dashboard and post-test</name>
  <files>
    src/components/nudges/SuggestedFocus.tsx,
    src/components/nudges/WeakAreaNudge.tsx,
    src/lib/mastery/nudgeMessages.ts,
    src/pages/Dashboard.tsx,
    src/pages/TestPage.tsx
  </files>
  <action>
    1. **nudgeMessages.ts** - Pool of rotating bilingual messages:
       - `getEncouragingMessage(): BilingualString` - returns random encouraging phrase
         - Pool of 10+ messages like:
           - { en: "You're improving!", my: "သင်တိုးတက်နေပါတယ်!" }
           - { en: "Keep going, you've got this!", my: "ဆက်လုပ်ပါ၊ သင်တတ်နိုင်ပါတယ်!" }
           - { en: "Every question brings you closer!", my: "မေးခွန်းတိုင်း သင့်ကိုပိုနီးကပ်စေပါတယ်!" }
           - { en: "Great effort!", my: "ကြိုးစားမှု ကောင်းပါတယ်!" }
         - Note: User requested emoji in nudge tone. Include relevant emoji per message.
       - `getNudgeMessage(category: string, mastery: number): BilingualString` - category-specific nudge
         - e.g., { en: "American History needs attention - 45% mastery", my: "အမေရိကန်သမိုင်း အာရုံစိုက်ရန်လိုပါတယ် - ၄၅% ကျွမ်းကျင်မှု" }
       - `getLevelUpMessage(category: string, currentMastery: number, nextTarget: number): BilingualString`
         - e.g., { en: "72% — push to silver (75%)!", my: "၇၂% — ငွေတံဆိပ်ရန် (၇၅%) ကြိုးစားပါ!" }
       - `getUnattemptedMessage(category: string): BilingualString`
         - e.g., { en: "Haven't started American History yet — give it a try!", my: "..." }
       - Messages should be warm, supportive, study-buddy tone (per CONTEXT.md)

    2. **WeakAreaNudge.tsx** - Individual nudge card:
       - Props: `category: string`, `mastery: number`, `isUnattempted: boolean`, `onPractice: () => void`, `onReview: () => void`
       - Shows: category name (bilingual), mastery % or "Not started", encouraging message
       - Buttons: "Practice Now / ယခုလေ့ကျင့်ပါ" + "Review in Study Guide / လေ့လာမှုအညွှန်းတွင်ပြန်ကြည့်ပါ"
       - Distinct styling for unattempted (neutral, inviting) vs weak (orange accent, encouraging)
       - Min 44px touch targets

    3. **SuggestedFocus.tsx** - Dashboard section:
       - Props: `categoryMasteries: Record<string, number>`, `answerHistory: StoredAnswer[]`
       - Uses detectWeakAreas and detectStaleCategories from weakAreaDetection
       - **Normal mode (has weak areas):** Shows top 2-3 weak/stale categories as WeakAreaNudge cards
       - **Level-up mode (all above threshold):** Shows category closest to next milestone with getLevelUpMessage
       - Smart rotation: prioritize stale categories (not practiced recently) even if not absolute weakest
       - Section header: "Suggested Focus / အကြံပြုလေ့လာရန်" with lightbulb icon
       - Rotating encouraging message at top of section
       - "Practice All Weak Areas" button when multiple weak categories exist

    4. **Dashboard integration:**
       - Add SuggestedFocus section below the Category Progress section
       - Pass categoryMasteries from useCategoryMastery
       - Wire onPractice to navigate to /practice?category=X
       - Wire onReview to navigate to /study#category-X

    5. **Post-test weak area nudge in TestPage:**
       - After test results are shown (resultView), add a subtle section below:
       - Import detectWeakAreas, useCategoryMastery
       - If weak areas exist, show 1-2 WeakAreaNudge cards with message: "Based on this test, consider reviewing..."
       - Use FadeIn animation for the nudge section
       - Place below the result cards list, above action buttons (Claude's discretion on exact placement)
  </action>
  <verify>
    `npx tsc --noEmit` passes. Dashboard shows SuggestedFocus with weak area cards. Post-test shows weak area nudge. Messages rotate with variety.
  </verify>
  <done>
    SuggestedFocus section on Dashboard shows weak/stale categories with encouraging bilingual messages and quick-start buttons. Level-up mode activates when all categories are above threshold. Post-test results show weak area nudge. Message pool provides variety. Unattempted categories show "Not started" with inviting tone.
  </done>
</task>

<task type="auto">
  <name>Task 2: Study guide highlighting, history practice tab, and push notification nudge</name>
  <files>
    src/components/nudges/StudyGuideHighlight.tsx,
    src/pages/StudyGuidePage.tsx,
    src/pages/HistoryPage.tsx,
    pages/api/push/weak-area-nudge.ts
  </files>
  <action>
    1. **StudyGuideHighlight.tsx** - Badge and dot components:
       - `CategoryHeaderBadge`: Shows MasteryBadge (bronze/silver/gold) next to category headers in study guide
         - Props: `category: string` - looks up mastery from useCategoryMastery
         - Shows badge + mastery percentage next to category name
       - `QuestionAccuracyDot`: Small indicator dot on individual questions
         - Props: `questionId: string`
         - Uses answer history to show: green dot (always correct), orange dot (ever incorrect), no dot (unattempted)
         - Claude's discretion on persistence: show based on most recent answer or overall accuracy

    2. **StudyGuidePage integration:**
       - Import CategoryHeaderBadge and QuestionAccuracyDot
       - **Category overview page:** Next to each category card, show CategoryHeaderBadge with mastery %
       - **Category detail view:** Next to each question (flip card), show QuestionAccuracyDot
       - **Cards view (FlashcardStack):** QuestionAccuracyDot visible on front of card

    3. **HistoryPage - Practice Sessions tab:**
       - Per CONTEXT.md: "Practice sessions tracked in separate 'Practice Sessions' tab on history page"
       - Add tab system at top of HistoryPage: "Tests" (default) | "Practice Sessions"
       - Tests tab: existing test history (no changes)
       - Practice Sessions tab: shows practice session history from masteryStore
         - Requires new function in masteryStore: `getPracticeSessions(): Promise<PracticeSession[]>`
         - Or extract practice data from answer history grouped by session timestamp
         - Each practice session shows: date, category, score, question count
         - Expandable to show individual question results
       - Use bilingual tab labels from strings.practice.practiceSessions

    4. **Push notification nudge endpoint:**
       - Create `pages/api/push/weak-area-nudge.ts` (Next.js API route, matching existing push pattern from Phase 2)
       - Read existing push infrastructure from `pages/api/push/send.ts`
       - Endpoint: POST /api/push/weak-area-nudge
       - Body: `{ userId: string, weakCategory: string, daysSinceStudied: number }`
       - Generates bilingual push message targeting weak/stale area:
         - Title: "Time to study! / လေ့လာရန်အချိန်ပါ!"
         - Body: "You haven't practiced [category] in [X] days. / [category]ကို [X] ရက်ကတည်းက မလေ့ကျင့်ရသေးပါ"
       - Uses existing web-push infrastructure (vapidKeys, etc.)
       - Per CONTEXT.md: "Every 2-3 days, only if user hasn't studied recently"
       - Note: This just creates the endpoint. Scheduling (cron) would be a future enhancement.
  </action>
  <verify>
    `npx tsc --noEmit` passes. Study guide shows mastery badges on category headers and accuracy dots on questions. History page has Practice Sessions tab. Push endpoint responds to POST.
  </verify>
  <done>
    Study guide categories show mastery badges and individual questions show accuracy dots. History page has "Tests" and "Practice Sessions" tabs. Push notification endpoint created for weak area reminders. All text bilingual.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Dashboard SuggestedFocus section shows weak areas with quick-start buttons
3. Level-up mode activates when all categories above threshold
4. Study guide categories show mastery badges
5. Individual questions show accuracy dots (green/orange/none)
6. History page has Practice Sessions tab
7. Post-test results show weak area nudge section
8. Push notification endpoint functional
9. All nudge messages bilingual with encouraging tone
10. Unattempted vs weak categories have distinct treatment
</verification>

<success_criteria>
- Dashboard has SuggestedFocus section with smart weak area recommendations
- Study guide has mastery badges on category headers and accuracy dots on questions
- History page separates tests and practice sessions
- Post-test shows contextual weak area nudge
- Push notification endpoint created for weak area reminders
- Nudge messages rotate with variety, warm tone, bilingual
- Level-up mode works when all categories mastered
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-learning-explanations-category-progress/04-09-SUMMARY.md`
</output>
