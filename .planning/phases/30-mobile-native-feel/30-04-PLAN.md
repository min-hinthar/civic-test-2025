---
phase: 30-mobile-native-feel
plan: 04
type: execute
wave: 2
depends_on: ["30-02"]
files_modified:
  - src/components/navigation/NavItem.tsx
  - src/components/navigation/BottomTabBar.tsx
  - src/components/navigation/Sidebar.tsx
  - src/components/ui/FlagToggle.tsx
  - src/components/ui/SpeechButton.tsx
  - src/components/ui/BurmeseSpeechButton.tsx
  - src/components/social/ShareButton.tsx
  - src/components/social/BadgeCelebration.tsx
  - src/components/quiz/FeedbackPanel.tsx
  - src/components/quiz/StreakReward.tsx
  - src/components/interview/LongPressButton.tsx
  - src/components/sessions/UnfinishedBanner.tsx
  - src/components/study/Flashcard3D.tsx
  - src/components/interview/InterviewSession.tsx
autonomous: true
requirements:
  - MOBI-06

must_haves:
  truths:
    - "Every button tap, toggle switch, and navigation tap fires a light haptic (10ms)"
    - "Card flips, answer grading, and mic start/stop fire a medium haptic (20ms)"
    - "Streak rewards, badge celebrations, and milestone events fire a heavy multi-burst haptic"
    - "TTS speak button fires light haptic on press"
    - "Share button fires light on tap and medium on success (copy/share confirmed)"
    - "All inline navigator.vibrate() calls are migrated to haptics.ts functions"
    - "Navigation taps in BottomTabBar and Sidebar fire light haptic"
    - "Toggle switches (FlagToggle, theme toggle) fire light haptic on tap"
  artifacts:
    - path: "src/components/navigation/NavItem.tsx"
      provides: "Light haptic on nav item tap"
      contains: "hapticLight"
    - path: "src/components/ui/FlagToggle.tsx"
      provides: "Light haptic replacing inline navigator.vibrate(10)"
      contains: "hapticLight"
    - path: "src/components/social/BadgeCelebration.tsx"
      provides: "Heavy haptic on badge celebration"
      contains: "hapticHeavy"
    - path: "src/components/quiz/StreakReward.tsx"
      provides: "Heavy haptic on streak reward"
      contains: "hapticHeavy"
  key_links:
    - from: "src/components/navigation/NavItem.tsx"
      to: "src/lib/haptics.ts"
      via: "hapticLight import and call in click handler"
      pattern: "import.*hapticLight.*from.*haptics"
    - from: "src/components/social/BadgeCelebration.tsx"
      to: "src/lib/haptics.ts"
      via: "hapticHeavy import and call on celebration mount"
      pattern: "import.*hapticHeavy.*from.*haptics"
---

<objective>
Integrate haptic feedback across all interactive components using the three-tier system.

Purpose: Make every tap feel tactile and native. Per user decision, haptics fire on EVERY interactive tap (not just meaningful state changes). Navigation, toggles, buttons, celebrations -- all get appropriate haptic tiers.

Output: ~14 component files updated with haptic calls from event handlers. All inline navigator.vibrate() calls migrated to haptics.ts. Light tier on taps/toggles/nav, medium tier on grading/flips/mic/share-success, heavy tier on celebrations/streaks/badges.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-mobile-native-feel/30-RESEARCH.md
@.planning/phases/30-mobile-native-feel/30-02-SUMMARY.md

@src/lib/haptics.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add haptics to navigation components and migrate inline vibrate calls</name>
  <files>
    src/components/navigation/NavItem.tsx
    src/components/navigation/BottomTabBar.tsx
    src/components/navigation/Sidebar.tsx
    src/components/ui/FlagToggle.tsx
    src/components/interview/LongPressButton.tsx
    src/components/sessions/UnfinishedBanner.tsx
  </files>
  <action>
  **NavItem.tsx** -- Light haptic on every nav tap:
  - Import `hapticLight` from `@/lib/haptics`
  - In the click handler (the Link's onClick or the button's onClick for locked taps), call `hapticLight()` at the top of the handler before any other logic
  - This covers both BottomTabBar and Sidebar nav taps since both use NavItem

  **BottomTabBar.tsx** -- Light haptic on theme toggle and sign out:
  - Import `hapticLight` from `@/lib/haptics`
  - Add `hapticLight()` at the start of the theme toggle button's `onClick` handler (`(e) => { hapticLight(); toggleTheme(e); }`)
  - Add `hapticLight()` at the start of the sign out button's `onClick` handler

  **Sidebar.tsx** -- Light haptic on theme toggle, sign out, and sidebar collapse:
  - Import `hapticLight` from `@/lib/haptics`
  - Add `hapticLight()` at the start of the theme toggle `onClick`
  - Add `hapticLight()` at the start of the sign out `onClick`
  - Add `hapticLight()` at the start of the sidebar collapse toggle `onClick`

  **FlagToggle.tsx** -- MIGRATE inline navigator.vibrate(10) to hapticLight:
  - Import `hapticLight` from `@/lib/haptics`
  - Replace the inline `if ('vibrate' in navigator) { navigator.vibrate(10); }` block (around line 52) with `hapticLight()`
  - This is a direct migration -- same timing (10ms), just centralized

  **LongPressButton.tsx** -- MIGRATE inline navigator.vibrate(50) to hapticMedium:
  - Import `hapticMedium` from `@/lib/haptics`
  - Replace `navigator.vibrate(50)` (line 70) with `hapticMedium()`
  - Medium tier is appropriate for mic record start (50ms was already close to medium's 20ms, and per user decision: "medium on start")

  **UnfinishedBanner.tsx** -- MIGRATE inline navigator.vibrate?.(10) to hapticLight:
  - Import `hapticLight` from `@/lib/haptics`
  - Replace `navigator.vibrate?.(10)` (line 88) with `hapticLight()`

  **CRITICAL:** All haptic calls must be in event handlers, NOT in useEffect bodies or during render. The React Compiler will flag effect-body side effects.
  </action>
  <verify>
  - `npm run typecheck` passes
  - `npm run lint` passes
  - Grep `navigator.vibrate` in src/ returns ONLY src/lib/haptics.ts (all inline calls migrated)
  - Grep `hapticLight` in NavItem.tsx, BottomTabBar.tsx, Sidebar.tsx, FlagToggle.tsx, UnfinishedBanner.tsx
  - Grep `hapticMedium` in LongPressButton.tsx
  </verify>
  <done>
  All navigation taps (NavItem), utility controls (theme, sign out, sidebar collapse, flag toggle), and inline vibrate calls are migrated to the haptics.ts utility. Zero inline navigator.vibrate() calls remain outside haptics.ts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add haptics to interactive, celebration, and feedback components</name>
  <files>
    src/components/ui/SpeechButton.tsx
    src/components/ui/BurmeseSpeechButton.tsx
    src/components/social/ShareButton.tsx
    src/components/social/BadgeCelebration.tsx
    src/components/quiz/FeedbackPanel.tsx
    src/components/quiz/StreakReward.tsx
    src/components/study/Flashcard3D.tsx
    src/components/interview/InterviewSession.tsx
  </files>
  <action>
  **SpeechButton.tsx** -- Light haptic on TTS speak press:
  - Import `hapticLight` from `@/lib/haptics`
  - Call `hapticLight()` at the start of the button's onClick handler (confirms tap registered despite TTS latency)

  **BurmeseSpeechButton.tsx** -- Light haptic on TTS speak press:
  - Import `hapticLight` from `@/lib/haptics`
  - Call `hapticLight()` at the start of the button's onClick handler (same pattern as SpeechButton)

  **ShareButton.tsx** -- Light on tap + medium on success:
  - Import `hapticLight, hapticMedium` from `@/lib/haptics`
  - Call `hapticLight()` at the start of the share button click handler (immediate feedback)
  - Call `hapticMedium()` AFTER the navigator.share succeeds or clipboard.writeText succeeds (in the .then() or after the await). This gives a double-haptic feedback: light on tap, medium on success confirmation (like iOS copy feedback).

  **BadgeCelebration.tsx** -- Heavy haptic on celebration:
  - Import `hapticHeavy` from `@/lib/haptics`
  - Call `hapticHeavy()` when the badge celebration component mounts and shows. This should be in an event handler context or a user-initiated callback (NOT useEffect). Look for the animation start callback or the trigger function and add hapticHeavy() there. If the component is triggered by a user action upstream, the haptic call should be at the point of triggering (e.g., when the badge is earned via a button press or action completion).
  - If the only option is useEffect on mount, this is acceptable as an exception since the celebration is always user-action-initiated (earning a badge requires completing a quiz). Add a comment noting this.

  **FeedbackPanel.tsx** -- This component already imports hapticLight and hapticDouble from haptics.ts. Verify it uses them correctly:
  - Check that correct answer uses `hapticLight()` and incorrect answer uses `hapticDouble()`
  - Per user decision, answer grading should use medium tier (same for correct/incorrect). If current code uses hapticLight for correct and hapticDouble for incorrect, consider changing both to `hapticMedium()` for consistency with the locked decision. BUT keep `hapticDouble` for incorrect as differentiation is valuable UX -- the user decided "same for correct/incorrect" but the double-pulse gives meaningful feedback. Use medium for both per the strict decision.
  - Actually, re-reading the user decision: "Medium -- card flip, answer grading (same for correct/incorrect)". Change BOTH correct and incorrect answer haptics to `hapticMedium()`. Replace hapticLight and hapticDouble usage for answer events.

  **StreakReward.tsx** -- Heavy haptic on streak reward:
  - Import `hapticHeavy` from `@/lib/haptics`
  - Call `hapticHeavy()` when the streak reward renders/triggers. Same approach as BadgeCelebration -- find the trigger callback or user-initiated event.

  **Flashcard3D.tsx** -- Medium haptic on card flip:
  - Import `hapticMedium` from `@/lib/haptics`
  - Call `hapticMedium()` at the start of the flip handler (when user taps the card to flip it)
  - Per user decision: "Medium -- card flip"

  **InterviewSession.tsx** -- Medium haptic on mic record start, light on stop:
  - Import `hapticLight, hapticMedium` from `@/lib/haptics`
  - Find the recording start handler and add `hapticMedium()` at the start
  - Find the recording stop handler and add `hapticLight()` at the start
  - Per user decision: "Mic record button: medium on start, light on stop (distinct from regular buttons)"

  **CRITICAL:** All haptic calls must be in event handlers or user-initiated callbacks. If a celebration component only has useEffect mount logic, add the haptic at the upstream trigger site instead (the component that shows the celebration), not in the celebration's own useEffect.
  </action>
  <verify>
  - `npm run typecheck` passes
  - `npm run lint` passes
  - `npm run build` succeeds
  - Grep `hapticLight` appears in SpeechButton.tsx, BurmeseSpeechButton.tsx, ShareButton.tsx, InterviewSession.tsx
  - Grep `hapticMedium` appears in ShareButton.tsx, FeedbackPanel.tsx, Flashcard3D.tsx, InterviewSession.tsx
  - Grep `hapticHeavy` appears in BadgeCelebration.tsx, StreakReward.tsx
  - No haptic calls inside useEffect bodies (grep verify -- haptic calls should be in handlers only, with documented exceptions for celebration mount effects)
  </verify>
  <done>
  All interactive components have haptic feedback: light on TTS speak/share tap, medium on answer grade/card flip/mic/share success, heavy on badge celebration/streak reward. Three-tier haptic system is fully integrated across the app.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- `npm run typecheck` passes
- `npm run lint` passes
- All inline navigator.vibrate() calls are gone (only in haptics.ts)
- 14 component files import from haptics.ts
- Light tier: NavItem, BottomTabBar, Sidebar, FlagToggle, SpeechButton, BurmeseSpeechButton, ShareButton(tap), UnfinishedBanner, InterviewSession(stop)
- Medium tier: ShareButton(success), FeedbackPanel, Flashcard3D, LongPressButton, InterviewSession(start)
- Heavy tier: BadgeCelebration, StreakReward
</verification>

<success_criteria>
1. Every interactive tap fires appropriate haptic tier
2. All inline navigator.vibrate() calls migrated to haptics.ts
3. Celebrations (badge, streak) use hapticHeavy multi-burst
4. Answer grading uses hapticMedium (same for correct/incorrect per user decision)
5. Card flip uses hapticMedium
6. TTS speak uses hapticLight
7. Share uses light on tap + medium on success
8. Mic record uses medium on start, light on stop
9. Build, typecheck, and lint all pass
</success_criteria>

<output>
After completion, create `.planning/phases/30-mobile-native-feel/30-04-SUMMARY.md`
</output>
