---
phase: 09-ui-polish-onboarding
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/audio/soundEffects.ts
  - src/pages/SettingsPage.tsx
autonomous: true

must_haves:
  truths:
    - "Correct answer plays ascending two-note ding sound"
    - "Incorrect answer plays soft descending tone"
    - "Level up / milestone plays triumphant ascending arpeggio"
    - "User can mute/unmute all sound effects from Settings page"
    - "Sound mute preference persists across sessions via localStorage"
    - "Sound functions are module-level and called from event handlers only (React Compiler safe)"
  artifacts:
    - path: "src/lib/audio/soundEffects.ts"
      provides: "Sound effects module with playCorrect, playIncorrect, playLevelUp, playMilestone, toggleMute, isMuted"
      exports: ["playCorrect", "playIncorrect", "playLevelUp", "playMilestone", "toggleMute", "isSoundMuted"]
    - path: "src/pages/SettingsPage.tsx"
      provides: "Sound mute toggle in Settings"
      contains: "sound"
  key_links:
    - from: "src/lib/audio/soundEffects.ts"
      to: "localStorage"
      via: "civic-prep-sound-muted key"
      pattern: "civic-prep-sound-muted"
---

<objective>
Create the sound effects system extending the existing audioChime.ts pattern, with distinct sounds for correct answers, incorrect answers, level-ups, and milestone celebrations. Add a mute toggle to the Settings page.

Purpose: Sound effects provide gamified feedback matching Duolingo's playful feel. They are wired into test/practice/SRS callbacks in later plans.
Output: soundEffects.ts module with 4+ sound functions and mute toggle, Settings page mute control.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-ui-polish-onboarding/09-RESEARCH.md

@src/lib/interview/audioChime.ts
@src/pages/SettingsPage.tsx
</context>

<instructions>
Use the /frontend-design skill for all UI design and implementation work in this phase. This is a locked user decision.
</instructions>

<tasks>

<task type="auto">
  <name>Task 1: Create Sound Effects Module</name>
  <files>src/lib/audio/soundEffects.ts</files>
  <action>
Create `src/lib/audio/soundEffects.ts` extending the audioChime.ts pattern (module-level AudioContext singleton with lazy initialization).

**Shared infrastructure:**
- `SOUND_MUTE_KEY = 'civic-prep-sound-muted'` localStorage key
- `let audioContext: AudioContext | null = null` (module-level singleton, separate from audioChime.ts)
- `getContext()` function: lazy init, resume if suspended, return null on failure
- `isSoundMuted(): boolean` - checks localStorage, returns true if window undefined (SSR safe)
- `toggleMute(): boolean` - toggles mute state, returns new state
- `setSoundMuted(muted: boolean): void` - explicit setter

**Helper:**
- `playNote(ctx, freq, delay, duration, gain = 0.25, waveType = 'sine')` - reusable note player with oscillator + gain envelope

**Sound functions (all module-level, NOT hooks):**
- `playCorrect()`: Ascending two-note ding. C5 (523 Hz) at delay 0, E5 (659 Hz) at delay 0.12s. Duration 0.15s each. Gain 0.25. Bright, cheerful.
- `playIncorrect()`: Soft descending two-note. E4 (330 Hz) at delay 0, C4 (262 Hz) at delay 0.15s. Duration 0.2s/0.3s. Lower gain 0.15. Gentle, not punishing.
- `playLevelUp()`: Ascending arpeggio. C5 (523), E5 (659), G5 (784) in quick succession (0, 0.1s, 0.2s). Duration 0.2s each. Gain 0.3.
- `playMilestone()`: Triumphant chord. C5+E5+G5 simultaneous (delay 0) with longer sustain (0.4s). Gain 0.25 each. Follow with octave C6 (1047 Hz) at 0.3s delay.
- `playSwoosh()`: Quick pitch sweep using frequency ramp from 400 Hz to 800 Hz over 0.15s. For navigation/transitions. Gain 0.1 (subtle).

All functions: check `isSoundMuted()` first, wrap in try/catch (failures must never break app flow), called from event handlers only (never from effects).

Export all sound functions and mute utilities.
  </action>
  <verify>Run `npx tsc --noEmit` to verify module compiles. Check that no React hooks are used (module-level functions only). Verify localStorage key matches convention.</verify>
  <done>soundEffects.ts exists with 5 distinct sound functions, mute toggle, lazy AudioContext singleton. All functions are module-level and React Compiler safe.</done>
</task>

<task type="auto">
  <name>Task 2: Add Sound Mute Toggle to Settings Page</name>
  <files>src/pages/SettingsPage.tsx</files>
  <action>
Add a "Sound Effects" toggle to the Settings page:

- Import `isSoundMuted`, `setSoundMuted` from `@/lib/audio/soundEffects`
- Add a new section in the Settings page (after the existing notification/theme sections) titled "Sound Effects" with bilingual label
- Use a toggle switch (consistent with other toggles on the page) that reflects `isSoundMuted()` state
- On toggle, call `setSoundMuted(!currentState)` and update local state
- Use `useState(() => isSoundMuted())` with lazy initializer (React Compiler safe)
- Play a brief `playCorrect()` when enabling sound (so user hears the effect) -- only when toggling FROM muted TO unmuted
- Add an icon (Volume2 / VolumeX from lucide-react) next to the label
- Style with the existing SettingsPage card/section pattern (rounded cards, grouped sections per locked decision)
- Bilingual label: "Sound Effects" / Burmese equivalent
  </action>
  <verify>Run `npx tsc --noEmit` to verify no type errors. Verify the toggle renders and state persists across page refreshes by checking localStorage.</verify>
  <done>Settings page has a Sound Effects toggle that mutes/unmutes all app sounds. State persists in localStorage. Enabling sound plays a brief preview.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- soundEffects.ts has no React imports (module-level only)
- Settings page renders sound toggle without errors
- localStorage key `civic-prep-sound-muted` is set on toggle
</verification>

<success_criteria>
Sound effects system is ready for consumption by test, practice, SRS, and celebration components in later plans. Mute toggle is available in Settings.
</success_criteria>

<output>
After completion, create `.planning/phases/09-ui-polish-onboarding/09-02-SUMMARY.md`
</output>
