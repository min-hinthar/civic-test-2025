---
phase: 37-bug-fixes-ux-polish
plan: 04
type: execute
wave: 2
depends_on: ["37-01"]
files_modified:
  - src/components/srs/DeckManager.tsx
  - src/components/srs/ReviewDeckCard.tsx
  - src/pages/StudyGuidePage.tsx
  - src/components/navigation/BottomTabBar.tsx
  - src/pages/DashboardPage.tsx
autonomous: true
requirements: []

must_haves:
  truths:
    - "Review deck cards are clickable and navigate to the flashcard view for that question"
    - "Review deck shows progress bar with card count at top (e.g. '5/12 reviewed')"
    - "Review deck has category dropdown filter to focus on specific topics"
    - "Review deck empty state shows celebration message with 'All caught up! Next review in X hours'"
    - "Due card count badge appears on Study Guide nav tab when cards are due"
    - "Dashboard shows due card banner when cards are due"
  artifacts:
    - path: "src/components/srs/ReviewDeckCard.tsx"
      provides: "Clickable card with question preview, category badge, difficulty indicator"
      contains: "navigate"
    - path: "src/components/srs/DeckManager.tsx"
      provides: "Overhauled deck view with progress bar, category filter, clickable cards, and enhanced empty state"
      contains: "Progress"
  key_links:
    - from: "src/components/srs/ReviewDeckCard.tsx"
      to: "src/pages/StudyGuidePage.tsx"
      via: "Card click navigates to flashcard view via hash route"
      pattern: "navigate.*study.*cards"
    - from: "src/components/srs/DeckManager.tsx"
      to: "src/components/srs/ReviewDeckCard.tsx"
      via: "DeckManager renders ReviewDeckCards in list"
      pattern: "ReviewDeckCard"
---

<objective>
Overhaul the Review Deck experience: make cards clickable to navigate to flashcard view, add progress bar with card count, category filter, spacious card design with spring animations, celebration empty state, and due card surfacing in nav badge + dashboard banner.

Purpose: User decision locks clickable cards, progress bar, category filter, empty state, and due surfacing.
Output: Redesigned DeckManager.tsx + new ReviewDeckCard.tsx + nav badge + dashboard banner.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/srs/DeckManager.tsx
@src/pages/StudyGuidePage.tsx
@src/components/navigation/BottomTabBar.tsx
@src/pages/DashboardPage.tsx
@src/lib/srs/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ReviewDeckCard component + overhaul DeckManager</name>
  <files>src/components/srs/ReviewDeckCard.tsx, src/components/srs/DeckManager.tsx</files>
  <action>
**Step 1: Create `src/components/srs/ReviewDeckCard.tsx`**

Spacious, clickable card for review deck list. Tapping navigates to the flashcard view for that specific question.

Requirements from user decisions:
- Spacious card design with question preview, category badge, and difficulty indicator
- Spring physics for card transition animations (SPRING_BOUNCY)
- Clickable — navigates to flashcard view

Implementation:
```typescript
import { useNavigate } from 'react-router-dom';
import { motion } from 'motion/react';
import clsx from 'clsx';
import { SPRING_BOUNCY } from '@/lib/motion-config';
import { Card } from '@/components/ui/Card';
import { useReducedMotion } from '@/hooks/useReducedMotion';
import { getSubCategoryColors } from '@/lib/mastery';
import type { Category } from '@/types';
```

Props: `questionId`, `questionText`, `questionTextMy?`, `category`, `isDue`, `difficulty` (FSRS stability as 0-1 number), `showBurmese`.

Structure:
- Outer `motion.div` with `whileTap={{ scale: 0.98 }}` + `SPRING_BOUNCY`
- `Card` component with `interactive` prop, `animate={false}` (StaggeredList handles animation)
- Top: 4px color accent bar using `getSubCategoryColors(category).bgAccent`
- Row 1: Category name (muted, small caps) + Due badge (warning color, pill)
- Row 2: Question text (medium weight, line-clamp-2)
- Row 3 (optional): Burmese text (font-myanmar, muted, line-clamp-1)
- Row 4: Difficulty indicator — 5 dots, filled proportional to difficulty, with color scale (green→yellow→red)
- Right side: Chevron icon (ChevronRight from lucide-react) as clickable indicator

On click: `navigate(`/study#cards-${encodeURIComponent(category)}`)` — navigates to the flashcard view filtered to that category. The specific question will be the first card shown.

Actually, to navigate to a SPECIFIC question, navigate with a search param or hash that includes the question index. Check how StudyGuidePage parses hash routes. Looking at the existing code, `#cards-{category}` shows the FlashcardStack for that category. To start at a specific question, pass `?start=${questionIndex}` or add it to the hash. Check how FlashcardStack's `startIndex` prop is wired from StudyGuidePage. If it's not, pass the question index via `searchParams` and have StudyGuidePage read it to pass as `startIndex` to FlashcardStack.

**Step 2: Overhaul DeckManager.tsx**

Transform the existing DeckManager from a basic list into a polished deck management view:

**A) Progress bar at top:**
- Import `@radix-ui/react-progress` (already installed)
- Show: "5/12 reviewed" text with fill animation
- Calculate reviewed count: cards where `card.reps > 0 && !isDue(card)` (reviewed and not yet due again)
- Progress bar uses `bg-primary` fill with spring animation on width change

**B) Category dropdown filter:**
- Add a `<select>` dropdown above the card list
- Options: "All Categories" + each unique USCIS category from the deck cards
- Filter the displayed cards by selected category
- Default: "All Categories"

**C) Replace card rendering with ReviewDeckCard:**
- Wrap the card list in `<StaggeredList>` for enter animations
- Each card in a `<StaggeredItem>`
- Pass all required props to ReviewDeckCard

**D) Enhanced empty state:**
- When deck is empty (no cards at all): Keep existing "Add cards to your review deck" empty state
- When all cards reviewed (deck has cards but none are due): Show celebration!
  - Use existing `CelebrationOverlay` or `useCelebration` hook to trigger light confetti
  - Display message: "All caught up!" / "အားလုံး ပြီးဆုံးပါပြီ!" (bilingual)
  - Show next due time: "Next review in X hours" calculated from the earliest `card.due` date
  - Use a checkmark icon (lucide `CheckCircle2`) with spring scale animation
  - Green success color scheme

**E) Spring physics for card animations:**
- Use `SPRING_BOUNCY` for card entrance via StaggeredList
- Use `SPRING_SNAPPY` for filter changes (faster response)
  </action>
  <verify>Run `npm run typecheck` and `npm run test:run`. Navigate to /#/study#deck — progress bar visible, category filter works, cards are clickable and navigate to flashcard view. When all cards reviewed, celebration empty state appears.</verify>
  <done>Review deck has clickable cards with navigation, progress bar, category filter, spring animations, and celebration empty state. Cards show question preview, category badge, and difficulty indicator.</done>
</task>

<task type="auto">
  <name>Task 2: Add due card surfacing — nav badge + dashboard banner</name>
  <files>src/components/navigation/BottomTabBar.tsx, src/pages/DashboardPage.tsx, src/pages/StudyGuidePage.tsx</files>
  <action>
**Step 1: Due count badge on Study Guide nav tab**

The `NAV_TABS` config already has `badgeKey: 'studyDueCount'` on the Study tab. Check how `NavBadges.studyDueCount` is computed and passed to BottomTabBar/Sidebar. The SRSContext already exposes `dueCount`. Verify the plumbing:

1. Check `NavigationProvider` or wherever `NavBadges` object is constructed
2. Ensure `studyDueCount` is wired to `useSRS().dueCount`
3. If not already wired, add it in the NavigationProvider or wherever badges are computed
4. Verify the badge renders as a notification dot or count pill on the Study tab icon

If the badge is already wired (likely from Phase 14-16), verify it works. If not, wire `studyDueCount` from SRSContext's `dueCount`.

**Step 2: Dashboard due card banner**

In `DashboardPage.tsx`, add a prominent banner when cards are due:

- Import `useSRS` from SRSContext to get `dueCount`
- When `dueCount > 0`, render a banner above the main dashboard content:
  ```
  You have {dueCount} cards due for review
  သင့်တွင် ပြန်လည်သုံးသပ်ရန် ကဒ် {dueCount} ခု ရှိပါသည်
  [Review Now] button
  ```
- Banner styling: `border-l-4 border-warning bg-warning/5 rounded-xl p-4`
- "Review Now" button navigates to `/#/study#deck`
- Animate banner entrance with `motion.div` + `SPRING_GENTLE` (opacity + y slide)
- Dismissable: X button that hides banner for current session (useState, resets on page reload)

**Step 3: Wire ReviewDeckCard navigation target in StudyGuidePage**

Ensure that when ReviewDeckCard navigates to `#cards-{category}`, StudyGuidePage correctly shows the FlashcardStack for that category. Check the existing hash parsing logic (lines 76-101) — the `#cards-{category}` pattern should already be handled (line ~84: `hash.startsWith('#cards-')`). Verify this works end-to-end.

If the user wants to navigate to a specific question (not just category), add `startIndex` support:
- Read `?q={questionId}` from search params
- Find the index of that question in the filtered question list
- Pass it as `startIndex` to FlashcardStack
  </action>
  <verify>Run `npm run typecheck`. Navigate to dashboard with due cards — banner should appear with "Review Now" button. Study tab should show due count badge. Banner dismiss button should hide it. "Review Now" navigates to /#/study#deck.</verify>
  <done>Due card count shows as badge on Study nav tab. Dashboard shows prominent banner with due count and "Review Now" link. ReviewDeckCard navigation targets are correctly handled by StudyGuidePage.</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. `npm run test:run` passes
3. Review deck shows progress bar, category filter, clickable cards
4. Cards navigate to flashcard view on click
5. Empty/all-reviewed state shows celebration
6. Study nav tab shows due count badge
7. Dashboard shows due card banner with dismiss
</verification>

<success_criteria>
- ReviewDeckCard component navigates to flashcard view on click
- DeckManager has progress bar, category filter, spring animations
- All-reviewed empty state shows celebration with next review time
- Due card badge on Study tab and banner on Dashboard
- All animations use existing motion tokens, respecting reduced motion
</success_criteria>

<output>
After completion, create `.planning/phases/37-bug-fixes-ux-polish/37-04-SUMMARY.md`
</output>
