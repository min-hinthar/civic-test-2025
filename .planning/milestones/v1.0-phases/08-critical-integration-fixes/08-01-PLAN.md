---
phase: 08-critical-integration-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pages/sentry-example-page.tsx (DELETE)
  - pages/api/sentry-example-api.ts (DELETE)
  - src/hooks/useStreak.ts
  - src/components/AppNavigation.tsx
  - eslint.config.mjs
  - next.config.mjs
  - .husky/pre-commit
autonomous: true

must_haves:
  truths:
    - "Developer runs `pnpm run lint` with zero errors"
    - "Developer runs `pnpm run build` without sentry-example-page SSG failure"
    - "Pre-commit hook runs lint-staged and typecheck but NOT next build"
    - "No eslint-disable comments remain in AppNavigation.tsx"
    - "No Sentry deprecation warnings appear during build"
  artifacts:
    - path: ".husky/pre-commit"
      provides: "Pre-commit hook with lint-staged + typecheck only"
      contains: "pnpm lint-staged"
    - path: "eslint.config.mjs"
      provides: "ESLint config with out/ ignored"
      contains: "out/**"
  key_links:
    - from: "AppNavigation.tsx"
      to: "location.pathname"
      via: "click handler closes menu (not effect)"
      pattern: "setIsMenuOpen.*false"
---

<objective>
Fix all build blockers (Sentry demo page, lint error, eslint-disable suppression) and restore pre-commit hook integrity so that `pnpm run lint`, `pnpm run build`, and `git commit` all work cleanly.

Purpose: Unblock build/lint verification for all subsequent plans in this phase and restore pre-commit safety that was bypassed since Phase 4.
Output: Clean build, clean lint, working pre-commit hook
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-critical-integration-fixes/08-RESEARCH.md
@src/hooks/useStreak.ts
@src/components/AppNavigation.tsx
@eslint.config.mjs
@next.config.mjs
@.husky/pre-commit
@pages/sentry-example-page.tsx
@pages/api/sentry-example-api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete Sentry demo pages, fix lint error, remove eslint-disable suppression</name>
  <files>
    pages/sentry-example-page.tsx (DELETE)
    pages/api/sentry-example-api.ts (DELETE)
    src/hooks/useStreak.ts
    src/components/AppNavigation.tsx
  </files>
  <action>
    **1a. Delete Sentry example files:**
    - Delete `pages/sentry-example-page.tsx` entirely
    - Delete `pages/api/sentry-example-api.ts` entirely
    - These are auto-generated Sentry SDK demo scaffolding that cause SSG build failure (manifest.json ENOENT). The Sentry SDK remains configured via next.config.mjs, sentry.edge.config.ts, and sentry.server.config.ts — only the demo pages are removed.

    **1b. Fix useStreak.ts lint error:**
    - In `src/hooks/useStreak.ts`, remove the unused `recordStudyActivity` import from line 20
    - The import `recordStudyActivity` was moved to masteryStore.recordAnswer() (per decision 07-03). It is no longer needed in useStreak.ts.
    - Keep the other imports from `@/lib/social` intact: `getStreakData`, `calculateStreak`, `shouldAutoUseFreeze`

    **1c. Fix AppNavigation.tsx eslint-disable suppression:**
    - Remove the `useEffect` block (lines 42-45) that closes the menu on route change with the eslint-disable comment
    - Remove `useEffect` from the React import if no other effects remain in the component
    - Instead, close the menu in the click handlers. Modify `handleGuardedNavigation` to add `setIsMenuOpen(false)` at the TOP of the function body (before the locked check) — this handles all nav link clicks in both desktop and mobile.
    - Also add `setIsMenuOpen(false)` in the logout onClick handler (both desktop and mobile versions) before calling `logout().then(...)`.
    - This eliminates the need for the route-change effect entirely because every navigation action now closes the menu at the point of user interaction, not reactively via effect.
    - Per user decision: "Fix ALL root causes — no eslint-disable suppressions, no workarounds"
    - Per MEMORY.md: setState in event handlers is fine for React Compiler; only setState in effects is flagged
  </action>
  <verify>
    - `pnpm exec eslint src/ --max-warnings=0` passes with zero errors
    - `pnpm exec eslint src/hooks/useStreak.ts` passes with zero errors
    - `pnpm exec eslint src/components/AppNavigation.tsx` passes with zero errors
    - Verify no `eslint-disable` comments remain in AppNavigation.tsx: `grep -r "eslint-disable" src/components/AppNavigation.tsx` returns nothing
    - Verify sentry example files are deleted: `ls pages/sentry-example-page.tsx` returns "not found"
  </verify>
  <done>
    All lint errors are zero. Sentry demo pages deleted. No eslint-disable suppression in AppNavigation.tsx. Menu closes via click handler instead of effect.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update ESLint config, fix Sentry deprecation warnings, restore pre-commit hook</name>
  <files>
    eslint.config.mjs
    next.config.mjs
    .husky/pre-commit
  </files>
  <action>
    **2a. Add `out/` to ESLint ignores:**
    - In `eslint.config.mjs`, add `'out/**'` to the `ignores` array (line 12)
    - The `out/` directory contains stale Next.js build artifacts that trigger hundreds of false lint errors if someone runs eslint from root

    **2b. Fix Sentry deprecation warnings in next.config.mjs:**
    - Replace `disableLogger: true` (line 43) with nothing — just remove the property and its comment. The `disableLogger` option is deprecated in favor of `webpack.treeshake.removeDebugLogging`, but since we don't need fine-grained webpack config for this, simply removing the deprecated option is cleanest. Sentry's default behavior handles logging appropriately.
    - Replace `automaticVercelMonitors: true` (line 49) with nothing — just remove the property and its comments (lines 45-49). This option is deprecated and the app is not using Vercel Cron Monitors.
    - Clean up any trailing whitespace or empty lines left from the removals

    **2c. Restore pre-commit hook:**
    - Edit `.husky/pre-commit` to contain ONLY:
      ```
      pnpm lint-staged
      pnpm run typecheck
      ```
    - Remove `pnpm run build` (line 3) — build stays as CI-only check
    - Per user decision: "lint-staged + typecheck in pre-commit hook (no `next build`)"
    - Combined run time is ~15-20 seconds per commit (lint-staged ~3-5s for changed files, typecheck ~10-15s)
  </action>
  <verify>
    - `pnpm run build` completes successfully (no Sentry SSG failure, no deprecation warnings)
    - `pnpm run typecheck` passes
    - `cat .husky/pre-commit` shows exactly 2 lines (lint-staged + typecheck, no build)
    - `grep -c "build" .husky/pre-commit` returns 0
    - Build output does NOT contain "DEPRECATION WARNING" for disableLogger or automaticVercelMonitors
  </verify>
  <done>
    ESLint ignores stale build artifacts in out/. Sentry deprecation warnings eliminated. Pre-commit hook restored with lint-staged + typecheck only (no build). Developers can commit without --no-verify.
  </done>
</task>

</tasks>

<verification>
1. `pnpm run lint` — zero errors
2. `pnpm run typecheck` — zero errors
3. `pnpm run build` — succeeds without sentry-example-page failure or deprecation warnings
4. `grep -r "eslint-disable" src/components/AppNavigation.tsx` — no results
5. `ls pages/sentry-example-page.tsx 2>/dev/null` — file does not exist
6. `cat .husky/pre-commit` — contains lint-staged + typecheck, no build
</verification>

<success_criteria>
- `pnpm run lint` exits 0
- `pnpm run build` exits 0 without sentry-example-page errors or deprecation warnings
- Pre-commit hook has lint-staged + typecheck only
- No eslint-disable comments in AppNavigation.tsx
- Sentry demo files deleted, SDK still configured
</success_criteria>

<output>
After completion, create `.planning/phases/08-critical-integration-fixes/08-01-SUMMARY.md`
</output>
