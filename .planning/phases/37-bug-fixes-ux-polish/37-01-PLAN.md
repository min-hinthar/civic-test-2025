---
phase: 37-bug-fixes-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/Card.tsx
  - src/components/interview/InterviewSession.tsx
  - src/components/interview/InterviewTranscript.tsx
autonomous: true
requirements: []

must_haves:
  truths:
    - "Study Guide browse view shows all 7 category cards visible and clickable"
    - "Interview Practice mode shows the correct answer text after self-grading"
    - "Interview Realistic mode does NOT reveal answer text during session or in transcript"
  artifacts:
    - path: "src/components/ui/Card.tsx"
      provides: "Interactive card with opacity:1 and scale:1 in idle variant"
      contains: "opacity: 1"
    - path: "src/components/interview/InterviewSession.tsx"
      provides: "Practice self-grade triggers feedback phase showing answer"
      contains: "setQuestionPhase('feedback')"
    - path: "src/components/interview/InterviewTranscript.tsx"
      provides: "Mode-aware transcript hiding answers in realistic mode"
      contains: "mode"
  key_links:
    - from: "src/components/ui/Card.tsx"
      to: "src/pages/StudyGuidePage.tsx"
      via: "Card interactive variant used in category grid"
      pattern: "Card.*interactive"
    - from: "src/components/interview/InterviewSession.tsx"
      to: "src/components/interview/InterviewTranscript.tsx"
      via: "mode prop passed through to transcript results"
      pattern: "mode.*practice|realistic"
---

<objective>
Fix three confirmed bugs with known root causes: (1) Study Guide category cards invisible due to missing opacity/scale in Card.tsx idle motion variant, (2) Interview Practice mode skipping feedback phase so answers never display after self-grading, (3) Interview Realistic mode leaking answers in transcript view.

Purpose: These are the highest-priority user-facing bugs that break core functionality.
Output: Card.tsx, InterviewSession.tsx, and InterviewTranscript.tsx with fixes applied.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/ui/Card.tsx
@src/components/interview/InterviewSession.tsx
@src/components/interview/InterviewTranscript.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Card.tsx interactive variant missing opacity and scale</name>
  <files>src/components/ui/Card.tsx</files>
  <action>
In `Card.tsx` lines 89-100, the `motionVariants` object for interactive cards defines `idle` with only `y` and `boxShadow` but NOT `opacity` or `scale`. When `initial` is `{ opacity: 0, scale: 0.95, y: 0 }` (line 109) and `animate="idle"`, motion/react interpolates TO the idle variant — but idle lacks `opacity` and `scale`, so they remain at their initial values (0 and 0.95), making cards invisible.

Fix: Add `opacity: 1, scale: 1` to both `idle` and `hover` variants:

```typescript
const motionVariants = {
  idle: {
    opacity: 1,
    scale: 1,
    y: 0,
    boxShadow: '0 10px 40px -10px hsl(var(--color-primary) / 0.15)',
  },
  hover: shouldReduceMotion
    ? { opacity: 1, scale: 1 }
    : {
        opacity: 1,
        scale: 1,
        y: -4,
        boxShadow: '0 20px 60px -15px hsl(var(--color-primary) / 0.3)',
      },
};
```

This ensures motion/react has explicit target values for opacity and scale in every variant state.
  </action>
  <verify>Run `npm run typecheck` and `npm run test:run` — no regressions. Verify by running `npm run dev` and navigating to Study Guide browse view (/#/study) — all 7 category cards should be visible.</verify>
  <done>Interactive Card components animate from opacity:0/scale:0.95 to opacity:1/scale:1 via idle variant. Study Guide category grid displays all cards.</done>
</task>

<task type="auto">
  <name>Task 2: Fix Interview Practice mode answer display + Realistic mode answer hiding</name>
  <files>src/components/interview/InterviewSession.tsx, src/components/interview/InterviewTranscript.tsx</files>
  <action>
**Bug 1 — Practice mode answer not shown after self-grade:**

In `InterviewSession.tsx`, `handleSelfGrade()` (line ~987) sets `setQuestionPhase('transition')` directly, which SKIPS the `'feedback'` phase. The FEEDBACK effect (lines 883-939) — which constructs answer text and plays answer audio — only runs when `questionPhase === 'feedback'`.

Fix `handleSelfGrade()`: Change `setQuestionPhase('transition')` (line ~987) to `setQuestionPhase('feedback')`. The FEEDBACK effect already handles the full flow including transition delay and auto-advance, so the transition timer in handleSelfGrade is redundant when feedback is triggered.

Specifically, replace the block starting at line ~987 that does:
```typescript
setQuestionPhase('transition');
transitionTimerRef.current = setTimeout(() => {
  setCurrentIndex(prev => prev + 1);
  // ...reset state...
  setQuestionPhase('chime');
}, TRANSITION_DELAY_MS);
```

With just:
```typescript
setQuestionPhase('feedback');
```

Remove the manual transition timer and state resets from handleSelfGrade — the existing feedback effect already calls `advanceToNext()` which handles all of that.

Also store the grade result before triggering feedback so the effect can read it:
- Before `setQuestionPhase('feedback')`, call `setLastGradeResult(interviewResult)` so the FEEDBACK effect has access to `lastResult.selfGrade`.

Verify the FEEDBACK effect (line ~883) reads `results` from state — it uses `results[results.length - 1]` to get `lastResult`. Since `setResults(newResults)` is called before `setQuestionPhase('feedback')`, the batched React state update should make both available in the next render. If not, pass the result via a ref.

**Bug 2 — Realistic mode answer leaking in transcript:**

In `InterviewTranscript.tsx`, the `mode` prop is received as `_mode` (unused, line 67). The transcript ALWAYS shows "Show correct answer" expand/collapse for incorrect items regardless of mode.

Fix: Rename `_mode` back to `mode` and gate the "Show correct answer" section:

1. Change line 67: `mode: _mode,` → `mode,`
2. Wrap the incorrect answer expandable section (lines ~189-274) with a mode check:
   ```typescript
   {!isCorrect && mode === 'practice' && (
     // ... existing expandable answer section
   )}
   ```

This ensures realistic mode transcript NEVER reveals correct answers, matching the real USCIS interview experience.
  </action>
  <verify>Run `npm run typecheck` and `npm run test:run` — no regressions. Manual test: (1) Start Practice interview, self-grade a question — answer text should appear in examiner chat bubble. (2) Start Realistic interview, complete it — transcript should NOT show "Show correct answer" buttons.</verify>
  <done>Practice mode shows answer text after self-grading via feedback phase. Realistic mode hides answers in both live session and transcript view.</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. `npm run test:run` passes
3. Study Guide browse (/#/study) shows all 7 category cards visible and clickable
4. Interview Practice mode: self-grade shows answer in chat bubble
5. Interview Realistic mode: transcript hides correct answers
</verification>

<success_criteria>
- Card.tsx idle variant includes opacity:1 and scale:1
- InterviewSession handleSelfGrade triggers feedback phase
- InterviewTranscript gates answer reveal on mode === 'practice'
- No TypeScript errors, no test regressions
</success_criteria>

<output>
After completion, create `.planning/phases/37-bug-fixes-ux-polish/37-01-SUMMARY.md`
</output>
