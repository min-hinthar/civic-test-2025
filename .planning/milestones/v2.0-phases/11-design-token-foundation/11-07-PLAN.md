---
phase: 11-design-token-foundation
plan: 07
type: execute
wave: 4
depends_on: [04, 05, 06]
files_modified:
  - package.json
  - .stylelintrc.json
  - .eslintrc.json
autonomous: false

must_haves:
  truths:
    - "Lint rules flag hardcoded hex colors in CSS files"
    - "Lint rules flag hardcoded hex colors in inline style objects in TSX"
    - "Running the lint command on the migrated codebase produces zero color violations"
    - "User has visually verified key pages look correct in both light and dark mode"
  artifacts:
    - path: ".stylelintrc.json"
      provides: "Stylelint config flagging hardcoded colors in CSS"
      contains: "color-no-hex"
    - path: "package.json"
      provides: "stylelint dev dependencies and lint:css script"
      contains: "stylelint"
  key_links: []
---

<objective>
Install and configure lint enforcement to prevent regression of hardcoded color values, then verify the complete migration visually via a human checkpoint.

Purpose: Ensure the token system stays clean going forward (no new hardcoded colors) and verify the migration is visually correct.
Output: Lint configuration files, visual verification of key pages.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-design-token-foundation/11-RESEARCH.md (lint rule enforcement, standard stack)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure lint enforcement for token usage</name>
  <files>package.json, .stylelintrc.json</files>
  <action>
**Install stylelint:**
```bash
pnpm add -D stylelint stylelint-config-standard
```

Note: Skip `@metamask/eslint-plugin-design-tokens` for now -- it's a niche package that may have compatibility issues. Instead, use a simpler approach for inline style enforcement.

**Create `.stylelintrc.json`:**
```json
{
  "extends": ["stylelint-config-standard"],
  "rules": {
    "color-no-hex": true,
    "color-named": "never",
    "at-rule-no-unknown": [true, {
      "ignoreAtRules": ["tailwind", "apply", "layer", "config"]
    }],
    "function-no-unknown": [true, {
      "ignoreFunctions": ["theme", "hsl", "var", "env", "calc", "max", "min", "rgb", "radial-gradient", "linear-gradient"]
    }],
    "import-notation": null,
    "no-descending-specificity": null,
    "selector-class-pattern": null
  },
  "ignoreFiles": [
    "node_modules/**",
    ".next/**",
    "out/**"
  ]
}
```

**IMPORTANT config notes:**
- `color-no-hex: true` flags any hex color usage in CSS files
- `color-named: "never"` flags named colors like `red`, `blue`
- The `at-rule-no-unknown` exception is needed for Tailwind directives
- `function-no-unknown` exceptions needed for CSS functions used with Tailwind
- `import-notation: null` to allow the existing @import syntax
- `no-descending-specificity: null` because Tailwind's @layer creates specificity patterns
- `selector-class-pattern: null` because Tailwind and dark-mode selectors don't follow BEM

**Add npm script to package.json:**
Add `"lint:css": "stylelint \"src/styles/**/*.css\""` to the scripts section.

**Run the lint:**
```bash
pnpm lint:css
```

If violations are found (they shouldn't be after the migration), fix them. The goal is zero violations.

**Handle known exceptions:**
- The `rgb(0 0 0 / X)` values in shadow tokens are acceptable -- shadows use rgb for true black. Add an exception or note in the config if stylelint flags these.
- If `hsl()` with literal values in gradients gets flagged, those should have been converted in Plan 06. Fix any remaining ones.

**For inline styles in TSX files (simpler approach):**
Instead of a full ESLint plugin, add a comment in the project's ESLint config or CONVENTIONS documentation noting that inline `style={{ color: '#xxx' }}` patterns should use `getTokenColor()` or CSS variables. The enforcement is via code review, not automated lint for inline styles (pragmatic decision -- the heavy lifting is done, and inline styles are rare).
  </action>
  <verify>
- `pnpm lint:css` runs without errors on src/styles/*.css
- .stylelintrc.json exists with color-no-hex rule
- package.json has stylelint dev dependencies
- package.json has lint:css script
  </verify>
  <done>Stylelint installed and configured. Running `pnpm lint:css` produces zero violations on the migrated CSS files. Hardcoded colors in CSS will be caught by lint going forward.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete design token migration:
- Single source of truth in tokens.css (primitives + semantic + dark mode)
- Tailwind config wired to CSS variables
- FOUC-free dark mode with animated sun/moon toggle
- ~103 components + 14 pages migrated to semantic token classes
- Lint enforcement preventing regression
  </what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Open `http://localhost:3000` in the browser

**Light mode checks:**
3. Verify the Dashboard page looks correct (colors, backgrounds, text contrast)
4. Navigate to Study Guide -- check category cards have correct colors
5. Open a Flashcard -- verify card styling, flip animation, answer feedback colors
6. Go to Progress page -- verify charts render with correct blue/amber/green colors
7. Check Settings page -- verify form inputs, toggles, section headers

**Dark mode checks:**
8. Click the theme toggle (sun/moon icon) -- verify smooth animation
9. Verify NO flash of white on page reload in dark mode (test by refreshing)
10. Verify backgrounds are soft dark (navy), not pure black
11. Navigate through the same pages -- verify text contrast is readable
12. Check that charts/progress visualizations adapt to dark mode
13. Verify the browser address bar color updates when toggling themes

**Regression checks:**
14. Run a mock test -- verify answer feedback colors (green=correct, orange=wrong)
15. Check the streak heatmap on Progress page
16. Verify the onboarding tour overlay (if accessible) still renders correctly
17. Check Interview mode -- verify results page charts
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual issues to fix</resume-signal>
</task>

</tasks>

<verification>
- Lint enforcement configured and passing
- Visual verification of light + dark mode across key pages
- No FOUC on dark mode page load
- Charts and data visualizations render correctly in both modes
</verification>

<success_criteria>
Lint rules prevent future hardcoded color values. User has visually confirmed that the app looks correct in both light and dark mode with no regressions. The design token migration is complete.
</success_criteria>

<output>
After completion, create `.planning/phases/11-design-token-foundation/11-07-SUMMARY.md`
</output>
