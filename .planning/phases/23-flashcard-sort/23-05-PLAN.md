---
phase: 23-flashcard-sort
plan: 05
type: execute
wave: 2
depends_on: ["23-01"]
files_modified:
  - src/components/sort/SortProgress.tsx
  - src/components/sort/SortCountdown.tsx
  - src/components/sort/KnowDontKnowButtons.tsx
autonomous: true

must_haves:
  truths:
    - "User sees live Know and Don't Know counters that animate on each sort"
    - "User sees a segmented progress bar for <=40 cards and continuous bar for >40 cards"
    - "User sees an undo button that is disabled during animation phase"
    - "User sees a 5-second countdown timer on the round summary CTA area"
    - "Know and Don't Know buttons are always visible below the card stack"
  artifacts:
    - path: "src/components/sort/SortProgress.tsx"
      provides: "Dual counters + adaptive progress bar"
      exports: ["SortProgress"]
    - path: "src/components/sort/SortCountdown.tsx"
      provides: "5-second auto-start countdown for next round"
      exports: ["SortCountdown"]
    - path: "src/components/sort/KnowDontKnowButtons.tsx"
      provides: "Know/Don't Know tap buttons + Undo button"
      exports: ["KnowDontKnowButtons"]
  key_links:
    - from: "src/components/sort/SortProgress.tsx"
      to: "src/components/quiz/SegmentedProgressBar.tsx"
      via: "Reuses SegmentedProgressBar for card-count based display"
      pattern: "SegmentedProgressBar"
---

<objective>
Build the sort mode progress UI components: dual counters, adaptive progress bar, know/don't-know buttons, undo button, and countdown timer.

Purpose: These components provide the "juice" -- animated counters, color-coded progress, and tactile buttons that make sorting feel satisfying. They are presentational components that receive state and dispatch callbacks as props.

Output: `SortProgress.tsx`, `SortCountdown.tsx`, `KnowDontKnowButtons.tsx`.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/quiz/SegmentedProgressBar.tsx (reuse for segmented display)
@src/lib/sort/sortTypes.ts (SortPhase for animation gating)
@.planning/phases/23-flashcard-sort/23-RESEARCH.md
@.planning/phases/23-flashcard-sort/23-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: SortProgress and KnowDontKnowButtons components</name>
  <files>
    src/components/sort/SortProgress.tsx
    src/components/sort/KnowDontKnowButtons.tsx
  </files>
  <action>
**SortProgress.tsx** -- Dual counters + adaptive progress bar:

Props:
```typescript
interface SortProgressProps {
  totalCards: number;
  knowCount: number;
  dontKnowCount: number;
  /** Array of sort results in order: 'know' | 'dont-know' | null (unsorted) */
  segments: ('know' | 'dont-know' | null)[];
  showBurmese: boolean;
}
```

Implementation:
1. **Dual counters** -- positioned on left (Don't Know) and right (Know) of the progress bar per discretion recommendation (flanking horizontally, mirroring swipe direction):
   - Know counter: green text (`text-success`), right-aligned. Format: checkmark icon + count
   - Don't Know counter: amber/red text (`text-warning`), left-aligned. Format: X icon + count
   - **Pop animation:** Use `motion.span` with `key={count}` to trigger spring scale animation `animate={{ scale: [1.3, 1] }}` on each increment (2 keyframes only -- WAAPI safe). Use `transition={{ type: 'spring', stiffness: 500, damping: 15 }}`.
   - **Color flash:** On each increment, briefly flash the counter background using a 2-keyframe `animate={{ backgroundColor: ['var(--success)', 'transparent'] }}` for Know (or `var(--warning)` for Don't Know). The `key={count}` remount triggers both pop and flash together for "maximum juice."
   - Bilingual labels: "Know / သိပါတယ်" and "Don't Know / မသိပါ" (FLSH-08 requirement)

2. **Adaptive progress bar:**
   - If `totalCards <= 40`: Use `SegmentedProgressBar` mapping segments to existing statuses:
     - `'know'` -> `'correct'` (green)
     - `'dont-know'` -> `'incorrect'` (red)
     - `null` -> `'unanswered'` (gray)
     - Current card -> `'current'` (blue)
   - If `totalCards > 40`: Use a simple continuous bar (div with percentage width), split into green (know) and amber (dont-know) segments inside a rounded container

3. **Round counter badge:** Show "Round {n}" / "အကြိမ် {n}" when round > 1 (FLSH-09)

**KnowDontKnowButtons.tsx** -- Tap button alternatives:

Props:
```typescript
interface KnowDontKnowButtonsProps {
  onKnow: () => void;
  onDontKnow: () => void;
  onUndo: () => void;
  canUndo: boolean;
  disabled: boolean; // true during animation
  showBurmese: boolean;
}
```

Implementation:
1. **Layout:** Three buttons in a row: Don't Know (left), Undo (center, smaller), Know (right)
2. **Don't Know button:** Amber/red themed, X icon, "Don't Know" / "မသိပါ" label. 3D chunky style matching existing quiz buttons (shadow-[0_4px_0], active translate-y).
3. **Know button:** Green themed, Check icon, "Know" / "သိပါတယ်" label. Same 3D chunky style.
4. **Undo button:** Neutral/muted, Undo2 icon from lucide-react, smaller size. Disabled when `!canUndo` or `disabled`. Tooltip/label "Undo" / "ပြန်ဖျက်ပါ".
5. **All buttons disabled** when `disabled` prop is true (during animation phase).
6. **Min touch target:** 48px height for Know/Don't Know, 44px for Undo.
7. **Focus visible:** ring-2 focus indicators on all buttons.
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint -- --no-warn-ignored` -- compiles and lints cleanly.</verify>
  <done>SortProgress shows dual animated counters with bilingual labels and adaptive progress bar. KnowDontKnowButtons renders three chunky buttons (Don't Know, Undo, Know) with proper disabled states and bilingual labels.</done>
</task>

<task type="auto">
  <name>Task 2: SortCountdown component</name>
  <files>src/components/sort/SortCountdown.tsx</files>
  <action>
Create `src/components/sort/SortCountdown.tsx` -- 5-second auto-start countdown overlaid on the round summary CTA area.

Props:
```typescript
interface SortCountdownProps {
  /** Called when countdown reaches zero */
  onComplete: () => void;
  /** Called when user taps to skip countdown */
  onSkip: () => void;
  /** Called when user cancels (stop auto-start) */
  onCancel: () => void;
  showBurmese: boolean;
}
```

Implementation:
1. **Timer state:** Use `useState(5)` starting at 5. Use `useEffect` with `setInterval` at 1000ms. When timer reaches 0, call `onComplete`. Per React Compiler safety, use the step-based pattern from SessionCountdown (setCount(prev => prev - 1) inside interval).

2. **Visual:** Circular countdown indicator using SVG circle with `stroke-dasharray` and `stroke-dashoffset` animation. Number displayed in center.

3. **Buttons overlaid on CTA area:**
   - "Study Missed Cards (5s)" / "မမှန်ကတ်များကိုလေ့လာပါ" -- tapping this calls `onSkip` (starts immediately)
   - "Cancel" / "ပယ်ဖျက်ပါ" -- smaller link-style text, calls `onCancel`
   - The countdown number decrements inside the main button text

4. **Sound:** Play `playCountdownTick()` on each tick (5, 4, 3, 2, 1). Play `playCountdownGo()` on 0.

5. **Reduced motion:** If prefers-reduced-motion, show static "Starting in 5s..." text instead of animated circle.

Use `'use client'` directive.
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint -- --no-warn-ignored` -- compiles and lints cleanly.</verify>
  <done>SortCountdown shows 5-second circular countdown with tick sounds, skip/cancel buttons, and bilingual labels. Calls onComplete when timer reaches zero.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run lint -- --no-warn-ignored` passes
3. Counter animations use only 2-keyframe arrays (WAAPI safe)
4. All bilingual text present for FLSH-08 and FLSH-09 requirements
5. Buttons have minimum 44px touch targets
</verification>

<success_criteria>
- Dual counters animate with spring pop on each increment
- Progress bar switches between segmented (<=40) and continuous (>40)
- Know/Don't Know buttons are 3D chunky style matching existing quiz buttons
- Undo button disabled during animation and when undo stack is empty
- Countdown counts from 5 to 0 with tick sounds and bilingual UI
- Round counter shown for round > 1 (FLSH-09)
</success_criteria>

<output>
After completion, create `.planning/phases/23-flashcard-sort/23-05-SUMMARY.md`
</output>
