---
phase: 07-social-features
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/hooks/useStreak.ts
  - src/components/social/StreakWidget.tsx
  - src/components/social/BadgeHighlights.tsx
  - src/pages/Dashboard.tsx
  - src/lib/saveSession.ts
  - src/lib/mastery/masteryStore.ts
  - src/lib/srs/srsStore.ts
  - src/lib/interview/interviewStore.ts
autonomous: true

must_haves:
  truths:
    - "User sees fire icon with current streak count on dashboard"
    - "Streak count updates after completing any study activity"
    - "Dashboard shows both current streak and best streak"
    - "Freeze auto-use triggers bilingual toast notification"
    - "Badge highlights row shows top earned badges on dashboard"
  artifacts:
    - path: "src/hooks/useStreak.ts"
      provides: "Streak state management hook"
      exports: ["useStreak"]
    - path: "src/components/social/StreakWidget.tsx"
      provides: "Dashboard streak display widget"
      exports: ["StreakWidget"]
    - path: "src/components/social/BadgeHighlights.tsx"
      provides: "Dashboard badge row"
      exports: ["BadgeHighlights"]
  key_links:
    - from: "src/hooks/useStreak.ts"
      to: "src/lib/social/streakStore.ts"
      via: "reads/writes streak data"
      pattern: "getStreakData|recordStudyActivity"
    - from: "src/pages/Dashboard.tsx"
      to: "src/components/social/StreakWidget.tsx"
      via: "rendered as dashboard widget"
      pattern: "StreakWidget"
    - from: "src/lib/saveSession.ts"
      to: "src/lib/social/streakStore.ts"
      via: "records activity on test completion"
      pattern: "recordStudyActivity"
---

<objective>
Create the streak display widget, badge highlights row, and hook activity recording into all existing study flows (test, practice, SRS, interview, study guide).

Purpose: Users immediately see their streak count and earned badges on the dashboard. Every study activity (test, practice, SRS review, study guide visit, interview) contributes to the streak, creating a positive engagement loop.
Output: Streak widget and badge highlights on dashboard, with activity recording integrated into all existing study flows.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/07-social-features/07-RESEARCH.md
@.planning/phases/07-social-features/07-01-SUMMARY.md
@src/pages/Dashboard.tsx
@src/lib/saveSession.ts
@src/components/srs/SRSWidget.tsx (widget pattern reference)
@src/components/interview/InterviewDashboardWidget.tsx (widget pattern reference)
@src/lib/social/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: useStreak hook and activity recording integration</name>
  <files>
    src/hooks/useStreak.ts
    src/lib/saveSession.ts
    src/lib/mastery/masteryStore.ts
    src/lib/srs/srsStore.ts
    src/lib/interview/interviewStore.ts
  </files>
  <action>
    Create `src/hooks/useStreak.ts`:

    1. Custom hook `useStreak()` that loads streak data on mount via `getStreakData()` from streakStore.
    2. Returns `{ currentStreak, longestStreak, freezesAvailable, freezesUsed, activityDates, isLoading, refresh }`.
    3. Compute `currentStreak` and `longestStreak` via `calculateStreak()` from streakTracker (derived in useMemo, not useState).
    4. `refresh()` function reloads from IndexedDB (call after recording activity).
    5. On mount, check if a freeze was auto-used since last visit — if `shouldAutoUseFreeze` returns true AND freeze hasn't been applied yet for today, apply it and show bilingual toast notification via `showInfo()` from BilingualToast: EN: "Streak freeze used! Your streak is safe." / MY: "Streak freeze သုံးပြီး! သင့် streak ဘေးကင်းပါတယ်။" Include snowflake icon mention in toast.
    6. Follow React Compiler patterns: no setState in effects, use useMemo for derived state, lazy useState for initial load.

    Hook activity recording into existing study flows:

    **In `src/lib/saveSession.ts`:** After successful test save (in the saveTestSession function or equivalent), call `recordStudyActivity('test')`. Import from `@/lib/social`.

    **In `src/lib/mastery/masteryStore.ts`:** In the function that records practice answers (recordAnswer or equivalent), call `recordStudyActivity('practice')` once per session (debounce: only record if date hasn't been recorded yet — streakStore handles this internally).

    **In `src/lib/srs/srsStore.ts`:** After recording a review (the function that saves graded card state), call `recordStudyActivity('srs_review')`. Also increment `dailyActivityCounts.srsReviewCount` for freeze eligibility.

    **In `src/lib/interview/interviewStore.ts`:** After saving interview session, call `recordStudyActivity('interview')`.

    Note: Study guide visit recording will be handled by the study guide page component detecting a visit (not in this plan — the streakStore `recordStudyActivity('study_guide')` is already available for later integration, or add a simple call in StudyGuidePage's useEffect mount).

    For study guide visits, add a one-liner in the StudyGuidePage's mount effect or in the study guide's data loading function: `recordStudyActivity('study_guide')`. This should be a fire-and-forget call (no await needed).
  </action>
  <verify>TypeScript compiles. Activity recording calls are present in saveSession, masteryStore, srsStore, and interviewStore. useStreak hook returns streak data.</verify>
  <done>Every study activity (test, practice, SRS review, interview, study guide) records to streak store. useStreak hook provides reactive streak data with freeze auto-use toast.</done>
</task>

<task type="auto">
  <name>Task 2: StreakWidget, BadgeHighlights, and Dashboard integration</name>
  <files>
    src/components/social/StreakWidget.tsx
    src/components/social/BadgeHighlights.tsx
    src/pages/Dashboard.tsx
  </files>
  <action>
    Create `src/components/social/StreakWidget.tsx`:

    1. Compact dashboard widget following SRSWidget/InterviewDashboardWidget pattern (Card component).
    2. Shows: Flame icon (lucide-react) + current streak count + "day streak" / "ရက်ဆက်တိုက်" bilingual text.
    3. Below streak: "Current: N days | Best: M days" / "လက်ရှိ: N ရက် | အကောင်းဆုံး: M ရက်" dual display per user decision.
    4. Freeze indicator: Snowflake icon + freeze count (e.g., "3 freezes" with snowflake icon) if freezesAvailable > 0.
    5. Tapping widget navigates to social hub `/social#streak` (placeholder, will be created in Plan 07).
    6. Empty state: "Start studying to build your streak!" bilingual message when currentStreak = 0.
    7. Use `useStreak()` hook for data. Use `useLanguage()` for bilingual display.
    8. Styling: warm colors — text-orange-500 for fire icon, text-blue-400 for snowflake. Follow existing widget Card + padding pattern.

    Create `src/components/social/BadgeHighlights.tsx`:

    1. Horizontal scrollable row showing top 3-5 earned badges.
    2. Each badge: circular icon container with badge icon (lucide-react dynamic icon), gold background for earned, gray for locked.
    3. If no badges earned yet, show 3 locked badge placeholders with "Keep studying!" bilingual message.
    4. Tapping any badge navigates to social hub `/social#badges`.
    5. Load earned badges from `getEarnedBadges()` (badgeStore) and match against `BADGE_DEFINITIONS`.
    6. Use `useLanguage()` for badge name display.
    7. Compact layout: horizontal flex with gap-2, overflow-x-auto.

    Update `src/pages/Dashboard.tsx`:

    1. Import and render `<StreakWidget />` BEFORE the SRSWidget (first widget after ReadinessIndicator).
    2. Import and render `<BadgeHighlights />` AFTER StreakWidget, BEFORE SRSWidget.
    3. Order: ReadinessIndicator -> StreakWidget -> BadgeHighlights -> SRSWidget -> InterviewDashboardWidget -> CategoryGrid.
  </action>
  <verify>Run `npx tsc --noEmit`. Dashboard renders StreakWidget and BadgeHighlights. Widget shows streak count with fire icon.</verify>
  <done>Dashboard displays streak count with fire icon + dual streak display, badge highlights row, and both widgets integrate seamlessly with existing dashboard layout.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. StreakWidget shows on Dashboard before SRSWidget
3. BadgeHighlights shows earned badges or locked placeholders
4. Activity recording calls exist in saveSession.ts, masteryStore.ts, srsStore.ts, interviewStore.ts
5. useStreak hook shows freeze auto-use toast when applicable
6. All text is bilingual (English + Burmese)
</verification>

<success_criteria>
- User sees fire icon with streak count on dashboard immediately
- Completing any activity (test, practice, SRS, interview) updates streak
- Dual display shows "Current: N days | Best: M days"
- Freeze auto-use shows bilingual toast notification
- Badge highlights row shows top earned badges or locked placeholders
- Widget placement follows existing dashboard order pattern
</success_criteria>

<output>
After completion, create `.planning/phases/07-social-features/07-03-SUMMARY.md`
</output>
