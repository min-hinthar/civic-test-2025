---
phase: 21-test-practice-ux
plan: 09
type: execute
wave: 4
depends_on: ["21-06", "21-07"]
files_modified:
  - src/components/results/TestResultsScreen.tsx
  - src/components/results/CategoryBreakdown.tsx
  - src/components/results/QuestionReviewList.tsx
  - src/pages/TestPage.tsx
  - src/components/practice/PracticeResults.tsx
autonomous: true

must_haves:
  truths:
    - "Results screen shows big score number with pass/fail indicator"
    - "Color-coded question list shows correct/wrong/skipped status"
    - "Category breakdown shows strong/weak topic areas"
    - "SRS integration offers to add wrong answers to deck"
    - "Confetti animation plays on passing scores"
    - "Share button uses native share API"
  artifacts:
    - path: "src/components/results/TestResultsScreen.tsx"
      provides: "Redesigned test/practice results screen"
      exports: ["TestResultsScreen"]
    - path: "src/components/results/CategoryBreakdown.tsx"
      provides: "Category-level score breakdown"
      exports: ["CategoryBreakdown"]
    - path: "src/components/results/QuestionReviewList.tsx"
      provides: "Filterable color-coded question review list"
      exports: ["QuestionReviewList"]
  key_links:
    - from: "src/components/results/TestResultsScreen.tsx"
      to: "src/components/celebrations/Confetti.tsx"
      via: "renders confetti on pass"
      pattern: "Confetti"
    - from: "src/components/results/TestResultsScreen.tsx"
      to: "src/components/social/ShareButton.tsx"
      via: "renders share button"
      pattern: "ShareButton"
    - from: "src/pages/TestPage.tsx"
      to: "src/components/results/TestResultsScreen.tsx"
      via: "renders results when finished"
      pattern: "TestResultsScreen"
---

<objective>
Create the redesigned test/practice results screen with score display, category breakdown, question review, SRS integration, and celebrations.

Purpose: Replace the current inline results view with a comprehensive, visually rich results experience that helps users understand their performance and take action.
Output: TestResultsScreen.tsx, CategoryBreakdown.tsx, QuestionReviewList.tsx, updated TestPage.tsx and PracticeResults.tsx
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-test-practice-ux/21-CONTEXT.md
@.planning/phases/21-test-practice-ux/21-06-SUMMARY.md
@.planning/phases/21-test-practice-ux/21-07-SUMMARY.md

@src/pages/TestPage.tsx
@src/components/practice/PracticeResults.tsx
@src/components/celebrations/Confetti.tsx
@src/components/celebrations/CountUpScore.tsx
@src/components/social/ShareButton.tsx
@src/components/srs/AddToDeckButton.tsx
@src/components/explanations/ExplanationCard.tsx
@src/components/nudges/WeakAreaNudge.tsx
@src/lib/mastery/categoryMapping.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: CategoryBreakdown and QuestionReviewList components</name>
  <files>src/components/results/CategoryBreakdown.tsx, src/components/results/QuestionReviewList.tsx</files>
  <action>
**CategoryBreakdown.tsx:**

Props:
```typescript
interface CategoryBreakdownProps {
  results: QuestionResult[];
  showBurmese: boolean;
}
```

Implementation per locked decisions:
- Group results by category
- For each category, show: category name, correct/total count, percentage bar, strong/weak indicator
- Use CATEGORY_COLORS from mastery mapping for color coding
- Weak categories (< 50%): amber highlight with "Needs Review" label
- Strong categories (>= 80%): green highlight with "Strong" label
- Staggered entrance animation (FadeIn with delay per category)
- Compact cards with rounded corners, subtle border
- Bilingual category names when showBurmese

**QuestionReviewList.tsx:**

Props:
```typescript
interface QuestionReviewListProps {
  results: QuestionResult[];
  skippedQuestionIds?: string[];
  questions: Question[];         // Full question data for explanations
  mode: 'mock-test' | 'practice';
  showBurmese: boolean;
  filter: 'all' | 'incorrect' | 'skipped';
  onFilterChange: (filter: 'all' | 'incorrect' | 'skipped') => void;
}
```

Implementation per locked decisions:
- Color-coded question list: green border for correct, red/amber for incorrect, amber-yellow for skipped
- Filter toggle: All / Incorrect Only / Skipped (tab-style selector)
- Each question card shows:
  - Question text (bilingual when showBurmese)
  - User's answer (styled correct/incorrect)
  - Correct answer
  - SpeechButton for question and answer audio
  - AddToDeckButton for SRS integration
  - ExplanationCard (expandable) when explanation exists
  - DynamicAnswerNote when question is dynamic
- SRS integration per locked decision: "Add to Review Deck" button on each wrong answer
- Batch SRS offer: Banner at top "Add all X wrong answers to your review deck?" with single button
- Staggered list entrance animation
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint`. Both components export correctly.</verify>
  <done>CategoryBreakdown shows strong/weak topic areas with color coding. QuestionReviewList shows filterable color-coded questions with SRS integration, explanations, and audio playback.</done>
</task>

<task type="auto">
  <name>Task 2: TestResultsScreen and integration into TestPage + PracticeResults</name>
  <files>src/components/results/TestResultsScreen.tsx, src/pages/TestPage.tsx, src/components/practice/PracticeResults.tsx</files>
  <action>
**TestResultsScreen.tsx:**

Props:
```typescript
interface TestResultsScreenProps {
  results: QuestionResult[];
  questions: Question[];
  mode: 'mock-test' | 'practice';
  endReason: TestEndReason | null;
  timeTaken: number;              // seconds
  previousAttempts?: { score: number; total: number; date: string }[];
  skippedQuestionIds?: string[];
  showBurmese: boolean;
  onRetry: () => void;
  onReviewWrongOnly: () => void;   // Filter to wrong+skipped only
  onHome: () => void;
}
```

Implementation per locked decisions:
- **Big score number**: CountUpScore component with animated count-up + pass/fail indicator. For pass (>=12 in mock, >=60% in practice): green glow badge. For fail: amber review badge.
- **Confetti on passing**: Confetti component fires with 'celebration' intensity on pass, 'burst' on completion.
- **Sound effect**: playMilestone() on pass, playLevelUp() on completion.
- **Time taken**: Display "Duration: X mins Y sec" with comparison to previous attempts if available. Show improvement/regression indicator.
- **Action buttons**: Retry (same quiz - reload), Review (wrong + skipped only filter), Home (navigate to /dashboard). 3D chunky button style.
- **Share button**: ShareButton with existing shareCardData pattern from TestPage.
- **Category breakdown**: Render CategoryBreakdown component.
- **Question review**: Render QuestionReviewList with filter controls.
- **End reason message**: Bilingual message explaining why test ended (pass threshold, fail threshold, time, complete).
- **SRS batch offer**: Banner: "You got X questions wrong. Add them to your review deck?" with "Add All" button that calls addToDeck for each wrong question.
- **Weak area nudge**: Reuse existing WeakAreaNudge component.
- **Scroll to top on mount**: window.scrollTo({ top: 0, behavior: 'smooth' })

**Update TestPage.tsx:**
- Replace the inline `resultView` JSX block with `<TestResultsScreen>` component
- Pass all required props from quiz state
- onRetry: window.location.reload()
- onReviewWrongOnly: scroll to question list with filter set to 'incorrect'
- onHome: navigate('/dashboard')
- Keep existing session save logic
- Pass previousAttempts from test history if available

**Update PracticeResults.tsx:**
- Replace the current results view with `<TestResultsScreen mode="practice">` component
- Pass results, questions, and practice-specific props
- Keep existing mastery animation and category color
- onRetry: reset practice and go back to config
- onHome: navigate to dashboard
  </action>
  <verify>Run `npx tsc --noEmit`, `npm run lint`, `npm run build`. Navigate to test results -- verify big score, confetti, category breakdown, and question review all render.</verify>
  <done>TestResultsScreen provides comprehensive results with score animation, confetti, category breakdown, filterable question review, SRS batch offer, share button, and action buttons. Integrated into both TestPage and PracticeResults.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run lint` passes
- `npm run build` succeeds
- Results screen shows big score with pass/fail
- Confetti fires on passing
- Category breakdown shows strong/weak areas
- Question review is filterable with SRS integration
- Share button works
</verification>

<success_criteria>
- Comprehensive results screen with all locked decision features
- Shared between mock test and practice modes
- SRS batch offer for wrong answers
- Category breakdown with strong/weak indicators
- Confetti + sound on passing
</success_criteria>

<output>
After completion, create `.planning/phases/21-test-practice-ux/21-09-SUMMARY.md`
</output>
