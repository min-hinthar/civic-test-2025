---
phase: 28-interview-ux-voice-flow-polish
plan: 08
type: execute
wave: 3
depends_on: [28-04]
files_modified:
  - scripts/generate-interview-audio.ts
  - src/lib/interview/interviewGreetings.ts
  - src/lib/interview/interviewFeedback.ts
autonomous: true
requirements: [IVPOL-01, IVPOL-05]
must_haves:
  truths:
    - "Feedback phrase audio files exist for practice mode correct/incorrect responses"
    - "interviewFeedback.ts exports phrase text + audio filename mappings"
    - "interviewGreetings.ts updated with any new greeting/closing variations"
    - "Edge-tts generation script produces feedback MP3s with Ava voice"
  artifacts:
    - path: "src/lib/interview/interviewFeedback.ts"
      provides: "Feedback phrase text + audio mappings"
      exports: ["getCorrectFeedback", "getIncorrectFeedback", "FEEDBACK_AUDIO_NAMES"]
    - path: "scripts/generate-interview-audio.ts"
      provides: "Edge-tts script for generating interview feedback audio"
  key_links:
    - from: "src/lib/interview/interviewFeedback.ts"
      to: "src/lib/audio/audioPlayer.ts"
      via: "audio filenames used with getInterviewAudioUrl"
      pattern: "getInterviewAudioUrl"
---

<objective>
Generate interview feedback phrase audio and create the feedback phrase mapping module.

Purpose: CONTEXT.md requires all examiner speech to be pre-generated MP3, including feedback phrases like "That's correct!" and "Not quite right." Currently only `correct-prefix.mp3` and `incorrect-prefix.mp3` exist. This plan generates additional feedback variations and creates the mapping module.

Output: Feedback phrase MP3 audio files and `interviewFeedback.ts` module
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/lib/interview/interviewGreetings.ts
@src/lib/audio/audioPlayer.ts
@scripts/generate-burmese-audio.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create interview feedback phrases module</name>
  <files>src/lib/interview/interviewFeedback.ts</files>
  <action>
Create `src/lib/interview/interviewFeedback.ts`:

Define USCIS-realistic feedback phrases. USCIS officers use brief, professional acknowledgments:

**Correct feedback phrases** (3 variations):
```typescript
const CORRECT_FEEDBACK: Array<{ text: string; audio: string }> = [
  { text: "That's correct.", audio: 'feedback-correct-01' },
  { text: "Yes, that's right.", audio: 'feedback-correct-02' },
  { text: "Correct.", audio: 'feedback-correct-03' },
];
```

**Incorrect feedback phrases** (3 variations):
```typescript
const INCORRECT_FEEDBACK: Array<{ text: string; audio: string }> = [
  { text: "That's not quite right.", audio: 'feedback-incorrect-01' },
  { text: "I'm sorry, that's not correct.", audio: 'feedback-incorrect-02' },
  { text: "Not quite.", audio: 'feedback-incorrect-03' },
];
```

Export functions:
- `getCorrectFeedback(): { text: string; audio: string }` -- random selection from correct pool
- `getIncorrectFeedback(): { text: string; audio: string }` -- random selection from incorrect pool
- `FEEDBACK_AUDIO_NAMES: string[]` -- all feedback audio filenames (for pre-caching)

Follow same pattern as `interviewGreetings.ts` (random selection from pool, text + audio pairs).
  </action>
  <verify>TypeScript compiles. Exports match expected interface.</verify>
  <done>interviewFeedback.ts provides feedback phrases with audio mappings following greetings pattern</done>
</task>

<task type="auto">
  <name>Task 2: Generate feedback audio files via edge-tts</name>
  <files>scripts/generate-interview-audio.ts</files>
  <action>
Create `scripts/generate-interview-audio.ts`:

Use the same pattern as `scripts/generate-burmese-audio.ts` (reference existing script).

1. Use `@andresaya/edge-tts` with voice `en-US-AvaMultilingualNeural` (same voice as existing interview audio)
2. Generate 6 feedback MP3 files:
   - `feedback-correct-01.mp3` through `feedback-correct-03.mp3`
   - `feedback-incorrect-01.mp3` through `feedback-incorrect-03.mp3`
3. Output directory: `public/audio/en-US/ava/interview/`
4. Rate: "+0%" (normal speed -- matches existing interview audio)
5. Add dry-run mode flag for testing
6. Log each file generated with size

Run the script: `npx ts-node scripts/generate-interview-audio.ts`

Verify output files exist and are reasonable size (10-50KB each for short phrases).

Also update `src/lib/audio/audioPrecache.ts` to include `FEEDBACK_AUDIO_NAMES` from `interviewFeedback.ts` in the pre-cache URL list. Import and spread into the INTERVIEW_AUDIO_NAMES array.
  </action>
  <verify>Audio files exist in `public/audio/en-US/ava/interview/`. `npm run typecheck` passes.</verify>
  <done>6 feedback audio files generated, audioPrecache updated to include them in pre-cache list</done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- 6 new MP3 files exist in `public/audio/en-US/ava/interview/`
- `npm run lint` passes
- audioPrecache includes feedback audio names
</verification>

<success_criteria>
- Feedback phrases match USCIS officer communication style (brief, professional)
- Audio files generated with consistent Ava voice matching existing interview audio
- Pre-cache module includes feedback audio in its URL list
- Both correct and incorrect feedback have 3 variations for natural variety
</success_criteria>

<output>
After completion, create `.planning/phases/28-interview-ux-voice-flow-polish/28-08-SUMMARY.md`
</output>
