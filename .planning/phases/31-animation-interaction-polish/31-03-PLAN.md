---
phase: 31-animation-interaction-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/globals.css
  - src/styles/tokens.css
autonomous: true
requirements: [ANIM-05]

must_haves:
  truths:
    - "All glass panels show a subtle noise/grain SVG texture overlay for realistic frosted look"
    - "Noise texture is more visible in dark mode (0.06 opacity) than light mode (0.03 opacity)"
    - "Text on glass surfaces has subtle text-shadow for WCAG readability"
    - "All glass tiers have a subtle semi-transparent white border highlight"
    - "Glass panels have subtle shadow underneath reinforcing floating/depth feel"
    - "Dark mode glass panels have smoky/dark tinted car window feel"
    - "No backdrop-filter support: semi-transparent solid color fallback"
    - "prefers-reduced-motion or low-end device: noise texture removed for performance"
    - "Glass noise pseudo-element has pointer-events: none (does not block clicks)"
  artifacts:
    - path: "src/styles/globals.css"
      provides: "Glass noise texture via ::before pseudo-element, text-shadow, border highlight, shadow"
      contains: "glass-light::before"
    - path: "src/styles/tokens.css"
      provides: "Glass-specific design tokens if needed"
      contains: "glass"
  key_links:
    - from: "src/styles/globals.css"
      to: "src/styles/tokens.css"
      via: "CSS custom properties for glass tiers"
      pattern: "var\\(--glass"
---

<objective>
Polish the glass-morphism tier system with noise texture overlay, text-shadow readability, border highlights, and dark mode smoky glass treatment.

Purpose: The glass-morphism tiers are functionally correct but visually basic. Adding noise/grain texture makes frosted glass look physically realistic (not "too clean digital"). Text-shadow ensures WCAG readability on translucent backgrounds. Subtle white borders add light refraction. Dark mode gets a smoky, tinted-car-window treatment that feels premium.

Output: Enhanced glass CSS classes in globals.css with noise texture, text-shadow, border highlight, and shadow depth. Verified dark mode treatment.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/styles/globals.css
@src/styles/tokens.css
@src/components/ui/GlassCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add noise texture, text-shadow, border, and shadow to glass tiers</name>
  <files>src/styles/globals.css</files>
  <action>
Enhance the existing `.glass-light`, `.glass-medium`, `.glass-heavy` classes with visual features specified in user decisions.

**1. SVG noise texture via `::before` pseudo-element:**

Add to globals.css after the existing glass class definitions:

```css
/* Glass noise texture overlay for realistic frosted glass */
.glass-light,
.glass-medium,
.glass-heavy {
  position: relative;
}

.glass-light::before,
.glass-medium::before,
.glass-heavy::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  opacity: 0.03;
  pointer-events: none;
  z-index: 1;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 128px 128px;
  mix-blend-mode: overlay;
}

/* Dark mode: more visible noise texture */
.dark .glass-light::before,
.dark .glass-medium::before,
.dark .glass-heavy::before {
  opacity: 0.06;
}
```

**IMPORTANT:** Many glass elements already have `position: relative` via `.prismatic-border`. Check for conflicts. The `.prismatic-border` class already sets `position: relative`, so adding it again is harmless (CSS is idempotent). Verify that `z-index: 1` on the pseudo-element does not cover content — glass element content should have a higher stacking context. Add `isolation: isolate` to glass classes to create a new stacking context, OR ensure child content uses `position: relative; z-index: 2` via a utility. Simpler: set `z-index: 0` on `::before` and rely on DOM order (content comes after `::before` in render, so it naturally stacks on top). Use `z-index: 0` to be safe.

Actually, `::before` is rendered BEFORE element content in DOM order, so content naturally sits on top. Set `z-index: 0` on `::before` to be explicit.

**2. Text-shadow for readability on glass:**

```css
/* Text readability on glass surfaces */
.glass-light,
.glass-medium,
.glass-heavy {
  text-shadow: 0 1px 2px hsl(var(--color-background) / 0.3);
}

.dark .glass-light,
.dark .glass-medium,
.dark .glass-heavy {
  text-shadow: 0 1px 3px hsl(0 0% 0% / 0.5);
}
```

**3. Subtle semi-transparent white border highlight:**

```css
/* Light refraction border highlight */
.glass-light,
.glass-medium,
.glass-heavy {
  border: 1px solid hsl(0 0% 100% / 0.15);
}

.dark .glass-light,
.dark .glass-medium,
.dark .glass-heavy {
  border: 1px solid hsl(0 0% 100% / 0.08);
}
```

**NOTE:** Some glass elements already have borders (e.g., `border border-border/60` on Dialog content). The CSS specificity of `.glass-heavy` is lower than inline Tailwind `border-*` classes, so this won't conflict. But check that the new border doesn't double up. The glass border is the "light refraction" highlight — it should be the subtle white edge. If a component already has a border, the white highlight should be the `::after` pseudo-element instead, or applied only when no other border exists. Simplest approach: use `box-shadow: inset 0 0 0 1px hsl(0 0% 100% / 0.15)` instead of `border`. This avoids border conflicts entirely:

```css
.glass-light,
.glass-medium,
.glass-heavy {
  box-shadow: inset 0 0 0 1px hsl(0 0% 100% / 0.15), /* white highlight */
              0 4px 16px hsl(0 0% 0% / 0.08); /* subtle depth shadow */
}

.dark .glass-light,
.dark .glass-medium,
.dark .glass-heavy {
  box-shadow: inset 0 0 0 1px hsl(0 0% 100% / 0.08), /* subtler in dark */
              0 4px 20px hsl(0 0% 0% / 0.25); /* deeper shadow in dark */
}
```

**CAUTION:** Some glass elements already have `box-shadow` from Tailwind (e.g., `shadow-2xl`). CSS `box-shadow` from a class definition gets overridden by Tailwind utilities. Use a dedicated custom property approach OR apply via a more specific selector. Actually, the glass classes in globals.css already use `@layer base` or are in the component layer. Tailwind utilities have higher specificity. So this `box-shadow` would be overridden by any Tailwind `shadow-*` class.

Better approach: Add the inset highlight and depth shadow as ADDITIONAL box-shadows that combine with existing ones. Since CSS box-shadow doesn't compound (last declaration wins), use a different approach: apply the inset highlight via `::after` pseudo-element:

Actually, the cleanest approach given existing Tailwind usage: add the depth shadow and white highlight to the glass class definitions themselves (they're already in `@layer components`), and let components that need custom shadows override with Tailwind. The white highlight can be via `outline: 1px solid hsl(0 0% 100% / 0.15)` which doesn't conflict with border or box-shadow:

```css
.glass-light,
.glass-medium,
.glass-heavy {
  /* Light refraction edge highlight (uses outline to avoid border/box-shadow conflicts) */
  outline: 1px solid hsl(0 0% 100% / 0.15);
  outline-offset: -1px;
}
```

Use `outline` with negative offset to render inside the element boundary, similar to an inset border but without conflicting with `border` or `box-shadow`.

**4. Dark mode smoky glass treatment:**

The existing dark mode glass classes in globals.css already set background colors. Enhance them for the "smoky/tinted car window" feel:
- Increase opacity slightly for the smoky effect
- The existing token `--glass-light-opacity` etc. control this — check values in tokens.css and adjust if needed for darker, smokier backgrounds

Check `tokens.css` for current dark mode glass opacity values. If they're too transparent, bump them up (e.g., from 0.6 to 0.7) for the smoky feel.

**5. Reduced motion / low-end performance:**

```css
@media (prefers-reduced-motion: reduce) {
  .glass-light::before,
  .glass-medium::before,
  .glass-heavy::before {
    display: none; /* Remove noise texture for performance */
  }
}
```

**6. Heavy tier colored tints:**

Per user decision, heavy tier gets "subtle colored tints from context (e.g., blue for modals, warm for success)." Add a CSS custom property that consumers can set:

```css
.glass-heavy {
  /* Contextual tint overlay - set --glass-tint-color on parent to activate */
  background: linear-gradient(
    hsl(var(--glass-tint-color, var(--color-surface)) / var(--glass-heavy-opacity)),
    hsl(var(--glass-tint-color, var(--color-surface)) / var(--glass-heavy-opacity))
  );
}
```

Actually, this is complex and may cause issues with the existing background. Simpler: add a `glass-tint-*` utility class set:

```css
.glass-tint-blue { --glass-tint: hsl(var(--color-primary) / 0.05); }
.glass-tint-warm { --glass-tint: hsl(30 80% 50% / 0.05); }
.glass-tint-success { --glass-tint: hsl(var(--color-success) / 0.05); }
```

Then in the glass-heavy class, layer the tint:
```css
.glass-heavy {
  background: var(--glass-tint, transparent),
              hsl(var(--color-surface) / var(--glass-heavy-opacity));
}
```

This is Claude's discretion territory. Keep it simple — add the `--glass-tint` custom property support but don't assign tints to specific components yet (that's an audit/consumer task, not infrastructure).

**7. Fallback for no backdrop-filter support (already exists — verify):**

The existing globals.css has a `@supports not (backdrop-filter: blur(1px))` block. Verify it covers all three tiers and provides opaque fallback backgrounds. If it does, no changes needed.
  </action>
  <verify>
- `npm run lint:css` passes (stylelint)
- `npm run build` completes without errors
- Glass noise `::before` pseudo-element is present on all three tier classes
- `pointer-events: none` is set on `::before`
- Text-shadow is applied to glass classes
- Dark mode has higher noise opacity (0.06 vs 0.03)
- `prefers-reduced-motion` removes noise texture
- No z-index conflicts (content still clickable through noise overlay)
  </verify>
  <done>
Glass-morphism tiers enhanced with noise/grain SVG texture overlay, text-shadow for readability, light refraction edge highlight, and depth shadow. Dark mode is smokier with more visible noise. Reduced motion removes texture. Heavy tier supports optional colored tints via CSS custom property. Fallback for no backdrop-filter support verified.
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit glass tier assignments across all components</name>
  <files>src/styles/globals.css</files>
  <action>
Audit all glass usage across the codebase to verify correct tier assignment. Based on research audit summary:

**Expected tier assignments:**
- **Heavy tier (overlays, navigation chrome):** Dialog, BottomTabBar, Sidebar, GlassHeader
- **Medium tier (featured content, hero):** OpEdPage header — verify this is correct
- **Light tier (regular cards, list items, sections):** TestPage sections, PracticeSession, SkippedReviewPhase, TestResultsScreen, ReviewCard, HubSkeleton

**Actions:**
1. Search for all `glass-light`, `glass-medium`, `glass-heavy`, `glass-card` usage across `.tsx` files
2. For each usage, verify it matches the expected tier:
   - Overlays/modals → heavy
   - Navigation chrome → heavy or medium
   - Hero/featured sections → medium
   - Regular content cards → light
   - Skeleton placeholders → light
3. Migrate `glass-card` (legacy alias) to `glass-light` in HistoryTab
4. Check that inline glass-* class usage matches what GlassCard component would provide
5. Document any tier mismatches found but do NOT change component files in this task (just CSS). Tier changes in component files would conflict with other Wave 1 plans.
6. Add a CSS comment block documenting the tier assignment guide:

```css
/* Glass-morphism Tier Guide:
 * - light: Regular cards, list items, sections, skeleton placeholders
 * - medium: Hero cards, featured content, navigation headers
 * - heavy: Modals, dialogs, overlays, bottom sheets, navigation chrome
 */
```

7. If any CSS-only adjustments are needed (e.g., adjusting dark mode opacity tokens for smokier feel), make those in tokens.css.
  </action>
  <verify>
- `npm run lint:css` passes
- No `glass-card` usage remains (migrated to `glass-light`)
- Tier assignment guide comment is in globals.css
- All glass tier CSS changes pass build
  </verify>
  <done>
Glass tier assignments audited. Legacy `glass-card` alias usage identified and migration documented. Tier assignment guide added to CSS. Any CSS-level adjustments for dark mode smokiness applied in tokens.css.
  </done>
</task>

</tasks>

<verification>
- `npm run lint:css` passes
- `npm run build` completes without errors
- Glass noise texture renders on glass panels (visual check in browser)
- Content inside glass panels remains clickable (pointer-events: none on noise)
- Dark mode shows smokier glass with more visible grain
- Text on glass is readable with text-shadow enhancement
</verification>

<success_criteria>
Glass panels across the app show subtle frosted noise texture, have text-shadow for readability, display a light refraction edge highlight, and cast a subtle depth shadow. Dark mode glass feels like smoky tinted car windows with more visible grain. Reduced motion removes the noise texture for performance. Heavy tier supports optional colored tints via CSS custom property.
</success_criteria>

<output>
After completion, create `.planning/phases/31-animation-interaction-polish/31-03-SUMMARY.md`
</output>
