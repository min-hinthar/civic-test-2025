---
phase: 20-session-persistence
plan: 03
type: execute
wave: 2
depends_on: ["20-01"]
files_modified:
  - src/components/sessions/ResumePromptModal.tsx
  - src/components/sessions/ResumeSessionCard.tsx
  - src/components/sessions/StartFreshConfirm.tsx
autonomous: true

must_haves:
  truths:
    - "Modal is non-dismissible -- cannot be closed via backdrop click or Escape"
    - "Modal shows session cards with type icon, progress, score, time info, and relative timestamp"
    - "User must choose Resume, Start Fresh, or Not Now -- no other way to dismiss"
    - "Start Fresh requires confirmation before discarding saved session"
    - "Modal text is bilingual following language mode"
    - "Resume button is auto-focused for immediate Enter key resumption"
    - "Multiple saved sessions appear as stacked cards inside the same modal"
  artifacts:
    - path: "src/components/sessions/ResumePromptModal.tsx"
      provides: "Non-dismissible Radix Dialog modal with session cards and 3 action buttons"
      exports: ["ResumePromptModal"]
    - path: "src/components/sessions/ResumeSessionCard.tsx"
      provides: "Individual session card with type-specific icon, color, progress info"
      exports: ["ResumeSessionCard"]
    - path: "src/components/sessions/StartFreshConfirm.tsx"
      provides: "Inline confirmation replacing action buttons when Start Fresh is clicked"
      exports: ["StartFreshConfirm"]
  key_links:
    - from: "src/components/sessions/ResumePromptModal.tsx"
      to: "src/components/ui/Dialog.tsx"
      via: "Uses Dialog, DialogContent, DialogTitle with onInteractOutside/onEscapeKeyDown prevention"
      pattern: "onInteractOutside.*preventDefault"
    - from: "src/components/sessions/ResumeSessionCard.tsx"
      to: "src/lib/sessions/timeAgo.ts"
      via: "Formats savedAt as relative timestamp"
      pattern: "import.*timeAgo"
    - from: "src/components/sessions/ResumePromptModal.tsx"
      to: "src/lib/sessions/sessionTypes.ts"
      via: "Uses SessionSnapshot type for session cards"
      pattern: "import.*SessionSnapshot"
---

<objective>
Build the resume prompt UI components: the non-dismissible modal, individual session cards, and inline Start Fresh confirmation.

Purpose: These components present saved sessions to the user and let them choose to resume, start fresh, or defer. They are used by TestPage, PracticePage, and InterviewPage to show the resume prompt on mount.

Output: 3 new components under `src/components/sessions/`.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/20-session-persistence/20-RESEARCH.md
@.planning/phases/20-session-persistence/20-CONTEXT.md
@.planning/phases/20-session-persistence/20-01-SUMMARY.md
@src/components/ui/Dialog.tsx
@src/components/dashboard/NBAHeroCard.tsx
@src/lib/sessions/sessionTypes.ts
@src/lib/sessions/timeAgo.ts
@src/contexts/LanguageContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: ResumeSessionCard component</name>
  <files>src/components/sessions/ResumeSessionCard.tsx</files>
  <action>
Create `src/components/sessions/ResumeSessionCard.tsx`:

**Props:**
```typescript
interface ResumeSessionCardProps {
  session: SessionSnapshot;
  onResume: () => void;
  onStartFresh: () => void;
  isSelected?: boolean;
}
```

**Visual design (per user decisions -- card style matches dashboard):**

1. **Card container:**
   - `rounded-2xl border p-4 shadow-sm` (matches dashboard card style)
   - Border color varies by session type:
     - mock-test: `border-primary/30 bg-primary-subtle/10`
     - practice: `border-success/30 bg-success-subtle/10`
     - interview: `border-accent/30 bg-accent-subtle/10`

2. **Left icon (per session type):**
   - mock-test: `ClipboardCheck` icon in `text-primary`
   - practice: `BookOpen` icon in `text-success`
   - interview: `Mic` icon in `text-accent`
   - Icon size: `h-8 w-8` in a `h-12 w-12 rounded-xl bg-{color}-subtle/20 flex items-center justify-center`

3. **Content (metadata only, no question snippet -- per discretion):**
   - Session type label (bilingual): "Mock Test" / "Practice: {categoryName}" / "Interview: {mode}"
   - Progress: "Q{currentIndex + 1}/{questions.length}" with score "{correctCount}/{results.length} correct"
   - Timer info (if applicable): "Time remaining: {timeLeft formatted}" or "Untimed" for practice without timer
   - Relative timestamp: use `timeAgo(session.savedAt)` -- display `en` or bilingual based on language mode
   - Layout: icon left, text content right, compact

4. **Derive display data from snapshot type:**
   - Use discriminated union narrowing: `if (session.type === 'mock-test') { ... }`
   - Mock test: show Q{currentIndex+1}/20, score {correctCount}/{results.length}, time {timeLeft}
   - Practice: show Q{currentIndex+1}/{questions.length}, score, category name from config
   - Interview: show Q{currentIndex+1}/{questions.length}, {correctCount} correct / {incorrectCount} incorrect, mode

5. **No action buttons on the card itself** -- actions are at the modal level. The card is purely informational.
  </action>
  <verify>
`npm run typecheck` passes. Component renders session info correctly for each session type (mock-test, practice, interview).
  </verify>
  <done>
ResumeSessionCard displays session-type-specific icon, color accent, progress metadata, score, timer info, and relative timestamp. Supports all three session types via discriminated union narrowing. Bilingual text follows language mode.
  </done>
</task>

<task type="auto">
  <name>Task 2: ResumePromptModal and StartFreshConfirm</name>
  <files>src/components/sessions/ResumePromptModal.tsx, src/components/sessions/StartFreshConfirm.tsx</files>
  <action>
Create `src/components/sessions/StartFreshConfirm.tsx`:

**Props:**
```typescript
interface StartFreshConfirmProps {
  onConfirm: () => void;
  onCancel: () => void;
}
```

Inline confirmation component (replaces action buttons when Start Fresh is clicked -- per discretion: inline swap, not sub-dialog):
- Warning icon (AlertTriangle from lucide-react) in amber/warning color
- Message: "Are you sure? Your progress will be lost." (bilingual)
- Two buttons: "Discard" (destructive, red/warning) and "Cancel" (outline)
- Use `AnimatePresence` with crossfade for smooth transition from action buttons
- "Cancel" returns to the original three-button state (parent manages this via state)

Create `src/components/sessions/ResumePromptModal.tsx`:

**Props:**
```typescript
interface ResumePromptModalProps {
  sessions: SessionSnapshot[];
  open: boolean;
  onResume: (session: SessionSnapshot) => void;
  onStartFresh: (session: SessionSnapshot) => void;
  onNotNow: () => void;
}
```

**Non-dismissible modal (per user decision):**

1. Use the existing `Dialog` + `DialogContent` from `@/components/ui/Dialog.tsx`
2. Pass `showCloseButton={false}` to DialogContent (removes X button)
3. Pass `onInteractOutside={(e) => e.preventDefault()}` to prevent backdrop close
4. Pass `onEscapeKeyDown={(e) => e.preventDefault()}` to prevent Escape close
5. The `onOpenChange` on `<Dialog>` should be a no-op (`() => {}`) since we control open state

**Modal content layout:**

1. **Title:** "Welcome back!" in friendly tone (bilingual: "ပြန်လာတာ ကြိုဆိုပါတယ်!")
   - Use DialogTitle component
   - Below title: "Pick up where you left off" (bilingual subtitle)

2. **Session cards:** Map over `sessions` array, render `ResumeSessionCard` for each
   - If only 1 session, show it directly
   - If multiple, stack cards with `space-y-3` gap
   - Track `selectedSessionId` state -- when multiple sessions exist, user must select one before Resume works
   - Single session: auto-selected

3. **Action buttons (3 buttons per user decision):**
   - **Resume** (primary, chunky 3D style): calls `onResume(selectedSession)`. Auto-focused via `autoFocus` prop. Disabled if no session selected (multiple sessions case).
   - **Start Fresh** (outline): triggers inline StartFreshConfirm swap. When confirmed, calls `onStartFresh(selectedSession)`.
   - **Not Now** (ghost/text): calls `onNotNow()`. Keeps session saved for next visit.
   - Button layout: Resume prominent at top, Start Fresh and Not Now below in a row

4. **State for inline confirmation:**
   - `confirmingFresh: boolean` state
   - When true, replace the 3 action buttons with `StartFreshConfirm`
   - When StartFreshConfirm's onCancel fires, set `confirmingFresh` back to false
   - Use `AnimatePresence` for crossfade between action buttons and confirmation

5. **Animation:**
   - Modal entrance: handled by existing DialogContent spring animation (SPRING_BOUNCY)
   - The existing Dialog wrapper already handles slide-up animation

6. **Keyboard support:**
   - Focus trap is handled by Radix Dialog automatically
   - Resume button gets `autoFocus` so Enter resumes immediately
   - Tab order: Resume -> Start Fresh -> Not Now

7. **Loading animation for Resume:**
   - When Resume is clicked, show a brief loading spinner (~0.5-1s) before calling `onResume`
   - Use a small `setTimeout` to simulate loading, then call the callback
   - During loading, disable all buttons and show a spinner icon on the Resume button

8. **Bilingual text:**
   - Use `useLanguage()` to get `showBurmese`
   - Title: "Welcome back!" / "ပြန်လာတာ ကြိုဆိုပါတယ်!"
   - Subtitle: "Pick up where you left off" / "ဖြေဆိုထားတာကို ဆက်လက်ဖြေဆိုပါ"
   - Resume: "Resume" / "ဆက်ဖြေမည်"
   - Start Fresh: "Start Fresh" / "အသစ်ဖြေမည်"
   - Not Now: "Not Now" / "နောက်မှ"
   - Discard confirmation: "Are you sure? Your progress will be lost." / "သေချာပါသလား? သင့်တိုးတက်မှု ဆုံးရှုံးပါမည်။"
  </action>
  <verify>
`npm run typecheck` passes. `npm run lint` passes. Modal opens with non-dismissible behavior. Focus trap works. Resume button is auto-focused. Start Fresh shows inline confirmation. All text is bilingual.
  </verify>
  <done>
ResumePromptModal is non-dismissible, shows session cards, has Resume/Start Fresh/Not Now actions. Start Fresh has inline confirmation. All text is bilingual. Focus trap and keyboard navigation work correctly. Loading animation shows on Resume click.
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes for all 3 new files
2. `npm run lint` passes
3. Modal cannot be closed via backdrop click or Escape key
4. Session cards display correct type-specific icons and colors
5. Start Fresh inline confirmation appears with crossfade animation
6. Resume button is auto-focused on modal open
7. All visible text has bilingual support
8. Multiple sessions display as stacked cards
</verification>

<success_criteria>
- 3 components created and exported correctly
- Modal is non-dismissible (only closable via the 3 action buttons)
- Session cards show type-specific visual treatment
- Start Fresh requires confirmation before proceeding
- Full keyboard navigation with focus trap
- Bilingual text throughout following language mode
</success_criteria>

<output>
After completion, create `.planning/phases/20-session-persistence/20-03-SUMMARY.md`
</output>
