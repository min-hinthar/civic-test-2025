---
phase: 07-social-features
plan: 08
type: execute
wave: 4
depends_on: ["07-03", "07-05", "07-06", "07-07"]
files_modified:
  - src/components/AppNavigation.tsx
  - src/AppShell.tsx
  - src/pages/Dashboard.tsx
  - src/pages/TestPage.tsx
  - src/pages/PracticePage.tsx
  - src/pages/InterviewPage.tsx
  - src/pages/HistoryPage.tsx
  - src/pages/StudyGuidePage.tsx
  - src/lib/i18n/strings.ts
autonomous: true

must_haves:
  truths:
    - "Social hub accessible from main navigation"
    - "SocialProvider wraps app in provider hierarchy"
    - "Share button appears after passing test/practice/interview results"
    - "Share button appears on history page entries"
    - "Badge celebration modal shows when new badge earned"
    - "Study guide visit records streak activity"
    - "Composite score updates to Supabase after activities"
    - "Navigation strings include Social Hub bilingual label"
  artifacts:
    - path: "src/components/AppNavigation.tsx"
      provides: "Updated navigation with social hub link"
      contains: "social"
    - path: "src/AppShell.tsx"
      provides: "SocialProvider in provider hierarchy and /social route"
      contains: "SocialProvider"
  key_links:
    - from: "src/AppShell.tsx"
      to: "src/contexts/SocialContext.tsx"
      via: "provider wrapping"
      pattern: "SocialProvider"
    - from: "src/AppShell.tsx"
      to: "src/pages/SocialHubPage.tsx"
      via: "route definition"
      pattern: "Route.*social"
    - from: "src/components/AppNavigation.tsx"
      to: "/social"
      via: "nav link"
      pattern: "href.*social"
---

<objective>
Complete the social features integration: add the Social Hub to navigation and routing, wire SocialProvider into the app, place share buttons on result pages, trigger badge celebrations, record study guide activity, and update composite scores after activities.

Purpose: This final plan connects all the independently-built social components into a cohesive user experience. Users discover social features through navigation, see celebrations on achievements, and can share their results — completing the social engagement loop.
Output: Fully integrated social features accessible from navigation, with share buttons on all result screens and badge celebrations triggering naturally.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/07-social-features/07-RESEARCH.md
@.planning/phases/07-social-features/07-03-SUMMARY.md
@.planning/phases/07-social-features/07-05-SUMMARY.md
@.planning/phases/07-social-features/07-06-SUMMARY.md
@.planning/phases/07-social-features/07-07-SUMMARY.md
@src/AppShell.tsx
@src/components/AppNavigation.tsx
@src/pages/TestPage.tsx
@src/pages/PracticePage.tsx
@src/pages/InterviewPage.tsx
@src/pages/HistoryPage.tsx
@src/pages/StudyGuidePage.tsx
@src/pages/Dashboard.tsx
@src/lib/i18n/strings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: AppShell routing, SocialProvider integration, and navigation</name>
  <files>
    src/AppShell.tsx
    src/components/AppNavigation.tsx
    src/lib/i18n/strings.ts
  </files>
  <action>
    Update `src/AppShell.tsx`:

    1. Import `SocialProvider` from `@/contexts/SocialContext`.
    2. Import `SocialHubPage` (lazy import like other pages, or direct import).
    3. Add `<SocialProvider>` in the provider hierarchy. Place it inside `AuthProvider` (needs auth) and inside `SRSProvider` (peer level). Position: wrap the Router or inside Router before Routes.
    4. Add route: `<Route path="/social" element={<SocialHubPage />} />`. Note: Social hub is viewable without authentication (leaderboard is public), so do NOT wrap in `<ProtectedRoute>`. The page itself handles auth-gated features internally.

    Update `src/components/AppNavigation.tsx`:

    1. Add social hub to `navLinks` array: `{ href: '/social', label: strings.nav.socialHub }`.
    2. Position it after "Test History" link (last in nav before settings, or before history — use judgment for natural placement).
    3. Import Trophy icon from lucide-react (optional: add icon to nav items if the pattern supports it).

    Update `src/lib/i18n/strings.ts`:

    1. Add `socialHub` to `strings.nav`: `{ en: 'Community', my: 'အသိုင်းအဝိုင်း' }`.
    2. Add any missing social-related strings that are needed for navigation and shared UI.
  </action>
  <verify>TypeScript compiles. Navigation shows Social Hub link. Route /social renders SocialHubPage. SocialProvider is in the provider tree.</verify>
  <done>Social hub accessible via main navigation, SocialProvider wraps the app, /social route renders without requiring authentication.</done>
</task>

<task type="auto">
  <name>Task 2: Share buttons on result pages, badge celebrations, study guide activity, and composite score updates</name>
  <files>
    src/pages/TestPage.tsx
    src/pages/PracticePage.tsx
    src/pages/InterviewPage.tsx
    src/pages/HistoryPage.tsx
    src/pages/StudyGuidePage.tsx
    src/pages/Dashboard.tsx
  </files>
  <action>
    **Share buttons on result screens:**

    In `src/pages/TestPage.tsx` (test results section):
    - Import `ShareButton` from `@/components/social/ShareButton`.
    - After the test results are shown (when the user has completed and results are displayed), render `<ShareButton data={shareCardData} />` next to existing action buttons.
    - Only show when score meets passing threshold (currently 6/10, use the existing passed logic).
    - Construct `ShareCardData` from test results: score, total, sessionType='test', streak from useStreak(), topBadge from useBadges(), categories from test category breakdown.

    In `src/pages/PracticePage.tsx` (practice results section):
    - Add `<ShareButton data={shareCardData} />` on the results screen.
    - Construct ShareCardData with sessionType='practice'.

    In `src/pages/InterviewPage.tsx` (interview results section):
    - Add `<ShareButton data={shareCardData} />` on the results screen.
    - Construct ShareCardData with sessionType='interview'.

    In `src/pages/HistoryPage.tsx`:
    - Add compact `<ShareButton data={shareCardData} variant="compact" />` on each history entry row.
    - Construct ShareCardData from the history entry's data.

    **Badge celebrations on Dashboard:**

    In `src/pages/Dashboard.tsx`:
    - Import `useBadges` hook and `BadgeCelebration` component.
    - Construct `BadgeCheckData` from existing dashboard data: streak from useStreak(), test accuracy from test history, coverage from mastery data.
    - Call `useBadges(badgeCheckData)` to detect newly earned badges.
    - Render `<BadgeCelebration badge={newlyEarnedBadge} onDismiss={() => dismissCelebration(newlyEarnedBadge.id)} />`.
    - This triggers when user navigates to dashboard after earning a badge.

    **Leaderboard widget on Dashboard:**

    In `src/pages/Dashboard.tsx`:
    - Import `LeaderboardWidget` from `@/components/social/LeaderboardWidget`.
    - Render `<LeaderboardWidget />` after InterviewDashboardWidget, before CategoryGrid.
    - Order: ReadinessIndicator -> StreakWidget -> BadgeHighlights -> SRSWidget -> InterviewDashboardWidget -> LeaderboardWidget -> CategoryGrid.

    **Study guide activity recording:**

    In `src/pages/StudyGuidePage.tsx`:
    - Import `recordStudyActivity` from `@/lib/social`.
    - On mount (useEffect), call `recordStudyActivity('study_guide')` — fire-and-forget (no await needed). This records the visit for streak tracking.
    - Only call once per mount (cleanup not needed for fire-and-forget).

    **Composite score updates:**

    After activity recording in the places where `recordStudyActivity` is called (saveSession, masteryStore, srsStore, interviewStore — already done in Plan 03), also call `updateCompositeScore()` from socialProfileSync if user is authenticated. This can be done by:
    - In the useStreak hook's refresh or in a new effect in Dashboard that detects streak changes → recalculates composite score → calls updateCompositeScore().
    - OR: Add a `syncCompositeScore()` call in the SocialContext that runs on streak/badge data change.
    - Choose the approach that avoids setState in effects. Recommended: SocialContext watches for auth changes and periodically syncs composite score, or Dashboard triggers sync on mount.
  </action>
  <verify>TypeScript compiles. Share buttons appear on test/practice/interview results. Badge celebration shows on dashboard. Study guide visit records activity. Composite score syncs to Supabase.</verify>
  <done>Share buttons on all result pages. Badge celebrations trigger from Dashboard. Study guide visits count for streaks. Composite scores update in Supabase for leaderboard ranking. LeaderboardWidget visible on Dashboard.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Navigation includes Social Hub / Community link
3. /social route loads without authentication
4. SocialProvider is in the provider hierarchy
5. Share button appears after passing test results
6. Share button appears on practice and interview results
7. History page entries have compact share buttons
8. Badge celebration modal triggers on dashboard when new badge earned
9. Study guide page records activity for streak tracking
10. LeaderboardWidget shows on dashboard after other widgets
11. All new text is bilingual
</verification>

<success_criteria>
- Social features are discoverable via main navigation
- Share buttons are contextually placed after results (not intrusive)
- Badge celebrations are delightful and bilingual
- All study activities contribute to streak (test, practice, SRS, interview, study guide)
- Composite score stays current in Supabase for accurate leaderboard ranking
- App works fully without social features (additive, not blocking)
- Non-authenticated users can navigate to /social and view leaderboard
</success_criteria>

<output>
After completion, create `.planning/phases/07-social-features/07-08-SUMMARY.md`
</output>
