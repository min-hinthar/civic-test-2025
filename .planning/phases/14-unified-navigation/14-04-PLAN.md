---
phase: 14-unified-navigation
plan: 04
type: execute
wave: 3
depends_on: ["14-02", "14-03"]
files_modified:
  - src/components/navigation/NavigationShell.tsx
  - src/AppShell.tsx
  - src/lib/i18n/strings.ts
autonomous: true

must_haves:
  truths:
    - "NavigationShell orchestrates showing Sidebar (md+) or BottomTabBar (below md) based on route"
    - "AppShell wraps all routes in NavigationProvider and NavigationShell"
    - "Old routes (/dashboard, /progress, /history, /social) redirect to new routes (/home, /hub)"
    - "Routes /history and /social redirect with brief loading state to /hub#history and /hub#social"
    - "Nav strings include Progress Hub label"
  artifacts:
    - path: "src/components/navigation/NavigationShell.tsx"
      provides: "Shell that orchestrates Sidebar + BottomTabBar visibility"
      min_lines: 20
    - path: "src/AppShell.tsx"
      provides: "Updated app shell with NavigationProvider, NavigationShell, new routes"
  key_links:
    - from: "src/components/navigation/NavigationShell.tsx"
      to: "src/components/navigation/Sidebar.tsx"
      via: "conditional render"
      pattern: "<Sidebar"
    - from: "src/components/navigation/NavigationShell.tsx"
      to: "src/components/navigation/BottomTabBar.tsx"
      via: "conditional render"
      pattern: "<BottomTabBar"
    - from: "src/AppShell.tsx"
      to: "src/components/navigation/NavigationProvider.tsx"
      via: "context provider wrapping routes"
      pattern: "<NavigationProvider"
    - from: "src/AppShell.tsx"
      to: "src/components/navigation/NavigationShell.tsx"
      via: "shell wrapping page content"
      pattern: "<NavigationShell"
---

<objective>
Wire everything together: create NavigationShell to orchestrate nav surfaces, update AppShell to use NavigationProvider + NavigationShell, add route redirects for renamed routes, and update i18n strings.

Purpose: This is the integration point -- the app shell switches from per-page nav to shell-level nav, and old routes redirect to new ones so bookmarks and external links don't break.
Output: NavigationShell.tsx, updated AppShell.tsx, updated strings.ts
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-unified-navigation/14-CONTEXT.md
@.planning/phases/14-unified-navigation/14-RESEARCH.md
@.planning/phases/14-unified-navigation/14-01-SUMMARY.md
@.planning/phases/14-unified-navigation/14-02-SUMMARY.md
@.planning/phases/14-unified-navigation/14-03-SUMMARY.md
@src/AppShell.tsx
@src/components/navigation/Sidebar.tsx
@src/components/navigation/BottomTabBar.tsx
@src/components/navigation/NavigationProvider.tsx
@src/components/navigation/navConfig.ts
@src/lib/i18n/strings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NavigationShell and update AppShell</name>
  <files>
    src/components/navigation/NavigationShell.tsx
    src/AppShell.tsx
  </files>
  <action>
**NavigationShell.tsx** -- Orchestrates which nav surface to show based on route.

```typescript
function NavigationShell({ children }: { children: ReactNode }) {
  const location = useLocation();
  const isPublicRoute = HIDDEN_ROUTES.includes(location.pathname);

  return (
    <>
      {!isPublicRoute && <Sidebar />}
      {children}
      {!isPublicRoute && <BottomTabBar />}
    </>
  );
}
```

Import HIDDEN_ROUTES from navConfig. Import Sidebar and BottomTabBar. Both components internally handle their own responsive visibility (Sidebar: `hidden md:flex`, BottomTabBar: `md:hidden`), so NavigationShell just needs to conditionally render them based on route.

Export as named export.

**AppShell.tsx** -- Major updates:

1. **Add NavigationProvider wrapping Router contents:**
   Insert `<NavigationProvider>` inside `<Router>` but wrapping `<ErrorBoundary>`, `<PageTransition>`, `<NavigationShell>`, and all existing overlay components.

2. **Add NavigationShell wrapping page content:**
   Wrap `<PageTransition><Routes>...</Routes></PageTransition>` inside `<NavigationShell>`.

3. **Remove BottomTabBar direct render:**
   Delete the standalone `<BottomTabBar />` line at the bottom of Router children. It's now rendered by NavigationShell.

4. **Route changes per user decisions:**

   Keep existing routes for:
   - `/` (LandingPage)
   - `/auth` (AuthPage)
   - `/auth/forgot` (PasswordResetPage)
   - `/auth/update-password` (PasswordUpdatePage)
   - `/op-ed` (OpEdPage)
   - `/study` (StudyGuidePage)
   - `/test` (TestPage)
   - `/practice` (PracticePage)
   - `/interview` (InterviewPage)
   - `/settings` (SettingsPage)

   Rename routes:
   - `/dashboard` -> render `<Navigate to="/home" replace />` (redirect)
   - `/progress` -> render `<Navigate to="/hub" replace />` (redirect)
   - Add `/home` route rendering `<ProtectedRoute><Dashboard /></ProtectedRoute>` (same component, new route)
   - Add `/hub` route rendering `<ProtectedRoute><ProgressPage /></ProtectedRoute>` (same component, new route)

   Redirect routes (with brief loading state):
   - `/history` -> render `<RedirectWithLoading to="/hub#history" />` (redirect to hub with hash)
   - `/social` -> render `<RedirectWithLoading to="/hub#social" />` (redirect to hub with hash)

   Create a small `RedirectWithLoading` component inline in AppShell:
   ```typescript
   function RedirectWithLoading({ to }: { to: string }) {
     return (
       <div className="flex h-screen items-center justify-center bg-background">
         <div className="animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full" />
         <Navigate to={to} replace />
       </div>
     );
   }
   ```

   Keep catch-all: `<Route path="*" element={<Navigate to="/" replace />} />`

5. **Update imports:**
   - Add: `NavigationProvider`, `NavigationShell`
   - Remove: `BottomTabBar` direct import (it's now rendered by NavigationShell)
   - Keep all page imports for now (pages still use AppNavigation internally -- that's removed in Plan 05)

6. **Update OnboardingTour route check:**
   The tour currently checks `location.pathname === '/dashboard'`. This needs to change to `'/home'`. But OnboardingTour is in its own file -- that update happens in Plan 07. For now, the `/dashboard` -> `/home` redirect means users will land on `/home` and the tour won't fire until updated. This is acceptable as a temporary gap.

7. **Provider hierarchy:**
   ```
   <Router>
     <NavigationProvider>
       <Head>...</Head>
       <ErrorBoundary>
         <NavigationShell>
           <PageTransition>
             <Routes>...</Routes>
           </PageTransition>
         </NavigationShell>
       </ErrorBoundary>
       <PWAOnboardingFlow />
       <OnboardingTour />
       <GreetingFlow />
       <SyncStatusIndicator />
     </NavigationProvider>
   </Router>
   ```

   NavigationProvider must be inside Router (it uses useLocation internally via useScrollDirection). It wraps everything else that needs nav state.
  </action>
  <verify>
Run `npx tsc --noEmit` and `npx eslint src/components/navigation/NavigationShell.tsx src/AppShell.tsx --max-warnings 0`. Verify that `/dashboard` route now renders `<Navigate to="/home" replace />`. Verify NavigationProvider wraps Router contents. Verify BottomTabBar is no longer directly rendered in AppShell.
  </verify>
  <done>
NavigationShell orchestrates Sidebar + BottomTabBar based on route. AppShell has NavigationProvider wrapping all Router children, NavigationShell wrapping page content, route redirects for /dashboard->/home, /progress->/hub, /history->/hub#history, /social->/hub#social. Catch-all still works. Provider hierarchy correct.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update i18n strings for new nav labels</name>
  <files>src/lib/i18n/strings.ts</files>
  <action>
Update the nav section of strings.ts:

1. Add `progressHub` entry: `{ en: 'Progress Hub', my: 'တိုးတက်မှုဗဟို' }` (or keep the existing `progress` label if "Progress Hub" is only used in navConfig directly -- check navConfig.ts to see if it references strings.ts or has inline labels).

2. Since navConfig.ts has inline label strings (per Plan 01 design -- `label: 'Progress Hub'`), the i18n strings update is minimal. But ensure existing strings like `strings.nav.dashboard`, `strings.nav.progress`, `strings.nav.testHistory`, `strings.nav.socialHub` are NOT deleted -- they may be referenced elsewhere in the codebase (page titles, headers, etc.).

3. Add new nav string if needed:
   - `home: { en: 'Home', my: 'ပင်မ' }` -- already exists in strings.ts

4. Verify all nav strings that navConfig references are available. If navConfig uses inline strings, no changes needed here. If it references `strings.nav.*`, ensure the keys match.

5. Check for any other places in the codebase that use `strings.nav.dashboard` or `strings.nav.testHistory` -- if they do, keep those strings (they may be used in page titles). Add a comment noting these are kept for backward compatibility with page headers.

This task is intentionally small -- the i18n impact is minimal because navConfig uses inline labels.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no broken string references. Grep for `strings.nav.` to confirm all usages still have valid string entries.
  </verify>
  <done>
i18n strings are updated with any new nav labels needed. Existing strings preserved for backward compatibility with page headers.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npx eslint src/components/navigation/NavigationShell.tsx src/AppShell.tsx src/lib/i18n/strings.ts --max-warnings 0` passes
- Navigating to `/dashboard` in browser redirects to `/home`
- Navigating to `/progress` redirects to `/hub`
- Navigating to `/history` shows spinner then redirects to `/hub#history`
- Navigating to `/social` shows spinner then redirects to `/hub#social`
- NavigationProvider context is accessible from any component inside Router
</verification>

<success_criteria>
AppShell integrates the unified navigation system. All route redirects work. NavigationShell conditionally renders Sidebar/BottomTabBar. The old BottomTabBar standalone render is removed. Compiles and lints cleanly.
</success_criteria>

<output>
After completion, create `.planning/phases/14-unified-navigation/14-04-SUMMARY.md`
</output>
