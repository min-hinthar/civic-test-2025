---
phase: 14-unified-navigation
plan: 06
type: execute
wave: 5
depends_on: ["14-05"]
files_modified:
  - src/components/animations/PageTransition.tsx
  - src/components/onboarding/OnboardingTour.tsx
  - src/pages/SettingsPage.tsx
  - src/components/AppNavigation.tsx
autonomous: true

must_haves:
  truths:
    - "Page transitions slide left/right based on tab order (higher tab = slide left, lower tab = slide right)"
    - "Onboarding tour targets nav items (nav-study, nav-test, nav-interview, nav-hub) instead of dashboard widgets"
    - "Tour runs on /home route and works with both sidebar and bottom bar targets"
    - "Settings page has Appearance section with Language and Theme toggles"
    - "AppNavigation.tsx is deleted"
  artifacts:
    - path: "src/components/animations/PageTransition.tsx"
      provides: "Direction-aware page transitions based on tab order"
    - path: "src/components/onboarding/OnboardingTour.tsx"
      provides: "Overhauled tour targeting nav items"
    - path: "src/pages/SettingsPage.tsx"
      provides: "Settings with Appearance section toggles"
  key_links:
    - from: "src/components/animations/PageTransition.tsx"
      to: "src/components/navigation/navConfig.ts"
      via: "getSlideDirection for transition direction"
      pattern: "getSlideDirection"
    - from: "src/components/onboarding/OnboardingTour.tsx"
      to: "nav items with data-tour attributes"
      via: "Joyride step targets"
      pattern: "data-tour.*nav-"
---

<objective>
Complete the finishing touches: direction-aware page transitions, overhauled onboarding tour, Settings page appearance section, and AppNavigation deletion. These are the final functional pieces that make the unified navigation feel polished and complete.

Purpose: Page transitions give spatial context to navigation (sliding left vs right). The onboarding tour teaches users the new nav structure. Settings page provides an alternative location for language/theme toggles. Deleting AppNavigation completes the migration.
Output: 3 updated files, 1 deleted file
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-unified-navigation/14-CONTEXT.md
@.planning/phases/14-unified-navigation/14-RESEARCH.md
@.planning/phases/14-unified-navigation/14-05-SUMMARY.md
@src/components/animations/PageTransition.tsx
@src/components/onboarding/OnboardingTour.tsx
@src/pages/SettingsPage.tsx
@src/components/navigation/navConfig.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Direction-aware page transitions and onboarding tour overhaul</name>
  <files>
    src/components/animations/PageTransition.tsx
    src/components/onboarding/OnboardingTour.tsx
  </files>
  <action>
**PageTransition.tsx -- Direction-aware slide transitions:**

Per user decision: slide transitions between tabs based on tab order (higher tab = slide left, lower tab = slide right).

Current implementation uses a fixed slide-right animation (x: 20 -> 0 -> -20). Change to direction-aware:

1. Import `getSlideDirection` from `@/components/navigation/navConfig`.
2. Track previous pathname using `useRef` (not useState -- we need the previous value without triggering re-render). Note React Compiler: ref access during render is not allowed -- use the ref only in the useMemo callback which is allowed since it's a side-effect-free computation.

   Actually, to avoid React Compiler ref issues: use `useState` with the "adjust state when props change" pattern:
   ```typescript
   const [prevPath, setPrevPath] = useState(location.pathname);
   const [direction, setDirection] = useState<'left' | 'right'>('right');

   if (prevPath !== location.pathname) {
     setDirection(getSlideDirection(prevPath, location.pathname));
     setPrevPath(location.pathname);
   }
   ```

3. Create direction-aware variants:
   ```typescript
   const getVariants = (dir: 'left' | 'right') => ({
     initial: { opacity: 0, x: dir === 'left' ? 30 : -30 },
     enter: { opacity: 1, x: 0 },
     exit: { opacity: 0, x: dir === 'left' ? -30 : 30 },
   });
   ```

4. Use `getVariants(direction)` instead of the static `pageVariants`.

5. Keep reduced motion handling: when shouldReduceMotion is true, use the existing instant-transition variants.

6. Keep the existing transition timing (type: 'tween', ease: 'easeInOut', duration: 0.2).

**OnboardingTour.tsx -- Target nav items instead of dashboard widgets:**

Per user decision: Replace all 4 dashboard widget steps (study-action, test-action, srs-deck, interview-sim) with nav tab highlights (nav-study, nav-test, nav-interview, nav-hub).

1. **Update route check:** Change `location.pathname === '/dashboard'` to `location.pathname === '/home'` (the tour runs on the home page now).

2. **Replace tour steps.** New 6-step tour (down from 8):

   Step 0 (body, center): "Welcome to Your Home" -- Welcome screen explaining the app. Keep bilingual content.

   Step 1 (body, center): StateSelectContent -- Same state picker step. No changes.

   Step 2 (`[data-tour="nav-study"]`): "Study with Flashcards" -- Highlight the Study tab in navigation. Placement: 'right' on desktop (sidebar is on left), 'top' on mobile (bottom bar is at bottom).
   - Use the responsive placement: detect if element is in sidebar or bottom bar. Simplest approach: use `placement: 'auto'` and let Joyride figure it out, OR detect `window.innerWidth >= 768` for placement choice.
   - Content: Keep existing bilingual text about studying flashcards and the SRS system (combine study-action + srs-deck content since both are now represented by one Study tab).

   Step 3 (`[data-tour="nav-test"]`): "Practice with Mock Tests" -- Highlight the Mock Test tab. Same responsive placement.

   Step 4 (`[data-tour="nav-interview"]`): "Interview Simulation" -- Highlight the Interview tab. Same responsive placement.

   Step 5 (`[data-tour="nav-hub"]`): "Track Your Progress" -- Highlight the Progress Hub tab. Explain that progress, history, and community features are all here.

   Step 6 (body, center): "You're All Set!" -- Same celebration step. No changes.

   Total: 7 steps (0-6), down from 8. The theme customization step is removed (it was body-centered and vague; users can find theme toggle in nav bar and Settings).

3. **Update the `isOnDashboard` check** to `isOnHome`:
   ```typescript
   const isOnHome = location.pathname === '/home';
   ```
   Update all references from `isOnDashboard` to `isOnHome`.

4. **Update Settings replay button target:** In SettingsPage.tsx (Task 2), the replay button navigates to `/dashboard`. Change to `/home`.

5. **Responsive placement helper:**
   ```typescript
   function getNavPlacement(): 'right' | 'top' {
     if (typeof window === 'undefined') return 'top';
     return window.innerWidth >= 768 ? 'right' : 'top';
   }
   ```
   Use this for nav item steps. Note: Joyride recalculates on resize, so a static initial value is fine.

6. Keep: Joyride dynamic import, custom TourTooltip, polling for welcome/what's-new screens, callback handling, localStorage completion tracking.
  </action>
  <verify>
Run `npx tsc --noEmit` and `npx eslint src/components/animations/PageTransition.tsx src/components/onboarding/OnboardingTour.tsx --max-warnings 0`. Verify OnboardingTour targets `[data-tour="nav-study"]` etc. Verify PageTransition imports getSlideDirection.
  </verify>
  <done>
PageTransition slides left/right based on tab order. OnboardingTour targets 4 nav items (nav-study, nav-test, nav-interview, nav-hub) with responsive placement. Tour runs on /home. SRS deck step merged into Study tab step.
  </done>
</task>

<task type="auto">
  <name>Task 2: Settings Appearance section + delete AppNavigation.tsx</name>
  <files>
    src/pages/SettingsPage.tsx
    src/components/AppNavigation.tsx
  </files>
  <action>
**SettingsPage.tsx -- Add Language and Theme toggles to Appearance section:**

Per user decision: Language toggle and Theme toggle added under "Appearance" section. They supplement the nav bar toggles (both locations available).

The Appearance section already exists in SettingsPage.tsx with the Display Language row. Add a Theme toggle row:

1. Import `useThemeContext` from `@/contexts/ThemeContext` (if not already imported).
2. Add a new `SettingsRow` after the Display Language row in the Appearance section:
   ```typescript
   <SettingsRow
     label="Theme"
     labelMy="အပြင်အဆင်"
     description="Switch between light and dark mode"
     descriptionMy="အလင်းနှင့် အမှာင်မုဒ် ပြောင်းလဲပါ"
     showBurmese={showBurmese}
     action={
       <ToggleSwitch
         checked={theme === 'dark'}
         onChange={toggleTheme}
         ariaLabel="Toggle dark mode"
       />
     }
   />
   ```
3. The LanguageToggle is already in the Appearance section. No change needed there.

4. **Update onboarding replay button:** Change `navigate('/dashboard')` to `navigate('/home')` in the replay onboarding button onClick handler.

**Delete AppNavigation.tsx:**

Delete `src/components/AppNavigation.tsx`. After Plan 05, zero files import it.

1. Verify no imports remain: `grep -r "AppNavigation" src/` should only show the file itself.
2. Delete the file: `rm src/components/AppNavigation.tsx`
3. This is the final cleanup -- the old desktop top nav is fully replaced by the Sidebar.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no broken imports after deletion. Run `npx eslint src/pages/SettingsPage.tsx --max-warnings 0`. Verify `src/components/AppNavigation.tsx` no longer exists. Verify SettingsPage has Theme toggle in Appearance section. Verify replay button navigates to `/home`.
  </verify>
  <done>
Settings page Appearance section has both Language and Theme toggles. Onboarding replay navigates to /home. AppNavigation.tsx is deleted. Zero references to the old component remain in the codebase.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npx eslint src/components/animations/PageTransition.tsx src/components/onboarding/OnboardingTour.tsx src/pages/SettingsPage.tsx --max-warnings 0` passes
- `ls src/components/AppNavigation.tsx` returns "no such file"
- `grep -r "AppNavigation" src/` returns zero results
- PageTransition imports getSlideDirection from navConfig
- OnboardingTour checks `/home` not `/dashboard`
- OnboardingTour step targets include `nav-study`, `nav-test`, `nav-interview`, `nav-hub`
- SettingsPage has Theme toggle under Appearance section
</verification>

<success_criteria>
Direction-aware page transitions work based on tab order. Onboarding tour targets nav items with responsive placement. Settings has theme toggle in Appearance section. AppNavigation.tsx is deleted and has zero references. All files compile and lint cleanly.
</success_criteria>

<output>
After completion, create `.planning/phases/14-unified-navigation/14-06-SUMMARY.md`
</output>
