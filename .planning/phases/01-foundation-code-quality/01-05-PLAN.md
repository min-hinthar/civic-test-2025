---
phase: 01-foundation-code-quality
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/constants/questions/index.ts
  - src/constants/questions/american-government.ts
  - src/constants/questions/american-history-colonial.ts
  - src/constants/questions/american-history-1800s.ts
  - src/constants/questions/american-history-recent.ts
  - src/constants/questions/rights-responsibilities.ts
  - src/constants/questions/symbols-holidays.ts
  - src/constants/civicsQuestions.ts
  - src/types/index.ts
  - src/pages/TestPage.tsx
  - src/pages/StudyGuidePage.tsx
autonomous: true

must_haves:
  truths:
    - "Each question has a stable unique ID (e.g., GOV-01, HIST-C15)"
    - "Questions are split into category-specific files"
    - "Existing functionality unchanged (tests, study guide work)"
  artifacts:
    - path: "src/constants/questions/index.ts"
      provides: "Aggregated questions export"
      exports: ["civicsQuestions", "questionById", "questionsByCategory"]
    - path: "src/constants/questions/american-government.ts"
      provides: "Government category questions"
      contains: "GOV-"
    - path: "src/constants/questions/american-history-colonial.ts"
      provides: "Colonial history questions"
      contains: "HIST-C"
  key_links:
    - from: "src/pages/TestPage.tsx"
      to: "src/constants/questions/index.ts"
      via: "import civicsQuestions"
      pattern: "civicsQuestions"
    - from: "src/constants/questions/index.ts"
      to: "src/constants/questions/*.ts"
      via: "aggregation"
      pattern: "import.*from"
---

<objective>
Split the monolithic questions file into per-category modules with stable unique IDs for reliable SRS tracking.

Purpose: The current 1691-line civicsQuestions.ts file is difficult to maintain. Stable IDs enable Phase 5 spaced repetition without data migration. Category-based files enable future lazy loading and targeted updates. This satisfies FNDN-10.

Output: Per-category question files with stable IDs (GOV-01, HIST-C01, etc.), barrel file aggregating all questions, backwards-compatible exports.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-code-quality/01-RESEARCH.md
@src/constants/civicsQuestions.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Question type to use string IDs and create category files structure</name>
  <files>src/types/index.ts, src/constants/questions/american-government.ts, src/constants/questions/american-history-colonial.ts</files>
  <action>
**1. Update src/types/index.ts Question interface:**

Change the `id` field from `number` to `string`:

```typescript
export interface Question {
  id: string;  // Changed from number to string for stable IDs like 'GOV-01'
  question_en: string;
  question_my: string;
  category: Category;
  studyAnswers: StudyAnswer[];
  answers: Answer[];
}
```

Also update QuestionResult:

```typescript
export interface QuestionResult {
  questionId: string;  // Changed from number
  questionText_en: string;
  questionText_my: string;
  selectedAnswer: Answer;
  correctAnswer: Answer;
  isCorrect: boolean;
  category: Category;
}
```

**2. Create src/constants/questions/ directory structure**

Create the directory: `src/constants/questions/`

**3. Create src/constants/questions/american-government.ts:**

This file covers categories:
- 'Principles of American Democracy' (prefix: GOV-P)
- 'System of Government' (prefix: GOV-S)

```typescript
import type { Question } from '@/types';

/**
 * American Government questions (Principles + System)
 * ID Format: GOV-P## for Principles, GOV-S## for System
 */
export const americanGovernmentQuestions: Question[] = [
  // Principles of American Democracy
  {
    id: 'GOV-P01',
    question_en: 'What is the supreme law of the land?',
    question_my: 'နိုင်ငံ၏ အမြင့်ဆုံးဥပဒေကား အဘယ်နည်း။',
    category: 'Principles of American Democracy',
    studyAnswers: [
      { text_en: 'the Constitution', text_my: 'ဖွဲ့စည်းပုံအခြေခံဥပဒေ' }
    ],
    answers: [
      { text_en: 'the Constitution', text_my: 'ဖွဲ့စည်းပုံအခြေခံဥပဒေ', correct: true },
      { text_en: 'the Declaration of Independence', text_my: 'လွတ်လပ်ရေးကြေညာစာတမ်း', correct: false },
      { text_en: 'the Articles of Confederation', text_my: 'ကွန်ဖက်ဒရေးရှင်း ဆောင်းပါးများ', correct: false },
      { text_en: 'the Emancipation Proclamation', text_my: 'လွတ်မြောက်ရေး ကြေညာချက်', correct: false },
    ],
  },
  // ... Continue with all Principles and System of Government questions
  // Copy from existing civicsQuestions.ts, updating IDs to GOV-P## and GOV-S## format
];
```

**4. Create src/constants/questions/american-history-colonial.ts:**

```typescript
import type { Question } from '@/types';

/**
 * American History: Colonial Period and Independence
 * ID Format: HIST-C##
 */
export const colonialHistoryQuestions: Question[] = [
  {
    id: 'HIST-C01',
    // ... questions from 'American History: Colonial Period and Independence' category
  },
];
```

Note: For this task, create the file structure and convert the first 10-15 questions from each category to demonstrate the pattern. Task 2 will complete the migration.
  </action>
  <verify>
Run `npm run typecheck` - may have errors until all files updated, but type changes should be valid.
Verify src/constants/questions/ directory exists with initial files.
  </verify>
  <done>Question type updated to string IDs, directory structure created, first category files started</done>
</task>

<task type="auto">
  <name>Task 2: Complete all category files with migrated questions</name>
  <files>src/constants/questions/american-history-1800s.ts, src/constants/questions/american-history-recent.ts, src/constants/questions/rights-responsibilities.ts, src/constants/questions/symbols-holidays.ts</files>
  <action>
Complete migration of all questions from src/constants/civicsQuestions.ts into category files.

**ID Prefix Mapping (from RESEARCH.md):**
- `GOV-P##`: Principles of American Democracy (questions 1-12 in original)
- `GOV-S##`: System of Government (questions 13-47 in original)
- `HIST-C##`: American History: Colonial Period and Independence
- `HIST-1##`: American History: 1800s
- `HIST-R##`: Recent American History and Other Important Historical Information
- `RR-##`: Rights and Responsibilities
- `SYM-##`: Civics: Symbols and Holidays

**Create remaining files:**

**1. src/constants/questions/american-history-1800s.ts:**
```typescript
import type { Question } from '@/types';

/**
 * American History: 1800s
 * ID Format: HIST-1##
 */
export const history1800sQuestions: Question[] = [
  {
    id: 'HIST-101',
    // ... migrate questions from '1800s' category
  },
];
```

**2. src/constants/questions/american-history-recent.ts:**
```typescript
import type { Question } from '@/types';

/**
 * Recent American History and Other Important Historical Information
 * ID Format: HIST-R##
 */
export const recentHistoryQuestions: Question[] = [
  {
    id: 'HIST-R01',
    // ... migrate questions from 'Recent' category
  },
];
```

**3. src/constants/questions/rights-responsibilities.ts:**
```typescript
import type { Question } from '@/types';

/**
 * Rights and Responsibilities
 * ID Format: RR-##
 */
export const rightsResponsibilitiesQuestions: Question[] = [
  {
    id: 'RR-01',
    // ... migrate questions from 'Rights' category
  },
];
```

**4. src/constants/questions/symbols-holidays.ts:**
```typescript
import type { Question } from '@/types';

/**
 * Civics: Symbols and Holidays
 * ID Format: SYM-##
 */
export const symbolsHolidaysQuestions: Question[] = [
  {
    id: 'SYM-01',
    // ... migrate questions from 'Symbols' category
  },
];
```

**Migration Process:**
1. Read existing civicsQuestions.ts
2. For each question, determine category and assign new ID
3. Copy question to appropriate file with new string ID
4. Ensure all questions are migrated (should be 100+ questions total)

**Important:** Maintain exact question content - only change the `id` field from number to string format.
  </action>
  <verify>
Count questions in each file - total should match original civicsQuestions.ts count.
Run `npm run typecheck` - may still have import errors until index.ts created.
  </verify>
  <done>All questions migrated to category files with stable string IDs</done>
</task>

<task type="auto">
  <name>Task 3: Create barrel file and update imports throughout codebase</name>
  <files>src/constants/questions/index.ts, src/constants/civicsQuestions.ts, src/pages/TestPage.tsx, src/pages/StudyGuidePage.tsx, src/contexts/SupabaseAuthContext.tsx</files>
  <action>
**1. Create src/constants/questions/index.ts (barrel file):**

```typescript
import type { Question, Category } from '@/types';
import { americanGovernmentQuestions } from './american-government';
import { colonialHistoryQuestions } from './american-history-colonial';
import { history1800sQuestions } from './american-history-1800s';
import { recentHistoryQuestions } from './american-history-recent';
import { rightsResponsibilitiesQuestions } from './rights-responsibilities';
import { symbolsHolidaysQuestions } from './symbols-holidays';

/**
 * All civics questions aggregated from category modules.
 * Maintains backwards compatibility with existing imports.
 */
export const civicsQuestions: Question[] = [
  ...americanGovernmentQuestions,
  ...colonialHistoryQuestions,
  ...history1800sQuestions,
  ...recentHistoryQuestions,
  ...rightsResponsibilitiesQuestions,
  ...symbolsHolidaysQuestions,
];

/**
 * Lookup question by stable ID.
 * Useful for SRS card retrieval.
 */
export const questionById = new Map<string, Question>(
  civicsQuestions.map(q => [q.id, q])
);

/**
 * Get question by ID (returns undefined if not found)
 */
export function getQuestionById(id: string): Question | undefined {
  return questionById.get(id);
}

/**
 * Questions grouped by category.
 * Useful for category-focused practice.
 */
export const questionsByCategory = new Map<Category, Question[]>();

for (const question of civicsQuestions) {
  const existing = questionsByCategory.get(question.category) ?? [];
  existing.push(question);
  questionsByCategory.set(question.category, existing);
}

/**
 * Get all questions for a specific category
 */
export function getQuestionsByCategory(category: Category): Question[] {
  return questionsByCategory.get(category) ?? [];
}

/**
 * Get all unique categories
 */
export function getAllCategories(): Category[] {
  return Array.from(questionsByCategory.keys());
}

// Re-export individual category arrays for targeted imports
export {
  americanGovernmentQuestions,
  colonialHistoryQuestions,
  history1800sQuestions,
  recentHistoryQuestions,
  rightsResponsibilitiesQuestions,
  symbolsHolidaysQuestions,
};
```

**2. Update src/constants/civicsQuestions.ts for backwards compatibility:**

Replace entire file with re-export:

```typescript
/**
 * @deprecated Import from '@/constants/questions' instead.
 * This file maintained for backwards compatibility.
 */
export { civicsQuestions } from './questions';
```

**3. Update imports in consuming files:**

In src/pages/TestPage.tsx, change:
```typescript
// Old:
import { civicsQuestions } from '@/constants/civicsQuestions';

// New:
import { civicsQuestions } from '@/constants/questions';
```

In src/pages/StudyGuidePage.tsx, change:
```typescript
// Old:
import { civicsQuestions } from '@/constants/civicsQuestions';

// New:
import { civicsQuestions, getQuestionsByCategory, getAllCategories } from '@/constants/questions';
```

**4. Update SupabaseAuthContext.tsx for string question IDs:**

The `question_id` field in mock_test_responses is stored in the database. Verify:
- If database stores as number, we need to handle conversion
- If database stores as string, update type definitions

In src/contexts/SupabaseAuthContext.tsx, ensure `questionId` is treated as string:
```typescript
// In mapResponses:
questionId: String(response.question_id), // Convert to string if DB stores as number
```

Or if we control the database schema, document that `question_id` should be string type.
  </action>
  <verify>
Run `npm run typecheck` - should pass with zero errors.
Run `npm run lint` - should pass.
Verify total question count: `civicsQuestions.length` should match original count.
Verify categorization: `questionsByCategory.size` should be 7 (all categories).
Manual test: Load /study page, verify questions display correctly.
Manual test: Start /test, verify questions work with new IDs.
  </verify>
  <done>Barrel file created, all imports updated, backwards compatibility maintained, question IDs now stable strings</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` - passes
2. `npm run lint` - passes
3. `civicsQuestions.length` equals original count (100+ questions)
4. `questionsByCategory.size` equals 7 (all categories present)
5. Each question has unique string ID (no duplicates)
6. ID format matches spec: GOV-P##, GOV-S##, HIST-C##, HIST-1##, HIST-R##, RR-##, SYM-##
7. StudyGuidePage loads and displays questions correctly
8. TestPage works with new question ID format
</verification>

<success_criteria>
- Questions split into 6 category files + 1 barrel file
- Each question has stable unique string ID
- Backwards-compatible export from civicsQuestions.ts
- Helper functions for lookup: questionById, questionsByCategory
- Zero impact on existing functionality
- Requirement FNDN-10 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-code-quality/01-05-SUMMARY.md`
</output>
