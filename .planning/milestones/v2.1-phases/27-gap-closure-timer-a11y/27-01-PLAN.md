---
phase: 27-gap-closure-timer-a11y
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/test/CircularTimer.tsx
  - src/pages/TestPage.tsx
autonomous: true
requirements:
  - A11Y-04
  - A11Y-05
gap_closure: true

must_haves:
  truths:
    - "Screen reader announces 5 minutes remaining when overall mock test timer reaches exactly 300 seconds"
    - "Screen reader announces 2 minutes remaining when overall mock test timer reaches exactly 120 seconds"
    - "Screen reader announces 1 minute remaining when overall mock test timer reaches exactly 60 seconds"
    - "Announcements fire regardless of whether the visual timer is hidden via the hide/show toggle"
    - "WCAG 2.2.1 timer extension exception is documented in a code comment referencing USCIS simulation essential timing"
  artifacts:
    - path: "src/components/test/CircularTimer.tsx"
      provides: "sr-only aria-live region for overall timer milestone announcements"
      contains: "aria-live"
    - path: "src/components/test/CircularTimer.tsx"
      provides: "WCAG 2.2.1 timer extension exception documentation"
      contains: "WCAG 2.2.1"
  key_links:
    - from: "src/components/test/CircularTimer.tsx"
      to: "remainingTime prop"
      via: "Derives announcement text from remainingTime at 300s, 120s, 60s thresholds"
      pattern: "remainingTime.*300|remainingTime.*120|remainingTime.*60"
    - from: "src/pages/TestPage.tsx"
      to: "src/components/test/CircularTimer.tsx"
      via: "Passes timeLeft as remainingTime prop"
      pattern: "remainingTime=\\{timeLeft\\}"
---

<objective>
Add screen reader announcements to the overall mock test countdown timer at milestone thresholds (5min, 2min, 1min), and document the WCAG 2.2.1 timer extension exception for the overall mock test timer.

Purpose: A11Y-04 requires screen reader announces timer status at key intervals. A11Y-05 requires timer extension to be either implemented or documented as an intentional exception. The per-question timer already has full accessibility (Phase 24). This plan addresses the OVERALL 20-minute mock test timer only.

Output: CircularTimer with sr-only aria-live announcements at exactly 5min/2min/1min, plus WCAG 2.2.1 exception documentation comment.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-gap-closure-timer-a11y/27-CONTEXT.md

@src/components/test/CircularTimer.tsx
@src/components/quiz/PerQuestionTimer.tsx (reference: sr-only aria-live pattern at lines 68-71, 128-131)
@src/pages/TestPage.tsx (consumer: passes timeLeft as remainingTime)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sr-only aria-live announcements to CircularTimer</name>
  <files>src/components/test/CircularTimer.tsx</files>
  <action>
Add screen reader milestone announcements to CircularTimer following the PerQuestionTimer pattern from Phase 24.

1. **Add announcement text derivation** (inside the component function, before the return):
   ```typescript
   // Milestone announcements for screen readers at 5min, 2min, 1min
   // Fires at exact threshold (not range) to avoid repeated announcements.
   // Content change triggers aria-live="assertive" announcement.
   const announcementText =
     remainingTime === 300 ? '5 minutes remaining' :
     remainingTime === 120 ? '2 minutes remaining' :
     remainingTime === 60 ? '1 minute remaining' :
     '';
   ```

   Key points:
   - Uses exact equality (`===`) not range — matches Phase 24 pattern where "sr-only announcement fires at exactly timeLeft === 5"
   - `remainingTime` changes every second, so each threshold value is hit exactly once
   - Simple derivation during render (no useRef flags needed) — same approach as PerQuestionTimer line 71
   - Text is English-only (no Burmese) — timer is numeric, screen readers handle numbers

2. **Add persistent sr-only div** at the END of the outer `<div>` return, OUTSIDE the `aria-hidden={isHidden}` wrapper (so it announces even when timer is visually hidden):
   ```tsx
   {/* Screen reader announcement at milestone thresholds (outside visual container so it works when timer is hidden) */}
   <span className="sr-only" aria-live="assertive" role="alert">
     {announcementText}
   </span>
   ```

   The sr-only span MUST be:
   - Outside the `aria-hidden={isHidden}` div (lines 94-128) so announcements work when timer is hidden
   - Outside AnimatePresence if any (Phase 24 established pattern: "Persistent sr-only div always in DOM")
   - Before the hide/show toggle button but after the timer display div

3. **Add WCAG 2.2.1 exception comment** at the top of the component (above the function signature or as a JSDoc addition):
   ```typescript
   /**
    * ...existing JSDoc...
    *
    * WCAG 2.2.1 Timer Extension Exception:
    * The overall mock test timer does NOT offer extension. This is an intentional
    * exception under WCAG 2.2.1 for "essential" timing — the 20-minute limit
    * simulates real USCIS naturalization interview conditions. Accommodations:
    * - Per-question timer already offers 50% extension (TimerExtensionToast)
    * - Practice mode has no overall time limit
    * - Timer can be visually hidden for anxiety reduction
    */
   ```

4. **Add role="timer" and aria-label** to the outer container div for the overall timer:
   ```tsx
   <div className="flex flex-col items-center gap-2" role="timer" aria-label={`${Math.floor(remainingTime / 60)} minutes ${remainingTime % 60} seconds remaining`}>
   ```
   This provides a continuous accessible label for the overall timer (matching PerQuestionTimer's role="timer" at line 79).
  </action>
  <verify>
1. `npm run typecheck` -- zero errors
2. `npm run test:run` -- all existing tests pass
3. `npm run build` -- production build succeeds
4. Code review: sr-only span with aria-live="assertive" exists outside the aria-hidden wrapper
5. Code review: announcementText checks exactly 300, 120, 60 (not ranges)
6. Code review: WCAG 2.2.1 exception comment references USCIS simulation essential timing
  </verify>
  <done>
CircularTimer has:
- sr-only aria-live="assertive" region that announces at exactly 5min (300s), 2min (120s), and 1min (60s) remaining
- Announcements work regardless of visual hide/show toggle state
- role="timer" with aria-label on outer container
- WCAG 2.2.1 exception documented in JSDoc comment
- No timer extension UI (documented as intentional USCIS simulation exception)
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` -- zero errors
2. `npm run test:run` -- all tests pass (no regressions)
3. `npm run build` -- production build succeeds
4. CircularTimer.tsx contains aria-live="assertive" sr-only span
5. Announcement text checks exactly 300, 120, 60 seconds
6. sr-only span is outside the aria-hidden={isHidden} div
7. WCAG 2.2.1 exception comment present
8. role="timer" with aria-label on outer container
</verification>

<success_criteria>
- Screen reader receives "5 minutes remaining" at exactly 5:00
- Screen reader receives "2 minutes remaining" at exactly 2:00
- Screen reader receives "1 minute remaining" at exactly 1:00
- Announcements fire even when timer is visually hidden
- WCAG 2.2.1 timer extension exception is documented with rationale
- All existing tests pass, typecheck clean, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/27-gap-closure-timer-a11y/27-01-SUMMARY.md`
</output>
