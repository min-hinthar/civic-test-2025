---
phase: 05-spaced-repetition
plan: 04
type: execute
wave: 3
depends_on: ["05-03"]
files_modified:
  - src/components/srs/AddToDeckButton.tsx
  - src/pages/StudyGuidePage.tsx
  - src/pages/TestPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can add a question to their SRS deck from the study guide"
    - "User can add a question to their SRS deck from the test review screen"
    - "User can remove a card from their deck via the same button"
    - "Button shows visual feedback indicating whether card is already in deck"
  artifacts:
    - path: "src/components/srs/AddToDeckButton.tsx"
      provides: "Toggle button for adding/removing questions from SRS deck"
      exports: ["AddToDeckButton"]
  key_links:
    - from: "src/components/srs/AddToDeckButton.tsx"
      to: "src/contexts/SRSContext.tsx"
      via: "useSRS() for addCard/removeCard/isInDeck"
      pattern: "useSRS\\(\\)"
    - from: "src/pages/StudyGuidePage.tsx"
      to: "src/components/srs/AddToDeckButton.tsx"
      via: "AddToDeckButton in question cards"
      pattern: "AddToDeckButton"
    - from: "src/pages/TestPage.tsx"
      to: "src/components/srs/AddToDeckButton.tsx"
      via: "AddToDeckButton in test review screen"
      pattern: "AddToDeckButton"
---

<objective>
Create the AddToDeckButton component and integrate it into the study guide and test review screen as the two user touchpoints for building their SRS deck.

Purpose: Users manually add questions to their review deck from the two places they encounter questions (per locked decision: study guide and test review screen are the two touchpoints).
Output: AddToDeckButton component integrated into StudyGuidePage and TestPage review screen.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-spaced-repetition/05-RESEARCH.md
@src/pages/StudyGuidePage.tsx
@src/pages/TestPage.tsx
@src/contexts/SRSContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AddToDeckButton component</name>
  <files>src/components/srs/AddToDeckButton.tsx</files>
  <action>
    Create `src/components/srs/AddToDeckButton.tsx`:

    **Props:**
    ```
    {
      questionId: string;
      compact?: boolean;      // Smaller version for inline use in test review
      className?: string;
      stopPropagation?: boolean;  // Prevent click bubbling (for use inside flip cards)
    }
    ```

    **Implementation:**
    - Use `useSRS()` to get `addCard`, `removeCard`, `isInDeck`
    - `const inDeck = isInDeck(questionId)`
    - Toggle behavior: if in deck, remove; if not, add
    - Show loading state during async operation (use local useState for isProcessing)

    **Visual design:**
    - Icon: `Plus` when not in deck, `Check` when in deck (from lucide-react)
    - Background: transparent when not in deck, `bg-primary-500/10` when in deck
    - Border: `border border-primary-500/30` when in deck, `border border-border` when not
    - Text: bilingual label
      - Not in deck: "Add to Review" / "ပြန်လှည့်ရန်ထည့်ပါ"
      - In deck: "In Review Deck" / "ပြန်လှည့်စာရင်းတွင်ရှိသည်"
    - Compact mode: icon-only button (no text), smaller size (32px), tooltip with text
    - Full mode: icon + text, min-h-[44px] touch target
    - Use motion/react for subtle scale animation on toggle (spring: stiffness 400, damping 17 per Phase 3 conventions)
    - Use `useLanguage().showBurmese` to conditionally show Burmese text

    **Click handler:**
    - If `stopPropagation`, call `e.stopPropagation()` on both click and keydown (same pattern as Phase 4 WhyButton in flashcards)
    - Toggle add/remove with optimistic UI (button changes immediately, async persists in background)
    - Show brief bilingual toast on add: "Added to review deck! / ပြန်လှည့်စာရင်းသို့ ထည့်ပြီးပါပြီ!" (using existing toast system)
    - No toast on remove (less disruptive)
  </action>
  <verify>
    - `pnpm exec tsc --noEmit` passes
    - Component renders without error
  </verify>
  <done>
    - AddToDeckButton toggles card in/out of SRS deck
    - Visual states clearly show whether card is in deck
    - Compact mode for inline test review use
    - Bilingual labels and toast feedback
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate AddToDeckButton into StudyGuidePage and TestPage</name>
  <files>
    src/pages/StudyGuidePage.tsx
    src/pages/TestPage.tsx
  </files>
  <action>
    1. **StudyGuidePage.tsx** -- Add AddToDeckButton in two places:

    a) In the **category question list** (the flip card grid, selectedCategory view around line 198-316):
       - Add `<AddToDeckButton questionId={question.id} stopPropagation />` next to the `QuestionAccuracyDot` in the front face header area (the `flex items-center justify-between gap-2` div around line 237-239)
       - Use compact mode here since it's inside a flip card

    b) In the **legacy flip-card grid** (around line 401-517):
       - Same placement: next to QuestionAccuracyDot in front face header
       - Compact mode, stopPropagation

    2. **TestPage.tsx** -- Add AddToDeckButton in the **test review screen**:
       - Find the review/results section (shown after test completion)
       - Add `<AddToDeckButton questionId={result.questionId} compact />` to each question result item in the review list
       - This is the second touchpoint per user decision
       - Place it near the question text, likely in a row with existing elements

    IMPORTANT: Wrap the click/keydown handlers with stopPropagation in the StudyGuidePage flip cards to prevent the button click from triggering the card flip. The pattern already exists with ExplanationCard in the same file (see line 297-299).
  </action>
  <verify>
    - `pnpm exec tsc --noEmit` passes
    - AddToDeckButton visible in study guide category view flip cards
    - AddToDeckButton visible in test review screen
    - Clicking AddToDeckButton in flip card does NOT flip the card
  </verify>
  <done>
    - Study guide has AddToDeckButton on each question card (both category view and legacy grid)
    - Test review screen has AddToDeckButton on each question result
    - stopPropagation prevents flip card interference
    - Two touchpoints for adding to deck are live (per locked decision)
  </done>
</task>

</tasks>

<verification>
- `pnpm exec tsc --noEmit` passes
- AddToDeckButton component exists and is used in both pages
- No ESLint errors
</verification>

<success_criteria>
- Users can add questions to SRS deck from study guide (touchpoint 1)
- Users can add questions to SRS deck from test review (touchpoint 2)
- Users can remove questions from deck via same button
- Button provides clear visual feedback of deck membership state
- Click events don't interfere with parent flip card interactions
</success_criteria>

<output>
After completion, create `.planning/phases/05-spaced-repetition/05-04-SUMMARY.md`
</output>
