---
phase: 05-spaced-repetition
plan: 05
type: execute
wave: 3
depends_on: ["05-03"]
files_modified:
  - src/components/srs/DeckManager.tsx
  - src/pages/StudyGuidePage.tsx
autonomous: true

must_haves:
  truths:
    - "User can view all cards in their SRS deck with status labels (New/Due/Done)"
    - "User can remove cards from their deck"
    - "User can bulk-add weak area questions to their deck"
    - "Deck management lives under Study Guide tab as a sub-view"
  artifacts:
    - path: "src/components/srs/DeckManager.tsx"
      provides: "Deck management page showing all cards with status and actions"
      exports: ["DeckManager"]
  key_links:
    - from: "src/components/srs/DeckManager.tsx"
      to: "src/contexts/SRSContext.tsx"
      via: "useSRS() for deck state"
      pattern: "useSRS\\(\\)"
    - from: "src/components/srs/DeckManager.tsx"
      to: "src/hooks/useSRSDeck.ts"
      via: "useSRSDeck for bulk operations"
      pattern: "useSRSDeck"
    - from: "src/pages/StudyGuidePage.tsx"
      to: "src/components/srs/DeckManager.tsx"
      via: "hash route #deck for deck view"
      pattern: "#deck"
---

<objective>
Create the DeckManager component and integrate it as a sub-view within the Study Guide page using hash routing.

Purpose: Users need a dedicated view to manage their review deck -- see card statuses, remove cards, and bulk-add weak area questions. Per locked decision: deck management lives under Study Guide tab.
Output: DeckManager component accessible via StudyGuidePage hash route #deck.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-spaced-repetition/05-RESEARCH.md
@src/pages/StudyGuidePage.tsx
@src/hooks/useSRSDeck.ts
@src/lib/mastery/weakAreaDetection.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DeckManager component</name>
  <files>src/components/srs/DeckManager.tsx</files>
  <action>
    Create `src/components/srs/DeckManager.tsx`:

    **Props:** `{ onStartReview: () => void; onBack: () => void }`

    **Data:**
    - Use `useSRSDeck()` for deck, dueCount, removeCard, bulkAddCards, getWeakQuestionIds, isLoading
    - Use `useCategoryMastery()` from existing Phase 4 hook for category mastery data
    - Look up question details from `civicsQuestions` for display

    **Layout:**
    - Header with back button ("Back to Study Guide / လေ့လာညွှန်းသို့"), deck title, and card counts
    - Stats bar: total cards, due cards, new cards (State.New), reviewed cards (State.Review)
    - "Start Review" button (prominent, primary variant): navigates to review session. Disabled if dueCount === 0. Shows due count in button text: "Review X Due Cards / X ကတ်ပြန်လှည့်ပါ"
    - Bulk-add section: "Add Weak Area Questions" button. Uses `getWeakQuestionIds(categoryMasteries)` to find weak questions not in deck. Shows count: "Add X weak questions / အားနည်းတဲ့မေးခွန်း X ခုထည့်ပါ". Disabled if no weak questions outside deck. Per discretion: support bulk-add.
    - Card list: grouped or flat list of all cards in deck

    **Card list items:**
    Each card shows:
    - Question text (English, Burmese below in muted)
    - Status label: use `getCardStatusLabel(card.card)` from fsrsEngine -- shows "New" (blue), "Due" (warning/orange), "Done" (success/green) with bilingual text
    - Interval strength indicator: colored dot using `getIntervalStrengthColor(card.card)` (red -> yellow -> green per locked decision)
    - Next review date: if card has been reviewed, show `getNextReviewText(card.card)` bilingual text
    - Remove button: X icon, calls `removeCard(questionId)`. Confirm with small "Remove?" text on first tap, execute on second (simple double-tap confirm, not a modal).

    **Empty state (per locked decision: context-aware):**
    - If deck is empty: encouraging message suggesting to add cards from study guide or test review. "Start building your review deck! Add questions from the study guide or after a test. / ပြန်လှည့်စာရင်း စတင်တည်ဆောက်ပါ!"
    - Link/button to go back to study guide categories

    **Sorting:** Due cards first, then New, then Done (reviewed with future due date). Within each group, sort by due date ascending.

    **Visual design:**
    - Use existing Card component for each deck item
    - StaggeredList for animated entry
    - Design tokens for all colors (no raw hex)
    - min-h-[44px] touch targets on all interactive elements
  </action>
  <verify>
    - `pnpm exec tsc --noEmit` passes
    - Component renders with empty deck (empty state)
    - Component renders with cards showing status labels
  </verify>
  <done>
    - DeckManager shows all cards with New/Due/Done labels and interval strength colors
    - Remove card functionality with simple confirmation
    - Bulk-add weak questions feature
    - Context-aware empty state
    - Start Review button with due count
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate DeckManager into StudyGuidePage via hash routing</name>
  <files>src/pages/StudyGuidePage.tsx</files>
  <action>
    1. Add hash route handling for `#deck` and `#review` in StudyGuidePage:
       - Existing hash routes: `#cards`, `#cards-{category}`, `#category-{name}`
       - Add: `#deck` for DeckManager view, `#review` for ReviewSession (to be built in later plan)
       - Parse: `const isDeckView = hash === '#deck'`
       - Parse: `const isReviewView = hash === '#review'`

    2. Add DeckManager view rendering:
       - When `isDeckView` is true, render DeckManager instead of other views
       - Pass `onBack={() => navigate('/study')}` to return to study guide
       - Pass `onStartReview={() => navigate('/study#review')}` to start a review session

    3. Add navigation entry point to deck view:
       - In the default category overview (bottom of the page, after "View All Flashcards" button), add a new section:
       - "Review Deck" button/card that navigates to `/study#deck`
       - Show due count badge on this button if there are due cards (use `useSRS().dueCount`)
       - Bilingual: "Review Deck / ပြန်လှည့်စာရင်း" with due count: "X cards due / X ကတ်ပြန်လှည့်ရန်"

    4. Render order in StudyGuidePage:
       - Check `isReviewView` first (return ReviewSession placeholder -- actual component in later plan, for now just render DeckManager with a note)
       - Check `isDeckView` next (return DeckManager)
       - Check `isCardsView` (existing)
       - Check `selectedCategory` (existing)
       - Default: category overview with new deck entry point

    IMPORTANT: Import DeckManager component. The ReviewSession component doesn't exist yet -- for the `#review` hash, temporarily redirect to `#deck` or show a "Coming soon" placeholder. Plan 07 will add the actual ReviewSession.
  </action>
  <verify>
    - `pnpm exec tsc --noEmit` passes
    - Navigating to `/study#deck` shows DeckManager
    - Study guide default view has "Review Deck" entry point
    - Back button in DeckManager returns to `/study`
  </verify>
  <done>
    - DeckManager accessible via /study#deck hash route
    - Study guide default view includes Review Deck entry point with due count badge
    - Hash routing extended to support #deck and #review views
    - Back navigation works correctly
  </done>
</task>

</tasks>

<verification>
- `pnpm exec tsc --noEmit` passes
- Navigate to /study -- see Review Deck entry point with due badge
- Navigate to /study#deck -- see DeckManager with card list
- No ESLint errors
</verification>

<success_criteria>
- Deck management page shows all cards with status labels (New/Due/Done) and interval strength colors
- Users can remove cards from deck
- Users can bulk-add weak area questions
- Deck lives under Study Guide tab (per locked decision)
- Context-aware empty state guides users to add cards
</success_criteria>

<output>
After completion, create `.planning/phases/05-spaced-repetition/05-05-SUMMARY.md`
</output>
