---
phase: 28-interview-ux-voice-flow-polish
plan: 07
type: execute
wave: 3
depends_on: [28-04, 28-05]
files_modified:
  - src/components/interview/InterviewSetup.tsx
  - src/components/interview/InterviewResults.tsx
  - src/pages/InterviewPage.tsx
autonomous: true
requirements: [IVPOL-04, IVPOL-05, IVPOL-06, IVPOL-10]
must_haves:
  truths:
    - "Interview setup shows last 3 scores and best score below mode selector"
    - "Interview results show keyword highlights for matched/missing keywords in transcript"
    - "InterviewPage passes pre-cache result and new props to InterviewSession"
    - "Practice exit confirmation dialog works correctly"
    - "Real mode results reveal score that was hidden during session"
  artifacts:
    - path: "src/components/interview/InterviewSetup.tsx"
      provides: "Enhanced setup with best score display"
    - path: "src/components/interview/InterviewResults.tsx"
      provides: "Results with keyword highlights in transcript"
    - path: "src/pages/InterviewPage.tsx"
      provides: "Page orchestrator with pre-cache flow"
  key_links:
    - from: "src/pages/InterviewPage.tsx"
      to: "src/components/interview/InterviewCountdown.tsx"
      via: "passes questionIds and includeBurmese for pre-caching"
      pattern: "InterviewCountdown"
    - from: "src/components/interview/InterviewResults.tsx"
      to: "src/components/interview/KeywordHighlight.tsx"
      via: "renders keyword highlights per transcript entry"
      pattern: "KeywordHighlight"
---

<objective>
Enhance the interview setup, results, and page orchestrator with Phase 28 features.

Purpose: The setup screen motivates users with score history, the results screen provides educational keyword feedback, and the page orchestrator wires the new countdown pre-caching flow.

Output: Enhanced InterviewSetup, InterviewResults, and InterviewPage
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/components/interview/InterviewSetup.tsx
@src/components/interview/InterviewResults.tsx
@src/components/interview/InterviewTranscript.tsx
@src/pages/InterviewPage.tsx
@.planning/phases/28-interview-ux-voice-flow-polish/28-04-SUMMARY.md
@.planning/phases/28-interview-ux-voice-flow-polish/28-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance InterviewSetup with best score and history</name>
  <files>src/components/interview/InterviewSetup.tsx</files>
  <action>
Modify `src/components/interview/InterviewSetup.tsx`:

1. **Best score highlight**: In the recent scores section, identify the best score (highest correct/total ratio) and highlight it
   - Best score chip gets a gold border: `border-2 border-amber-400`
   - Small crown or star icon next to best score
   - If no sessions exist, skip this (current empty state is fine)

2. **Score history improvements**:
   - Already shows last 5 recent sessions (good)
   - Per CONTEXT.md: "last 3 interview scores and best score" -- limit display to 3 + best
   - If best score is within the 3 most recent, show 3 with best highlighted
   - If best score is older, show 3 recent + 1 best with "Best:" prefix

3. **Network quality indicator on setup**:
   - Run `checkNetworkQuality()` in the setup useEffect
   - If 'slow': show subtle warning below the start button: "Slow connection detected. Audio may take longer to load."
   - If 'offline': show warning: "You're offline. Interview audio may use voice synthesis."
   - Use amber warning color for slow, red for offline

4. **Mic permission + text fallback messaging**:
   - When micPermission is 'denied': update the mic notice to include "You can still type your answers"
   - Detect iOS Safari (check UA for Safari + NOT Chrome + iPhone/iPad): add note "For voice input, try Chrome"
  </action>
  <verify>TypeScript compiles. Setup renders with score history and warnings.</verify>
  <done>InterviewSetup shows best score highlight, network quality warning, and improved mic fallback messaging</done>
</task>

<task type="auto">
  <name>Task 2: Enhance InterviewResults with keyword highlights</name>
  <files>src/components/interview/InterviewResults.tsx</files>
  <action>
Modify `src/components/interview/InterviewResults.tsx`:

1. **Keyword highlights in transcript**:
   - For each transcript entry that has grading data (matchedKeywords, missingKeywords):
     - Render `<KeywordHighlight>` component showing the user's answer with keywords highlighted
     - Show matched keywords in green, missing keywords as warning pills
   - Both Real and Practice mode results get keyword highlights (per CONTEXT.md decision)
   - Import `KeywordHighlight` from `@/components/interview/KeywordHighlight`

2. **Practice mode: answer audio in results**:
   - Each transcript entry for Practice mode: add a small SpeechButton/BurmeseSpeechButton to re-play the correct answer audio
   - This is already partially done (from Phase 22); ensure it works with the pre-cached audio

3. **Real mode reveal**:
   - Add a dramatic score reveal animation at the top of results for Real mode
   - Score was hidden during the session -- now show it prominently
   - Use the existing pass/fail determination and badge styling
   - Confetti/checkmark animation for pass (reuse existing celebration patterns)

4. **Bilingual keyword labels**:
   - "Matched:" / "Missing:" labels should have Burmese translations when showBurmese is true
   - Use strings from `@/lib/i18n/strings` or add new entries as needed
  </action>
  <verify>TypeScript compiles. Results show keyword highlights in transcript entries.</verify>
  <done>InterviewResults shows keyword highlights for all transcript entries, Real mode has score reveal</done>
</task>

<task type="auto">
  <name>Task 3: Update InterviewPage orchestrator</name>
  <files>src/pages/InterviewPage.tsx</files>
  <action>
Modify `src/pages/InterviewPage.tsx`:

1. **Pre-cache flow integration**:
   - After user starts interview (selects mode, clicks Start):
     - Generate the 20 question IDs (shuffle happens here already)
     - Store question IDs in state for passing to countdown
     - Pass `questionIds` and `includeBurmese` (from language context) to `InterviewCountdown`
   - `InterviewCountdown.onCacheComplete` stores the `PrecacheProgress` result in state
   - Pass `precacheResult` to `InterviewSession` when transitioning to session phase

2. **Practice exit confirmation**:
   - When InterviewSession fires exit request in Practice mode:
     - Save session progress (existing behavior)
     - Show confirmation dialog: "Are you sure? Your progress will be saved." with Continue/Exit buttons
   - When InterviewSession fires exit in Real mode (long-press):
     - Discard session (don't save)
     - Navigate home immediately

3. **Phase management**:
   - Current phases: 'setup' | 'countdown' | 'session' | 'results'
   - Ensure smooth transitions between phases
   - Pass all new props through: mode, precacheResult, questionIds
   - Handle `interviewActive` flag for hook activation (true only during 'session' phase)
  </action>
  <verify>TypeScript compiles. Page orchestrates the full interview flow with pre-caching.</verify>
  <done>InterviewPage orchestrates pre-cache during countdown, passes result to session, handles practice/real exit differently</done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- `npm run lint` passes
- `npm run build` produces no errors
</verification>

<success_criteria>
- Setup shows best score and network quality warnings
- Results show keyword highlights in transcript
- Page orchestrator manages pre-cache flow from countdown to session
- Practice and Real mode exit behaviors work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/28-interview-ux-voice-flow-polish/28-07-SUMMARY.md`
</output>
