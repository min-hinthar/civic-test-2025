---
phase: 06-interview-simulation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/index.ts
  - src/lib/interview/interviewStore.ts
  - src/lib/interview/interviewGreetings.ts
  - src/lib/interview/audioChime.ts
  - src/lib/interview/index.ts
  - src/lib/i18n/strings.ts
autonomous: true

must_haves:
  truths:
    - "Interview session types exist and are importable from @/types"
    - "Interview history persists in IndexedDB across page reloads"
    - "Interviewer greeting and closing text can be retrieved randomly"
    - "A chime sound plays via Web Audio API when called"
    - "All interview UI strings exist in bilingual format"
  artifacts:
    - path: "src/types/index.ts"
      provides: "InterviewMode, InterviewEndReason, InterviewResult, InterviewSession types"
      contains: "InterviewSession"
    - path: "src/lib/interview/interviewStore.ts"
      provides: "IndexedDB CRUD for interview sessions"
      exports: ["getInterviewHistory", "saveInterviewSession"]
    - path: "src/lib/interview/interviewGreetings.ts"
      provides: "Randomized greeting/closing text arrays"
      exports: ["INTERVIEWER_GREETINGS", "CLOSING_PASS", "CLOSING_FAIL"]
    - path: "src/lib/interview/audioChime.ts"
      provides: "Programmatic chime via Web Audio API OscillatorNode"
      exports: ["playChime"]
    - path: "src/lib/interview/index.ts"
      provides: "Barrel exports for interview lib"
    - path: "src/lib/i18n/strings.ts"
      provides: "Bilingual interview strings"
      contains: "interview"
  key_links:
    - from: "src/lib/interview/interviewStore.ts"
      to: "idb-keyval"
      via: "createStore, get, set"
      pattern: "createStore.*civic-prep-interview"
    - from: "src/lib/interview/interviewStore.ts"
      to: "src/types/index.ts"
      via: "import InterviewSession"
      pattern: "import.*InterviewSession"
---

<objective>
Create the foundation layer for Phase 6: Interview Simulation.

Purpose: Establish all types, data stores, text content, and audio utilities that every subsequent plan depends on. This is the shared infrastructure that enables the interview setup, session, and results to be built independently.

Output: TypeScript types for interview sessions, IndexedDB persistence layer, interviewer greeting/closing text, programmatic chime generator, and bilingual i18n strings for the entire interview feature.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-interview-simulation/06-CONTEXT.md
@.planning/phases/06-interview-simulation/06-RESEARCH.md

@src/types/index.ts
@src/lib/mastery/masteryStore.ts
@src/lib/srs/srsStore.ts
@src/lib/i18n/strings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Interview types and IndexedDB store</name>
  <files>
    src/types/index.ts
    src/lib/interview/interviewStore.ts
    src/lib/interview/index.ts
  </files>
  <action>
    1. Add interview types to `src/types/index.ts` (append after existing TestSession/User types):
       - `InterviewMode = 'realistic' | 'practice'`
       - `InterviewEndReason = 'passThreshold' | 'failThreshold' | 'complete' | 'quit'`
       - `InterviewResult` interface with: questionId (string), questionText_en (string), questionText_my (string), correctAnswers (Array of {text_en, text_my} from studyAnswers), selfGrade ('correct' | 'incorrect'), category (Category)
       - `InterviewSession` interface with: id? (string), date (string), mode (InterviewMode), score (number), totalQuestions (number), durationSeconds (number), passed (boolean), endReason (InterviewEndReason), results (InterviewResult[])

    2. Create `src/lib/interview/interviewStore.ts` following the idb-keyval pattern from masteryStore.ts:
       - Use `createStore('civic-prep-interview', 'sessions')` for dedicated IndexedDB database
       - Key: `'interview-sessions'`
       - `getInterviewHistory(): Promise<InterviewSession[]>` - returns array, newest first
       - `saveInterviewSession(session: InterviewSession): Promise<void>` - unshift to front of array, then set
       - `clearInterviewHistory(): Promise<void>` - for testing/dev purposes, sets empty array

    3. Create `src/lib/interview/index.ts` barrel export re-exporting everything from interviewStore, interviewGreetings, and audioChime.
  </action>
  <verify>Run `npx tsc --noEmit` to confirm types compile. Verify the interviewStore functions are exported correctly from the barrel.</verify>
  <done>InterviewSession and related types importable from @/types. IndexedDB store for interview history is functional with get/save/clear operations. Barrel export re-exports all interview lib modules.</done>
</task>

<task type="auto">
  <name>Task 2: Interviewer greetings, audio chime, and bilingual strings</name>
  <files>
    src/lib/interview/interviewGreetings.ts
    src/lib/interview/audioChime.ts
    src/lib/i18n/strings.ts
  </files>
  <action>
    1. Create `src/lib/interview/interviewGreetings.ts`:
       - Export `INTERVIEWER_GREETINGS: string[]` with 3 USCIS-style greeting variations (English only, matching real interview):
         - "Good morning. I'm going to ask you some questions about U.S. history and government. Please answer to the best of your ability."
         - "Hello. Today I'll be asking you some questions about United States civics. Please listen carefully and answer each question."
         - "Welcome. I'm going to read you some questions about American government and history. Please give your best answer to each one."
       - Export `CLOSING_PASS: string[]` with 2 variations:
         - "Congratulations. You have successfully completed the civics portion of your interview. Well done."
         - "Great job. You've passed the civics test. You should be very proud of your preparation."
       - Export `CLOSING_FAIL: string[]` with 2 variations:
         - "Thank you for your effort today. You can retake this test to continue preparing for your interview."
         - "Don't be discouraged. Many people need extra practice. You can try again when you're ready."
       - Export `getRandomGreeting(): string` - picks random from INTERVIEWER_GREETINGS
       - Export `getClosingStatement(passed: boolean): string` - picks random from CLOSING_PASS or CLOSING_FAIL

    2. Create `src/lib/interview/audioChime.ts`:
       - Module-level `audioContext: AudioContext | null = null` (lazy init per user decision to avoid autoplay policy)
       - Export `playChime(): void`:
         - Create AudioContext lazily on first call
         - Call `audioContext.resume()` if state is 'suspended' (required for some browsers)
         - Create OscillatorNode with sine wave at 880 Hz (A5 note)
         - Create GainNode starting at 0.3, exponential ramp to 0.001 over 0.5 seconds
         - Connect osc -> gain -> destination
         - Start immediately, stop after 0.5 seconds
         - Wrap in try-catch so chime failure never breaks the interview flow

    3. Add interview strings section to `src/lib/i18n/strings.ts`:
       Under a new `interview` key, add bilingual strings for:
       - `practiceInterview: { en: 'Practice Interview', my: 'အင်တာဗျူးလေ့ကျင့်မှု' }`
       - `realisticMode: { en: 'Realistic Interview', my: 'လက်တွေ့အင်တာဗျူး' }`
       - `practiceMode: { en: 'Practice Interview', my: 'လေ့ကျင့်အင်တာဗျူး' }`
       - `startInterview: { en: 'Start Interview', my: 'အင်တာဗျူးစတင်ပါ' }`
       - `showAnswer: { en: 'Show Answer', my: 'အဖြေပြပါ' }`
       - `correct: { en: 'Correct', my: 'မှန်ပါတယ်' }`
       - `incorrect: { en: 'Incorrect', my: 'မှားပါတယ်' }`
       - `nextQuestion: { en: 'Next Question', my: 'နောက်မေးခွန်း' }`
       - `whatToExpect: { en: 'What to Expect', my: 'ဘာကိုမျှော်လင့်ရမလဲ' }`
       - `recentScores: { en: 'Recent Scores', my: 'မကြာသေးမီရမှတ်များ' }`
       - `interviewResults: { en: 'Interview Results', my: 'အင်တာဗျူးရလဒ်များ' }`
       - `passed: { en: 'Passed', my: 'အောင်မြင်ပါတယ်' }`
       - `failed: { en: 'Did Not Pass', my: 'မအောင်မြင်ပါ' }`
       - `replaysUsed: { en: 'replays used', my: 'ပြန်ဖွင့်မှုအကြိမ်' }`
       - `alsoAccepted: { en: 'Also accepted', my: 'လက်ခံနိုင်သောအဖြေများ' }`
       - `yourAnswer: { en: 'Your Recording', my: 'သင့်အသံဖမ်းမှု' }`
       - `realisticTip: { en: 'Like the real USCIS interview. 15 seconds per question.', my: 'တကယ့် USCIS အင်တာဗျူးကဲ့သို့။ မေးခွန်းတစ်ခုလျှင် ၁၅ စက္ကန့်။' }`
       - `practiceTip: { en: 'Self-paced with explanations. Take your time.', my: 'ရှင်းလင်းချက်များနှင့်အတူ သင့်အချိန်ယူပါ။' }`
       - `speechRate: { en: 'Speech Rate', my: 'စကားပြောနှုန်း' }`
       - `slow: { en: 'Slow', my: 'နှေးနှေး' }`
       - `normal: { en: 'Normal', my: 'ပုံမှန်' }`
       - `fast: { en: 'Fast', my: 'မြန်မြန်' }`
       - `interviewHistory: { en: 'Interviews', my: 'အင်တာဗျူးများ' }`

       Also add to `nav` section:
       - `practiceInterview: { en: 'Interview', my: 'အင်တာဗျူး' }`
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no type errors. Verify `playChime` is callable without errors. Verify strings.interview object has all required keys.</verify>
  <done>Three randomized USCIS-style greetings and pass/fail closings exportable. Programmatic chime plays a 0.5s sine wave via Web Audio API. All interview bilingual strings are centralized in the strings object.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. InterviewSession type is importable: `import type { InterviewSession } from '@/types'`
3. Interview store functions work: `import { getInterviewHistory, saveInterviewSession } from '@/lib/interview'`
4. Greeting functions return strings: `getRandomGreeting()` returns non-empty string
5. `playChime()` executes without throwing (may not produce sound in test env)
6. `strings.interview.startInterview.en === 'Start Interview'`
7. `strings.nav.practiceInterview.en === 'Interview'`
</verification>

<success_criteria>
All interview foundation types, stores, utilities, and strings compile cleanly and are importable from their respective modules. No new npm dependencies required.
</success_criteria>

<output>
After completion, create `.planning/phases/06-interview-simulation/06-01-SUMMARY.md`
</output>
