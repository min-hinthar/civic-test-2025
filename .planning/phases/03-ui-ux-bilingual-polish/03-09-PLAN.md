---
phase: 03-ui-ux-bilingual-polish
plan: 09
type: execute
wave: 4
depends_on: ["03-01", "03-03", "03-08"]
files_modified:
  - src/styles/globals.css
  - src/components/ui/LanguageToggle.tsx
  - src/contexts/LanguageContext.tsx
  - src/components/AppNavigation.tsx
  - src/pages/SettingsPage.tsx
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "Dark mode has proper contrast for all feedback colors"
    - "Blue shades work in dark mode (inverted for readability)"
    - "User can toggle English-only practice mode"
    - "Language preference persists across sessions"
    - "Quick language toggle accessible in header"
  artifacts:
    - path: "src/contexts/LanguageContext.tsx"
      provides: "Language preference context and hook"
      exports: ["LanguageProvider", "useLanguage"]
    - path: "src/components/ui/LanguageToggle.tsx"
      provides: "Quick toggle for English-only mode"
      exports: ["LanguageToggle"]
  key_links:
    - from: "src/components/AppNavigation.tsx"
      to: "src/components/ui/LanguageToggle.tsx"
      via: "Header toggle"
      pattern: "LanguageToggle"
    - from: "src/App.tsx"
      to: "src/contexts/LanguageContext.tsx"
      via: "Context provider"
      pattern: "LanguageProvider"
---

<objective>
Complete dark mode polish and add English-only practice mode for USCIS interview simulation.

Purpose: Dark mode must look intentional with proper contrast. English-only mode lets users practice under real interview conditions (USCIS asks questions in English only).

Output: Polished dark mode CSS, LanguageContext for preference management, LanguageToggle component.
</objective>

<execution_context>
@C:\Users\minkk\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\minkk\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-ui-ux-bilingual-polish/03-CONTEXT.md
@src/styles/globals.css
@src/components/AppNavigation.tsx
@src/pages/SettingsPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Polish dark mode CSS variables</name>
  <files>
    src/styles/globals.css
  </files>
  <action>
Read `src/styles/globals.css` and update the `.dark` section to ensure proper contrast.

Key changes to the dark mode CSS variables:

```css
.dark {
  /* Base colors - ensure good contrast */
  --background: 222 47% 11%;
  --foreground: 210 40% 98%;

  /* Card and popover surfaces - slightly lighter than background */
  --card: 222 47% 14%;
  --card-foreground: 210 40% 98%;

  --popover: 222 47% 14%;
  --popover-foreground: 210 40% 98%;

  /* Primary blue shades - inverted for dark mode readability */
  --primary-50: 224 71% 15%;
  --primary-100: 224 68% 20%;
  --primary-200: 223 65% 28%;
  --primary-300: 220 62% 38%;
  --primary-400: 218 70% 50%;
  --primary-500: 217 85% 60%;
  --primary-600: 215 90% 68%;
  --primary-700: 213 95% 76%;
  --primary-800: 212 97% 84%;
  --primary-900: 211 100% 92%;

  /* Primary uses the 500 shade (brighter in dark mode) */
  --primary: 217 85% 60%;
  --primary-foreground: 222 47% 11%;

  /* Muted - subtle backgrounds */
  --muted: 217 33% 17%;
  --muted-foreground: 215 20% 65%;

  /* Accent */
  --accent: 217 33% 20%;
  --accent-foreground: 210 40% 98%;

  /* Destructive - keep visible */
  --destructive: 0 63% 55%;
  --destructive-foreground: 210 40% 98%;

  /* Success - slightly brighter in dark mode */
  --success: 142 71% 50%;
  --success-foreground: 222 47% 11%;

  /* Warning (soft orange) - brighter in dark mode */
  --warning: 32 95% 58%;
  --warning-foreground: 222 47% 11%;

  /* Border and input */
  --border: 217 33% 25%;
  --input: 217 33% 20%;
  --ring: 217 85% 60%;
}
```

Also add specific dark mode overrides for feedback states:

```css
/* Dark mode feedback color overrides */
.dark .bg-success-50 {
  background-color: hsl(142 71% 15% / 0.3);
}

.dark .bg-warning-50 {
  background-color: hsl(32 95% 20% / 0.3);
}

.dark .border-success-500 {
  border-color: hsl(142 71% 50%);
}

.dark .border-warning-500 {
  border-color: hsl(32 95% 58%);
}

/* Ensure text remains readable on colored backgrounds in dark mode */
.dark .bg-primary-500 {
  background-color: hsl(217 85% 55%);
}

.dark .text-primary-500 {
  color: hsl(217 85% 65%);
}

.dark .shadow-primary-500\/25 {
  box-shadow: 0 10px 40px -10px hsl(217 85% 60% / 0.25);
}

/* Card shadows in dark mode - more subtle */
.dark .shadow-lg {
  box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
}

/* Skeleton shimmer in dark mode */
.dark .skeleton-shimmer {
  background: linear-gradient(
    90deg,
    hsl(217 33% 17%) 0%,
    hsl(217 33% 25%) 50%,
    hsl(217 33% 17%) 100%
  );
  background-size: 200% 100%;
}
```
  </action>
  <verify>
Toggle dark mode.
Check that cards have visible borders.
Check that success (green) and warning (orange) are visible.
Check that text on primary buttons is readable.
Check that skeleton shimmer is visible.
  </verify>
  <done>
Dark mode CSS properly polished with contrast-appropriate colors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LanguageContext and LanguageToggle</name>
  <files>
    src/contexts/LanguageContext.tsx
    src/components/ui/LanguageToggle.tsx
  </files>
  <action>
Create `src/contexts/LanguageContext.tsx`:

```typescript
'use client';

import {
  createContext,
  useContext,
  useState,
  useCallback,
  useEffect,
  ReactNode,
} from 'react';

type LanguageMode = 'bilingual' | 'english-only';

interface LanguageContextValue {
  /** Current language mode */
  mode: LanguageMode;
  /** Whether to show Burmese text */
  showBurmese: boolean;
  /** Toggle between bilingual and english-only */
  toggleMode: () => void;
  /** Set specific mode */
  setMode: (mode: LanguageMode) => void;
}

const LanguageContext = createContext<LanguageContextValue | null>(null);

const STORAGE_KEY = 'civic-test-language-mode';

/**
 * Language preference provider.
 *
 * Features:
 * - Persists preference to localStorage
 * - English-only mode for USCIS interview simulation
 * - SSR-safe with lazy initialization
 */
export function LanguageProvider({ children }: { children: ReactNode }) {
  const [mode, setModeState] = useState<LanguageMode>(() => {
    if (typeof window === 'undefined') return 'bilingual';
    const stored = localStorage.getItem(STORAGE_KEY);
    return (stored as LanguageMode) || 'bilingual';
  });

  const showBurmese = mode === 'bilingual';

  const setMode = useCallback((newMode: LanguageMode) => {
    setModeState(newMode);
    localStorage.setItem(STORAGE_KEY, newMode);
  }, []);

  const toggleMode = useCallback(() => {
    setMode(mode === 'bilingual' ? 'english-only' : 'bilingual');
  }, [mode, setMode]);

  // Sync with localStorage on mount (SSR hydration fix)
  useEffect(() => {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored && stored !== mode) {
      setModeState(stored as LanguageMode);
    }
  }, []);

  return (
    <LanguageContext.Provider value={{ mode, showBurmese, toggleMode, setMode }}>
      {children}
    </LanguageContext.Provider>
  );
}

/**
 * Hook to access language preferences.
 */
export function useLanguage(): LanguageContextValue {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useLanguage must be used within LanguageProvider');
  }
  return context;
}
```

Create `src/components/ui/LanguageToggle.tsx`:

```typescript
'use client';

import { motion } from 'motion/react';
import { Languages } from 'lucide-react';
import { clsx } from 'clsx';
import { useLanguage } from '@/contexts/LanguageContext';
import { useReducedMotion } from '@/hooks/useReducedMotion';

interface LanguageToggleProps {
  /** Size variant */
  size?: 'sm' | 'md';
  /** Show label */
  showLabel?: boolean;
  /** Additional class names */
  className?: string;
}

/**
 * Quick toggle for English-only practice mode.
 *
 * Features:
 * - Toggle between bilingual and english-only
 * - Visual indicator of current mode
 * - Tooltip explaining the feature
 * - Animated switch
 */
export function LanguageToggle({
  size = 'md',
  showLabel = false,
  className,
}: LanguageToggleProps) {
  const { mode, showBurmese, toggleMode } = useLanguage();
  const shouldReduceMotion = useReducedMotion();

  const sizeClasses = {
    sm: 'h-8 px-2',
    md: 'h-10 px-3',
  };

  return (
    <button
      onClick={toggleMode}
      className={clsx(
        'relative inline-flex items-center gap-2 rounded-full',
        'bg-muted/50 hover:bg-muted transition-colors',
        'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500',
        sizeClasses[size],
        className
      )}
      aria-label={showBurmese ? 'Switch to English only' : 'Switch to bilingual'}
      title={
        showBurmese
          ? 'Currently: Bilingual (English + Burmese)\nClick for English-only practice'
          : 'Currently: English only (USCIS simulation)\nClick for bilingual mode'
      }
    >
      <Languages className="h-4 w-4 text-muted-foreground" />

      {/* Mode indicator */}
      <div className="flex items-center gap-1">
        <span
          className={clsx(
            'text-xs font-medium transition-colors',
            showBurmese ? 'text-primary-500' : 'text-muted-foreground'
          )}
        >
          EN
        </span>
        <motion.div
          className="relative h-5 w-9 rounded-full bg-muted-foreground/20"
          animate={{
            backgroundColor: showBurmese
              ? 'hsl(217 85% 60% / 0.2)'
              : 'hsl(var(--muted-foreground) / 0.2)',
          }}
          transition={{ duration: shouldReduceMotion ? 0 : 0.2 }}
        >
          <motion.div
            className="absolute top-0.5 h-4 w-4 rounded-full bg-primary-500 shadow-sm"
            animate={{
              left: showBurmese ? 18 : 2,
            }}
            transition={
              shouldReduceMotion
                ? { duration: 0 }
                : { type: 'spring', stiffness: 500, damping: 30 }
            }
          />
        </motion.div>
        <span
          className={clsx(
            'text-xs font-medium font-myanmar transition-colors',
            showBurmese ? 'text-primary-500' : 'text-muted-foreground'
          )}
        >
          မြန်မာ
        </span>
      </div>

      {showLabel && (
        <span className="text-xs text-muted-foreground hidden sm:inline">
          {showBurmese ? 'Bilingual' : 'English only'}
        </span>
      )}
    </button>
  );
}

/**
 * Compact language toggle for mobile header
 */
export function LanguageToggleCompact({ className }: { className?: string }) {
  const { showBurmese, toggleMode } = useLanguage();

  return (
    <button
      onClick={toggleMode}
      className={clsx(
        'flex items-center justify-center h-10 w-10 rounded-full',
        'bg-muted/50 hover:bg-muted transition-colors',
        'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500',
        className
      )}
      aria-label={showBurmese ? 'Switch to English only' : 'Switch to bilingual'}
    >
      <Languages className="h-5 w-5 text-muted-foreground" />
      {!showBurmese && (
        <span className="absolute -top-1 -right-1 h-3 w-3 rounded-full bg-warning-500 border-2 border-background" />
      )}
    </button>
  );
}
```
  </action>
  <verify>
Import LanguageProvider and wrap app.
Import LanguageToggle and render in header.
Click toggle - should switch between bilingual and english-only.
Reload page - preference should persist.
  </verify>
  <done>
LanguageContext and LanguageToggle for English-only practice mode.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate language toggle into navigation and settings</name>
  <files>
    src/components/AppNavigation.tsx
    src/pages/SettingsPage.tsx
    src/App.tsx
  </files>
  <action>
Update `src/App.tsx` to wrap with LanguageProvider:

```typescript
import { LanguageProvider } from '@/contexts/LanguageContext';

// In the render, wrap with LanguageProvider (inside Router, outside other providers)
<Router>
  <LanguageProvider>
    <ThemeProvider>
      {/* ... rest of app */}
    </ThemeProvider>
  </LanguageProvider>
</Router>
```

Update `src/components/AppNavigation.tsx`:

1. Import the toggle:
```typescript
import { LanguageToggleCompact } from '@/components/ui/LanguageToggle';
```

2. Add the toggle in the header actions (near ThemeToggle):
```tsx
<div className="flex items-center gap-2">
  <LanguageToggleCompact />
  <ThemeToggle />
  {/* ... rest of actions */}
</div>
```

3. Add `data-tour="theme-toggle"` to the ThemeToggle button.

Update `src/pages/SettingsPage.tsx`:

Add a full language settings section:

```tsx
import { useLanguage } from '@/contexts/LanguageContext';
import { LanguageToggle } from '@/components/ui/LanguageToggle';
import { BilingualHeading, SectionHeading } from '@/components/bilingual/BilingualHeading';
import { Card, CardHeader, CardContent } from '@/components/ui/Card';

// In the component:
const { mode, showBurmese, setMode } = useLanguage();

// Add language settings section:
<section className="mb-8">
  <SectionHeading
    text={{ en: 'Language Settings', my: 'ဘာသာစကားဆက်တင်များ' }}
  />

  <Card>
    <CardContent className="space-y-4">
      <div className="flex items-center justify-between">
        <div>
          <p className="font-medium text-foreground">Display Mode</p>
          <p className="text-sm text-muted-foreground">
            Choose between bilingual or English-only display
          </p>
        </div>
        <LanguageToggle showLabel />
      </div>

      <div className="pt-4 border-t border-border">
        <p className="text-sm text-muted-foreground mb-2">
          <strong>English-only mode</strong> simulates the real USCIS interview where questions are asked in English only.
          This helps practice under test conditions.
        </p>
        <p className="text-sm text-muted-foreground font-myanmar">
          <strong>အင်္ဂလိပ်သီးသန့်မုဒ်</strong>က တကယ့်USCIS အင်တာဗျူးကိုတူစေပါတယ်။ စာမေးပွဲအခြေအနေအတိုင်းလေ့ကျင့်ရန်ဖြစ်ပါသည်။
        </p>
      </div>
    </CardContent>
  </Card>
</section>
```
  </action>
  <verify>
Check header shows language toggle icon.
Click toggle - verify it switches mode.
Navigate to Settings page.
Verify full language settings section with explanation.
Toggle in settings - should sync with header toggle.
  </verify>
  <done>
Language toggle integrated into header and settings page.
  </done>
</task>

</tasks>

<verification>
1. `pnpm run build` completes without errors
2. Dark mode shows proper contrast on all elements
3. Green (success) and orange (warning) are visible in dark mode
4. Language toggle appears in header
5. Clicking toggle switches between bilingual and english-only
6. Preference persists after page reload
7. Settings page has full language settings section
8. English-only mode hides Burmese text throughout app
</verification>

<success_criteria>
- Dark mode CSS has proper contrast for all colors
- Success/warning colors visible in both modes
- Card shadows appropriate for dark mode
- LanguageContext persists preference to localStorage
- LanguageToggle shows visual mode indicator
- Header has compact language toggle
- Settings page has full language controls with explanation
- English-only mode works for USCIS simulation practice
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-ui-ux-bilingual-polish/03-09-SUMMARY.md`
</output>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 3 UI/UX polish including:
- Dark mode with proper contrast
- Language toggle for English-only practice mode
- All pages updated with new components
  </what-built>
  <how-to-verify>
1. Open app in browser at http://localhost:3000
2. Toggle dark mode - verify all colors look intentional
3. Check feedback colors in test (green=correct, orange=wrong)
4. Click language toggle in header
5. Verify Burmese text hides/shows throughout app
6. Complete a test - verify circular timer, confetti, count-up
7. Check study guide flashcards flip with 3D animation
8. Navigate between pages - verify slide transitions
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual issues</resume-signal>
</task>
