---
phase: 18-language-mode
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ErrorBoundary.tsx
  - src/components/study/Flashcard3D.tsx
  - src/components/study/FlashcardStack.tsx
  - src/components/test/AnswerFeedback.tsx
  - src/components/test/CircularTimer.tsx
  - src/components/srs/DeckManager.tsx
  - src/components/social/ShareCardPreview.tsx
  - src/components/update/WhatsNewModal.tsx
  - src/components/ui/Progress.tsx
autonomous: true

must_haves:
  truths:
    - "ErrorBoundary hides Burmese text in English-only mode"
    - "Flashcard3D hides all Burmese card content in English-only mode"
    - "FlashcardStack hides Burmese text in English-only mode"
    - "AnswerFeedback hides Burmese text in English-only mode"
    - "CircularTimer hides Burmese text in English-only mode"
    - "DeckManager hides all Burmese labels and content in English-only mode"
    - "ShareCardPreview hides Burmese text in English-only mode"
    - "WhatsNewModal hides Burmese text in English-only mode"
    - "Progress component hides Burmese label text in English-only mode"
  artifacts:
    - path: "src/components/study/Flashcard3D.tsx"
      provides: "Flashcard with language-mode-aware Burmese rendering"
    - path: "src/components/srs/DeckManager.tsx"
      provides: "Deck manager with language-mode-aware labels"
  key_links:
    - from: "all 9 files"
      to: "src/contexts/LanguageContext.tsx"
      via: "useLanguage() hook import"
      pattern: "useLanguage"
---

<objective>
Audit and fix 9 component files that render font-myanmar text without showBurmese guards. Each file needs: import useLanguage, destructure showBurmese, wrap every font-myanmar text block with {showBurmese && ...}.

Purpose: English-only mode must show zero Burmese text. These 9 files currently render Burmese unconditionally.

Output: 9 updated component files with proper showBurmese guards on all font-myanmar text.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@src/contexts/LanguageContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add showBurmese guards to study, test, and SRS components</name>
  <files>
    src/components/study/Flashcard3D.tsx
    src/components/study/FlashcardStack.tsx
    src/components/test/AnswerFeedback.tsx
    src/components/test/CircularTimer.tsx
    src/components/srs/DeckManager.tsx
  </files>
  <action>
For each file, apply this systematic process:

1. **Check if `useLanguage` is already imported**. If not, add: `import { useLanguage } from '@/contexts/LanguageContext';`
2. **Call `useLanguage()`** in the component body: `const { showBurmese } = useLanguage();`
   - For components that are class-based or don't have direct access to hooks (e.g., ErrorBoundary), use a wrapper pattern or pass showBurmese as a prop from parent.
3. **Find every `font-myanmar` occurrence** in the file
4. **Wrap each with `{showBurmese && ...}`** if not already guarded

Specific file details:

**Flashcard3D.tsx** (5 occurrences):
- This file has the `DynamicAnswerNote` component exported from it. Check if DynamicAnswerNote renders Burmese -- if so, it needs a guard too.
- Wrap all 5 `font-myanmar` text blocks with `{showBurmese && ...}`
- If the component already receives `showBurmese` as a prop instead of using the hook, use the prop.

**FlashcardStack.tsx** (1 occurrence):
- Single font-myanmar render. Add useLanguage import and guard.

**AnswerFeedback.tsx** (3 occurrences):
- Three Burmese text renders. Add useLanguage import and wrap all three.

**CircularTimer.tsx** (1 occurrence):
- Single Burmese text. Add useLanguage import and guard.
- Note: CircularTimer may be a presentational component that receives props. If so, add `showBurmese` prop instead of importing the hook. Check the component's existing interface.

**DeckManager.tsx** (8 occurrences):
- Largest file in this batch. Add useLanguage import and wrap all 8 occurrences.
- DeckManager may have nested subcomponents. Ensure each subcomponent either uses the hook directly or receives showBurmese as a prop.

IMPORTANT:
- Do NOT use `useMemo<T>()` generic syntax
- Do NOT access refs during render
- For each file, run a final check: grep for `font-myanmar` and verify every occurrence is inside a `showBurmese` conditional
  </action>
  <verify>
- `npx tsc --noEmit` passes
- For each file: `grep -c "font-myanmar"` count matches `grep -c "showBurmese"` count (every font-myanmar should have a corresponding showBurmese guard)
- All 5 files import and use useLanguage or receive showBurmese as prop
  </verify>
  <done>Flashcard3D, FlashcardStack, AnswerFeedback, CircularTimer, and DeckManager all respect language mode.</done>
</task>

<task type="auto">
  <name>Task 2: Add showBurmese guards to ErrorBoundary, ShareCard, WhatsNew, Progress</name>
  <files>
    src/components/ErrorBoundary.tsx
    src/components/social/ShareCardPreview.tsx
    src/components/update/WhatsNewModal.tsx
    src/components/ui/Progress.tsx
  </files>
  <action>
Apply the same systematic process for each file:

**ErrorBoundary.tsx** (1 occurrence):
- ErrorBoundary is likely a class component (class-based error boundaries). If so, it CANNOT use hooks directly.
- Solution: Create a small functional wrapper or use a render prop / HOC pattern. Alternatively, check if it's already a functional component with `useErrorBoundary` or similar.
- If class component: The Burmese message text (line ~157) needs to be conditionally rendered. Options:
  a. Pass `showBurmese` from a parent context consumer wrapper
  b. Create an inner functional component that reads useLanguage and renders the error content
  c. Read localStorage directly: `localStorage.getItem('civic-test-language-mode') !== 'english-only'`
- Option (c) is simplest for error boundaries since they run in edge cases. Use it.

**ShareCardPreview.tsx** (2 occurrences):
- This renders a share card image preview. Add useLanguage import and wrap Burmese text with showBurmese guards.
- NOTE: If ShareCardPreview renders to a canvas or generates an image, the Burmese text should still be conditionally rendered based on mode (the shared image should match the user's language preference).

**WhatsNewModal.tsx** (4 occurrences):
- What's new changelog modal. Add useLanguage import and wrap all 4 Burmese texts.

**Progress.tsx** (1 occurrence):
- Single Burmese label. Add useLanguage import and guard.
- Note: Progress.tsx is a UI primitive. If it receives the label as a prop (not hardcoded), the parent already controls whether Burmese is passed. Check if the font-myanmar text is in a hardcoded string or a prop render.
- If Progress is a generic component that just applies font-myanmar class, the fix may need to be in the parent instead. Investigate the actual usage.

IMPORTANT: For ErrorBoundary, use the simplest approach that works with class components. Don't over-engineer it.
  </action>
  <verify>
- `npx tsc --noEmit` passes
- All 4 files have their font-myanmar text properly guarded
- ErrorBoundary's approach works with class component constraints
- ShareCardPreview respects language mode for share images
  </verify>
  <done>ErrorBoundary, ShareCardPreview, WhatsNewModal, and Progress all respect language mode.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npm run lint` passes
- For all 9 files: every `font-myanmar` CSS class usage is inside a `showBurmese` conditional block
- Run: `grep -rl "font-myanmar" src/components/ErrorBoundary.tsx src/components/study/ src/components/test/AnswerFeedback.tsx src/components/test/CircularTimer.tsx src/components/srs/DeckManager.tsx src/components/social/ShareCardPreview.tsx src/components/update/WhatsNewModal.tsx src/components/ui/Progress.tsx | xargs grep -L "showBurmese"` -- should return empty (all files now have showBurmese)
</verification>

<success_criteria>
- All 9 files import useLanguage (or use equivalent) and guard font-myanmar text with showBurmese
- Zero unconditional Burmese text renders in these 9 files
- No TypeScript or ESLint errors
- ErrorBoundary handles the class component limitation gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/18-language-mode/18-06-SUMMARY.md`
</output>
