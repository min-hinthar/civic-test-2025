---
phase: 18-language-mode
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/pwa/InstallPrompt.tsx
  - src/components/pwa/IOSTip.tsx
  - src/components/pwa/NotificationPrePrompt.tsx
  - src/components/pwa/NotificationSettings.tsx
  - src/components/pwa/WelcomeModal.tsx
  - src/components/onboarding/OnboardingTour.tsx
  - src/components/onboarding/WelcomeScreen.tsx
  - src/pages/AuthPage.tsx
  - src/pages/LandingPage.tsx
  - src/pages/PasswordResetPage.tsx
  - src/pages/PasswordUpdatePage.tsx
autonomous: true

must_haves:
  truths:
    - "PWA install prompts hide Burmese text in English-only mode"
    - "iOS tip hides Burmese text in English-only mode"
    - "Notification prompts hide Burmese text in English-only mode"
    - "Welcome modal hides Burmese text in English-only mode"
    - "Onboarding tour hides Burmese text in English-only mode"
    - "Welcome screen hides Burmese text in English-only mode"
    - "Auth page hides Burmese text in English-only mode"
    - "Landing page hides Burmese text in English-only mode"
    - "Password reset page hides Burmese text in English-only mode"
    - "Password update page hides Burmese text in English-only mode"
  artifacts:
    - path: "src/pages/LandingPage.tsx"
      provides: "Landing page with 14 font-myanmar occurrences properly guarded"
    - path: "src/pages/AuthPage.tsx"
      provides: "Auth page with 8 font-myanmar occurrences properly guarded"
  key_links:
    - from: "all 11 files"
      to: "src/contexts/LanguageContext.tsx"
      via: "useLanguage() hook import"
      pattern: "useLanguage"
---

<objective>
Audit and fix 11 files that render font-myanmar text without showBurmese guards: 5 PWA components, 2 onboarding components, and 4 page-level components. 58 total font-myanmar occurrences to guard.

Purpose: English-only mode must show zero Burmese text everywhere -- including PWA prompts, onboarding flows, auth pages, and the landing page.

Output: 11 updated files with proper showBurmese guards on all font-myanmar text.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@src/contexts/LanguageContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add showBurmese guards to PWA and onboarding components</name>
  <files>
    src/components/pwa/InstallPrompt.tsx
    src/components/pwa/IOSTip.tsx
    src/components/pwa/NotificationPrePrompt.tsx
    src/components/pwa/NotificationSettings.tsx
    src/components/pwa/WelcomeModal.tsx
    src/components/onboarding/OnboardingTour.tsx
    src/components/onboarding/WelcomeScreen.tsx
  </files>
  <action>
For each of the 7 files, apply this systematic process:

1. **Check if `useLanguage` is already imported**. If not, add: `import { useLanguage } from '@/contexts/LanguageContext';`
2. **Call `useLanguage()`** in the component body: `const { showBurmese } = useLanguage();`
3. **Find every `font-myanmar` occurrence** using grep
4. **Wrap each with `{showBurmese && ...}`** if not already guarded

Specific counts:
- **InstallPrompt.tsx**: 4 occurrences
- **IOSTip.tsx**: 2 occurrences
- **NotificationPrePrompt.tsx**: 2 occurrences
- **NotificationSettings.tsx**: 5 occurrences
- **WelcomeModal.tsx**: 4 occurrences
- **OnboardingTour.tsx**: 7 occurrences. NOTE: OnboardingTour may define step content as a data array with both `.en` and `.my` text. If the tour content is defined as an array of objects, ensure the rendering of `.my` text is gated by `showBurmese`.
- **WelcomeScreen.tsx**: 3 occurrences

**Context provider concern**: PWA components (InstallPrompt, IOSTip, etc.) and onboarding components may render OUTSIDE the main app tree (e.g., in portals or before LanguageProvider mounts). If `useLanguage()` throws because there's no provider:
- Check the component tree in `_app.tsx` to verify LanguageProvider wraps these components
- If not wrapped, use a try-catch wrapper or read localStorage directly:
  ```typescript
  const showBurmese = typeof window !== 'undefined'
    ? localStorage.getItem('civic-test-language-mode') !== 'english-only'
    : true;
  ```
- This fallback is simpler for edge-case components that may render before the provider.

**For OnboardingTour**: If the tour uses react-joyride, the step content might be JSX or strings. For JSX content, wrap Burmese text with `{showBurmese && ...}`. For string content, use ternary: `showBurmese ? 'English / မြန်မာ' : 'English'`.

IMPORTANT:
- Do NOT use `useMemo<T>()` generic syntax
- Do NOT access refs during render
  </action>
  <verify>
- `npx tsc --noEmit` passes
- For each file: grep for `font-myanmar` and verify every occurrence is inside a `showBurmese` conditional
- All 7 files have showBurmese guards
  </verify>
  <done>All 7 PWA and onboarding components respect language mode with proper showBurmese guards.</done>
</task>

<task type="auto">
  <name>Task 2: Add showBurmese guards to auth and page-level components</name>
  <files>
    src/pages/AuthPage.tsx
    src/pages/LandingPage.tsx
    src/pages/PasswordResetPage.tsx
    src/pages/PasswordUpdatePage.tsx
  </files>
  <action>
For each of the 4 page files:

1. **Import useLanguage**: `import { useLanguage } from '@/contexts/LanguageContext';`
2. **Call in component**: `const { showBurmese } = useLanguage();`
3. **Guard all font-myanmar text**: Wrap each occurrence with `{showBurmese && ...}`

Specific counts:
- **AuthPage.tsx**: 8 occurrences. This page has sign-in/sign-up forms with bilingual labels and descriptions.
- **LandingPage.tsx**: 14 occurrences (largest in this batch). This is the public landing page with hero section, feature descriptions, CTAs -- all bilingual.
- **PasswordResetPage.tsx**: 4 occurrences
- **PasswordUpdatePage.tsx**: 5 occurrences

**LandingPage special consideration**: The landing page may be the first page users see. In English-only mode, it should show clean English-only content. In Myanmar mode, it shows bilingual content. Since this page has 14 occurrences, be thorough and systematic -- check every line.

**Auth pages context concern**: Auth pages render on `/auth` routes which might be before user preference is set. The default is `bilingual` (from LanguageContext initialization), so new users see bilingual content by default. This is correct per the user decision (default mode = Myanmar/bilingual).

**Pattern for each font-myanmar block:**
```tsx
// BEFORE (unconditional):
<p className="font-myanmar text-sm text-muted-foreground">
  မြန်မာ text here
</p>

// AFTER (guarded):
{showBurmese && (
  <p className="font-myanmar text-sm text-muted-foreground">
    မြန်မာ text here
  </p>
)}
```

**For inline bilingual strings** like "Sign In / ဝင်ရန်":
```tsx
// BEFORE:
<span>Sign In / ဝင်ရန်</span>

// AFTER:
<span>{showBurmese ? 'Sign In / ဝင်ရန်' : 'Sign In'}</span>
```

After each file is done, run a verification grep to ensure ALL font-myanmar occurrences are guarded.
  </action>
  <verify>
- `npx tsc --noEmit` passes
- For each file: every `font-myanmar` class is inside a `showBurmese` conditional
- Run: `grep -rl "font-myanmar" src/pages/AuthPage.tsx src/pages/LandingPage.tsx src/pages/PasswordResetPage.tsx src/pages/PasswordUpdatePage.tsx | xargs grep -L "showBurmese"` returns empty
  </verify>
  <done>All 4 page-level components (AuthPage, LandingPage, PasswordResetPage, PasswordUpdatePage) respect language mode.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npm run lint` passes
- For all 11 files: every `font-myanmar` CSS class usage is inside a `showBurmese` conditional block
- Run: `grep -rl "font-myanmar" src/components/pwa/ src/components/onboarding/ src/pages/AuthPage.tsx src/pages/LandingPage.tsx src/pages/PasswordResetPage.tsx src/pages/PasswordUpdatePage.tsx | xargs grep -L "showBurmese"` returns empty
- CRITICAL FINAL CHECK: Run `grep -rl "font-myanmar" src/ --include="*.tsx" --include="*.ts" | xargs grep -L "showBurmese"` -- should return ZERO files (all font-myanmar files now have showBurmese)
</verification>

<success_criteria>
- All 11 files import useLanguage (or equivalent) and guard font-myanmar text with showBurmese
- Zero unconditional Burmese text renders in any of these files
- After this plan + Plan 06, the entire codebase has zero files with font-myanmar that lack showBurmese guards
- No TypeScript or ESLint errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-language-mode/18-07-SUMMARY.md`
</output>
