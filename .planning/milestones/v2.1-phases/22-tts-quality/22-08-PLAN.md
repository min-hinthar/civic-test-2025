---
phase: 22-tts-quality
plan: 08
type: execute
wave: 4
depends_on: [22-05, 22-07]
files_modified:
  - src/components/interview/InterviewSession.tsx
  - src/components/interview/InterviewSetup.tsx
  - src/components/interview/InterviewResults.tsx
autonomous: true

must_haves:
  truths:
    - "Interview always auto-reads questions regardless of global auto-read toggle"
    - "Practice mode respects user's selected speed; Real mode uses fixed normal speed"
    - "Practice mode in Myanmar mode: English question then Burmese audio"
    - "Real mode: English only regardless of language mode"
    - "Interview uses user's selected English voice"
  artifacts:
    - path: "src/components/interview/InterviewSession.tsx"
      provides: "Speed override, always-auto-read, Burmese audio in Practice/Myanmar mode"
  key_links:
    - from: "src/components/interview/InterviewSession.tsx"
      to: "src/hooks/useTTS.ts"
      via: "speak() with speed override and voice selection"
      pattern: "speak|speedOverride"
    - from: "src/components/interview/InterviewSession.tsx"
      to: "src/lib/audio/burmeseAudio.ts"
      via: "createBurmesePlayer for Myanmar mode Practice"
      pattern: "burmesePlayer|getBurmeseAudioUrl"
---

<objective>
Integrate TTS quality features into the interview session: always-auto-read (examiner simulation), speed override from InterviewSetup, Practice mode Burmese audio in Myanmar mode, and Real mode English-only enforcement.

Purpose: Interview simulation feels authentic with examiner voice at user-selected speed (Practice) or standard speed (Real), with Burmese support in Practice mode for Myanmar mode users.
Output: InterviewSession with speed override, always-auto-read, conditional Burmese audio.
</objective>

<execution_context>
@C:/Users/minkk/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/minkk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/22-tts-quality/22-RESEARCH.md
@.planning/phases/22-tts-quality/22-05-SUMMARY.md

@src/components/interview/InterviewSession.tsx
@src/components/interview/InterviewSetup.tsx
@src/components/interview/InterviewResults.tsx
@src/hooks/useTTS.ts
@src/lib/audio/burmeseAudio.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add speed override and always-auto-read to InterviewSession</name>
  <files>src/components/interview/InterviewSession.tsx, src/components/interview/InterviewSetup.tsx</files>
  <action>
**InterviewSetup.tsx:**
1. Ensure the speedOverride from the pre-screen (Plan 22-05) is correctly forwarded when starting the session
2. The session start callback should include: `{ mode: 'practice' | 'real', speedOverride: sessionSpeed }`
3. Real mode always uses 'normal' speed (ignore user selection)

**InterviewSession.tsx:**
1. Accept `speedOverride?: 'slow' | 'normal' | 'fast'` prop
2. Determine effective speed:
   ```
   const effectiveSpeed = mode === 'real' ? 'normal' : (speedOverride ?? tts.rate);
   const numericRate = { slow: 0.7, normal: 0.98, fast: 1.3 }[effectiveSpeed];
   ```
3. The interview already auto-reads questions via its phase machine (`safeSpeakLocal`). Do NOT use the `useAutoRead` hook here (per research recommendation -- interview has its own phase machine that controls when speech happens).
4. Instead, ensure the existing `safeSpeakLocal` / `speak()` calls pass the correct rate:
   - Find where `speak()` is called for question reading
   - Pass `{ rate: numericRate }` as the rate override
5. Interview always auto-reads regardless of the global `autoRead` toggle. No changes needed for this since the interview phase machine already calls speak() on each question -- it's inherently auto-read.
6. The user's selected English voice is already used because TTSContext's engine respects the `preferredVoice` setting. Verify this is the case -- the engine uses `findVoice()` which checks `preferredVoiceName` from settings.
  </action>
  <verify>
`npx tsc --noEmit` passes.
`npx eslint src/components/interview/InterviewSession.tsx src/components/interview/InterviewSetup.tsx` passes.
  </verify>
  <done>
InterviewSession accepts speed override, enforces normal speed in Real mode, respects user speed in Practice mode. Auto-read is inherent to the phase machine (no useAutoRead hook needed).
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Burmese audio to Practice mode in Myanmar mode</name>
  <files>src/components/interview/InterviewSession.tsx, src/components/interview/InterviewResults.tsx</files>
  <action>
**InterviewSession.tsx - Practice mode Burmese audio:**
1. Import `createBurmesePlayer`, `getBurmeseAudioUrl` from `@/lib/audio/burmeseAudio`
2. Import `useLanguage` for `showBurmese`
3. In Practice mode AND Myanmar mode (`showBurmese && mode === 'practice'`):
   - After the English TTS finishes speaking a question, play the Burmese audio
   - Create a module-scoped or ref-based Burmese player instance
   - After `await speak(questionText, { rate: numericRate })` resolves, call:
     ```
     if (showBurmese && mode === 'practice') {
       const url = getBurmeseAudioUrl(questionId, 'q', tts.burmeseVoice);
       await burmesePlayer.play(url, numericRate);
     }
     ```
   - This creates the "English then Burmese" flow per user decision
4. In Real mode: English only, no Burmese audio regardless of language mode
5. In Practice mode, add BurmeseSpeechButton in the chat UI for the examiner's question messages (visible only in Myanmar mode):
   - After each question chat bubble, show a small Myanmar flag button that replays the Burmese audio
6. Clean up Burmese player on unmount

**InterviewResults.tsx:**
1. If transcript review shows question text, add BurmeseSpeechButton alongside English speech button (Myanmar mode only)
2. Speed label on speech buttons using the session's effective speed

**Error handling:**
- If Burmese audio fails to load (network issue, file missing), catch the error silently and continue. Do not block the interview flow. The user can still hear the English version.
- Log a console.debug for debugging but no user-facing error for interview auto-read failures.
  </action>
  <verify>
`npx tsc --noEmit` passes.
`npx eslint src/components/interview/InterviewSession.tsx src/components/interview/InterviewResults.tsx` passes.
`npm run build` succeeds.
  </verify>
  <done>
Practice mode in Myanmar mode plays English then Burmese for each question. Real mode plays English only. BurmeseSpeechButton appears in chat bubbles for replay. Results screen has Burmese replay buttons. Errors handled gracefully without blocking interview flow.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npx tsc --noEmit` passes
3. `npm run lint` passes
4. Interview Practice mode: questions auto-read at user-selected speed
5. Interview Real mode: questions auto-read at normal speed (ignoring user override)
6. Interview Practice + Myanmar mode: English then Burmese audio sequence
7. Interview Real + Myanmar mode: English only
8. Burmese audio failure doesn't block interview
</verification>

<success_criteria>
- Practice mode: speed override applied to speak() calls
- Real mode: fixed normal speed regardless of user setting
- Practice + Myanmar: English TTS followed by Burmese MP3 for each question
- Real + Myanmar: English only (no Burmese audio)
- BurmeseSpeechButton in chat bubbles (Practice mode, Myanmar mode)
- Burmese audio errors are silent (no blocking, no toast)
- Selected English voice used throughout (from TTSSettings)
</success_criteria>

<output>
After completion, create `.planning/phases/22-tts-quality/22-08-SUMMARY.md`
</output>
